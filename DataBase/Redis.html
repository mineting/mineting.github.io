<!doctype html>
<html lang="en-US" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.67" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://vuepress-theme-hope-docs-MineTing.netlify.app/DataBase/Redis.html"><meta property="og:site_name" content="Docs Demo"><meta property="og:title" content="Redis"><meta property="og:description" content="Redis æŠ€æœ¯å‘å±• æŠ€æœ¯çš„åˆ†ç±»ï¼š 1. è§£å†³åŠŸèƒ½æ€§çš„é—®é¢˜ï¼šJavaã€Jspã€RDBMSã€Tomcatã€HTMLã€Linuxã€JDBCã€SVN ç­‰ 2. è§£å†³æ‰©å±•æ€§çš„é—®é¢˜ï¼šStrutsã€Springã€SpringMVCã€Hibernateã€Mybatis ç­‰ 3. è§£å†³æ€§èƒ½çš„é—®é¢˜ï¼šNOSQLã€Threadã€Hadoopã€Nginxã€MQã€Elastic..."><meta property="og:type" content="article"><meta property="og:image" content="https://vuepress-theme-hope-docs-MineTing.netlify.app/"><meta property="og:locale" content="en-US"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image:alt" content="Redis"><meta property="article:author" content="MineTing"><meta property="article:published_time" content="2023-03-17T00:00:00.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Redis","image":["https://vuepress-theme-hope-docs-MineTing.netlify.app/"],"datePublished":"2023-03-17T00:00:00.000Z","dateModified":null,"author":[{"@type":"Person","name":"MineTing"}]}</script><title>Redis | Docs Demo</title><meta name="description" content="Redis æŠ€æœ¯å‘å±• æŠ€æœ¯çš„åˆ†ç±»ï¼š 1. è§£å†³åŠŸèƒ½æ€§çš„é—®é¢˜ï¼šJavaã€Jspã€RDBMSã€Tomcatã€HTMLã€Linuxã€JDBCã€SVN ç­‰ 2. è§£å†³æ‰©å±•æ€§çš„é—®é¢˜ï¼šStrutsã€Springã€SpringMVCã€Hibernateã€Mybatis ç­‰ 3. è§£å†³æ€§èƒ½çš„é—®é¢˜ï¼šNOSQLã€Threadã€Hadoopã€Nginxã€MQã€Elastic...">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-d97197b4.css" as="style"><link rel="stylesheet" href="/assets/style-d97197b4.css">
    <link rel="modulepreload" href="/assets/app-ae2ce5af.js"><link rel="modulepreload" href="/assets/Redis.html-1871171c.js"><link rel="modulepreload" href="/assets/Redis.html-5593bcac.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-c27b6911.js"><link rel="prefetch" href="/assets/slides.html-d4b68ae3.js" as="script"><link rel="prefetch" href="/assets/MySQL.html-2c3189d9.js" as="script"><link rel="prefetch" href="/assets/Oracle.html-1ddfb32a.js" as="script"><link rel="prefetch" href="/assets/PostgreSQL.html-8d7c3b11.js" as="script"><link rel="prefetch" href="/assets/ActiveMQ.html-7e36c817.js" as="script"><link rel="prefetch" href="/assets/Dubbo.html-a8cd7449.js" as="script"><link rel="prefetch" href="/assets/Effective Java.html-dfcd6599.js" as="script"><link rel="prefetch" href="/assets/Elasticsearch.html-e5846d2c.js" as="script"><link rel="prefetch" href="/assets/Gis.html-ddd37e0c.js" as="script"><link rel="prefetch" href="/assets/Git-Svn.html-af5d4a81.js" as="script"><link rel="prefetch" href="/assets/Http.html-8daf18da.js" as="script"><link rel="prefetch" href="/assets/Interview.html-1b10aa33.js" as="script"><link rel="prefetch" href="/assets/JavaSE.html-9f047d15.js" as="script"><link rel="prefetch" href="/assets/JavaWeb.html-cb212caf.js" as="script"><link rel="prefetch" href="/assets/JVM.html-f072d845.js" as="script"><link rel="prefetch" href="/assets/Kafka.html-25bd84a0.js" as="script"><link rel="prefetch" href="/assets/Maven-Gradle.html-d83ac95f.js" as="script"><link rel="prefetch" href="/assets/Mybatis.html-885e6e8d.js" as="script"><link rel="prefetch" href="/assets/MybatisPlus.html-598dfbea.js" as="script"><link rel="prefetch" href="/assets/Netty.html-8c02d0e8.js" as="script"><link rel="prefetch" href="/assets/Nginx.html-5aa9d1fb.js" as="script"><link rel="prefetch" href="/assets/RabbitMQ.html-0d6d977e.js" as="script"><link rel="prefetch" href="/assets/RocketMQ.html-49e403fa.js" as="script"><link rel="prefetch" href="/assets/ServerLess.html-e22cee80.js" as="script"><link rel="prefetch" href="/assets/Shiro.html-5d17df5c.js" as="script"><link rel="prefetch" href="/assets/Spring.html-97965d72.js" as="script"><link rel="prefetch" href="/assets/SpringBoot2.html-c86a37b5.js" as="script"><link rel="prefetch" href="/assets/SpringCloud.html-9a245adc.js" as="script"><link rel="prefetch" href="/assets/SpringMVC.html-0cc84083.js" as="script"><link rel="prefetch" href="/assets/SpringSecurity.html-f1ecb2f4.js" as="script"><link rel="prefetch" href="/assets/Zookeeper.html-796b6238.js" as="script"><link rel="prefetch" href="/assets/å¤šçº¿ç¨‹ä¸å¹¶å‘ç¼–ç¨‹.html-db7a7ee6.js" as="script"><link rel="prefetch" href="/assets/å¸¸è§åœºæ™¯å®ç°.html-45d3f82e.js" as="script"><link rel="prefetch" href="/assets/æ“ä½œç³»ç»Ÿ.html-4f78fb7f.js" as="script"><link rel="prefetch" href="/assets/æ•°æ®ç»“æ„ä¸ç®—æ³•.html-08698f6d.js" as="script"><link rel="prefetch" href="/assets/è®¡ç®—æœºç½‘ç»œ.html-b52dc063.js" as="script"><link rel="prefetch" href="/assets/è®¾è®¡æ¨¡å¼.html-21d367ac.js" as="script"><link rel="prefetch" href="/assets/Basic.html-2e318635.js" as="script"><link rel="prefetch" href="/assets/Docker.html-25a77026.js" as="script"><link rel="prefetch" href="/assets/KubeSphere.html-9567c249.js" as="script"><link rel="prefetch" href="/assets/Python.html-1e966dd9.js" as="script"><link rel="prefetch" href="/assets/HtmlCSS.html-7dd20864.js" as="script"><link rel="prefetch" href="/assets/JavaScript.html-7c696a30.js" as="script"><link rel="prefetch" href="/assets/jQuery.html-2a1066fa.js" as="script"><link rel="prefetch" href="/assets/React.html-5412a153.js" as="script"><link rel="prefetch" href="/assets/Vue.html-85fe9f9e.js" as="script"><link rel="prefetch" href="/assets/index.html-67b15fdc.js" as="script"><link rel="prefetch" href="/assets/slides.html-8c03d836.js" as="script"><link rel="prefetch" href="/assets/Notifition.html-ac544339.js" as="script"><link rel="prefetch" href="/assets/disable.html-2dea8664.js" as="script"><link rel="prefetch" href="/assets/encrypt.html-abf55e88.js" as="script"><link rel="prefetch" href="/assets/markdown.html-175f2004.js" as="script"><link rel="prefetch" href="/assets/page.html-0e44d074.js" as="script"><link rel="prefetch" href="/assets/index.html-a29f879c.js" as="script"><link rel="prefetch" href="/assets/index.html-b73e550e.js" as="script"><link rel="prefetch" href="/assets/baz.html-2cb41f02.js" as="script"><link rel="prefetch" href="/assets/index.html-969443a6.js" as="script"><link rel="prefetch" href="/assets/ray.html-62ce5fc6.js" as="script"><link rel="prefetch" href="/assets/index.html-9b626ed8.js" as="script"><link rel="prefetch" href="/assets/404.html-9df708ff.js" as="script"><link rel="prefetch" href="/assets/index.html-f1ef565e.js" as="script"><link rel="prefetch" href="/assets/index.html-7dc05b06.js" as="script"><link rel="prefetch" href="/assets/index.html-94fd5f7d.js" as="script"><link rel="prefetch" href="/assets/index.html-c580c463.js" as="script"><link rel="prefetch" href="/assets/index.html-2e8ee3a7.js" as="script"><link rel="prefetch" href="/assets/index.html-bc51f108.js" as="script"><link rel="prefetch" href="/assets/index.html-de8bd102.js" as="script"><link rel="prefetch" href="/assets/slides.html-35427f3a.js" as="script"><link rel="prefetch" href="/assets/MySQL.html-b4c05c5f.js" as="script"><link rel="prefetch" href="/assets/Oracle.html-31a22ec5.js" as="script"><link rel="prefetch" href="/assets/PostgreSQL.html-4b3a9fee.js" as="script"><link rel="prefetch" href="/assets/ActiveMQ.html-17e2f150.js" as="script"><link rel="prefetch" href="/assets/Dubbo.html-f1ccf506.js" as="script"><link rel="prefetch" href="/assets/Effective Java.html-611a5b80.js" as="script"><link rel="prefetch" href="/assets/Elasticsearch.html-6a52bfc3.js" as="script"><link rel="prefetch" href="/assets/Gis.html-8abfec19.js" as="script"><link rel="prefetch" href="/assets/Git-Svn.html-52d9c4f5.js" as="script"><link rel="prefetch" href="/assets/Http.html-be7a915b.js" as="script"><link rel="prefetch" href="/assets/Interview.html-e7be77bf.js" as="script"><link rel="prefetch" href="/assets/JavaSE.html-0e3b628d.js" as="script"><link rel="prefetch" href="/assets/JavaWeb.html-41d4b249.js" as="script"><link rel="prefetch" href="/assets/JVM.html-dbd72723.js" as="script"><link rel="prefetch" href="/assets/Kafka.html-944c972c.js" as="script"><link rel="prefetch" href="/assets/Maven-Gradle.html-d8008567.js" as="script"><link rel="prefetch" href="/assets/Mybatis.html-ce0c0db3.js" as="script"><link rel="prefetch" href="/assets/MybatisPlus.html-2c5b8712.js" as="script"><link rel="prefetch" href="/assets/Netty.html-d9e9600f.js" as="script"><link rel="prefetch" href="/assets/Nginx.html-98042356.js" as="script"><link rel="prefetch" href="/assets/RabbitMQ.html-789fcfb2.js" as="script"><link rel="prefetch" href="/assets/RocketMQ.html-076b5dec.js" as="script"><link rel="prefetch" href="/assets/ServerLess.html-0737dc3b.js" as="script"><link rel="prefetch" href="/assets/Shiro.html-e3093d4f.js" as="script"><link rel="prefetch" href="/assets/Spring.html-2ac4675c.js" as="script"><link rel="prefetch" href="/assets/SpringBoot2.html-7ab29a5b.js" as="script"><link rel="prefetch" href="/assets/SpringCloud.html-05fe7030.js" as="script"><link rel="prefetch" href="/assets/SpringMVC.html-748abb3f.js" as="script"><link rel="prefetch" href="/assets/SpringSecurity.html-e9f6acd6.js" as="script"><link rel="prefetch" href="/assets/Zookeeper.html-5d8329d4.js" as="script"><link rel="prefetch" href="/assets/å¤šçº¿ç¨‹ä¸å¹¶å‘ç¼–ç¨‹.html-f6dbec75.js" as="script"><link rel="prefetch" href="/assets/å¸¸è§åœºæ™¯å®ç°.html-8f6b3fa9.js" as="script"><link rel="prefetch" href="/assets/æ“ä½œç³»ç»Ÿ.html-5bc15ff2.js" as="script"><link rel="prefetch" href="/assets/æ•°æ®ç»“æ„ä¸ç®—æ³•.html-3c552842.js" as="script"><link rel="prefetch" href="/assets/è®¡ç®—æœºç½‘ç»œ.html-1a1a87f0.js" as="script"><link rel="prefetch" href="/assets/è®¾è®¡æ¨¡å¼.html-5c7c95ef.js" as="script"><link rel="prefetch" href="/assets/Basic.html-a2d2fe60.js" as="script"><link rel="prefetch" href="/assets/Docker.html-6d4eaef8.js" as="script"><link rel="prefetch" href="/assets/KubeSphere.html-3728deb9.js" as="script"><link rel="prefetch" href="/assets/Python.html-347ee1e7.js" as="script"><link rel="prefetch" href="/assets/HtmlCSS.html-fc50e4d3.js" as="script"><link rel="prefetch" href="/assets/JavaScript.html-b05d397f.js" as="script"><link rel="prefetch" href="/assets/jQuery.html-1c4e954d.js" as="script"><link rel="prefetch" href="/assets/React.html-d9b1e002.js" as="script"><link rel="prefetch" href="/assets/Vue.html-0b3d4dd9.js" as="script"><link rel="prefetch" href="/assets/index.html-acb676ad.js" as="script"><link rel="prefetch" href="/assets/slides.html-40da5346.js" as="script"><link rel="prefetch" href="/assets/Notifition.html-42cb38d5.js" as="script"><link rel="prefetch" href="/assets/disable.html-3b8c1244.js" as="script"><link rel="prefetch" href="/assets/encrypt.html-57f5861e.js" as="script"><link rel="prefetch" href="/assets/markdown.html-a2e16149.js" as="script"><link rel="prefetch" href="/assets/page.html-fee4dd0d.js" as="script"><link rel="prefetch" href="/assets/index.html-a5e39405.js" as="script"><link rel="prefetch" href="/assets/index.html-a7c9ad07.js" as="script"><link rel="prefetch" href="/assets/baz.html-e3cf3d89.js" as="script"><link rel="prefetch" href="/assets/index.html-b7cc2189.js" as="script"><link rel="prefetch" href="/assets/ray.html-295aa4c2.js" as="script"><link rel="prefetch" href="/assets/index.html-cc65b46d.js" as="script"><link rel="prefetch" href="/assets/404.html-3ea6dd0d.js" as="script"><link rel="prefetch" href="/assets/index.html-df589b5a.js" as="script"><link rel="prefetch" href="/assets/index.html-fe03f011.js" as="script"><link rel="prefetch" href="/assets/index.html-0a3b162f.js" as="script"><link rel="prefetch" href="/assets/index.html-f0a5ac48.js" as="script"><link rel="prefetch" href="/assets/index.html-37711430.js" as="script"><link rel="prefetch" href="/assets/index.html-68e0b571.js" as="script"><link rel="prefetch" href="/assets/index.html-2c257328.js" as="script"><link rel="prefetch" href="/assets/auto-fe80bb03.js" as="script"><link rel="prefetch" href="/assets/index-2bf332f6.js" as="script"><link rel="prefetch" href="/assets/flowchart-c441f34d.js" as="script"><link rel="prefetch" href="/assets/mermaid.core-e67e6523.js" as="script"><link rel="prefetch" href="/assets/highlight.esm-75b11b9d.js" as="script"><link rel="prefetch" href="/assets/markdown.esm-abe06b83.js" as="script"><link rel="prefetch" href="/assets/math.esm-70a288c8.js" as="script"><link rel="prefetch" href="/assets/notes.esm-a106bb2c.js" as="script"><link rel="prefetch" href="/assets/reveal.esm-ec5549c1.js" as="script"><link rel="prefetch" href="/assets/search.esm-7e6792e2.js" as="script"><link rel="prefetch" href="/assets/zoom.esm-b83b91d0.js" as="script"><link rel="prefetch" href="/assets/VuePlayground-0382da01.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-5794cde2.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">Skip to main content</a><!--]--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="vp-link vp-brand" href="/"><img class="vp-nav-logo" src="/logo.svg" alt="Docs Demo"><!----><span class="vp-site-name hide-in-pad">MineTing</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><!----><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><div class="nav-item"><div class="dropdown-wrapper i18n-dropdown"><button type="button" class="dropdown-title" aria-label="Select language"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon i18n-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="i18n icon" style="width:1rem;height:1rem;vertical-align:middle;"><path d="M379.392 460.8 494.08 575.488l-42.496 102.4L307.2 532.48 138.24 701.44l-71.68-72.704L234.496 460.8l-45.056-45.056c-27.136-27.136-51.2-66.56-66.56-108.544h112.64c7.68 14.336 16.896 27.136 26.112 35.84l45.568 46.08 45.056-45.056C382.976 312.32 409.6 247.808 409.6 204.8H0V102.4h256V0h102.4v102.4h256v102.4H512c0 70.144-37.888 161.28-87.04 210.944L378.88 460.8zM576 870.4 512 1024H409.6l256-614.4H768l256 614.4H921.6l-64-153.6H576zM618.496 768h196.608L716.8 532.48 618.496 768z"></path></svg><!--]--><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="vp-link nav-link active" href="/DataBase/Redis.html"><!---->English<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/zh/"><!---->ç®€ä½“ä¸­æ–‡<!----></a></li></ul></button></div></div><div class="nav-item vp-repo"><a class="vp-repo-link" href="https://github.com/vuepress-theme-hope/vuepress-theme-hope" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button type="button" class="outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><!----><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/slides.html"><span class="font-icon icon fa-fw fa-sm fas fa-person-chalkboard" style=""></span>Slide page<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">Java</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">DevOps</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">BigData</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">Python</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">MachineLearning</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">GIS</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">Web</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">Go</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">C/C++</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->Redis</h1><div class="page-info"><span class="page-author-info" aria-label="AuthorğŸ–Š" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">MineTing</span></span><span property="author" content="MineTing"></span></span><!----><span class="page-date-info" aria-label="Writing DateğŸ“…" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-03-17T00:00:00.000Z"></span><!----><span class="page-reading-time-info" aria-label="Reading TimeâŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>About 107 min</span><meta property="timeRequired" content="PT107M"></span><!----><!----></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">On This Page<!----></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#æŠ€æœ¯å‘å±•">æŠ€æœ¯å‘å±•</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#web1-0-æ—¶ä»£">Web1.0 æ—¶ä»£</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#web2-0-æ—¶ä»£">Web2.0 æ—¶ä»£</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#è§£å†³-cpu-åŠå†…å­˜å‹åŠ›">è§£å†³ CPU åŠå†…å­˜å‹åŠ›</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#è§£å†³-io-å‹åŠ›">è§£å†³ IO å‹åŠ›</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#nosql-æ•°æ®åº“">NoSQL æ•°æ®åº“</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#nosql-é€‚ç”¨åœºæ™¯">NoSQL é€‚ç”¨åœºæ™¯</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#nosql-ä¸é€‚ç”¨åœºæ™¯">NoSQL ä¸é€‚ç”¨åœºæ™¯</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#memcache">Memcache</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#redis">Redis</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#mongodb">MongoDB</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#è¡Œåˆ—å­˜å‚¨æ•°æ®åº“">è¡Œåˆ—å­˜å‚¨æ•°æ®åº“</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#å›¾å…³ç³»å‹æ•°æ®åº“">å›¾å…³ç³»å‹æ•°æ®åº“</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#db-engines-æ•°æ®åº“æ’å">DB-Engines æ•°æ®åº“æ’å</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#åº”ç”¨åœºæ™¯">åº”ç”¨åœºæ™¯</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#å®‰è£…">å®‰è£…</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#å®‰è£…æ­¥éª¤">å®‰è£…æ­¥éª¤</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#å®‰è£…ç›®å½•-usr-local-bin">å®‰è£…ç›®å½•ï¼š/usr/local/bin</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#é…ç½®-redis-ç¯å¢ƒå˜é‡">é…ç½® Redis ç¯å¢ƒå˜é‡</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#å‰å°å¯åŠ¨">å‰å°å¯åŠ¨</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#åå°å¯åŠ¨">åå°å¯åŠ¨</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#å®¢æˆ·ç«¯è¿œç¨‹è¿æ¥">å®¢æˆ·ç«¯è¿œç¨‹è¿æ¥</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#å…³é—­è¿æ¥">å…³é—­è¿æ¥</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#å¸è½½">å¸è½½</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#redis-åŸºç¡€çŸ¥è¯†">Redis åŸºç¡€çŸ¥è¯†</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#redis-é”®-key">Redis é”®ï¼ˆkeyï¼‰</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#redis-å­—ç¬¦ä¸²-string">Redis å­—ç¬¦ä¸²ï¼ˆStringï¼‰</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#ç®€ä»‹">ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#å¸¸ç”¨å‘½ä»¤">å¸¸ç”¨å‘½ä»¤</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#æ•°æ®ç»“æ„">æ•°æ®ç»“æ„</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#redis-åˆ—è¡¨-list">Redis åˆ—è¡¨ï¼ˆListï¼‰</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#ç®€ä»‹-1">ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#å¸¸ç”¨å‘½ä»¤-1">å¸¸ç”¨å‘½ä»¤</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#æ•°æ®ç»“æ„-1">æ•°æ®ç»“æ„</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#redis-é›†åˆ-set">Redis é›†åˆï¼ˆSetï¼‰</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#ç®€ä»‹-2">ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#å¸¸ç”¨å‘½ä»¤-2">å¸¸ç”¨å‘½ä»¤</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#æ•°æ®ç»“æ„-2">æ•°æ®ç»“æ„</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#redis-å“ˆå¸Œ-hash">Redis å“ˆå¸Œï¼ˆHashï¼‰</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#ç®€ä»‹-3">ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#å¸¸ç”¨å‘½ä»¤-3">å¸¸ç”¨å‘½ä»¤</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#æ•°æ®ç»“æ„-3">æ•°æ®ç»“æ„</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#redis-æœ‰åºé›†åˆ-zset-sorted-set">Redis æœ‰åºé›†åˆ Zsetï¼ˆSorted setï¼‰</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#ç®€ä»‹-4">ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#å¸¸ç”¨å‘½ä»¤-4">å¸¸ç”¨å‘½ä»¤</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#æ•°æ®ç»“æ„-4">æ•°æ®ç»“æ„</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#è·³è·ƒè¡¨">è·³è·ƒè¡¨</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#units-å•ä½">Units å•ä½</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#includes-åŒ…å«">INCLUDES åŒ…å«</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#ç½‘ç»œç›¸å…³é…ç½®">ç½‘ç»œç›¸å…³é…ç½®</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#bind">bind</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#protected-mode">protected-mode</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#port">port</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#tcp-backlog">tcp-backlog</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#timeout">timeout</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#tcp-keepalive">tcp-keepalive</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#general-é€šç”¨">GENERAL é€šç”¨</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#daemonize">daemonize</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#pidfile">pidfile</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#loglevel">loglevel</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#logfile">logfile</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#database-16">database  16</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#security-å®‰å…¨">SECURITY å®‰å…¨</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#è®¾ç½®å¯†ç ">è®¾ç½®å¯†ç </a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#limit-é™åˆ¶">LIMIT é™åˆ¶</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#maxclients">maxclients</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#maxmemory">maxmemory</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#maxmemory-policy">maxmemory-policy</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#maxmemory-samples">maxmemory-samples</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#å‘å¸ƒå’Œè®¢é˜…">å‘å¸ƒå’Œè®¢é˜…</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#redis-çš„å‘å¸ƒå’Œè®¢é˜…-1">Redis çš„å‘å¸ƒå’Œè®¢é˜…</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#bitmaps">Bitmaps</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#ç®€ä»‹-5">ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#å‘½ä»¤">å‘½ä»¤</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#bitmaps-ä¸-set-å¯¹æ¯”">Bitmaps ä¸ set å¯¹æ¯”</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#hyperloglog">HyperLogLog</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#ç®€ä»‹-6">ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#å‘½ä»¤-1">å‘½ä»¤</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#geospatial">Geospatial</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#ç®€ä»‹-7">ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#å‘½ä»¤-2">å‘½ä»¤</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#pom-xml">pom.xml</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#è¿æ¥-redis-æ³¨æ„äº‹é¡¹">è¿æ¥ Redis æ³¨æ„äº‹é¡¹</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#æµ‹è¯•è¿æ¥">æµ‹è¯•è¿æ¥</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#æµ‹è¯•æ•°æ®ç±»å‹">æµ‹è¯•æ•°æ®ç±»å‹</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#key">key</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#string">string</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#list">list</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#set">set</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#hash">hash</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#zset">zset</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#jedis-éªŒè¯ç ç¤ºä¾‹">Jedis éªŒè¯ç ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#å¼•å…¥ä¾èµ–">å¼•å…¥ä¾èµ–</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#é…ç½®">é…ç½®</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#æµ‹è¯•">æµ‹è¯•</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#redisäº‹åŠ¡å®šä¹‰">Redisäº‹åŠ¡å®šä¹‰</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#multiã€execã€discard">Multiã€Execã€discard</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#äº‹åŠ¡çš„é”™è¯¯å¤„ç†">äº‹åŠ¡çš„é”™è¯¯å¤„ç†</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#äº‹åŠ¡å†²çª">äº‹åŠ¡å†²çª</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#æ‚²è§‚é”">æ‚²è§‚é”</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#ä¹è§‚é”">ä¹è§‚é”</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#watch-key">WATCH key</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#unwatch">unwatch</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#redis-äº‹åŠ¡ä¸‰ç‰¹æ€§">Redis  äº‹åŠ¡ä¸‰ç‰¹æ€§</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#redisäº‹åŠ¡-ç§’æ€ç¤ºä¾‹">Redisäº‹åŠ¡ï¼šç§’æ€ç¤ºä¾‹</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#åŸºæœ¬ä»£ç ">åŸºæœ¬ä»£ç </a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#ab-å·¥å…·ä½¿ç”¨">ab å·¥å…·ä½¿ç”¨</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#è¶…å–é—®é¢˜">è¶…å–é—®é¢˜</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#åº“å­˜é—ç•™é—®é¢˜">åº“å­˜é—ç•™é—®é¢˜</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#rdb-redis-database">RDB (Redis DataBase)</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#å®˜ç½‘ä»‹ç»">å®˜ç½‘ä»‹ç»</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#å®šä¹‰">å®šä¹‰</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#å¤‡ä»½æ–‡ä»¶çš„æ‰§è¡Œ">å¤‡ä»½æ–‡ä»¶çš„æ‰§è¡Œ</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#fork">Fork</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#rdb-æŒä¹…åŒ–æµç¨‹">RDB æŒä¹…åŒ–æµç¨‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#rdb-æ–‡ä»¶é…ç½®">rdb æ–‡ä»¶é…ç½®</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#rdb-å¿«ç…§è§¦å‘">RDB å¿«ç…§è§¦å‘</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#rdb-ä¼˜åŠ¿">RDB ä¼˜åŠ¿</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#rdb-åŠ£åŠ¿">RDB åŠ£åŠ¿</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#åŠ¨æ€åœæ­¢rdb">åŠ¨æ€åœæ­¢RDB</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#rdb-æ€»ç»“">RDB æ€»ç»“</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#aof-append-only-file">AOFï¼ˆAppend Only Fileï¼‰</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#å®šä¹‰-1">å®šä¹‰</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#aof-æŒä¹…åŒ–æµç¨‹">AOF æŒä¹…åŒ–æµç¨‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#aof-é»˜è®¤é…ç½®">AOF é»˜è®¤é…ç½®</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#aof-å’Œ-rdb-åŒæ—¶å¼€å¯">AOF å’Œ RDB åŒæ—¶å¼€å¯</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#aof-å¯åŠ¨ã€æ¢å¤">AOF å¯åŠ¨ã€æ¢å¤</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#aof-åŒæ­¥é¢‘ç‡è®¾ç½®">AOF åŒæ­¥é¢‘ç‡è®¾ç½®</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#rewrite-å‹ç¼©">Rewrite å‹ç¼©</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#ä¼˜åŠ¿">ä¼˜åŠ¿</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#åŠ£åŠ¿">åŠ£åŠ¿</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#åº”è¯¥ä½¿ç”¨é‚£ä¸ªç­–ç•¥">åº”è¯¥ä½¿ç”¨é‚£ä¸ªç­–ç•¥</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#å®˜æ–¹æ¨è">å®˜æ–¹æ¨è</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#æ€§èƒ½å»ºè®®">æ€§èƒ½å»ºè®®</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#å®šä¹‰-3">å®šä¹‰</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#ä½œç”¨">ä½œç”¨</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#æ­å»ºä¸»ä»å¤åˆ¶">æ­å»ºä¸»ä»å¤åˆ¶</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#ç¬¬ä¸€æ­¥-æ–°å»ºé…ç½®æ–‡ä»¶">ç¬¬ä¸€æ­¥ï¼šæ–°å»ºé…ç½®æ–‡ä»¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#ç¬¬äºŒæ­¥-å¯åŠ¨ä¸‰å°-redis-æŸ¥çœ‹è¿›ç¨‹">ç¬¬äºŒæ­¥ï¼šå¯åŠ¨ä¸‰å° Redisï¼ŒæŸ¥çœ‹è¿›ç¨‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#ç¬¬ä¸‰æ­¥-ä½¿ç”¨-info-replication-æ‰“å°ä¸»ä»å¤åˆ¶ä¿¡æ¯">ç¬¬ä¸‰æ­¥ï¼šä½¿ç”¨ info replication æ‰“å°ä¸»ä»å¤åˆ¶ä¿¡æ¯</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#ç¬¬å››æ­¥-é…ç½®ä¸»æœºå’Œä»æœº">ç¬¬å››æ­¥ï¼šé…ç½®ä¸»æœºå’Œä»æœº</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#ç¬¬äº”æ­¥-è¯»å†™æ•°æ®">ç¬¬äº”æ­¥ï¼šè¯»å†™æ•°æ®</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#ç¬¬å…­æ­¥-ä¸»æœºæŒ‚æ‰-é‡å¯ä»æ˜¯-master">ç¬¬å…­æ­¥ï¼šä¸»æœºæŒ‚æ‰ï¼Œé‡å¯ä»æ˜¯ master</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#ç¬¬ä¸ƒæ­¥-ä»æœºé‡å¯-éœ€è¦é‡æ–°è®¾ç½®-slaveof">ç¬¬ä¸ƒæ­¥ï¼šä»æœºé‡å¯ï¼Œéœ€è¦é‡æ–°è®¾ç½® slaveof</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#ä¸»ä»å¤åˆ¶åŸç†">ä¸»ä»å¤åˆ¶åŸç†</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#é—®é¢˜-ä¸»æœºä»æœºå®•æœºæ•°æ®å¤åˆ¶é—®é¢˜">é—®é¢˜ï¼šä¸»æœºä»æœºå®•æœºæ•°æ®å¤åˆ¶é—®é¢˜</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#é—®é¢˜-slave-ä¹Ÿå¯ä»¥æ˜¯-master">é—®é¢˜ï¼šSlave ä¹Ÿå¯ä»¥æ˜¯ Master</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#é—®é¢˜-master-å®•æœºå-ä»æœºå˜ä¸ºä¸»æœº">é—®é¢˜ï¼šMaster å®•æœºåï¼Œä»æœºå˜ä¸ºä¸»æœº</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#å“¨å…µæ¨¡å¼-sentinel">å“¨å…µæ¨¡å¼ï¼ˆsentinelï¼‰</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#ç¬¬ä¸€æ­¥-æ–°å»º-sentinel-conf-æ–‡ä»¶">ç¬¬ä¸€æ­¥ï¼šæ–°å»º sentinel.conf æ–‡ä»¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#ç¬¬äºŒæ­¥-é…ç½®æ–‡ä»¶å†…å®¹">ç¬¬äºŒæ­¥ï¼šé…ç½®æ–‡ä»¶å†…å®¹</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#ç¬¬ä¸‰æ­¥-å¯åŠ¨-redis-ä»¥åŠå“¨å…µ">ç¬¬ä¸‰æ­¥ï¼šå¯åŠ¨ Redis ä»¥åŠå“¨å…µ</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#ç¬¬å››æ­¥-å½“ä¸»æœºæŒ‚æ‰-åœ¨ä»æœºé€‰ä¸¾ä¸­äº§ç”Ÿæ–°çš„ä¸»æœº">ç¬¬å››æ­¥ï¼šå½“ä¸»æœºæŒ‚æ‰ï¼Œåœ¨ä»æœºé€‰ä¸¾ä¸­äº§ç”Ÿæ–°çš„ä¸»æœº</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#å¤åˆ¶å»¶æ—¶">å¤åˆ¶å»¶æ—¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#æ•…éšœæ¢å¤">æ•…éšœæ¢å¤</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#java-ä»£ç å®ç°ä¸»ä»å¤åˆ¶">Java ä»£ç å®ç°ä¸»ä»å¤åˆ¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#è§£å†³çš„é—®é¢˜">è§£å†³çš„é—®é¢˜</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#æ­å»ºé›†ç¾¤ç¯å¢ƒ">æ­å»ºé›†ç¾¤ç¯å¢ƒ</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#ç¬¬ä¸€æ­¥-æ–°å»ºé…ç½®æ–‡ä»¶-1">ç¬¬ä¸€æ­¥ï¼šæ–°å»ºé…ç½®æ–‡ä»¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#ç¬¬äºŒæ­¥-å¯åŠ¨-6-ä¸ªå®ä¾‹">ç¬¬äºŒæ­¥ï¼šå¯åŠ¨ 6 ä¸ªå®ä¾‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#ç¬¬ä¸‰æ­¥-å¯åŠ¨é›†ç¾¤">ç¬¬ä¸‰æ­¥ï¼šå¯åŠ¨é›†ç¾¤</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#ç¬¬å››æ­¥-è¿æ¥">ç¬¬å››æ­¥ï¼šè¿æ¥</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯">æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#redis-cluster-èŠ‚ç‚¹åˆ†é…">redis cluster èŠ‚ç‚¹åˆ†é…</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#slots">slots</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#é›†ç¾¤ä¸­è¯»å†™æ•°æ®">é›†ç¾¤ä¸­è¯»å†™æ•°æ®</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#æ•…éšœæ¢å¤-1">æ•…éšœæ¢å¤</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#é›†ç¾¤çš„-jedis-å¼€å‘">é›†ç¾¤çš„ Jedis å¼€å‘</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#redis-é›†ç¾¤ä¼˜ç‚¹">Redis é›†ç¾¤ä¼˜ç‚¹</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#redis-é›†ç¾¤çš„ä¸è¶³">Redis é›†ç¾¤çš„ä¸è¶³</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#ç¼“å­˜ç©¿é€">ç¼“å­˜ç©¿é€</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#é—®é¢˜æè¿°">é—®é¢˜æè¿°</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#ç¼“å­˜å‡»ç©¿">ç¼“å­˜å‡»ç©¿</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#é—®é¢˜æè¿°-1">é—®é¢˜æè¿°</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#è§£å†³æ–¹æ¡ˆ-1">è§£å†³æ–¹æ¡ˆ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#ç¼“å­˜é›ªå´©">ç¼“å­˜é›ªå´©</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#é—®é¢˜æè¿°-2">é—®é¢˜æè¿°</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#è§£å†³æ–¹æ¡ˆ-2">è§£å†³æ–¹æ¡ˆ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#åˆ†å¸ƒå¼é”">åˆ†å¸ƒå¼é”</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#rediså®ç°åˆ†å¸ƒå¼é”">Rediså®ç°åˆ†å¸ƒå¼é”</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#è®¾ç½®é”çš„è¿‡æœŸæ—¶é—´">è®¾ç½®é”çš„è¿‡æœŸæ—¶é—´</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#uuidé˜²æ­¢è¯¯åˆ ">UUIDé˜²æ­¢è¯¯åˆ </a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#lua-è„šæœ¬ä¼˜åŒ–-åŸå­æ€§é—®é¢˜">Lua è„šæœ¬ä¼˜åŒ–ï¼šåŸå­æ€§é—®é¢˜</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#æ€»ç»“">æ€»ç»“</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#acl">ACL</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#ç®€ä»‹-8">ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#å‘½ä»¤-3">å‘½ä»¤</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#io-å¤šçº¿ç¨‹">IO å¤šçº¿ç¨‹</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#ç®€ä»‹-9">ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#åŸç†æ¶æ„">åŸç†æ¶æ„</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#å·¥å…·æ”¯æŒ-cluster">å·¥å…·æ”¯æŒ Cluster</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#redis-æ–°åŠŸèƒ½æŒç»­å…³æ³¨">Redis æ–°åŠŸèƒ½æŒç»­å…³æ³¨</a></li><!----><!--]--></ul><div class="toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!----><div class="theme-hope-content"><div align="center"><!----></div><h1 id="nosql-æ¦‚è¿°" tabindex="-1"><a class="header-anchor" href="#nosql-æ¦‚è¿°" aria-hidden="true">#</a> NOSQL æ¦‚è¿°</h1><h2 id="æŠ€æœ¯å‘å±•" tabindex="-1"><a class="header-anchor" href="#æŠ€æœ¯å‘å±•" aria-hidden="true">#</a> æŠ€æœ¯å‘å±•</h2><p>æŠ€æœ¯çš„åˆ†ç±»ï¼š</p><ol><li><p>è§£å†³åŠŸèƒ½æ€§çš„é—®é¢˜ï¼šJavaã€Jspã€RDBMSã€Tomcatã€HTMLã€Linuxã€JDBCã€SVN ç­‰</p></li><li><p>è§£å†³æ‰©å±•æ€§çš„é—®é¢˜ï¼šStrutsã€Springã€SpringMVCã€Hibernateã€Mybatis ç­‰</p></li><li><p>è§£å†³æ€§èƒ½çš„é—®é¢˜ï¼šNOSQLã€Threadã€Hadoopã€Nginxã€MQã€ElasticSearchs ç­‰</p></li></ol><h3 id="web1-0-æ—¶ä»£" tabindex="-1"><a class="header-anchor" href="#web1-0-æ—¶ä»£" aria-hidden="true">#</a> Web1.0 æ—¶ä»£</h3><p>Web1.0 çš„æ—¶ä»£ï¼Œæ•°æ®è®¿é—®é‡å¾ˆæœ‰é™ï¼Œç”¨ä¸€å¤«å½“å…³çš„é«˜æ€§èƒ½çš„å•ç‚¹æœåŠ¡å™¨å¯ä»¥è§£å†³å¤§éƒ¨åˆ†é—®é¢˜ã€‚</p><h3 id="web2-0-æ—¶ä»£" tabindex="-1"><a class="header-anchor" href="#web2-0-æ—¶ä»£" aria-hidden="true">#</a> Web2.0 æ—¶ä»£</h3><p>éšç€ Web2.0 çš„æ—¶ä»£çš„åˆ°æ¥ï¼Œç”¨æˆ·è®¿é—®é‡å¤§å¹…åº¦æå‡ï¼ŒåŒæ—¶äº§ç”Ÿäº†å¤§é‡çš„ç”¨æˆ·æ•°æ®ã€‚åŠ ä¸Šåæ¥çš„æ™ºèƒ½ç§»åŠ¨è®¾å¤‡çš„æ™®åŠï¼Œæ‰€æœ‰çš„äº’è”ç½‘å¹³å°éƒ½é¢ä¸´äº†å·¨å¤§çš„æ€§èƒ½æŒ‘æˆ˜ã€‚</p><h3 id="è§£å†³-cpu-åŠå†…å­˜å‹åŠ›" tabindex="-1"><a class="header-anchor" href="#è§£å†³-cpu-åŠå†…å­˜å‹åŠ›" aria-hidden="true">#</a> è§£å†³ CPU åŠå†…å­˜å‹åŠ›</h3><img src="/assets/è§£å†³CPUå’Œå†…å­˜å‹åŠ›-b0981692.png" alt="è§£å†³CPUå’Œå†…å­˜å‹åŠ›" style="zoom:80%;"><h3 id="è§£å†³-io-å‹åŠ›" tabindex="-1"><a class="header-anchor" href="#è§£å†³-io-å‹åŠ›" aria-hidden="true">#</a> è§£å†³ IO å‹åŠ›</h3><img src="/assets/è§£å†³IOå‹åŠ›-599e0989.png" alt="è§£å†³IOå‹åŠ›" style="zoom:80%;"><h2 id="nosql-æ•°æ®åº“" tabindex="-1"><a class="header-anchor" href="#nosql-æ•°æ®åº“" aria-hidden="true">#</a> NoSQL æ•°æ®åº“</h2><p>NoSQLï¼ˆNoSQL = <strong>Not Only SQL</strong> ï¼‰ï¼Œæ„å³ &quot;ä¸ä»…ä»…æ˜¯SQL&quot;ï¼Œæ³›æŒ‡<strong>éå…³ç³»å‹çš„æ•°æ®åº“</strong>ã€‚</p><p>NoSQL ä¸ä¾èµ–ä¸šåŠ¡é€»è¾‘æ–¹å¼å­˜å‚¨ï¼Œè€Œä»¥ç®€å•çš„ key-value æ¨¡å¼å­˜å‚¨ã€‚å› æ­¤å¤§å¤§çš„å¢åŠ äº†æ•°æ®åº“çš„æ‰©å±•èƒ½åŠ›ã€‚</p><ul><li>ä¸éµå¾ª SQL æ ‡å‡†</li><li>ä¸æ”¯æŒ ACID</li><li>è¿œè¶…äº SQL çš„æ€§èƒ½</li></ul><h3 id="nosql-é€‚ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#nosql-é€‚ç”¨åœºæ™¯" aria-hidden="true">#</a> NoSQL é€‚ç”¨åœºæ™¯</h3><ul><li>å¯¹æ•°æ®é«˜å¹¶å‘çš„è¯»å†™</li><li>æµ·é‡æ•°æ®çš„è¯»å†™</li><li>å¯¹æ•°æ®é«˜å¯æ‰©å±•æ€§çš„</li></ul><h3 id="nosql-ä¸é€‚ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#nosql-ä¸é€‚ç”¨åœºæ™¯" aria-hidden="true">#</a> NoSQL ä¸é€‚ç”¨åœºæ™¯</h3><ul><li>éœ€è¦äº‹åŠ¡æ”¯æŒ</li><li>åŸºäº SQL çš„ç»“æ„åŒ–æŸ¥è¯¢å­˜å‚¨ï¼Œå¤„ç†å¤æ‚çš„å…³ç³»ï¼Œéœ€è¦å³å¸­æŸ¥è¯¢ï¼ˆç”¨æˆ–è€…ä¸ç”¨ SQL éƒ½ä¸è¡Œçš„æƒ…å†µï¼Œè¯·è€ƒè™‘ç”¨ NoSqlï¼‰</li></ul><h3 id="memcache" tabindex="-1"><a class="header-anchor" href="#memcache" aria-hidden="true">#</a> Memcache</h3><ol><li>æ•°æ®éƒ½åœ¨å†…å­˜ä¸­ï¼Œä¸€èˆ¬ä¸æŒä¹…åŒ–</li><li>æ”¯æŒç®€å•çš„ key-value æ¨¡å¼ï¼Œæ”¯æŒç±»å‹å•ä¸€</li><li>ä¸€èˆ¬æ˜¯ä½œä¸ºç¼“å­˜æ•°æ®åº“è¾…åŠ©æŒä¹…åŒ–çš„æ•°æ®åº“</li></ol><h3 id="redis" tabindex="-1"><a class="header-anchor" href="#redis" aria-hidden="true">#</a> Redis</h3><ol><li>å‡ ä¹è¦†ç›–äº† Memcached çš„ç»å¤§éƒ¨åˆ†åŠŸèƒ½</li><li>æ•°æ®éƒ½åœ¨å†…å­˜ä¸­ï¼Œæ”¯æŒæŒä¹…åŒ–ï¼Œä¸»è¦ç”¨ä½œå¤‡ä»½æ¢å¤</li><li>é™¤äº†æ”¯æŒç®€å•çš„ key-value æ¨¡å¼ï¼Œè¿˜æ”¯æŒå¤šç§æ•°æ®ç»“æ„çš„å­˜å‚¨ï¼Œæ¯”å¦‚ listã€setã€hashã€zsetç­‰ã€‚</li><li>ä¸€èˆ¬æ˜¯ä½œä¸ºç¼“å­˜æ•°æ®åº“è¾…åŠ©æŒä¹…åŒ–çš„æ•°æ®åº“</li></ol><h3 id="mongodb" tabindex="-1"><a class="header-anchor" href="#mongodb" aria-hidden="true">#</a> MongoDB</h3><ol><li>é«˜æ€§èƒ½ã€å¼€æºã€æ¨¡å¼è‡ªç”±ï¼ˆschema freeï¼‰çš„<strong>æ–‡æ¡£å‹æ•°æ®åº“</strong></li><li>æ•°æ®éƒ½åœ¨å†…å­˜ä¸­ï¼Œ å¦‚æœå†…å­˜ä¸è¶³ï¼ŒæŠŠä¸å¸¸ç”¨çš„æ•°æ®ä¿å­˜åˆ°ç¡¬ç›˜</li><li>è™½ç„¶æ˜¯ key-value æ¨¡å¼ï¼Œä½†æ˜¯å¯¹ valueï¼ˆå°¤å…¶æ˜¯ <strong>json</strong>ï¼‰æä¾›äº†ä¸°å¯Œçš„æŸ¥è¯¢åŠŸèƒ½</li><li>æ”¯æŒäºŒè¿›åˆ¶æ•°æ®åŠå¤§å‹å¯¹è±¡</li><li>å¯ä»¥æ ¹æ®æ•°æ®çš„ç‰¹ç‚¹<strong>æ›¿ä»£ RDBMS</strong> ï¼Œæˆä¸ºç‹¬ç«‹çš„æ•°æ®åº“ã€‚æˆ–è€…é…åˆ RDBMSï¼Œå­˜å‚¨ç‰¹å®šçš„æ•°æ®ã€‚</li></ol><h2 id="è¡Œåˆ—å­˜å‚¨æ•°æ®åº“" tabindex="-1"><a class="header-anchor" href="#è¡Œåˆ—å­˜å‚¨æ•°æ®åº“" aria-hidden="true">#</a> è¡Œåˆ—å­˜å‚¨æ•°æ®åº“</h2><p><strong>è¡Œå¼æ•°æ®åº“</strong></p><img src="/assets/è¡Œå¼æ•°æ®åº“-14cc7bfd.png" alt="è¡Œå¼æ•°æ®åº“" style="zoom:80%;"><p><strong>åˆ—å¼æ•°æ®åº“</strong></p><img src="/assets/åˆ—å¼æ•°æ®åº“-0eb77e34.png" alt="åˆ—å¼æ•°æ®åº“" style="zoom:80%;"><p><strong>Hbase</strong></p><p>HBase æ˜¯ <strong>Hadoop</strong> é¡¹ç›®ä¸­çš„æ•°æ®åº“ã€‚å®ƒç”¨äºéœ€è¦å¯¹å¤§é‡çš„æ•°æ®è¿›è¡Œéšæœºã€å®æ—¶çš„è¯»å†™æ“ä½œçš„åœºæ™¯ä¸­ã€‚</p><p>HBase çš„ç›®æ ‡å°±æ˜¯å¤„ç†æ•°æ®é‡éå¸¸åºå¤§çš„è¡¨ï¼Œå¯ä»¥ç”¨æ™®é€šçš„è®¡ç®—æœºå¤„ç†è¶…è¿‡ 10 äº¿è¡Œæ•°æ®ï¼Œè¿˜å¯å¤„ç†æœ‰æ•°ç™¾ä¸‡åˆ—å…ƒç´ çš„æ•°æ®è¡¨ã€‚</p><h2 id="å›¾å…³ç³»å‹æ•°æ®åº“" tabindex="-1"><a class="header-anchor" href="#å›¾å…³ç³»å‹æ•°æ®åº“" aria-hidden="true">#</a> å›¾å…³ç³»å‹æ•°æ®åº“</h2><p>ä¸»è¦åº”ç”¨ï¼šç¤¾ä¼šå…³ç³»ï¼Œå…¬å…±äº¤é€šç½‘ç»œï¼Œåœ°å›¾åŠç½‘ç»œæ‹“è°± (n*(n-1)/2)</p><h2 id="db-engines-æ•°æ®åº“æ’å" tabindex="-1"><a class="header-anchor" href="#db-engines-æ•°æ®åº“æ’å" aria-hidden="true">#</a> DB-Engines æ•°æ®åº“æ’å</h2><blockquote><p><a href="http://db-engines.com/en/ranking" target="_blank" rel="noopener noreferrer"><strong>http://db-engines.com/en/ranking</strong><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></blockquote><h1 id="redis-æ¦‚è¿°" tabindex="-1"><a class="header-anchor" href="#redis-æ¦‚è¿°" aria-hidden="true">#</a> Redis æ¦‚è¿°</h1><p>å®˜ç½‘åœ°å€ï¼š<a href="http://redis.io" target="_blank" rel="noopener noreferrer">http://redis.io<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>ä¸­æ–‡åœ°å€ï¼š<a href="http://redis.cn/" target="_blank" rel="noopener noreferrer">http://redis.cn/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="åº”ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#åº”ç”¨åœºæ™¯" aria-hidden="true">#</a> åº”ç”¨åœºæ™¯</h2><ol><li><p><strong>é…åˆå…³ç³»å‹æ•°æ®åº“åšé«˜é€Ÿç¼“å­˜</strong></p><p>é«˜é¢‘æ¬¡ï¼Œçƒ­é—¨è®¿é—®çš„æ•°æ®ï¼Œé™ä½æ•°æ®åº“ IO</p><p>åˆ†å¸ƒå¼æ¶æ„ï¼Œåš session å…±äº«</p></li><li><p><strong>å¤šæ ·çš„æ•°æ®ç»“æ„å­˜å‚¨æŒä¹…åŒ–æ•°æ®</strong></p><p>æœ€æ–° N ä¸ªæ•°æ®ï¼šé€šè¿‡ List å®ç°æŒ‰è‡ªç„¶æ—¶é—´æ’åºçš„æ•°æ®</p><p>æ’è¡Œæ¦œï¼ŒTopNï¼šåˆ©ç”¨ zset æœ‰åºé›†åˆ</p><p>æ—¶æ•ˆæ€§çš„æ•°æ®ï¼Œå¦‚ï¼šæ‰‹æœºéªŒè¯ç ï¼šExpire è¿‡æœŸ</p><p>è®¡æ•°å™¨ï¼Œç§’æ€ï¼šåŸå­æ€§ï¼Œè‡ªå¢æ–¹æ³• INCREã€DECRE</p><p>å–å‡ºå¤§é‡æ•°æ®ä¸­çš„é‡å¤æ•°æ®ï¼šåˆ©ç”¨ Set é›†åˆ</p><p>æ„å»ºé˜Ÿåˆ—ï¼šåˆ©ç”¨ List é›†åˆ</p><p>å‘å¸ƒè®¢é˜…ç³»ç»Ÿï¼špub/sub æ¨¡å¼</p></li></ol><h2 id="å®‰è£…" tabindex="-1"><a class="header-anchor" href="#å®‰è£…" aria-hidden="true">#</a> å®‰è£…</h2><p>å®‰è£…åœ°å€ï¼š<a href="https://redis.io/docs/getting-started/installation/" target="_blank" rel="noopener noreferrer">https://redis.io/docs/getting-started/installation/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><figure><img src="/assets/image-20220513090502331-ce51a5e9.png" alt="image-20220513090502331" tabindex="0" loading="lazy"><figcaption>image-20220513090502331</figcaption></figure><p>æ­¤å¤„ä»¥ CentOS7 ç³»ç»Ÿä¸ºä¾‹ï¼ˆè¶…è¿‡ 95% çš„ Redis éƒ½å®‰è£…åœ¨ Linux ä¸Šï¼‰ï¼Œå®‰è£…ç‰ˆæœ¬ï¼š<code>redis-6.2.1.tar.gz</code></p><h3 id="å®‰è£…æ­¥éª¤" tabindex="-1"><a class="header-anchor" href="#å®‰è£…æ­¥éª¤" aria-hidden="true">#</a> å®‰è£…æ­¥éª¤</h3><ol><li><p>å®‰è£… gcc ç¼–è¯‘å™¨</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost /<span class="token punctuation">]</span><span class="token comment"># yum install -y centos-release-scl scl-utils-build</span>
<span class="token punctuation">[</span>root@localhost /<span class="token punctuation">]</span><span class="token comment"># yum install -y devtoolset-8-toolchain</span>
<span class="token punctuation">[</span>root@localhost /<span class="token punctuation">]</span><span class="token comment"># scl enable devtoolset-8 bash</span>
<span class="token punctuation">[</span>root@localhost /<span class="token punctuation">]</span><span class="token comment"># gcc --version</span>
<span class="token comment"># [root@localhost /]# gcc -v</span>
gcc <span class="token punctuation">(</span>GCC<span class="token punctuation">)</span> <span class="token number">8.3</span>.1 <span class="token number">20190311</span> <span class="token punctuation">(</span>Red Hat <span class="token number">8.3</span>.1-3<span class="token punctuation">)</span>
Copyright <span class="token punctuation">(</span>C<span class="token punctuation">)</span> <span class="token number">2018</span> Free Software Foundation, Inc.
This is <span class="token function">free</span> software<span class="token punctuation">;</span> see the <span class="token builtin class-name">source</span> <span class="token keyword">for</span> copying conditions.  There is NO
warranty<span class="token punctuation">;</span> not even <span class="token keyword">for</span> MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>ä¸‹è½½ <code>redis-6.2.1.tar.gz</code> æ”¾åœ¨ /opt ç›®å½•å¹¶è§£å‹</p></li><li><p>åœ¨ /usr/local/bin ä¸‹æ–°å»º redis ç›®å½•ï¼Œç”¨äºå­˜æ”¾ç¼–è¯‘å¥½çš„ç¨‹åºï¼Œæ‹·è´è§£å‹å¥½çš„æ–‡ä»¶å¤¹è‡³è¯¥ç›®å½•ä¸­</p></li><li><p>è¿›å…¥ **redis-6.2.1 **ç›®å½•ä½¿ç”¨ make ç¼–è¯‘</p></li><li><p><strong>è·³è¿‡ make test ç»§ç»­æ‰§è¡Œ: make installï¼Œå¯ä»¥æŒ‡å®šå‰ç¼€ä¸º redisï¼šmake PREFIX=/usr/local/redis install</strong></p><p>ç¼–è¯‘å®Œæˆåå¯ä»¥åœ¨ src ä¸‹æ–°å¢çš„å‘½ä»¤ç§»åŠ¨è‡³ /usr/local/bin ä¸‹</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost redis<span class="token punctuation">]</span><span class="token comment"># cd /opt/redis</span>
<span class="token punctuation">[</span>root@localhost redis<span class="token punctuation">]</span><span class="token comment"># tar -zxvf redis-6.2.1.tar.gz</span>
<span class="token punctuation">[</span>root@localhost redis<span class="token punctuation">]</span><span class="token comment"># ls</span>
redis-6.2.1  redis-6.2.1.tar.gz
<span class="token punctuation">[</span>root@localhost redis<span class="token punctuation">]</span><span class="token comment"># cd redis-6.2.1</span>
<span class="token punctuation">[</span>root@localhost redis-6.2.1<span class="token punctuation">]</span><span class="token comment"># make &amp;&amp; make install</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>æ³¨æ„äº‹é¡¹ï¼š</p><p>å¦‚æœæŠ¥é”™ï¼š<strong>å¦‚æœæ²¡æœ‰å‡†å¤‡å¥½ C è¯­è¨€ç¼–è¯‘ç¯å¢ƒï¼Œmake ä¼šæŠ¥é”™ Jemalloc/jemalloc.hï¼šæ²¡æœ‰é‚£ä¸ªæ–‡ä»¶</strong></p><p>è§£å†³æ–¹æ¡ˆï¼š<strong>è¿è¡Œ make distclean</strong>ï¼Œ<strong>å†æ¬¡æ‰§è¡Œ make å‘½ä»¤</strong></p><p>å¦‚æœæŠ¥é”™ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>server.c:1062:32: é”™è¯¯ï¼šâ€˜struct redisServerâ€™æ²¡æœ‰åä¸ºâ€˜masterhostâ€™çš„æˆå‘˜
             role_char <span class="token operator">=</span> <span class="token punctuation">(</span>server.masterhost ? <span class="token string">&#39;S&#39;</span><span class="token builtin class-name">:</span><span class="token string">&#39;M&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> /* Slave or Master. */
                                ^
server.c:1070:15: é”™è¯¯ï¼šâ€˜struct redisServerâ€™æ²¡æœ‰åä¸ºâ€˜syslog_enabledâ€™çš„æˆå‘˜
     <span class="token keyword">if</span> <span class="token punctuation">(</span>server.syslog_enabled<span class="token punctuation">)</span> syslog<span class="token punctuation">(</span>syslogLevelMap<span class="token punctuation">[</span>level<span class="token punctuation">]</span>, <span class="token string">&quot;%s&quot;</span>, msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
               ^
server.c: åœ¨å‡½æ•°â€˜serverLogâ€™ä¸­:
server.c:1080:30: é”™è¯¯ï¼šâ€˜struct redisServerâ€™æ²¡æœ‰åä¸ºâ€˜verbosityâ€™çš„æˆå‘˜
     <span class="token keyword">if</span> <span class="token punctuation">((</span>level<span class="token operator">&amp;</span>0xff<span class="token punctuation">)</span> <span class="token operator">&lt;</span> server.verbosity<span class="token punctuation">)</span> <span class="token builtin class-name">return</span><span class="token punctuation">;</span>
                              ^
server.c: åœ¨å‡½æ•°â€˜serverLogFromHandlerâ€™ä¸­:
server.c:1097:31: é”™è¯¯ï¼šâ€˜struct redisServerâ€™æ²¡æœ‰åä¸ºâ€˜logfileâ€™çš„æˆå‘˜
     int log_to_stdout <span class="token operator">=</span> server.logfile<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">&#39;\0&#39;</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é—®é¢˜åŸå› ï¼š</p><p>è‡ª redis 6.0.0 ä¹‹åï¼Œç¼–è¯‘ redis éœ€è¦æ”¯æŒ C11 ç‰¹æ€§ï¼ŒC11 ç‰¹æ€§åœ¨ 4.9 ä¸­è¢«å¼•å…¥ã€‚</p><p>Redis é»˜è®¤ç¼–è¯‘ç¯å¢ƒéœ€è¦ï¼šyum install gcc-c++</p><p>Centos7 é»˜è®¤ gcc ç‰ˆæœ¬ä¸º 4.8.5ï¼Œæ‰€ä»¥éœ€è¦å‡çº§ gcc ç‰ˆæœ¬</p><p>å‡çº§ GCC ç‰ˆæœ¬</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># æŸ¥çœ‹ gcc ç‰ˆæœ¬</span>
gcc <span class="token parameter variable">-v</span>
<span class="token comment"># 1. å®‰è£…gccå¥—è£…ï¼šä¾æ¬¡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</span>
yum <span class="token function">install</span> cpp
yum <span class="token function">install</span> binutils
yum <span class="token function">install</span> glibc
yum <span class="token function">install</span> glibc-kernheaders
yum <span class="token function">install</span> glibc-common
yum <span class="token function">install</span> glibc-devel
yum <span class="token function">install</span> gcc
yum <span class="token function">install</span> <span class="token function">make</span>

<span class="token comment"># 2. å‡çº§gcc</span>
yum <span class="token parameter variable">-y</span> <span class="token function">install</span> centos-release-scl
yum <span class="token parameter variable">-y</span> <span class="token function">install</span> devtoolset-9-gcc devtoolset-9-gcc-c++ devtoolset-9-binutils
scl <span class="token builtin class-name">enable</span> devtoolset-9 <span class="token function">bash</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h3 id="å®‰è£…ç›®å½•-usr-local-bin" tabindex="-1"><a class="header-anchor" href="#å®‰è£…ç›®å½•-usr-local-bin" aria-hidden="true">#</a> å®‰è£…ç›®å½•ï¼š/usr/local/bin</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost redis-6.2.1<span class="token punctuation">]</span><span class="token comment"># ll /usr/local/bin</span>
æ€»ç”¨é‡ <span class="token number">19136</span>
-rwxr-xr-x. <span class="token number">1</span> root root <span class="token number">4833352</span> <span class="token number">5</span>æœˆ  <span class="token number">13</span> 09:20 redis-benchmark
lrwxrwxrwx. <span class="token number">1</span> root root      <span class="token number">12</span> <span class="token number">5</span>æœˆ  <span class="token number">13</span> 09:20 redis-check-aof -<span class="token operator">&gt;</span> redis-server
lrwxrwxrwx. <span class="token number">1</span> root root      <span class="token number">12</span> <span class="token number">5</span>æœˆ  <span class="token number">13</span> 09:20 redis-check-rdb -<span class="token operator">&gt;</span> redis-server
-rwxr-xr-x. <span class="token number">1</span> root root <span class="token number">5003368</span> <span class="token number">5</span>æœˆ  <span class="token number">13</span> 09:20 redis-cli
lrwxrwxrwx. <span class="token number">1</span> root root      <span class="token number">12</span> <span class="token number">5</span>æœˆ  <span class="token number">13</span> 09:20 redis-sentinel -<span class="token operator">&gt;</span> redis-server
-rwxr-xr-x. <span class="token number">1</span> root root <span class="token number">9450208</span> <span class="token number">5</span>æœˆ  <span class="token number">13</span> 09:20 redis-server
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æŸ¥çœ‹é»˜è®¤å®‰è£…ç›®å½•ï¼š</p><ol><li>redis-benchmarkï¼šæ€§èƒ½æµ‹è¯•å·¥å…·</li><li>redis-check-aofï¼šä¿®å¤æœ‰é—®é¢˜çš„ AOF æ–‡ä»¶</li><li>redis-check-dumpï¼šä¿®å¤æœ‰é—®é¢˜çš„ dump.rdb æ–‡ä»¶</li><li>redis-sentinelï¼šRedis é›†ç¾¤ä½¿ç”¨</li><li>redis-serverï¼šRedis æœåŠ¡å™¨å¯åŠ¨å‘½ä»¤</li><li>redis-cliï¼šå®¢æˆ·ç«¯å·¥å…·</li></ol><h3 id="é…ç½®-redis-ç¯å¢ƒå˜é‡" tabindex="-1"><a class="header-anchor" href="#é…ç½®-redis-ç¯å¢ƒå˜é‡" aria-hidden="true">#</a> é…ç½® Redis ç¯å¢ƒå˜é‡</h3><p><strong>å¯¹äº /usr/local/bin ç›®å½•è¯´æ˜ï¼š</strong></p><p><strong>è¯¥ç›®å½•ä¸‹çš„å¯æ‰§è¡Œå‘½ä»¤å·²ç»ä½œä¸ºç¯å¢ƒå˜é‡è€Œå­˜åœ¨ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚</strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost nginx<span class="token punctuation">]</span><span class="token comment"># echo $PATH</span>
/usr/local/nginx/sbin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å‰å°å¯åŠ¨" tabindex="-1"><a class="header-anchor" href="#å‰å°å¯åŠ¨" aria-hidden="true">#</a> å‰å°å¯åŠ¨</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost redis-6.2.1<span class="token punctuation">]</span><span class="token comment"># cd /usr/local/bin</span>
<span class="token punctuation">[</span>root@localhost bin<span class="token punctuation">]</span><span class="token comment"># ./redis-server</span>
<span class="token number">97713</span>:C <span class="token number">13</span> May <span class="token number">2022</span> 09:22:05.617 <span class="token comment"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span>
<span class="token number">97713</span>:C <span class="token number">13</span> May <span class="token number">2022</span> 09:22:05.617 <span class="token comment"># Redis version=6.2.1, bits=64, commit=00000000, modified=0, pid=97713, just started</span>
<span class="token number">97713</span>:C <span class="token number">13</span> May <span class="token number">2022</span> 09:22:05.617 <span class="token comment"># Warning: no config file specified, using the default config. In order to specify a config file use ./redis-server /path/to/redis.conf</span>
<span class="token number">97713</span>:M <span class="token number">13</span> May <span class="token number">2022</span> 09:22:05.618 * Increased maximum number of <span class="token function">open</span> files to <span class="token number">10032</span> <span class="token punctuation">(</span>it was originally <span class="token builtin class-name">set</span> to <span class="token number">1024</span><span class="token punctuation">)</span>.
<span class="token number">97713</span>:M <span class="token number">13</span> May <span class="token number">2022</span> 09:22:05.618 * monotonic clock: POSIX clock_gettime
                _._
           _.-`<span class="token variable"><span class="token variable">`</span>__ <span class="token string">&#39;&#39;</span>-._
      _.-<span class="token variable">`</span></span><span class="token variable"><span class="token variable">`</span>    <span class="token variable">`</span></span><span class="token builtin class-name">.</span>  <span class="token variable"><span class="token variable">`</span>_.  <span class="token string">&#39;&#39;</span>-._           Redis <span class="token number">6.2</span>.1 <span class="token punctuation">(</span>00000000/0<span class="token punctuation">)</span> <span class="token number">64</span> bit
  .-<span class="token variable">`</span></span><span class="token variable"><span class="token variable">`</span> .-<span class="token variable">`</span></span>`<span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">.</span>  <span class="token variable">`</span></span>`<span class="token variable"><span class="token variable">`</span><span class="token punctuation">\</span>/    _.,_ <span class="token string">&#39;&#39;</span>-._
 <span class="token punctuation">(</span>    &#39;      ,       .-<span class="token variable">`</span></span>  <span class="token operator">|</span> <span class="token variable"><span class="token variable">`</span>,    <span class="token punctuation">)</span>     Running <span class="token keyword">in</span> standalone mode
 <span class="token operator">|</span><span class="token variable">`</span></span>-._<span class="token variable"><span class="token variable">`</span>-<span class="token punctuation">..</span>.-<span class="token variable">`</span></span> __<span class="token punctuation">..</span>.-.`<span class="token variable"><span class="token variable">`</span>-._<span class="token operator">|</span>&#39;<span class="token variable">`</span></span> _.-<span class="token string">&#39;|     Port: 6379
 |    `-._   `._    /     _.-&#39;</span>    <span class="token operator">|</span>     PID: <span class="token number">97713</span>
  <span class="token variable"><span class="token variable">`</span>-._    <span class="token variable">`</span></span>-._  <span class="token variable"><span class="token variable">`</span>-./  _.-<span class="token string">&#39;    _.-&#39;</span>
 <span class="token operator">|</span><span class="token variable">`</span></span>-._<span class="token variable"><span class="token variable">`</span>-._    <span class="token variable">`</span></span>-.__.-<span class="token string">&#39;    _.-&#39;</span>_.-<span class="token string">&#39;|
 |    `-._`-._        _.-&#39;</span>_.-<span class="token string">&#39;    |           http://redis.io
  `-._    `-._`-.__.-&#39;</span>_.-<span class="token string">&#39;    _.-&#39;</span>
 <span class="token operator">|</span><span class="token variable"><span class="token variable">`</span>-._<span class="token variable">`</span></span>-._    <span class="token variable"><span class="token variable">`</span>-.__.-<span class="token string">&#39;    _.-&#39;</span>_.-&#39;<span class="token operator">|</span>
 <span class="token operator">|</span>    <span class="token variable">`</span></span>-._<span class="token variable"><span class="token variable">`</span>-._        _.-<span class="token string">&#39;_.-&#39;</span>    <span class="token operator">|</span>
  <span class="token variable">`</span></span>-._    <span class="token variable"><span class="token variable">`</span>-._<span class="token variable">`</span></span>-.__.-<span class="token string">&#39;_.-&#39;</span>    _.-<span class="token string">&#39;
      `-._    `-.__.-&#39;</span>    _.-<span class="token string">&#39;
          `-._        _.-&#39;</span>
              `-.__.-<span class="token string">&#39;

97713:M 13 May 2022 09:22:05.621 # WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.
97713:M 13 May 2022 09:22:05.621 # Server initialized
97713:M 13 May 2022 09:22:05.621 # WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add &#39;</span>vm.overcommit_memory <span class="token operator">=</span> <span class="token number">1</span><span class="token string">&#39; to /etc/sysctl.conf and then reboot or run the command &#39;</span><span class="token function">sysctl</span> <span class="token assign-left variable">vm.overcommit_memory</span><span class="token operator">=</span><span class="token number">1</span>&#39; <span class="token keyword">for</span> this to take effect.
<span class="token number">97713</span>:M <span class="token number">13</span> May <span class="token number">2022</span> 09:22:05.621 * Ready to accept connections
^C97713:signal-handler <span class="token punctuation">(</span><span class="token number">1652404933</span><span class="token punctuation">)</span> Received SIGINT scheduling shutdown<span class="token punctuation">..</span>.
<span class="token number">97713</span>:M <span class="token number">13</span> May <span class="token number">2022</span> 09:22:13.266 <span class="token comment"># User requested shutdown...</span>
<span class="token number">97713</span>:M <span class="token number">13</span> May <span class="token number">2022</span> 09:22:13.266 * Saving the final RDB snapshot before exiting.
<span class="token number">97713</span>:M <span class="token number">13</span> May <span class="token number">2022</span> 09:22:13.271 * DB saved on disk
<span class="token number">97713</span>:M <span class="token number">13</span> May <span class="token number">2022</span> 09:22:13.271 <span class="token comment"># Redis is now ready to exit, bye bye...</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="åå°å¯åŠ¨" tabindex="-1"><a class="header-anchor" href="#åå°å¯åŠ¨" aria-hidden="true">#</a> åå°å¯åŠ¨</h3><p>å¤‡ä»½ redis.confï¼Œæˆ–è€…æ‹·è´åˆ° /etc ç­‰å…¶ä»–ç›®å½•ä¸­ã€‚</p><p><strong>åå°å¯åŠ¨è®¾ç½® daemonize no æ”¹æˆ yes</strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost bin<span class="token punctuation">]</span><span class="token comment"># cp /opt/redis-6.2.1/redis.conf /etc</span>
<span class="token punctuation">[</span>root@localhost bin<span class="token punctuation">]</span><span class="token comment"># vim /etc/redis.conf</span>
<span class="token punctuation">[</span>root@localhost bin<span class="token punctuation">]</span><span class="token comment"># redis-server /etc/redis.conf</span>
<span class="token punctuation">[</span>root@localhost bin<span class="token punctuation">]</span><span class="token comment"># ps -ef |grep redis</span>
root      <span class="token number">97843</span>      <span class="token number">1</span>  <span class="token number">0</span> 09:30 ?        00:00:00 redis-server <span class="token number">127.0</span>.0.1:6379
root      <span class="token number">97849</span>  <span class="token number">93182</span>  <span class="token number">0</span> 09:30 pts/1    00:00:00 <span class="token function">grep</span> <span class="token parameter variable">--color</span><span class="token operator">=</span>auto redis
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># ps -aux|grep redis|grep -v grep</span>
root      <span class="token number">18370</span>  <span class="token number">0.4</span>  <span class="token number">0.2</span> <span class="token number">162540</span>  <span class="token number">2644</span> ?        Ssl  <span class="token number">12</span>:26   <span class="token number">0</span>:00 redis-server <span class="token number">127.0</span>.0.1:6379
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¤šä¸ªç«¯å£å¯åŠ¨å¯ä»¥ï¼š<code>redis-cli -p 6379</code></p><p>æ³¨æ„ï¼šæ­¤å¤„çš„ 127.0.0.1:6379 ä»…ä»…æ”¯æŒæœ¬åœ°è¿æ¥ï¼Œè¿œç¨‹è¿æ¥ï¼š<code>redis-cli -h 192.168.100.100 -p 6379</code></p><h3 id="å®¢æˆ·ç«¯è¿œç¨‹è¿æ¥" tabindex="-1"><a class="header-anchor" href="#å®¢æˆ·ç«¯è¿œç¨‹è¿æ¥" aria-hidden="true">#</a> å®¢æˆ·ç«¯è¿œç¨‹è¿æ¥</h3><p>ç¦ç”¨ Linux çš„é˜²ç«å¢™ï¼šLinuxï¼ˆCentOS7ï¼‰ é‡Œæ‰§è¡Œå‘½ä»¤</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>systemctl stop/disable firewalld.service
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æˆ–è€…å¼€æ”¾ç«¯å£ 6379</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># æŸ¥çœ‹å¼€æ”¾çš„ç«¯å£å·</span>
firewall-cmd --list-all
<span class="token comment"># è®¾ç½®å¼€æ”¾çš„ç«¯å£å·</span>
firewall-cmd --add-service<span class="token operator">=</span>redis <span class="token parameter variable">--permanent</span>
firewall-cmd --add-port<span class="token operator">=</span><span class="token number">6379</span>/tcp <span class="token parameter variable">--permanent</span>
<span class="token comment"># é‡å¯é˜²ç«å¢™</span>
firewall-cmd <span class="token parameter variable">--reload</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>redis.conf ä¸­æ³¨é‡Šæ‰ bind 127.0.0.1ï¼Œå¹¶ä¸”è®¾ç½®ï¼š protected-mode no</strong></p><p>ã€<strong>æ”¹é…ç½®å‰å¿…é¡»å…³æ‰ redisï¼Œå¦åˆ™ä¸ç”Ÿæ•ˆ</strong>ã€‘</p><div class="language-tex line-numbers-mode" data-ext="tex"><pre class="language-tex"><code>-DENIED Redis is running in protected mode because protected mode is enabled, no bind address was specified, no authentication password is requested to clients. In this mode connections are only accepted from the loopback interface. If you want to connect from external computers to Redis you may adopt one of the following solutions: 
1) Just disable protected mode sending the command &#39;CONFIG SET protected-mode no&#39; from the loopback interface by connecting to Redis from the same host the server is running, however MAKE SURE Redis is not publicly accessible from internet if you do so. Use CONFIG REWRITE to make this change permanent. 
2) Alternatively you can just disable the protected mode by editing the Redis configuration file, and setting the protected mode option to &#39;no&#39;, and then restarting the server. 
3) If you started the server manually just for testing, restart it with the &#39;--protected-mode no&#39; option. 
4) Setup a bind address or an authentication password. 
NOTE: You only need to do one of the above things in order for the server to start accepting connections from the outside. 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨å®¢æˆ·ç«¯å·¥å…· redis-cli è®¿é—®</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost bin<span class="token punctuation">]</span><span class="token comment"># redis-cli</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token function">ping</span>
PONG
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å…³é—­è¿æ¥" tabindex="-1"><a class="header-anchor" href="#å…³é—­è¿æ¥" aria-hidden="true">#</a> å…³é—­è¿æ¥</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># æ–¹å¼ä¸€ï¼š</span>
<span class="token punctuation">[</span>root@localhost bin<span class="token punctuation">]</span><span class="token comment"># redis-cli</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token function">shutdown</span>
not connected<span class="token operator">&gt;</span>
<span class="token punctuation">[</span>root@localhost bin<span class="token punctuation">]</span><span class="token comment"># ps -ef |grep redis|grep -v grep</span>
root      <span class="token number">97843</span>      <span class="token number">1</span>  <span class="token number">0</span> 09:30 ?        00:00:00 redis-server <span class="token number">127.0</span>.0.1:6379

<span class="token comment"># æ–¹å¼äºŒï¼š redis-cli shutdown</span>
<span class="token punctuation">[</span>root@localhost bin<span class="token punctuation">]</span><span class="token comment"># redis-cli shutdown</span>
<span class="token punctuation">[</span>root@localhost bin<span class="token punctuation">]</span><span class="token comment"># ps -ef |grep redis</span>
root      <span class="token number">97884</span>  <span class="token number">93182</span>  <span class="token number">0</span> 09:33 pts/1    00:00:00 <span class="token function">grep</span> <span class="token parameter variable">--color</span><span class="token operator">=</span>auto redis

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="å¸è½½" tabindex="-1"><a class="header-anchor" href="#å¸è½½" aria-hidden="true">#</a> å¸è½½</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code> <span class="token comment"># å¦‚æœå®‰è£…æ—¶æœªæŒ‡å®šå‰ç¼€è·¯å¾„ï¼Œåˆ™é»˜è®¤å®‰è£…åœ¨ /usr/local/bin ä¸‹</span>
<span class="token function">rm</span> <span class="token parameter variable">-f</span> /usr/local/redis/*
<span class="token comment"># åˆ é™¤å‘½ä»¤</span>
<span class="token function">rm</span> <span class="token parameter variable">-f</span> /usr/local/bin/redis-*
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="redis-åŸºç¡€çŸ¥è¯†" tabindex="-1"><a class="header-anchor" href="#redis-åŸºç¡€çŸ¥è¯†" aria-hidden="true">#</a> Redis åŸºç¡€çŸ¥è¯†</h2><p>ç«¯å£ 6379ï¼šAlessia Merz</p><ol><li>é»˜è®¤ 16 ä¸ªæ•°æ®åº“ï¼Œç±»ä¼¼æ•°ç»„ä¸‹æ ‡ä» 0 å¼€å§‹ï¼Œåˆå§‹é»˜è®¤ä½¿ç”¨ 0 å·åº“</li><li>ä½¿ç”¨å‘½ä»¤ select &lt;dbid&gt;æ¥åˆ‡æ¢æ•°æ®åº“ã€‚å¦‚ï¼šselect 8</li><li>ç»Ÿä¸€å¯†ç ç®¡ç†ï¼Œæ‰€æœ‰åº“åŒæ ·å¯†ç ã€‚</li><li>dbsize ï¼šæŸ¥çœ‹å½“å‰æ•°æ®åº“çš„ key çš„æ•°é‡</li><li>flushdb ï¼š æ¸…ç©ºå½“å‰åº“</li><li>flushall ï¼šé€šæ€å…¨éƒ¨åº“</li></ol><p><strong>Redis æ˜¯å•çº¿ç¨‹ + å¤šè·¯ IO å¤ç”¨æŠ€æœ¯</strong></p><blockquote><p>â€‹ å¤šè·¯å¤ç”¨æ˜¯æŒ‡ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹æ¥æ£€æŸ¥å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼ˆSocketï¼‰çš„å°±ç»ªçŠ¶æ€ï¼Œæ¯”å¦‚è°ƒç”¨ select å’Œ poll å‡½æ•°ï¼Œä¼ å…¥å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œå¦‚æœæœ‰ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦å°±ç»ªï¼Œ</p><p>åˆ™è¿”å›ï¼Œå¦åˆ™é˜»å¡ç›´åˆ°è¶…æ—¶ã€‚å¾—åˆ°å°±ç»ªçŠ¶æ€åè¿›è¡ŒçœŸæ­£çš„æ“ä½œå¯ä»¥åœ¨åŒä¸€ä¸ªçº¿ç¨‹é‡Œæ‰§è¡Œï¼Œä¹Ÿå¯ä»¥å¯åŠ¨çº¿ç¨‹æ‰§è¡Œï¼ˆæ¯”å¦‚ä½¿ç”¨çº¿ç¨‹æ± ï¼‰</p><p>ä¸²è¡Œ vs å¤šçº¿ç¨‹ + é”ï¼ˆmemcachedï¼‰ vs å•çº¿ç¨‹ + å¤šè·¯ IO å¤ç”¨ï¼ˆRedisï¼‰</p><p>ï¼ˆä¸ Memcache ä¸‰ç‚¹ä¸åŒï¼šæ”¯æŒå¤šæ•°æ®ç±»å‹ï¼Œæ”¯æŒæŒä¹…åŒ–ï¼Œå•çº¿ç¨‹ + å¤šè·¯ IO å¤ç”¨ï¼‰</p></blockquote><h1 id="å¸¸ç”¨äº”å¤§æ•°æ®ç±»å‹" tabindex="-1"><a class="header-anchor" href="#å¸¸ç”¨äº”å¤§æ•°æ®ç±»å‹" aria-hidden="true">#</a> å¸¸ç”¨äº”å¤§æ•°æ®ç±»å‹</h1><p>Redis å¸¸è§æ•°æ®ç±»å‹æ“ä½œå‘½ä»¤ï¼š<a href="http://www.redis.cn/commands.html" target="_blank" rel="noopener noreferrer">http://www.redis.cn/commands.html<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="redis-é”®-key" tabindex="-1"><a class="header-anchor" href="#redis-é”®-key" aria-hidden="true">#</a> Redis é”®ï¼ˆkeyï¼‰</h2><table><thead><tr><th>å‘½ä»¤</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>keys *</td><td>æŸ¥çœ‹å½“å‰åº“æ‰€æœ‰ keyï¼ˆåŒ¹é…ï¼š<code>keys *1</code> å¾—åˆ° &#39;k1&#39;ï¼‰ï¼Œä½œä¸ºé€šé…ç¬¦å­˜åœ¨ï¼Œ* ä»£è¡¨ä¸€ä¸ªæˆ–å¤šä¸ª</td></tr><tr><td>exists key</td><td>åˆ¤æ–­æŸä¸ª key æ˜¯å¦å­˜åœ¨</td></tr><tr><td>type key</td><td>æŸ¥çœ‹ key çš„ç±»å‹</td></tr><tr><td>del key</td><td>åˆ é™¤æŒ‡å®šçš„ key æ•°æ®</td></tr><tr><td>unlink key</td><td>æ ¹æ® value é€‰æ‹©éé˜»å¡åˆ é™¤ï¼Œä»…å°† keys ä» keyspace å…ƒæ•°æ®ä¸­åˆ é™¤ï¼ŒçœŸæ­£çš„åˆ é™¤ä¼šåœ¨åç»­å¼‚æ­¥æ“ä½œ</td></tr><tr><td>expire key 10</td><td>ä¸ºç»™å®šçš„ key è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œ10 ç§’</td></tr><tr><td>ttl key</td><td>æŸ¥çœ‹è¿˜æœ‰å¤šå°‘ç§’è¿‡æœŸï¼Œ-1 è¡¨ç¤ºæ°¸ä¸è¿‡æœŸï¼Œ-2 è¡¨ç¤ºå·²è¿‡æœŸ</td></tr></tbody></table><p>ç¤ºä¾‹ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">set</span> k1
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> ERR wrong number of arguments <span class="token keyword">for</span> <span class="token string">&#39;set&#39;</span> <span class="token builtin class-name">command</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">set</span> k1 v1
OK
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">set</span> k2 v2
OK
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">set</span> k3 v3
OK
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> keys *
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;k3&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;k2&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;k1&quot;</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> dbsize
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> exists k2
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">type</span> k1
string
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> expire k3 <span class="token number">10</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> ttl k3
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">7</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> ttl k3
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">4</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> ttl k3
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token parameter variable">-2</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> keys *
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;k2&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;k1&quot;</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> del k2
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> keys *
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;k1&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="redis-å­—ç¬¦ä¸²-string" tabindex="-1"><a class="header-anchor" href="#redis-å­—ç¬¦ä¸²-string" aria-hidden="true">#</a> Redis å­—ç¬¦ä¸²ï¼ˆStringï¼‰</h2><h3 id="ç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#ç®€ä»‹" aria-hidden="true">#</a> ç®€ä»‹</h3><ul><li><p>String æ˜¯ Redis æœ€åŸºæœ¬çš„ç±»å‹ï¼Œå¯ä»¥ç†è§£æˆä¸ Memcached ä¸€æ¨¡ä¸€æ ·çš„ç±»å‹ï¼Œä¸€ä¸ª key å¯¹åº”ä¸€ä¸ª valueã€‚</p></li><li><p>String ç±»å‹æ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ã€‚æ„å‘³ç€ Redis çš„ String å¯ä»¥åŒ…å«ä»»ä½•æ•°æ®ã€‚æ¯”å¦‚ jpg å›¾ç‰‡æˆ–è€…åºåˆ—åŒ–çš„å¯¹è±¡ã€‚</p></li><li><p>String ç±»å‹æ˜¯ Redis æœ€åŸºæœ¬çš„æ•°æ®ç±»å‹ï¼Œä¸€ä¸ª Redis ä¸­å­—ç¬¦ä¸² value æœ€å¤šå¯ä»¥æ˜¯ 512M</p></li></ul><h3 id="å¸¸ç”¨å‘½ä»¤" tabindex="-1"><a class="header-anchor" href="#å¸¸ç”¨å‘½ä»¤" aria-hidden="true">#</a> å¸¸ç”¨å‘½ä»¤</h3><ol><li><code>set &lt;key&gt;&lt;value&gt; æ·»åŠ é”®å€¼å¯¹</code></li></ol><ul><li><p>*<strong>NXï¼šå½“æ•°æ®åº“ä¸­ key ä¸å­˜åœ¨æ—¶ï¼Œå¯ä»¥å°† key-value æ·»åŠ æ•°æ®åº“</strong></p></li><li><p>*XXï¼šå½“æ•°æ®åº“ä¸­ key å­˜åœ¨æ—¶ï¼Œå¯ä»¥å°† key-value æ·»åŠ æ•°æ®åº“ï¼Œä¸ NX å‚æ•°äº’æ–¥</p></li><li><p>*<strong>EXï¼škey çš„è¶…æ—¶ç§’æ•°ï¼Œsetex k2 10 v2</strong></p></li><li><p>*PXï¼škey çš„è¶…æ—¶æ¯«ç§’æ•°ï¼Œä¸ EX äº’æ–¥</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> <span class="token keyword">set</span> k1 v1
OK
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> setnx k1 v11
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">0</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> setex k2 <span class="token number">10</span> v2
OK
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> ttl k2
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">7</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> ttl k2
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">3</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><ol start="2"><li><p><code>get &lt;key&gt;æŸ¥è¯¢å¯¹åº”é”®å€¼</code></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> get k1
<span class="token string">&quot;v1&quot;</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> get k2
<span class="token punctuation">(</span>nil<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>append &lt;key&gt;&lt;value&gt;å°†ç»™å®šçš„&lt;value&gt; è¿½åŠ åˆ°åŸå€¼çš„æœ«å°¾</code></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> append k1 v1v1
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">6</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> get k1
<span class="token string">&quot;v1v1v1&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>strlen &lt;key&gt;è·å¾—å€¼çš„é•¿åº¦</code></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> strlen k1
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">6</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>setnx &lt;key&gt;&lt;value&gt;</code>åªæœ‰åœ¨ key ä¸å­˜åœ¨æ—¶ è®¾ç½® key çš„å€¼</p></li><li><p><code>incr &lt;key&gt; </code> å°† key ä¸­å‚¨å­˜çš„æ•°å­—å€¼å¢ 1ï¼Œåªèƒ½å¯¹æ•°å­—å€¼æ“ä½œï¼Œå¦‚æœä¸ºç©ºï¼Œæ–°å¢å€¼ä¸º 1</p></li><li><p><code>decr &lt;key&gt;</code> å°† key ä¸­å‚¨å­˜çš„æ•°å­—å€¼å‡1ï¼Œåªèƒ½å¯¹æ•°å­—å€¼æ“ä½œï¼Œå¦‚æœä¸ºç©ºï¼Œæ–°å¢å€¼ä¸º -1</p></li><li><p><code>incrby / decrby &lt;key&gt;&lt;æ­¥é•¿&gt;</code> å°† key ä¸­å‚¨å­˜çš„æ•°å­—å€¼å¢å‡ã€‚è‡ªå®šä¹‰æ­¥é•¿ã€‚ã€åŸå­æ“ä½œã€‘</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> get k1
v1
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> incr k1
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> ERR <span class="token keyword">value</span> <span class="token operator">is</span> <span class="token operator">not</span> an <span class="token keyword">integer</span> <span class="token operator">or</span> <span class="token keyword">out</span> <span class="token keyword">of</span> range

<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> <span class="token keyword">set</span> k2 <span class="token number">2</span>
OK
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> incr k2
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">3</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> incr k2
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">4</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> get k2
<span class="token string">&quot;4&quot;</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> decr k2
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">3</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> incrby k2 <span class="token number">3</span>
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">6</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> incrby k2 <span class="token number">3</span>
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">9</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> decrby k2 <span class="token number">1</span>
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">8</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> get k2
<span class="token string">&quot;8&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>mset &lt;key1&gt;&lt;value1&gt;&lt;key2&gt;&lt;value2&gt;</code> åŒæ—¶è®¾ç½®ä¸€ä¸ªæˆ–å¤šä¸ª key-value å¯¹</p></li><li><p><code>mget &lt;key1&gt;&lt;key2&gt;&lt;key3&gt;</code> åŒæ—¶è·å–ä¸€ä¸ªæˆ–å¤šä¸ª value</p></li><li><p><code>msetnx &lt;key1&gt;&lt;value1&gt;&lt;key2&gt;&lt;value2&gt;</code> åŒæ—¶è®¾ç½®ä¸€ä¸ªæˆ–å¤šä¸ª key-value å¯¹ï¼Œå½“ä¸”ä»…å½“æ‰€æœ‰ç»™å®š key éƒ½ä¸å­˜åœ¨ã€‚</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> mset k1 v1 k2 v2
OK
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> mget k1 k2
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;v1&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;v2&quot;</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> msetnx k3 v3 k4 v4
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> msetnx k3 k33 k5 v5
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">0</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> get k5
<span class="token punctuation">(</span>nil<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>åŸå­æ€§ï¼Œæœ‰ä¸€ä¸ªå¤±è´¥åˆ™éƒ½å¤±è´¥</strong></p></li><li><p><code>getrange &lt;key&gt;&lt;èµ·å§‹ä½ç½®&gt;&lt;ç»“æŸä½ç½®&gt;</code> è·å¾—å€¼çš„èŒƒå›´ï¼Œç±»ä¼¼ substringï¼Œ<strong>å‰åŒ…ï¼ŒååŒ…</strong></p></li><li><p><code>setrange &lt;key&gt;&lt;èµ·å§‹ä½ç½®&gt;&lt;value&gt; ç”¨ &lt;value&gt; è¦†å†™&lt;key&gt;æ‰€å‚¨å­˜çš„å­—ç¬¦ä¸²å€¼</code>ï¼Œä»èµ·å§‹ä½ç½®å¼€å§‹ï¼ˆç´¢å¼•ä»0å¼€å§‹ï¼‰ã€‚</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> <span class="token keyword">set</span> k1 abcdefg
OK
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> getrange k1 <span class="token number">2</span> <span class="token number">4</span>
<span class="token string">&quot;cde&quot;</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> setrange k1 <span class="token number">1</span> xxx
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">7</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> get k1
<span class="token string">&quot;axxxefg&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>setex &lt;key&gt;&lt;è¿‡æœŸæ—¶é—´&gt;&lt;value&gt;</code> è®¾ç½®é”®å€¼çš„åŒæ—¶ï¼Œè®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå•ä½ç§’ã€‚</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> setex k2 <span class="token number">10</span> v2
OK
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> ttl k2
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">7</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>getset &lt;key&gt;&lt;value&gt; ä»¥æ–°æ¢æ—§</code>ï¼Œè®¾ç½®äº†æ–°å€¼åŒæ—¶è·å¾—æ—§å€¼ï¼Œé‡æ–°è®¾ç½®åˆ™é»˜è®¤æ°¸ä¸è¿‡æœŸ</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> <span class="token keyword">set</span> k3 v3
OK
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> getset k3 v33
<span class="token string">&quot;v3&quot;</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> get k3
<span class="token string">&quot;v33&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>åŸå­æ€§ï¼š</p><p>æ‰€è°“ <strong>åŸå­æ“ä½œ</strong> æ˜¯æŒ‡ä¸ä¼šè¢«çº¿ç¨‹è°ƒåº¦æœºåˆ¶æ‰“æ–­çš„æ“ä½œã€‚</p><p>è¿™ç§æ“ä½œä¸€æ—¦å¼€å§‹ï¼Œå°±ä¸€ç›´è¿è¡Œåˆ°ç»“æŸï¼Œä¸­é—´ä¸ä¼šæœ‰ä»»ä½• context switch ã€‚</p><p>ï¼ˆ1ï¼‰åœ¨å•çº¿ç¨‹ä¸­ï¼Œ èƒ½å¤Ÿåœ¨å•æ¡æŒ‡ä»¤ä¸­å®Œæˆçš„æ“ä½œéƒ½å¯ä»¥è®¤ä¸ºæ˜¯ &quot;åŸå­æ“ä½œ&quot;ï¼Œå› ä¸ºä¸­æ–­åªèƒ½å‘ç”ŸäºæŒ‡ä»¤ä¹‹é—´ã€‚</p><p>ï¼ˆ2ï¼‰åœ¨å¤šçº¿ç¨‹ä¸­ï¼Œä¸èƒ½è¢«å…¶å®ƒè¿›ç¨‹ï¼ˆçº¿ç¨‹ï¼‰æ‰“æ–­çš„æ“ä½œå°±å«åŸå­æ“ä½œã€‚</p><p><strong>Redis å•å‘½ä»¤çš„åŸå­æ€§ä¸»è¦å¾—ç›Šäº Redis çš„å•çº¿ç¨‹ã€‚</strong></p><p><mark> Redis ä¸­çš„ incr/decr æ˜¯åŸå­æ“ä½œ</mark></p><p><strong>æ¡ˆä¾‹ï¼š</strong></p><p>Javaä¸­çš„ i++ æ˜¯å¦æ˜¯åŸå­æ“ä½œï¼Ÿ<strong>ä¸æ˜¯</strong></p><p>i=0; ä¸¤ä¸ªçº¿ç¨‹åˆ†åˆ«å¯¹ i è¿›è¡Œ ++100æ¬¡ï¼Œå€¼æ˜¯å¤šå°‘ï¼Ÿã€2-200ã€‘</p><figure><img src="/assets/i__ä¸æ˜¯åŸå­æ“ä½œ-43ec8a0a.png" alt="i++ä¸æ˜¯åŸå­æ“ä½œ" tabindex="0" loading="lazy"><figcaption>i++ä¸æ˜¯åŸå­æ“ä½œ</figcaption></figure><p>è¯´æ˜ï¼š</p><p>i++ çš„æ“ä½œåˆ†ä¸ºä¸‰æ­¥ï¼šå–å€¼ï¼Œ++ï¼Œå†èµ‹å€¼</p><p>a çº¿ç¨‹åŠ åˆ° 99 ä½†æœªèµ‹å€¼ï¼Œè¢« b çº¿ç¨‹æ‰“æ–­å¹¶è¿›è¡ŒåŠ  1 æ“ä½œï¼Œæ­¤æ—¶ a çº¿ç¨‹æ‰§è¡Œèµ‹å€¼æ“ä½œ i=1ï¼Œb çº¿ç¨‹æ‰“æ–­å¹¶åŠ åˆ° 99ï¼Œi++ å i = 100ï¼Œa çº¿ç¨‹æ‰“æ–­ï¼Œå†æ¬¡ i++ ï¼Œæœ€ç»ˆå€¼ä¸º 2ï¼Œä¸¤ä¸ªçº¿ç¨‹éƒ½æ‰§è¡Œäº†100æ¬¡ï¼Œæ‰€ä»¥æœ€ç»ˆçš„èŒƒå›´æ˜¯ [2, 200]</p><h3 id="æ•°æ®ç»“æ„" tabindex="-1"><a class="header-anchor" href="#æ•°æ®ç»“æ„" aria-hidden="true">#</a> æ•°æ®ç»“æ„</h3><p>â€‹ String çš„æ•°æ®ç»“æ„ä¸ºç®€å•åŠ¨æ€å­—ç¬¦ä¸²ï¼ˆSimple Dynamic Stringï¼Œç¼©å†™ SDSï¼‰ã€‚æ˜¯å¯ä»¥ä¿®æ”¹çš„å­—ç¬¦ä¸²ï¼Œå†…éƒ¨ç»“æ„å®ç°ä¸Šç±»ä¼¼äºJava çš„ ArrayListï¼Œ<strong>é‡‡ç”¨é¢„åˆ†é…å†—ä½™ç©ºé—´çš„æ–¹å¼æ¥å‡å°‘å†…å­˜çš„é¢‘ç¹åˆ†é…ã€‚</strong></p><figure><img src="/assets/å­—ç¬¦ä¸²æ•°æ®ç»“æ„-4babb07c.png" alt="å­—ç¬¦ä¸²æ•°æ®ç»“æ„" tabindex="0" loading="lazy"><figcaption>å­—ç¬¦ä¸²æ•°æ®ç»“æ„</figcaption></figure><p>â€‹ å¦‚å›¾ä¸­æ‰€ç¤ºï¼Œå†…éƒ¨ä¸ºå½“å‰å­—ç¬¦ä¸²å®é™…åˆ†é…çš„ç©ºé—´ capacity ä¸€èˆ¬è¦é«˜äºå®é™…å­—ç¬¦ä¸²é•¿åº¦ lenã€‚å½“å­—ç¬¦ä¸²é•¿åº¦å°äº 1M æ—¶ï¼Œæ‰©å®¹éƒ½æ˜¯åŠ å€ç°æœ‰çš„ç©ºé—´ï¼Œå¦‚æœè¶…è¿‡ 1Mï¼Œæ‰©å®¹æ—¶ä¸€æ¬¡åªä¼šå¤šæ‰© 1M çš„ç©ºé—´ã€‚éœ€è¦æ³¨æ„çš„æ˜¯å­—ç¬¦ä¸²æœ€å¤§é•¿åº¦ä¸º 512Mã€‚</p><h2 id="redis-åˆ—è¡¨-list" tabindex="-1"><a class="header-anchor" href="#redis-åˆ—è¡¨-list" aria-hidden="true">#</a> Redis åˆ—è¡¨ï¼ˆListï¼‰</h2><h3 id="ç®€ä»‹-1" tabindex="-1"><a class="header-anchor" href="#ç®€ä»‹-1" aria-hidden="true">#</a> ç®€ä»‹</h3><p>å•é”®å¤šå€¼</p><p>â€‹ Redis åˆ—è¡¨æ˜¯ç®€å•çš„å­—ç¬¦ä¸²åˆ—è¡¨ï¼ŒæŒ‰ç…§æ’å…¥é¡ºåºæ’åºã€‚ä½ å¯ä»¥æ·»åŠ ä¸€ä¸ªå…ƒç´ åˆ°åˆ—è¡¨çš„å¤´éƒ¨ï¼ˆå·¦è¾¹ï¼‰æˆ–è€…å°¾éƒ¨ï¼ˆå³è¾¹ï¼‰ã€‚å®ƒçš„åº•å±‚å®é™…æ˜¯ä¸ªåŒå‘é“¾è¡¨ï¼Œå¯¹ä¸¤ç«¯çš„æ“ä½œæ€§èƒ½å¾ˆé«˜ï¼Œé€šè¿‡ç´¢å¼•ä¸‹æ ‡çš„æ“ä½œä¸­é—´çš„èŠ‚ç‚¹æ€§èƒ½ä¼šè¾ƒå·®ã€‚</p><figure><img src="/assets/é“¾è¡¨-5b720b55.png" alt="é“¾è¡¨" tabindex="0" loading="lazy"><figcaption>é“¾è¡¨</figcaption></figure><h3 id="å¸¸ç”¨å‘½ä»¤-1" tabindex="-1"><a class="header-anchor" href="#å¸¸ç”¨å‘½ä»¤-1" aria-hidden="true">#</a> å¸¸ç”¨å‘½ä»¤</h3><ol><li><p><code>lpush/rpush &lt;key&gt;&lt;value1&gt;&lt;value2&gt;&lt;value3&gt; .... ä»å·¦è¾¹/å³è¾¹æ’å…¥ä¸€ä¸ªæˆ–å¤šä¸ªå€¼ã€‚</code></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> lpush code java go c<span class="token operator">+</span><span class="token operator">+</span>
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">3</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> lrange code <span class="token number">0</span> <span class="token operator">-</span><span class="token number">1</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;c++&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;go&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;java&quot;</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> rpush code python scala
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">5</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> lrange code <span class="token number">0</span> <span class="token operator">-</span><span class="token number">1</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;c++&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;go&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;java&quot;</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">&quot;python&quot;</span>
<span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">&quot;scala&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>lrange &lt;key&gt;&lt;start&gt;&lt;stop&gt; æŒ‰ç…§ç´¢å¼•ä¸‹æ ‡è·å¾—å…ƒç´ (ä»å·¦åˆ°å³)ï¼Œï¼ˆ0 åˆ° -1è¡¨ç¤ºè·å–æ‰€æœ‰ï¼‰</code></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> lrange code <span class="token number">0</span> <span class="token number">2</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;c++&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;go&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;java&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>lpop/rpop &lt;key&gt; &lt;count&gt;ä»å·¦è¾¹/å³è¾¹å¼¹å‡ºä¸€ä¸ªæˆ–å¤šä¸ªå€¼ã€‚</code></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> lpop code
<span class="token string">&quot;c++&quot;</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> rpop code <span class="token number">2</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;scala&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;python&quot;</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> lrange code <span class="token number">0</span> <span class="token operator">-</span><span class="token number">1</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;go&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;java&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>rpoplpush &lt;key1&gt;&lt;key2&gt;ä»&lt;key1&gt;åˆ—è¡¨å³è¾¹å¼¹å‡ºä¸€ä¸ªå€¼ï¼Œæ’åˆ°&lt;key2&gt;åˆ—è¡¨å·¦è¾¹ã€‚</code></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> rpush list01 A B C
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">3</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> rpush list02 D E F
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">3</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> rpoplpush list01 list02
<span class="token string">&quot;C&quot;</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> lrange list01 <span class="token number">0</span> <span class="token operator">-</span><span class="token number">1</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;A&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;B&quot;</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> lrange list02 <span class="token number">0</span> <span class="token operator">-</span><span class="token number">1</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;C&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;D&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;E&quot;</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">&quot;F&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>lindex &lt;key&gt;&lt;index&gt;æŒ‰ç…§ç´¢å¼•ä¸‹æ ‡è·å¾—å…ƒç´ (ä»å·¦åˆ°å³)</code></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> lrange list02 <span class="token number">0</span> <span class="token operator">-</span><span class="token number">1</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;C&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;D&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;E&quot;</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">&quot;F&quot;</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> lindex list02 <span class="token number">2</span>
<span class="token string">&quot;E&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>llen &lt;key&gt;è·å¾—åˆ—è¡¨é•¿åº¦ </code></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> llen list02
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">4</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>linsert &lt;key&gt; before &lt;value&gt;&lt;newvalue&gt;åœ¨&lt;value&gt;çš„åé¢æ’å…¥&lt;newvalue&gt;æ’å…¥å€¼</code></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> rpush list A B C D
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">4</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> linsert list before C X
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">5</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> lrange list <span class="token number">0</span> <span class="token operator">-</span><span class="token number">1</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;A&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;B&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;X&quot;</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">&quot;C&quot;</span>
<span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">&quot;D&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>lrem &lt;key&gt;&lt;n&gt;&lt;value&gt;ä»å·¦è¾¹åˆ é™¤ n ä¸ª value (ä»å·¦åˆ°å³)</code></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> rpush list A B B B C D
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">6</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> lrem list <span class="token number">2</span> B
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">2</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> lrange list <span class="token number">0</span> <span class="token operator">-</span><span class="token number">1</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;A&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;B&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;C&quot;</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">&quot;D&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>lset&lt;key&gt;&lt;index&gt;&lt;value&gt;å°†åˆ—è¡¨keyä¸‹æ ‡ä¸ºindexçš„å€¼æ›¿æ¢æˆvalue</code></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> lset list <span class="token number">2</span> CC
OK
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> lrange list <span class="token number">0</span> <span class="token operator">-</span><span class="token number">1</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;A&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;B&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;CC&quot;</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">&quot;D&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h3 id="æ•°æ®ç»“æ„-1" tabindex="-1"><a class="header-anchor" href="#æ•°æ®ç»“æ„-1" aria-hidden="true">#</a> æ•°æ®ç»“æ„</h3><p><strong>List çš„æ•°æ®ç»“æ„ä¸ºå¿«é€Ÿé“¾è¡¨ quickListã€‚</strong></p><p>é¦–å…ˆåœ¨åˆ—è¡¨å…ƒç´ è¾ƒå°‘çš„æƒ…å†µä¸‹ä¼šä½¿ç”¨ä¸€å—è¿ç»­çš„å†…å­˜å­˜å‚¨ï¼Œè¿™ä¸ªç»“æ„æ˜¯ ziplistï¼Œä¹Ÿå³æ˜¯å‹ç¼©åˆ—è¡¨ï¼Œå®ƒå°†æ‰€æœ‰çš„å…ƒç´ ç´§æŒ¨ç€ä¸€èµ·å­˜å‚¨ï¼Œåˆ†é…çš„æ˜¯ä¸€å—è¿ç»­çš„å†…å­˜ã€‚</p><p>å½“æ•°æ®é‡æ¯”è¾ƒå¤šçš„æ—¶å€™æ‰ä¼šæ”¹æˆ quicklistã€‚</p><p>å› ä¸ºæ™®é€šçš„é“¾è¡¨éœ€è¦çš„é™„åŠ æŒ‡é’ˆç©ºé—´å¤ªå¤§ï¼Œä¼šæ¯”è¾ƒæµªè´¹ç©ºé—´ã€‚æ¯”å¦‚è¿™ä¸ªåˆ—è¡¨é‡Œå­˜çš„åªæ˜¯ int ç±»å‹çš„æ•°æ®ï¼Œç»“æ„ä¸Šè¿˜éœ€è¦ä¸¤ä¸ªé¢å¤–çš„æŒ‡é’ˆ prev å’Œ nextã€‚</p><figure><img src="/assets/Listæ•°æ®ç»“æ„QuickList-e92d29c7.png" alt="Listæ•°æ®ç»“æ„QuickList" tabindex="0" loading="lazy"><figcaption>Listæ•°æ®ç»“æ„QuickList</figcaption></figure><p>Redis å°†é“¾è¡¨å’Œ ziplist ç»“åˆèµ·æ¥ç»„æˆäº† quicklistã€‚ä¹Ÿå°±æ˜¯å°†å¤šä¸ª ziplist ä½¿ç”¨åŒå‘æŒ‡é’ˆä¸²èµ·æ¥ä½¿ç”¨ã€‚è¿™æ ·æ—¢æ»¡è¶³äº†å¿«é€Ÿçš„æ’å…¥åˆ é™¤æ€§èƒ½ï¼Œåˆä¸ä¼šå‡ºç°å¤ªå¤§çš„ç©ºé—´å†—ä½™ã€‚</p><h2 id="redis-é›†åˆ-set" tabindex="-1"><a class="header-anchor" href="#redis-é›†åˆ-set" aria-hidden="true">#</a> Redis é›†åˆï¼ˆSetï¼‰</h2><h3 id="ç®€ä»‹-2" tabindex="-1"><a class="header-anchor" href="#ç®€ä»‹-2" aria-hidden="true">#</a> ç®€ä»‹</h3><p>â€‹ Set å¯¹å¤–æä¾›çš„åŠŸèƒ½ä¸ List ç±»ä¼¼æ˜¯ä¸€ä¸ªåˆ—è¡¨çš„åŠŸèƒ½ï¼Œç‰¹æ®Šä¹‹å¤„åœ¨äº Set æ˜¯å¯ä»¥<strong>è‡ªåŠ¨å»é‡</strong>çš„ï¼Œå½“ä½ éœ€è¦å­˜å‚¨ä¸€ä¸ªåˆ—è¡¨æ•°æ®ï¼Œåˆä¸å¸Œæœ›å‡ºç°é‡å¤æ•°æ®æ—¶ï¼ŒSet æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼Œå¹¶ä¸” Set æä¾›äº†åˆ¤æ–­æŸä¸ªæˆå‘˜æ˜¯å¦åœ¨ä¸€ä¸ª Set é›†åˆå†…çš„é‡è¦æ¥å£ï¼Œè¿™ä¸ªä¹Ÿæ˜¯ List æ‰€ä¸èƒ½æä¾›çš„ã€‚</p><p>â€‹ <strong>Redis çš„ Set æ˜¯ String ç±»å‹çš„æ— åºé›†åˆã€‚<strong>å®ƒåº•å±‚å…¶å®æ˜¯ä¸€ä¸ª value ä¸º null çš„ hash è¡¨ï¼Œæ‰€ä»¥æ·»åŠ ï¼Œåˆ é™¤ï¼ŒæŸ¥æ‰¾çš„</strong>å¤æ‚åº¦éƒ½æ˜¯</strong>O(1)ã€‚ä¸€ä¸ªç®—æ³•ï¼Œéšç€æ•°æ®çš„å¢åŠ ï¼Œæ‰§è¡Œæ—¶é—´çš„é•¿çŸ­ï¼Œå¦‚æœæ˜¯ O(1)ï¼Œæ•°æ®å¢åŠ ï¼ŒæŸ¥æ‰¾æ•°æ®çš„æ—¶é—´ä¸å˜ã€‚</p><h3 id="å¸¸ç”¨å‘½ä»¤-2" tabindex="-1"><a class="header-anchor" href="#å¸¸ç”¨å‘½ä»¤-2" aria-hidden="true">#</a> å¸¸ç”¨å‘½ä»¤</h3><ol><li><p><code>sadd &lt;key&gt;&lt;value1&gt;&lt;value2&gt;</code> å°†ä¸€ä¸ªæˆ–å¤šä¸ª member å…ƒç´ åŠ å…¥åˆ°é›†åˆ key ä¸­ï¼Œå·²å­˜åœ¨çš„ member å…ƒç´ å°†è¢«å¿½ç•¥</p></li><li><p><code>smembers &lt;key&gt;</code> å–å‡ºè¯¥é›†åˆçš„æ‰€æœ‰å€¼ã€‚</p></li><li><p><code>sismember &lt;key&gt;&lt;value&gt; åˆ¤æ–­é›†åˆ&lt;key&gt;æ˜¯å¦ä¸ºå«æœ‰è¯¥&lt;value&gt;å€¼ï¼Œæœ‰1ï¼Œæ²¡æœ‰0</code></p></li><li><p><code>scard&lt;key&gt; è¿”å›è¯¥é›†åˆçš„å…ƒç´ ä¸ªæ•°ã€‚</code></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> sadd set01 A A B C C
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">3</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> smembers set01
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;B&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;C&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;A&quot;</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> sismember set01 C
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> scard set01
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">3</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>srem &lt;key&gt;&lt;value1&gt;&lt;value2&gt; åˆ é™¤é›†åˆä¸­çš„æŸä¸ªå…ƒç´ ã€‚</code></p></li><li><p><code>spop &lt;key&gt; éšæœºä»è¯¥é›†åˆä¸­å¼¹å‡ºä¸€ä¸ªå€¼ã€‚</code></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> smembers set01
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;F&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;B&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;E&quot;</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">&quot;A&quot;</span>
<span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">&quot;C&quot;</span>
<span class="token number">6</span><span class="token punctuation">)</span> <span class="token string">&quot;D&quot;</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> srem set01 D
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> smembers set01
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;F&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;B&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;E&quot;</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">&quot;A&quot;</span>
<span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">&quot;C&quot;</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> spop set01 <span class="token number">2</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;A&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;C&quot;</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> smembers set01
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;F&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;B&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;E&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>srandmember &lt;key&gt;&lt;n&gt; éšæœºä»è¯¥é›†åˆä¸­å–å‡ºnä¸ªå€¼ã€‚ä¸ä¼šä»é›†åˆä¸­åˆ é™¤ ã€‚</code></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> sadd set01  A B C D E F
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">6</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> srandmember set01 <span class="token number">2</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;E&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;C&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>smove &lt;source&gt;&lt;destination&gt; value æŠŠé›†åˆä¸­ä¸€ä¸ªå€¼ä»ä¸€ä¸ªé›†åˆç§»åŠ¨åˆ°å¦ä¸€ä¸ªé›†åˆã€‚</code></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> sadd set01 A B C
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">3</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> smove set01 set02 A
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> smembers set02
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;A&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>sinter &lt;key1&gt;&lt;key2&gt; è¿”å›ä¸¤ä¸ªé›†åˆçš„äº¤é›†å…ƒç´ ã€‚</code></p></li><li><p><code>sunion &lt;key1&gt;&lt;key2&gt;è¿”å›ä¸¤ä¸ªé›†åˆçš„å¹¶é›†å…ƒç´ ã€‚</code></p></li><li><p><code>sdiff &lt;key1&gt;&lt;key2&gt; è¿”å›ä¸¤ä¸ªé›†åˆçš„å·®é›†å…ƒç´ ï¼ˆkey1ä¸­çš„ï¼Œä¸åŒ…å«key2ä¸­çš„ï¼‰ã€‚</code></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> sadd set01 A C D
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">3</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> sadd set02 B C E
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">3</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> sinter set01 set02
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;C&quot;</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> sunion set01 set02
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;A&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;C&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;D&quot;</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">&quot;B&quot;</span>
<span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">&quot;E&quot;</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> sdiff set01 set02
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;A&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;D&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h3 id="æ•°æ®ç»“æ„-2" tabindex="-1"><a class="header-anchor" href="#æ•°æ®ç»“æ„-2" aria-hidden="true">#</a> æ•°æ®ç»“æ„</h3><p>Set æ•°æ®ç»“æ„æ˜¯ dict å­—å…¸ï¼Œå­—å…¸æ˜¯ç”¨å“ˆå¸Œè¡¨å®ç°çš„ã€‚</p><p>â€‹ Java ä¸­ HashSet çš„å†…éƒ¨å®ç°ä½¿ç”¨çš„æ˜¯ HashMapï¼Œåªä¸è¿‡æ‰€æœ‰çš„ value éƒ½æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ã€‚Redis çš„ Set ç»“æ„ä¹Ÿæ˜¯ä¸€æ ·ï¼Œå®ƒçš„å†…éƒ¨ä¹Ÿä½¿ç”¨ hash ç»“æ„ï¼Œæ‰€æœ‰çš„ value éƒ½æŒ‡å‘åŒä¸€ä¸ªå†…éƒ¨å€¼ã€‚</p><h2 id="redis-å“ˆå¸Œ-hash" tabindex="-1"><a class="header-anchor" href="#redis-å“ˆå¸Œ-hash" aria-hidden="true">#</a> Redis å“ˆå¸Œï¼ˆHashï¼‰</h2><h3 id="ç®€ä»‹-3" tabindex="-1"><a class="header-anchor" href="#ç®€ä»‹-3" aria-hidden="true">#</a> ç®€ä»‹</h3><p>Redis hash æ˜¯ä¸€ä¸ªé”®å€¼å¯¹é›†åˆã€‚</p><p>Redis hash æ˜¯ä¸€ä¸ª String ç±»å‹çš„ field å’Œ value çš„æ˜ å°„è¡¨ï¼Œ<mark>hash ç‰¹åˆ«é€‚åˆç”¨äºå­˜å‚¨å¯¹è±¡ã€‚</mark></p><p>ç±»ä¼¼ Java é‡Œé¢çš„ Map&lt;String, Object&gt;</p><h3 id="å¸¸ç”¨å‘½ä»¤-3" tabindex="-1"><a class="header-anchor" href="#å¸¸ç”¨å‘½ä»¤-3" aria-hidden="true">#</a> å¸¸ç”¨å‘½ä»¤</h3><ol><li><p><code>hset &lt;key&gt;&lt;field&gt;&lt;value&gt; ç»™&lt;key&gt;é›†åˆä¸­çš„ &lt;field&gt;é”®èµ‹å€¼&lt;value&gt;</code></p></li><li><p><code>hget &lt;key1&gt;&lt;field&gt;</code> <code>ä»&lt;key1&gt;é›†åˆ&lt;field&gt;å–å‡º value </code></p></li><li><p><code>hmset &lt;key1&gt;&lt;field1&gt;&lt;value1&gt;&lt;field2&gt;&lt;value2&gt;</code> æ‰¹é‡è®¾ç½® hash çš„å€¼</p></li><li><p><code>hexists&lt;key1&gt;&lt;field&gt;</code> æŸ¥çœ‹å“ˆå¸Œè¡¨ key ä¸­ï¼Œç»™å®šåŸŸ field æ˜¯å¦å­˜åœ¨ã€‚</p></li><li><p><code>hkeys &lt;key&gt; </code> åˆ—å‡ºè¯¥hashé›†åˆçš„æ‰€æœ‰field</p></li><li><p><code>hvals &lt;key&gt; </code> åˆ—å‡ºè¯¥hashé›†åˆçš„æ‰€æœ‰value</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> hset hash01 id <span class="token number">1</span>
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> hget hash01 id
<span class="token string">&quot;1&quot;</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> hmset hash02 name tom age <span class="token number">12</span> gender man
OK
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> hexists hash02 birth
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">0</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> hkeys hash02
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;name&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;age&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;gender&quot;</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> hvals hash02
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;tom&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;12&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;man&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>hincrby &lt;key&gt;&lt;field&gt;&lt;increment&gt; </code> ä¸ºå“ˆå¸Œè¡¨ key ä¸­çš„åŸŸ field çš„å€¼åŠ ä¸Šå¢é‡ 1 -1</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> hget hash02 age
<span class="token string">&quot;12&quot;</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> hincrby hash02 age <span class="token number">2</span>
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">14</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> hget hash02 age
<span class="token string">&quot;14&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>hsetnx &lt;key&gt;&lt;field&gt;&lt;value&gt;</code> å°†å“ˆå¸Œè¡¨ key ä¸­çš„åŸŸ field çš„å€¼è®¾ç½®ä¸º value ï¼Œå½“ä¸”ä»…å½“åŸŸ field ä¸å­˜åœ¨ã€‚</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> hkeys hash02
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;name&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;age&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;gender&quot;</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> hsetnx hash02 age <span class="token number">10</span>
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">0</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> hsetnx hash02 birth <span class="token number">1997</span><span class="token operator">/</span><span class="token number">01</span><span class="token operator">/</span><span class="token number">20</span>
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h3 id="æ•°æ®ç»“æ„-3" tabindex="-1"><a class="header-anchor" href="#æ•°æ®ç»“æ„-3" aria-hidden="true">#</a> æ•°æ®ç»“æ„</h3><p>â€‹ <strong>Hash ç±»å‹å¯¹åº”çš„æ•°æ®ç»“æ„æ˜¯ä¸¤ç§ï¼šziplistï¼ˆå‹ç¼©åˆ—è¡¨ï¼‰ï¼Œhashtableï¼ˆå“ˆå¸Œè¡¨ï¼‰ã€‚å½“ field-value é•¿åº¦è¾ƒçŸ­ä¸”ä¸ªæ•°è¾ƒå°‘æ—¶ï¼Œä½¿ç”¨ ziplistï¼Œå¦åˆ™ä½¿ç”¨ hashtableã€‚</strong></p><h2 id="redis-æœ‰åºé›†åˆ-zset-sorted-set" tabindex="-1"><a class="header-anchor" href="#redis-æœ‰åºé›†åˆ-zset-sorted-set" aria-hidden="true">#</a> Redis æœ‰åºé›†åˆ Zsetï¼ˆSorted setï¼‰</h2><h3 id="ç®€ä»‹-4" tabindex="-1"><a class="header-anchor" href="#ç®€ä»‹-4" aria-hidden="true">#</a> ç®€ä»‹</h3><p>Redis æœ‰åºé›†åˆ Sorted Set ä¸æ™®é€šé›†åˆ set éå¸¸ç›¸ä¼¼ï¼Œæ˜¯ä¸€ä¸ªæ²¡æœ‰é‡å¤å…ƒç´ çš„å­—ç¬¦ä¸²é›†åˆã€‚</p><p>ä¸åŒä¹‹å¤„æ˜¯æœ‰åºé›†åˆçš„æ¯ä¸ªæˆå‘˜éƒ½å…³è”äº†ä¸€ä¸ª<strong>è¯„åˆ†ï¼ˆscoreï¼‰</strong>ï¼Œè¿™ä¸ªè¯„åˆ†ï¼ˆscoreï¼‰è¢«ç”¨æ¥æŒ‰ç…§ä»æœ€ä½åˆ†åˆ°æœ€é«˜åˆ†çš„æ–¹å¼æ’åºé›†åˆä¸­çš„æˆå‘˜ã€‚</p><p>é›†åˆçš„æˆå‘˜æ˜¯å”¯ä¸€çš„ï¼Œä½†æ˜¯è¯„åˆ†å¯ä»¥é‡å¤ ã€‚</p><p>å› ä¸ºå…ƒç´ æ˜¯æœ‰åºçš„ï¼Œ æ‰€ä»¥å¯ä»¥å¾ˆå¿«çš„æ ¹æ®è¯„åˆ†ï¼ˆscoreï¼‰æˆ–è€…æ¬¡åºï¼ˆpositionï¼‰æ¥è·å–ä¸€ä¸ªèŒƒå›´çš„å…ƒç´ ã€‚</p><p>è®¿é—®æœ‰åºé›†åˆçš„ä¸­é—´å…ƒç´ ä¹Ÿæ˜¯éå¸¸å¿«çš„ï¼Œå› æ­¤èƒ½å¤Ÿä½¿ç”¨æœ‰åºé›†åˆä½œä¸ºä¸€ä¸ªæ²¡æœ‰é‡å¤æˆå‘˜çš„æ™ºèƒ½åˆ—è¡¨ã€‚</p><h3 id="å¸¸ç”¨å‘½ä»¤-4" tabindex="-1"><a class="header-anchor" href="#å¸¸ç”¨å‘½ä»¤-4" aria-hidden="true">#</a> å¸¸ç”¨å‘½ä»¤</h3><ol><li><p><code>zadd &lt;key&gt;&lt;score1&gt;&lt;value1&gt;&lt;score2&gt;&lt;value2&gt;</code></p><p>å°†ä¸€ä¸ªæˆ–å¤šä¸ª member å…ƒç´ åŠå…¶ score å€¼åŠ å…¥åˆ°æœ‰åºé›† key å½“ä¸­ã€‚</p></li><li><p><code>zrange &lt;key&gt;&lt;start&gt;&lt;stop&gt; [WITHSCORES]</code></p><p>è¿”å›æœ‰åºé›† key ä¸­ï¼Œ<code>&lt;mark&gt;ä¸‹æ ‡åœ¨&lt;start&gt;&lt;stop&gt;ä¹‹é—´çš„å…ƒç´ &lt;/mark&gt;</code>ï¼Œå¸¦ WITHSCORESï¼Œå¯ä»¥è®©åˆ†æ•°ä¸€èµ·å’Œå€¼è¿”å›åˆ°ç»“æœé›†ã€‚</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> zadd zset01 <span class="token number">30</span> A <span class="token number">40</span> B <span class="token number">10</span> C
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">3</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> zrange zset01 <span class="token number">0</span> <span class="token operator">-</span><span class="token number">1</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;C&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;A&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;B&quot;</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> zrange zset01 <span class="token number">0</span> <span class="token operator">-</span><span class="token number">1</span> withscores
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;C&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;10&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;A&quot;</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">&quot;30&quot;</span>
<span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">&quot;B&quot;</span>
<span class="token number">6</span><span class="token punctuation">)</span> <span class="token string">&quot;40&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>zrangebyscore key minmax [withscores] [limit offset count]</code></p><p>è¿”å›æœ‰åºé›† key ä¸­ï¼Œ<mark>æ‰€æœ‰ score å€¼ä»‹äº min å’Œ max ä¹‹é—´</mark>ï¼ˆåŒ…æ‹¬ç­‰äº min æˆ– max ï¼‰æˆå‘˜ã€‚æœ‰åºé›†æˆå‘˜æŒ‰ score å€¼é€’å¢ï¼ˆä»å°åˆ°å¤§ï¼‰æ¬¡åºæ’åˆ—ã€‚</p></li><li><p><code>zrevrangebyscore key maxmin [withscores] [limit offset count] </code> åŒä¸Šï¼Œæ”¹ä¸ºä»å¤§åˆ°å°æ’åˆ—ã€‚</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> zrangebyscore zset01 <span class="token number">20</span> <span class="token number">40</span> withscores
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;A&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;30&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;B&quot;</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">&quot;40&quot;</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> zrevrangebyscore zset01 <span class="token number">30</span> <span class="token number">10</span>  withscores
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;A&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;30&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;C&quot;</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">&quot;10&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>zincrby &lt;key&gt;&lt;increment&gt;&lt;value&gt; ä¸ºå…ƒç´ çš„scoreåŠ ä¸Šå¢é‡</code></p><div class="language-SQL line-numbers-mode" data-ext="SQL"><pre class="language-SQL"><code>127.0.0.1:6379&gt; zincrby zset01 10 B
&quot;50&quot;
127.0.0.1:6379&gt; zrange zset01 0 -1 withscores
1) &quot;C&quot;
2) &quot;10&quot;
3) &quot;A&quot;
4) &quot;30&quot;
5) &quot;B&quot;
6) &quot;50&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>zcount &lt;key&gt;&lt;min&gt;&lt;max&gt;ç»Ÿè®¡è¯¥é›†åˆï¼Œåˆ†æ•°åŒºé—´å†…çš„å…ƒç´ ä¸ªæ•° </code></p></li><li><p><code>zrank &lt;key&gt;&lt;value&gt;è¿”å›è¯¥å€¼åœ¨é›†åˆä¸­çš„æ’åï¼Œä»0å¼€å§‹ã€‚</code></p></li><li><p><code>zrem &lt;key&gt;&lt;value&gt;åˆ é™¤è¯¥é›†åˆä¸‹ï¼ŒæŒ‡å®šå€¼çš„å…ƒç´ </code></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> zcount zset01 <span class="token number">10</span> <span class="token number">50</span>
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">3</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> zrank zset01 A
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> zrem zset01 C
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> zrange zset01 <span class="token number">0</span> <span class="token operator">-</span><span class="token number">1</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;A&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;B&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h3 id="æ•°æ®ç»“æ„-4" tabindex="-1"><a class="header-anchor" href="#æ•°æ®ç»“æ„-4" aria-hidden="true">#</a> æ•°æ®ç»“æ„</h3><p>â€‹ SortedSetï¼ˆzsetï¼‰æ˜¯ Redis æä¾›çš„ä¸€ä¸ªéå¸¸ç‰¹åˆ«çš„æ•°æ®ç»“æ„ï¼Œä¸€æ–¹é¢å®ƒç­‰ä»·äº Java çš„æ•°æ®ç»“æ„ Map&lt;String, Double&gt;ï¼Œå¯ä»¥ç»™æ¯ä¸€ä¸ªå…ƒç´  value èµ‹äºˆä¸€ä¸ªæƒé‡ scoreï¼Œå¦ä¸€æ–¹é¢å®ƒåˆç±»ä¼¼äº TreeSetï¼Œå†…éƒ¨çš„å…ƒç´ ä¼šæŒ‰ç…§æƒé‡ score è¿›è¡Œæ’åºï¼Œå¯ä»¥å¾—åˆ°æ¯ä¸ªå…ƒç´ çš„åæ¬¡ï¼Œè¿˜å¯ä»¥é€šè¿‡ score çš„èŒƒå›´æ¥è·å–å…ƒç´ çš„åˆ—è¡¨ã€‚</p><p>zset åº•å±‚ä½¿ç”¨äº†ä¸¤ä¸ªæ•°æ®ç»“æ„ï¼š</p><p>ï¼ˆ1ï¼‰hashï¼Œhash çš„ä½œç”¨å°±æ˜¯å…³è”å…ƒç´  value å’Œæƒé‡ scoreï¼Œä¿éšœå…ƒç´  value çš„å”¯ä¸€æ€§ï¼Œå¯ä»¥é€šè¿‡å…ƒç´  value æ‰¾åˆ°ç›¸åº”çš„ score å€¼ã€‚</p><p>ï¼ˆ2ï¼‰è·³è·ƒè¡¨ï¼Œ<mark>è·³è·ƒè¡¨çš„ç›®çš„åœ¨äºç»™å…ƒç´  value æ’åºï¼Œæ ¹æ® score çš„èŒƒå›´è·å–å…ƒç´ åˆ—è¡¨ã€‚</mark></p><h3 id="è·³è·ƒè¡¨" tabindex="-1"><a class="header-anchor" href="#è·³è·ƒè¡¨" aria-hidden="true">#</a> è·³è·ƒè¡¨</h3><ol><li>ç®€ä»‹</li></ol><p>â€‹ æœ‰åºé›†åˆåœ¨ç”Ÿæ´»ä¸­æ¯”è¾ƒå¸¸è§ï¼Œä¾‹å¦‚æ ¹æ®æˆç»©å¯¹å­¦ç”Ÿæ’åï¼Œæ ¹æ®å¾—åˆ†å¯¹ç©å®¶æ’åç­‰ã€‚å¯¹äºæœ‰åºé›†åˆçš„åº•å±‚å®ç°ï¼Œå¯ä»¥ç”¨æ•°ç»„ã€å¹³è¡¡æ ‘ã€é“¾è¡¨ç­‰ã€‚æ•°ç»„ä¸ä¾¿å…ƒç´ çš„æ’å…¥ã€åˆ é™¤ï¼›å¹³è¡¡æ ‘æˆ–çº¢é»‘æ ‘è™½ç„¶æ•ˆç‡é«˜ä½†ç»“æ„å¤æ‚ï¼›é“¾è¡¨æŸ¥è¯¢éœ€è¦éå†æ‰€æœ‰æ•ˆç‡ä½ã€‚Redis é‡‡ç”¨çš„æ˜¯è·³è·ƒè¡¨ã€‚è·³è·ƒè¡¨æ•ˆç‡å ªæ¯”çº¢é»‘æ ‘ï¼Œå®ç°è¿œæ¯”çº¢é»‘æ ‘ç®€å•ã€‚</p><ol start="2"><li>å®ä¾‹</li></ol><p>â€‹ å¯¹æ¯”æœ‰åºé“¾è¡¨å’Œè·³è·ƒè¡¨ï¼Œä»é“¾è¡¨ä¸­æŸ¥è¯¢å‡º 51ã€‚</p><p>â€‹ 2.1 æœ‰åºé“¾è¡¨</p><figure><img src="/assets/image-20220513110841045-e9a0a0aa.png" alt="image-20220513110841045" tabindex="0" loading="lazy"><figcaption>image-20220513110841045</figcaption></figure><p>â€‹ è¦æŸ¥æ‰¾å€¼ä¸º 51 çš„å…ƒç´ ï¼Œéœ€è¦ä»ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹ä¾æ¬¡æŸ¥æ‰¾ã€æ¯”è¾ƒæ‰èƒ½æ‰¾åˆ°ï¼Œå…±éœ€è¦ 6 æ¬¡æ¯”è¾ƒã€‚</p><p>â€‹ 2.2 è·³è·ƒè¡¨</p><figure><img src="/assets/image-20220513110851298-807d373b.png" alt="image-20220513110851298" tabindex="0" loading="lazy"><figcaption>image-20220513110851298</figcaption></figure><ol><li>ä»ç¬¬ 2 å±‚å¼€å§‹ï¼Œ1 èŠ‚ç‚¹æ¯” 51 èŠ‚ç‚¹å°ï¼Œå‘åæ¯”è¾ƒã€‚</li><li>21 èŠ‚ç‚¹æ¯” 51 èŠ‚ç‚¹å°ï¼Œç»§ç»­å‘åæ¯”è¾ƒï¼Œåé¢å°±æ˜¯ NULL äº†ï¼Œæ‰€ä»¥ä» 21 èŠ‚ç‚¹å‘ä¸‹åˆ°ç¬¬ 1 å±‚</li><li>åœ¨ç¬¬ 1 å±‚ï¼Œ41 èŠ‚ç‚¹æ¯” 51 èŠ‚ç‚¹å°ï¼Œç»§ç»­å‘åï¼Œ61 èŠ‚ç‚¹æ¯” 51 èŠ‚ç‚¹å¤§ï¼Œæ‰€ä»¥ä» 41 å‘ä¸‹</li><li>åœ¨ç¬¬ 0 å±‚ï¼Œ51èŠ‚ç‚¹ä¸ºè¦æŸ¥æ‰¾çš„èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹è¢«æ‰¾åˆ°ï¼Œå…±æŸ¥æ‰¾ 4 æ¬¡ã€‚</li><li>ä»æ­¤å¯ä»¥çœ‹å‡ºè·³è·ƒè¡¨æ¯”æœ‰åºé“¾è¡¨æ•ˆç‡è¦é«˜ã€‚</li></ol><h1 id="redis-é…ç½®æ–‡ä»¶ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#redis-é…ç½®æ–‡ä»¶ä»‹ç»" aria-hidden="true">#</a> Redis é…ç½®æ–‡ä»¶ä»‹ç»</h1><p>/etc/redis.conf</p><h2 id="units-å•ä½" tabindex="-1"><a class="header-anchor" href="#units-å•ä½" aria-hidden="true">#</a> Units å•ä½</h2><p>é…ç½®å¤§å°å•ä½ï¼Œå¼€å¤´å®šä¹‰äº†ä¸€äº›åŸºæœ¬çš„åº¦é‡å•ä½ï¼Œåªæ”¯æŒ bytesï¼Œä¸æ”¯æŒ bitï¼Œå¤§å°å†™ä¸æ•æ„Ÿã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>     <span class="token number">1</span>  <span class="token comment"># Redis configuration file example.</span>
     <span class="token number">4</span>  <span class="token comment"># started with the file path as first argument:</span>
     <span class="token number">6</span>  <span class="token comment"># ./redis-server /path/to/redis.conf</span>
     <span class="token number">8</span>  <span class="token comment"># Note on units: when memory size is needed, it is possible to specify</span>
     <span class="token number">9</span>  <span class="token comment"># it in the usual form of 1k 5GB 4M and so forth:</span>
    <span class="token number">10</span>  <span class="token comment">#</span>
    <span class="token number">11</span>  <span class="token comment"># 1k =&gt; 1000 bytes</span>
    <span class="token number">12</span>  <span class="token comment"># 1kb =&gt; 1024 bytes</span>
    <span class="token number">13</span>  <span class="token comment"># 1m =&gt; 1000000 bytes</span>
    <span class="token number">14</span>  <span class="token comment"># 1mb =&gt; 1024*1024 bytes</span>
    <span class="token number">15</span>  <span class="token comment"># 1g =&gt; 1000000000 bytes</span>
    <span class="token number">16</span>  <span class="token comment"># 1gb =&gt; 1024*1024*1024 bytes</span>
    <span class="token number">17</span>  <span class="token comment">#</span>
    <span class="token number">18</span>  <span class="token comment"># units are case insensitive so 1GB 1Gb 1gB are all the same.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="includes-åŒ…å«" tabindex="-1"><a class="header-anchor" href="#includes-åŒ…å«" aria-hidden="true">#</a> INCLUDES åŒ…å«</h2><p>å¼•å…¥å…¶ä»–é…ç½®</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>    <span class="token number">20</span>	<span class="token comment">################################## INCLUDES ###################################</span>
    <span class="token number">21</span>	
    <span class="token number">22</span>	<span class="token comment"># Include one or more other config files here.  This is useful if you</span>
    <span class="token number">23</span>	<span class="token comment"># have a standard template that goes to all Redis servers but also need</span>
    <span class="token number">24</span>	<span class="token comment"># to customize a few per-server settings.  Include files can include</span>
    <span class="token number">25</span>	<span class="token comment"># other files, so use this wisely.</span>
    <span class="token number">26</span>	<span class="token comment">#</span>
    <span class="token number">27</span>	<span class="token comment"># Note that option &quot;include&quot; won&#39;t be rewritten by command &quot;CONFIG REWRITE&quot;</span>
    <span class="token number">28</span>	<span class="token comment"># from admin or Redis Sentinel. Since Redis always uses the last processed</span>
    <span class="token number">29</span>	<span class="token comment"># line as value of a configuration directive, you&#39;d better put includes</span>
    <span class="token number">30</span>	<span class="token comment"># at the beginning of this file to avoid overwriting config change at runtime.</span>
    <span class="token number">31</span>	<span class="token comment">#</span>
    <span class="token number">32</span>	<span class="token comment"># If instead you are interested in using includes to override configuration</span>
    <span class="token number">33</span>	<span class="token comment"># options, it is better to use include as the last line.</span>
    <span class="token number">34</span>	<span class="token comment">#</span>
    <span class="token number">35</span>	<span class="token comment"># include /path/to/local.conf</span>
    <span class="token number">36</span>	<span class="token comment"># include /path/to/other.conf</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ç½‘ç»œç›¸å…³é…ç½®" tabindex="-1"><a class="header-anchor" href="#ç½‘ç»œç›¸å…³é…ç½®" aria-hidden="true">#</a> ç½‘ç»œç›¸å…³é…ç½®</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>    <span class="token number">46</span>	<span class="token comment">################################## NETWORK #####################################</span>
    <span class="token number">47</span>	
    <span class="token number">48</span>	<span class="token comment"># By default, if no &quot;bind&quot; configuration directive is specified, Redis listens</span>
    <span class="token number">49</span>	<span class="token comment"># for connections from all available network interfaces on the host machine.</span>
    <span class="token number">50</span>	<span class="token comment"># It is possible to listen to just one or multiple selected interfaces using</span>
    <span class="token number">51</span>	<span class="token comment"># the &quot;bind&quot; configuration directive, followed by one or more IP addresses.</span>
    <span class="token number">52</span>	<span class="token comment"># Each address can be prefixed by &quot;-&quot;, which means that redis will not fail to</span>
    <span class="token number">53</span>	<span class="token comment"># start if the address is not available. Being not available only refers to</span>
    <span class="token number">54</span>	<span class="token comment"># addresses that does not correspond to any network interfece. Addresses that</span>
    <span class="token number">55</span>	<span class="token comment"># are already in use will always fail, and unsupported protocols will always BE</span>
    <span class="token number">56</span>	<span class="token comment"># silently skipped.</span>
    <span class="token number">57</span>	<span class="token comment">#</span>
    <span class="token number">58</span>	<span class="token comment"># Examples:</span>
    <span class="token number">59</span>	<span class="token comment">#</span>
    <span class="token number">60</span>	<span class="token comment"># bind 192.168.1.100 10.0.0.1     # listens on two specific IPv4 addresses</span>
    <span class="token number">61</span>	<span class="token comment"># bind 127.0.0.1 ::1              # listens on loopback IPv4 and IPv6</span>
    <span class="token number">62</span>	<span class="token comment"># bind * -::*                     # like the default, all available interfaces</span>
    <span class="token number">63</span>	<span class="token comment">#</span>
    <span class="token number">64</span>	<span class="token comment"># ~~~ WARNING ~~~ If the computer running Redis is directly exposed to the</span>
    <span class="token number">65</span>	<span class="token comment"># internet, binding to all the interfaces is dangerous and will expose the</span>
    <span class="token number">66</span>	<span class="token comment"># instance to everybody on the internet. So by default we uncomment the</span>
    <span class="token number">67</span>	<span class="token comment"># following bind directive, that will force Redis to listen only on the</span>
    <span class="token number">68</span>	<span class="token comment"># IPv4 and IPv6 (if available) loopback interface addresses (this means Redis</span>
    <span class="token number">69</span>	<span class="token comment"># will only be able to accept client connections from the same host that it is</span>
    <span class="token number">70</span>	<span class="token comment"># running on).</span>
    <span class="token number">71</span>	<span class="token comment">#</span>
    <span class="token number">72</span>	<span class="token comment"># IF YOU ARE SURE YOU WANT YOUR INSTANCE TO LISTEN TO ALL THE INTERFACES</span>
    <span class="token number">73</span>	<span class="token comment"># JUST COMMENT OUT THE FOLLOWING LINE.</span>
    <span class="token number">74</span>	<span class="token comment"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="token number">75</span>	<span class="token builtin class-name">bind</span> <span class="token number">127.0</span>.0.1 -::1
    <span class="token number">76</span>	
    <span class="token number">77</span>	<span class="token comment"># Protected mode is a layer of security protection, in order to avoid that</span>
    <span class="token number">78</span>	<span class="token comment"># Redis instances left open on the internet are accessed and exploited.</span>
    <span class="token number">79</span>	<span class="token comment">#</span>
    <span class="token number">80</span>	<span class="token comment"># When protected mode is on and if:</span>
    <span class="token number">81</span>	<span class="token comment">#</span>
    <span class="token number">82</span>	<span class="token comment"># 1) The server is not binding explicitly to a set of addresses using the</span>
    <span class="token number">83</span>	<span class="token comment">#    &quot;bind&quot; directive.</span>
    <span class="token number">84</span>	<span class="token comment"># 2) No password is configured.</span>
    <span class="token number">85</span>	<span class="token comment">#</span>
    <span class="token number">86</span>	<span class="token comment"># The server only accepts connections from clients connecting from the</span>
    <span class="token number">87</span>	<span class="token comment"># IPv4 and IPv6 loopback addresses 127.0.0.1 and ::1, and from Unix domain</span>
    <span class="token number">88</span>	<span class="token comment"># sockets.</span>
    <span class="token number">89</span>	<span class="token comment">#</span>
    <span class="token number">90</span>	<span class="token comment"># By default protected mode is enabled. You should disable it only if</span>
    <span class="token number">91</span>	<span class="token comment"># you are sure you want clients from other hosts to connect to Redis</span>
    <span class="token number">92</span>	<span class="token comment"># even if no authentication is configured, nor a specific set of interfaces</span>
    <span class="token number">93</span>	<span class="token comment"># are explicitly listed using the &quot;bind&quot; directive.</span>
    <span class="token number">94</span>	protected-mode <span class="token function">yes</span>
    <span class="token number">95</span>	
    <span class="token number">96</span>	<span class="token comment"># Accept connections on the specified port, default is 6379 (IANA #815344).</span>
    <span class="token number">97</span>	<span class="token comment"># If port 0 is specified Redis will not listen on a TCP socket.</span>
    <span class="token number">98</span>	port <span class="token number">6379</span>
    <span class="token number">99</span>	
   <span class="token number">100</span>	<span class="token comment"># TCP listen() backlog.</span>
   <span class="token number">101</span>	<span class="token comment">#</span>
   <span class="token number">102</span>	<span class="token comment"># In high requests-per-second environments you need a high backlog in order</span>
   <span class="token number">103</span>	<span class="token comment"># to avoid slow clients connection issues. Note that the Linux kernel</span>
   <span class="token number">104</span>	<span class="token comment"># will silently truncate it to the value of /proc/sys/net/core/somaxconn so</span>
   <span class="token number">105</span>	<span class="token comment"># make sure to raise both the value of somaxconn and tcp_max_syn_backlog</span>
   <span class="token number">106</span>	<span class="token comment"># in order to get the desired effect.</span>
   <span class="token number">107</span>	tcp-backlog <span class="token number">511</span>
   <span class="token number">108</span>	
   <span class="token number">109</span>	<span class="token comment"># Unix socket.</span>
   <span class="token number">110</span>	<span class="token comment">#</span>
   <span class="token number">111</span>	<span class="token comment"># Specify the path for the Unix socket that will be used to listen for</span>
   <span class="token number">112</span>	<span class="token comment"># incoming connections. There is no default, so Redis will not listen</span>
   <span class="token number">113</span>	<span class="token comment"># on a unix socket when not specified.</span>
   <span class="token number">114</span>	<span class="token comment">#</span>
   <span class="token number">115</span>	<span class="token comment"># unixsocket /run/redis.sock</span>
   <span class="token number">116</span>	<span class="token comment"># unixsocketperm 700</span>
   <span class="token number">117</span>	
   <span class="token number">118</span>	<span class="token comment"># Close the connection after a client is idle for N seconds (0 to disable)</span>
   <span class="token number">119</span>	<span class="token function">timeout</span> <span class="token number">0</span>
   <span class="token number">120</span>	
   <span class="token number">121</span>	<span class="token comment"># TCP keepalive.</span>
   <span class="token number">122</span>	<span class="token comment">#</span>
   <span class="token number">123</span>	<span class="token comment"># If non-zero, use SO_KEEPALIVE to send TCP ACKs to clients in absence</span>
   <span class="token number">124</span>	<span class="token comment"># of communication. This is useful for two reasons:</span>
   <span class="token number">125</span>	<span class="token comment">#</span>
   <span class="token number">126</span>	<span class="token comment"># 1) Detect dead peers.</span>
   <span class="token number">127</span>	<span class="token comment"># 2) Force network equipment in the middle to consider the connection to be</span>
   <span class="token number">128</span>	<span class="token comment">#    alive.</span>
   <span class="token number">129</span>	<span class="token comment">#</span>
   <span class="token number">130</span>	<span class="token comment"># On Linux, the specified value (in seconds) is the period used to send ACKs.</span>
   <span class="token number">131</span>	<span class="token comment"># Note that to close the connection the double of the time is needed.</span>
   <span class="token number">132</span>	<span class="token comment"># On other kernels the period depends on the kernel configuration.</span>
   <span class="token number">133</span>	<span class="token comment">#</span>
   <span class="token number">134</span>	<span class="token comment"># A reasonable value for this option is 300 seconds, which is the new</span>
   <span class="token number">135</span>	<span class="token comment"># Redis default starting with Redis 3.2.1.</span>
   <span class="token number">136</span>	tcp-keepalive <span class="token number">300</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="bind" tabindex="-1"><a class="header-anchor" href="#bind" aria-hidden="true">#</a> bind</h3><p>é»˜è®¤æƒ…å†µ bind=127.0.0.1 åªèƒ½æ¥å—æœ¬æœºçš„è®¿é—®è¯·æ±‚ï¼Œä¸å†™çš„æƒ…å†µä¸‹ï¼Œæ— é™åˆ¶æ¥å—ä»»ä½• ip åœ°å€çš„è®¿é—®ã€‚</p><p>ç”Ÿäº§ç¯å¢ƒè¦å†™åº”ç”¨æœåŠ¡å™¨çš„åœ°å€ï¼›æœåŠ¡å™¨æ˜¯éœ€è¦è¿œç¨‹è®¿é—®çš„ï¼Œæ‰€ä»¥éœ€è¦å°†å…¶æ³¨é‡Šæ‰ã€‚</p><p>å¦‚æœå¼€å¯äº† protected-modeï¼Œé‚£ä¹ˆåœ¨æ²¡æœ‰è®¾å®š bind ip ä¸”æ²¡æœ‰è®¾å¯†ç çš„æƒ…å†µä¸‹ï¼ŒRedis åªå…è®¸æ¥å—æœ¬æœºçš„å“åº”ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost bin<span class="token punctuation">]</span><span class="token comment"># ps -ef |grep redis|grep -v grep</span>
root      <span class="token number">97989</span>      <span class="token number">1</span>  <span class="token number">0</span> 09:43 ?        00:00:31 redis-server <span class="token number">127.0</span>.0.1:6379
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨é‡Šæ‰ bind</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost bin<span class="token punctuation">]</span><span class="token comment"># redis-server /etc/redis.conf</span>
<span class="token punctuation">[</span>root@localhost bin<span class="token punctuation">]</span><span class="token comment"># ps -ef |grep redis|grep -v grep</span>
root      <span class="token number">99498</span>      <span class="token number">1</span>  <span class="token number">0</span> <span class="token number">11</span>:39 ?        00:00:00 redis-server *:6379
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="protected-mode" tabindex="-1"><a class="header-anchor" href="#protected-mode" aria-hidden="true">#</a> protected-mode</h3><p>æœ¬æœºè®¿é—®ä¿æŠ¤æ¨¡å¼</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>protected-mode no
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="port" tabindex="-1"><a class="header-anchor" href="#port" aria-hidden="true">#</a> port</h3><p>ç«¯å£é»˜è®¤ 6379</p><h3 id="tcp-backlog" tabindex="-1"><a class="header-anchor" href="#tcp-backlog" aria-hidden="true">#</a> tcp-backlog</h3><p>è®¾ç½® tcp çš„ backlogï¼Œbacklog å…¶å®æ˜¯ä¸€ä¸ªè¿æ¥é˜Ÿåˆ—ï¼Œbacklog é˜Ÿåˆ—æ€»å’Œ = æœªå®Œæˆä¸‰æ¬¡æ¡æ‰‹é˜Ÿåˆ— + å·²ç»å®Œæˆä¸‰æ¬¡æ¡æ‰‹é˜Ÿåˆ—ã€‚</p><p><strong>åœ¨é«˜å¹¶å‘ç¯å¢ƒä¸‹ä½ éœ€è¦ä¸€ä¸ªé«˜ backlog å€¼æ¥é¿å…æ…¢å®¢æˆ·ç«¯è¿æ¥é—®é¢˜ã€‚</strong></p><p>æ³¨æ„ Linux å†…æ ¸ä¼šå°†è¿™ä¸ªå€¼å‡å°åˆ° <strong>/proc/sys/net/core/somaxconn</strong> çš„å€¼ï¼ˆ128ï¼‰ï¼Œæ‰€ä»¥éœ€è¦ç¡®è®¤å¢å¤§ <strong>/proc/sys/net/core/somaxconn</strong> å’Œ <strong>/proc/sys/net/ipv4/tcp_max_syn_backlog</strong>ï¼ˆ128ï¼‰ä¸¤ä¸ªå€¼æ¥è¾¾åˆ°æƒ³è¦çš„æ•ˆæœ</p><h3 id="timeout" tabindex="-1"><a class="header-anchor" href="#timeout" aria-hidden="true">#</a> timeout</h3><p>ä¸€ä¸ªç©ºé—²çš„å®¢æˆ·ç«¯ç»´æŒå¤šå°‘ç§’ä¼šå…³é—­ï¼Œ0 è¡¨ç¤ºå…³é—­è¯¥åŠŸèƒ½ã€‚å³æ°¸ä¸å…³é—­ã€‚</p><h3 id="tcp-keepalive" tabindex="-1"><a class="header-anchor" href="#tcp-keepalive" aria-hidden="true">#</a> tcp-keepalive</h3><p>å¯¹è®¿é—®å®¢æˆ·ç«¯çš„ä¸€ç§å¿ƒè·³æ£€æµ‹ï¼Œæ¯éš” n ç§’æ£€æµ‹ä¸€æ¬¡ã€‚</p><p>å•ä½ä¸ºç§’ï¼Œå¦‚æœè®¾ç½®ä¸º 0ï¼Œåˆ™ä¸ä¼šè¿›è¡Œ Keepalive æ£€æµ‹ï¼Œå»ºè®®è®¾ç½®æˆ 60 ã€‚</p><h2 id="general-é€šç”¨" tabindex="-1"><a class="header-anchor" href="#general-é€šç”¨" aria-hidden="true">#</a> GENERAL é€šç”¨</h2><h3 id="daemonize" tabindex="-1"><a class="header-anchor" href="#daemonize" aria-hidden="true">#</a> daemonize</h3><p>æ˜¯å¦ä¸ºåå°è¿›ç¨‹ï¼Œè®¾ç½®ä¸º yes</p><h3 id="pidfile" tabindex="-1"><a class="header-anchor" href="#pidfile" aria-hidden="true">#</a> pidfile</h3><p>å­˜æ”¾ pid æ–‡ä»¶çš„ä½ç½®ï¼Œæ¯ä¸ªå®ä¾‹ä¼šäº§ç”Ÿä¸€ä¸ªä¸åŒçš„ pid æ–‡ä»¶</p><h3 id="loglevel" tabindex="-1"><a class="header-anchor" href="#loglevel" aria-hidden="true">#</a> loglevel</h3><p>æŒ‡å®šæ—¥å¿—è®°å½•çº§åˆ«ï¼ŒRedis æ€»å…±æ”¯æŒå››ä¸ªçº§åˆ«ï¼šdebugã€verboseã€noticeã€warningï¼Œé»˜è®¤ä¸º <strong>notice</strong></p><p>å››ä¸ªçº§åˆ«æ ¹æ®ä½¿ç”¨é˜¶æ®µæ¥é€‰æ‹©ï¼Œç”Ÿäº§ç¯å¢ƒé€‰æ‹© notice æˆ–è€… warning</p><h3 id="logfile" tabindex="-1"><a class="header-anchor" href="#logfile" aria-hidden="true">#</a> logfile</h3><p>æ—¥å¿—æ–‡ä»¶åç§°</p><h3 id="database-16" tabindex="-1"><a class="header-anchor" href="#database-16" aria-hidden="true">#</a> database 16</h3><p>è®¾å®šåº“çš„æ•°é‡é»˜è®¤16ï¼Œé»˜è®¤æ•°æ®åº“ä¸º 0ï¼Œå¯ä»¥ä½¿ç”¨ <code>SELECT &lt;dbid&gt;</code> å‘½ä»¤åœ¨è¿æ¥ä¸ŠæŒ‡å®šæ•°æ®åº“ id</p><h2 id="security-å®‰å…¨" tabindex="-1"><a class="header-anchor" href="#security-å®‰å…¨" aria-hidden="true">#</a> SECURITY å®‰å…¨</h2><h3 id="è®¾ç½®å¯†ç " tabindex="-1"><a class="header-anchor" href="#è®¾ç½®å¯†ç " aria-hidden="true">#</a> è®¾ç½®å¯†ç </h3><p>è®¿é—®å¯†ç çš„æŸ¥çœ‹ã€è®¾ç½®å’Œå–æ¶ˆ</p><p>åœ¨å‘½ä»¤ä¸­è®¾ç½®å¯†ç ï¼Œåªæ˜¯ä¸´æ—¶çš„ã€‚é‡å¯ redis æœåŠ¡å™¨ï¼Œå¯†ç å°±è¿˜åŸäº†ã€‚</p><p>æ°¸ä¹…è®¾ç½®ï¼Œéœ€è¦å†é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œè®¾ç½®ã€‚</p><h2 id="limit-é™åˆ¶" tabindex="-1"><a class="header-anchor" href="#limit-é™åˆ¶" aria-hidden="true">#</a> LIMIT é™åˆ¶</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">946</span> <span class="token comment">############################## MEMORY MANAGEMENT ################################</span>
 <span class="token number">947</span>
 <span class="token number">948</span> <span class="token comment"># Set a memory usage limit to the specified amount of bytes.</span>
 <span class="token number">949</span> <span class="token comment"># When the memory limit is reached Redis will try to remove keys</span>
 <span class="token number">950</span> <span class="token comment"># according to the eviction policy selected (see maxmemory-policy).</span>
 <span class="token number">951</span> <span class="token comment">#</span>
 <span class="token number">952</span> <span class="token comment"># If Redis can&#39;t remove keys according to the policy, or if the policy is</span>
 <span class="token number">953</span> <span class="token comment"># set to &#39;noeviction&#39;, Redis will start to reply with errors to commands</span>
 <span class="token number">954</span> <span class="token comment"># that would use more memory, like SET, LPUSH, and so on, and will continue</span>
 <span class="token number">955</span> <span class="token comment"># to reply to read-only commands like GET.</span>
 <span class="token number">956</span> <span class="token comment">#</span>
 <span class="token number">957</span> <span class="token comment"># This option is usually useful when using Redis as an LRU or LFU cache, or to</span>
 <span class="token number">958</span> <span class="token comment"># set a hard memory limit for an instance (using the &#39;noeviction&#39; policy).</span>
 <span class="token number">959</span> <span class="token comment">#</span>
 <span class="token number">960</span> <span class="token comment"># WARNING: If you have replicas attached to an instance with maxmemory on,</span>
 <span class="token number">961</span> <span class="token comment"># the size of the output buffers needed to feed the replicas are subtracted</span>
 <span class="token number">962</span> <span class="token comment"># from the used memory count, so that network problems / resyncs will</span>
 <span class="token number">963</span> <span class="token comment"># not trigger a loop where keys are evicted, and in turn the output</span>
 <span class="token number">964</span> <span class="token comment"># buffer of replicas is full with DELs of keys evicted triggering the deletion</span>
 <span class="token number">965</span> <span class="token comment"># of more keys, and so forth until the database is completely emptied.</span>
 <span class="token number">966</span> <span class="token comment">#</span>
 <span class="token number">967</span> <span class="token comment"># In short... if you have replicas attached it is suggested that you set a lower</span>
 <span class="token number">968</span> <span class="token comment"># limit for maxmemory so that there is some free RAM on the system for replica</span>
 <span class="token number">969</span> <span class="token comment"># output buffers (but this is not needed if the policy is &#39;noeviction&#39;).</span>
 <span class="token number">970</span> <span class="token comment">#</span>
 <span class="token number">971</span> <span class="token comment"># maxmemory &lt;bytes&gt;</span>
 <span class="token number">972</span>
 <span class="token number">973</span> <span class="token comment"># MAXMEMORY POLICY: how Redis will select what to remove when maxmemory</span>
 <span class="token number">974</span> <span class="token comment"># is reached. You can select one from the following behaviors:</span>
 <span class="token number">975</span> <span class="token comment">#</span>
 <span class="token number">976</span> <span class="token comment"># volatile-lru -&gt; Evict using approximated LRU, only keys with an expire set.</span>
 <span class="token number">977</span> <span class="token comment"># allkeys-lru -&gt; Evict any key using approximated LRU.</span>
 <span class="token number">978</span> <span class="token comment"># volatile-lfu -&gt; Evict using approximated LFU, only keys with an expire set.</span>
 <span class="token number">979</span> <span class="token comment"># allkeys-lfu -&gt; Evict any key using approximated LFU.</span>
 <span class="token number">980</span> <span class="token comment"># volatile-random -&gt; Remove a random key having an expire set.</span>
 <span class="token number">981</span> <span class="token comment"># allkeys-random -&gt; Remove a random key, any key.</span>
 <span class="token number">982</span> <span class="token comment"># volatile-ttl -&gt; Remove the key with the nearest expire time (minor TTL)</span>
 <span class="token number">983</span> <span class="token comment"># noeviction -&gt; Don&#39;t evict anything, just return an error on write operations.</span>
 <span class="token number">984</span> <span class="token comment">#</span>
 <span class="token number">985</span> <span class="token comment"># LRU means Least Recently Used</span>
 <span class="token number">986</span> <span class="token comment"># LFU means Least Frequently Used</span>
 <span class="token number">987</span> <span class="token comment">#</span>
 <span class="token number">988</span> <span class="token comment"># Both LRU, LFU and volatile-ttl are implemented using approximated</span>
 <span class="token number">989</span> <span class="token comment"># randomized algorithms.</span>
 <span class="token number">990</span> <span class="token comment">#</span>
 <span class="token number">991</span> <span class="token comment"># Note: with any of the above policies, when there are no suitable keys for</span>
 <span class="token number">992</span> <span class="token comment"># eviction, Redis will return an error on write operations that require</span>
 <span class="token number">993</span> <span class="token comment"># more memory. These are usually commands that create new keys, add data or</span>
 <span class="token number">994</span> <span class="token comment"># modify existing keys. A few examples are: SET, INCR, HSET, LPUSH, SUNIONSTORE,</span>
 <span class="token number">995</span> <span class="token comment"># SORT (due to the STORE argument), and EXEC (if the transaction includes any</span>
 <span class="token number">996</span> <span class="token comment"># command that requires memory).</span>
 <span class="token number">997</span> <span class="token comment">#</span>
 <span class="token number">998</span> <span class="token comment"># The default is:</span>
 <span class="token number">999</span> <span class="token comment">#</span>
<span class="token number">1000</span> <span class="token comment"># maxmemory-policy noeviction</span>
<span class="token number">1001</span>
<span class="token number">1002</span> <span class="token comment"># LRU, LFU and minimal TTL algorithms are not precise algorithms but approximated</span>
<span class="token number">1003</span> <span class="token comment"># algorithms (in order to save memory), so you can tune it for speed or</span>
<span class="token number">1004</span> <span class="token comment"># accuracy. By default Redis will check five keys and pick the one that was</span>
<span class="token number">1005</span> <span class="token comment"># used least recently, you can change the sample size using the following</span>
<span class="token number">1006</span> <span class="token comment"># configuration directive.</span>
<span class="token number">1007</span> <span class="token comment">#</span>
<span class="token number">1008</span> <span class="token comment"># The default of 5 produces good enough results. 10 Approximates very closely</span>
<span class="token number">1009</span> <span class="token comment"># true LRU but costs more CPU. 3 is faster but not very accurate.</span>
<span class="token number">1010</span> <span class="token comment">#</span>
<span class="token number">1011</span> <span class="token comment"># maxmemory-samples 5</span>
<span class="token number">1012</span>
<span class="token number">1013</span> <span class="token comment"># Eviction processing is designed to function well with the default setting.</span>
<span class="token number">1014</span> <span class="token comment"># If there is an unusually large amount of write traffic, this value may need to</span>
<span class="token number">1015</span> <span class="token comment"># be increased.  Decreasing this value may reduce latency at the risk of</span>
<span class="token number">1016</span> <span class="token comment"># eviction processing effectiveness</span>
<span class="token number">1017</span> <span class="token comment">#   0 = minimum latency, 10 = default, 100 = process without regard to latency</span>
<span class="token number">1018</span> <span class="token comment">#</span>
<span class="token number">1019</span> <span class="token comment"># maxmemory-eviction-tenacity 10</span>
<span class="token number">1020</span>
<span class="token number">1021</span> <span class="token comment"># Starting from Redis 5, by default a replica will ignore its maxmemory setting</span>
<span class="token number">1022</span> <span class="token comment"># (unless it is promoted to master after a failover or manually). It means</span>
<span class="token number">1023</span> <span class="token comment"># that the eviction of keys will be just handled by the master, sending the</span>
<span class="token number">1024</span> <span class="token comment"># DEL commands to the replica as keys evict in the master side.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="maxclients" tabindex="-1"><a class="header-anchor" href="#maxclients" aria-hidden="true">#</a> maxclients</h3><ol><li>è®¾ç½® redis åŒæ—¶å¯ä»¥ä¸å¤šå°‘ä¸ªå®¢æˆ·ç«¯è¿›è¡Œè¿æ¥ã€‚</li><li>é»˜è®¤æƒ…å†µä¸‹ä¸º 10000 ä¸ªå®¢æˆ·ç«¯ã€‚</li><li>å¦‚æœè¾¾åˆ°äº†æ­¤é™åˆ¶ï¼Œredis åˆ™ä¼šæ‹’ç»æ–°çš„è¿æ¥è¯·æ±‚ï¼Œå¹¶ä¸”å‘è¿™äº›è¿æ¥è¯·æ±‚æ–¹å‘å‡º &quot;max number of clients reached&quot; ä»¥ä½œå›åº”ã€‚</li></ol><h3 id="maxmemory" tabindex="-1"><a class="header-anchor" href="#maxmemory" aria-hidden="true">#</a> maxmemory</h3><ol><li><p>å»ºè®®<strong>å¿…é¡»è®¾ç½®</strong>ï¼Œå¦åˆ™ï¼Œå°†å†…å­˜å æ»¡ï¼Œé€ æˆæœåŠ¡å™¨å®•æœº</p></li><li><p>è®¾ç½® redis å¯ä»¥ä½¿ç”¨çš„å†…å­˜é‡ã€‚ä¸€æ—¦åˆ°è¾¾å†…å­˜ä½¿ç”¨ä¸Šé™ï¼Œredis å°†ä¼šè¯•å›¾ç§»é™¤å†…éƒ¨æ•°æ®ï¼Œç§»é™¤è§„åˆ™å¯ä»¥é€šè¿‡ <strong>maxmemory-policy</strong> æ¥æŒ‡å®šã€‚</p></li><li><p>å¦‚æœ redis æ— æ³•æ ¹æ®ç§»é™¤è§„åˆ™æ¥ç§»é™¤å†…å­˜ä¸­çš„æ•°æ®ï¼Œæˆ–è€…è®¾ç½®äº† &quot;ä¸å…è®¸ç§»é™¤&quot;ï¼Œé‚£ä¹ˆ redis åˆ™ä¼šé’ˆå¯¹é‚£äº›éœ€è¦ç”³è¯·å†…å­˜çš„æŒ‡ä»¤è¿”å›é”™è¯¯ä¿¡æ¯ï¼Œæ¯”å¦‚ SETã€LPUSH ç­‰ã€‚</p></li><li><p>ä½†æ˜¯å¯¹äºæ— å†…å­˜ç”³è¯·çš„æŒ‡ä»¤ï¼Œä»ç„¶ä¼šæ­£å¸¸å“åº”ï¼Œæ¯”å¦‚ GET ç­‰ã€‚å¦‚ redis æ˜¯ä¸» redisï¼Œé‚£ä¹ˆåœ¨è®¾ç½®å†…å­˜ä½¿ç”¨ä¸Šé™æ—¶ï¼Œéœ€è¦åœ¨ç³»ç»Ÿä¸­ç•™å‡ºä¸€äº›å†…å­˜ç©ºé—´ç»™åŒæ­¥é˜Ÿåˆ—ç¼“å­˜ï¼Œåªæœ‰åœ¨ä½ è®¾ç½®çš„æ˜¯ &quot;ä¸ç§»é™¤&quot; çš„æƒ…å†µä¸‹ï¼Œæ‰ä¸ç”¨è€ƒè™‘è¿™ä¸ªå› ç´ ã€‚</p></li></ol><h3 id="maxmemory-policy" tabindex="-1"><a class="header-anchor" href="#maxmemory-policy" aria-hidden="true">#</a> maxmemory-policy</h3><ol><li>volatile-lruï¼šä½¿ç”¨ LRU ç®—æ³•ç§»é™¤ keyï¼Œåªå¯¹è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ï¼›ï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰</li><li>allkeys-lruï¼šåœ¨æ‰€æœ‰é›†åˆ key ä¸­ï¼Œä½¿ç”¨ LRU ç®—æ³•ç§»é™¤ key</li><li>volatile-randomï¼šåœ¨è¿‡æœŸé›†åˆä¸­ç§»é™¤éšæœºçš„ keyï¼Œåªå¯¹è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®</li><li>allkeys-randomï¼šåœ¨æ‰€æœ‰é›†åˆ key ä¸­ï¼Œç§»é™¤éšæœºçš„ key</li><li>volatile-ttlï¼šç§»é™¤é‚£äº› TTL å€¼æœ€å°çš„ keyï¼Œå³é‚£äº›æœ€è¿‘è¦è¿‡æœŸçš„ key</li><li>noevictionï¼šä¸è¿›è¡Œç§»é™¤ã€‚é’ˆå¯¹å†™æ“ä½œï¼Œåªæ˜¯è¿”å›é”™è¯¯ä¿¡æ¯ã€é»˜è®¤å€¼ã€‘</li></ol><h3 id="maxmemory-samples" tabindex="-1"><a class="header-anchor" href="#maxmemory-samples" aria-hidden="true">#</a> maxmemory-samples</h3><ol><li><p>è®¾ç½®æ ·æœ¬æ•°é‡ï¼ŒLRU ç®—æ³•å’Œæœ€å° TTL ç®—æ³•éƒ½å¹¶éæ˜¯ç²¾ç¡®çš„ç®—æ³•ï¼Œè€Œæ˜¯ä¼°ç®—å€¼ï¼Œæ‰€ä»¥ä½ å¯ä»¥è®¾ç½®æ ·æœ¬çš„å¤§å°ï¼Œredis é»˜è®¤ä¼šæ£€æŸ¥è¿™ä¹ˆå¤šä¸ª key ï¼Œå¹¶é€‰æ‹©å…¶ä¸­ LRU çš„é‚£ä¸ªã€‚</p></li><li><p>ä¸€èˆ¬è®¾ç½® 3 åˆ° 7 çš„æ•°å­—ï¼Œæ•°å€¼è¶Šå°æ ·æœ¬è¶Šä¸å‡†ç¡®ï¼Œä½†æ€§èƒ½æ¶ˆè€—è¶Šå°ã€‚</p></li></ol><h1 id="redis-çš„å‘å¸ƒå’Œè®¢é˜…" tabindex="-1"><a class="header-anchor" href="#redis-çš„å‘å¸ƒå’Œè®¢é˜…" aria-hidden="true">#</a> Redis çš„å‘å¸ƒå’Œè®¢é˜…</h1><h2 id="å‘å¸ƒå’Œè®¢é˜…" tabindex="-1"><a class="header-anchor" href="#å‘å¸ƒå’Œè®¢é˜…" aria-hidden="true">#</a> å‘å¸ƒå’Œè®¢é˜…</h2><p>Redis å‘å¸ƒè®¢é˜… ï¼ˆpub/subï¼‰ æ˜¯ä¸€ç§æ¶ˆæ¯é€šä¿¡æ¨¡å¼ï¼šå‘é€è€… ï¼ˆpubï¼‰ å‘é€æ¶ˆæ¯ï¼Œè®¢é˜…è€… ï¼ˆsubï¼‰æ¥æ”¶æ¶ˆæ¯ã€‚</p><p>Redis å®¢æˆ·ç«¯å¯ä»¥è®¢é˜…ä»»æ„æ•°é‡çš„é¢‘é“ã€‚</p><h2 id="redis-çš„å‘å¸ƒå’Œè®¢é˜…-1" tabindex="-1"><a class="header-anchor" href="#redis-çš„å‘å¸ƒå’Œè®¢é˜…-1" aria-hidden="true">#</a> Redis çš„å‘å¸ƒå’Œè®¢é˜…</h2><ol><li><p>å®¢æˆ·ç«¯å¯ä»¥è®¢é˜…é¢‘é“å¦‚ä¸‹å›¾ï¼Œå½“ç»™è¿™ä¸ªé¢‘é“å‘å¸ƒæ¶ˆæ¯åï¼Œæ¶ˆæ¯å°±ä¼šå‘é€ç»™è®¢é˜…çš„å®¢æˆ·ç«¯ã€‚</p><figure><img src="/assets/Rediså‘å¸ƒè®¢é˜…-21c75a4d.png" alt="Rediså‘å¸ƒè®¢é˜…" tabindex="0" loading="lazy"><figcaption>Rediså‘å¸ƒè®¢é˜…</figcaption></figure></li><li><p>ç¤ºä¾‹</p><ol><li><p>æ‰“å¼€ä¸€ä¸ªå®¢æˆ·ç«¯è®¢é˜… channel01</p></li><li><p>æ‰“å¼€å¦ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œç»™ channel01 å‘å¸ƒå­—ç¬¦ä¸²æ¶ˆæ¯ hello redisï¼Œ<strong>è¿”å›çš„ 1 æ˜¯è®¢é˜…è€…æ•°é‡</strong></p></li><li><p>æ‰“å¼€ç¬¬ä¸€ä¸ªå®¢æˆ·ç«¯å¯ä»¥çœ‹åˆ°å‘é€çš„æ¶ˆæ¯</p></li><li><p>æ³¨æ„ï¼šå‘å¸ƒçš„æ¶ˆæ¯æ²¡æœ‰æŒä¹…åŒ–ï¼Œå¦‚æœåœ¨è®¢é˜…çš„å®¢æˆ·ç«¯æ”¶ä¸åˆ° helloï¼Œ<strong>åªèƒ½æ”¶åˆ°è®¢é˜…åå‘å¸ƒçš„æ¶ˆæ¯</strong></p></li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> subscribe channel01
Reading messages<span class="token punctuation">..</span>. <span class="token punctuation">(</span>press Ctrl-C to quit<span class="token punctuation">)</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;subscribe&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;channel01&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># redis-cli</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> publish channel01 hello redis
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> ERR wrong number of arguments <span class="token keyword">for</span> <span class="token string">&#39;publish&#39;</span> <span class="token builtin class-name">command</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> publish channel01 <span class="token string">&quot;hello redis&quot;</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> subscribe channel01
Reading messages<span class="token punctuation">..</span>. <span class="token punctuation">(</span>press Ctrl-C to quit<span class="token punctuation">)</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;subscribe&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;channel01&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;message&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;channel01&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;hello redis&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h1 id="redis-æ–°æ•°æ®ç±»å‹" tabindex="-1"><a class="header-anchor" href="#redis-æ–°æ•°æ®ç±»å‹" aria-hidden="true">#</a> Redis æ–°æ•°æ®ç±»å‹</h1><h2 id="bitmaps" tabindex="-1"><a class="header-anchor" href="#bitmaps" aria-hidden="true">#</a> Bitmaps</h2><h3 id="ç®€ä»‹-5" tabindex="-1"><a class="header-anchor" href="#ç®€ä»‹-5" aria-hidden="true">#</a> ç®€ä»‹</h3><p>â€‹ ç°ä»£è®¡ç®—æœºç”¨äºŒè¿›åˆ¶ï¼ˆä½ï¼‰ ä½œä¸ºä¿¡æ¯çš„åŸºç¡€å•ä½ï¼Œ 1ä¸ªå­—èŠ‚ç­‰äº8ä½ï¼Œ ä¾‹å¦‚ &quot;abc&quot; å­—ç¬¦ä¸²æ˜¯ç”± 3 ä¸ªå­—èŠ‚ç»„æˆï¼Œ ä½†å®é™…åœ¨è®¡ç®—æœºå­˜å‚¨æ—¶å°†å…¶ç”¨äºŒè¿›åˆ¶è¡¨ç¤ºï¼Œ &quot;abc&quot; åˆ†åˆ«å¯¹åº”çš„ ASCII ç åˆ†åˆ«æ˜¯97ã€ 98ã€ 99ï¼Œ å¯¹åº”çš„äºŒè¿›åˆ¶åˆ†åˆ«æ˜¯ 01100001ã€ 01100010 å’Œ 01100011ï¼Œå¦‚ä¸‹å›¾ï¼š</p><img src="/assets/image-20221009163649599-26db9a4a.png" alt="image-20221009163649599" style="zoom:80%;"><p>åˆç†åœ°ä½¿ç”¨æ“ä½œä½èƒ½å¤Ÿæœ‰æ•ˆåœ°æé«˜å†…å­˜ä½¿ç”¨ç‡å’Œå¼€å‘æ•ˆç‡ã€‚</p><p>Redis æä¾›äº† Bitmaps è¿™ä¸ª &quot;æ•°æ®ç±»å‹&quot; å¯ä»¥å®ç°å¯¹ä½çš„æ“ä½œï¼š</p><p>ï¼ˆ1ï¼‰ Bitmaps æœ¬èº«ä¸æ˜¯ä¸€ç§æ•°æ®ç±»å‹ï¼Œ å®é™…ä¸Šå®ƒå°±æ˜¯å­—ç¬¦ä¸²ï¼ˆkey-valueï¼‰ ï¼Œ ä½†æ˜¯å®ƒå¯ä»¥å¯¹å­—ç¬¦ä¸²çš„ä½è¿›è¡Œæ“ä½œã€‚</p><p>ï¼ˆ2ï¼‰ Bitmaps å•ç‹¬æä¾›äº†ä¸€å¥—å‘½ä»¤ï¼Œ æ‰€ä»¥åœ¨ Redis ä¸­ä½¿ç”¨ Bitmaps å’Œä½¿ç”¨å­—ç¬¦ä¸²çš„æ–¹æ³•ä¸å¤ªç›¸åŒã€‚ å¯ä»¥æŠŠ Bitmaps æƒ³è±¡æˆä¸€ä¸ªä»¥ä½ä¸ºå•ä½çš„æ•°ç»„ï¼Œ æ•°ç»„çš„æ¯ä¸ªå•å…ƒ</p><p>â€‹ åªèƒ½å­˜å‚¨ 0 å’Œ 1ï¼Œ æ•°ç»„çš„ä¸‹æ ‡åœ¨ Bitmaps ä¸­å«åšåç§»é‡ã€‚</p><h3 id="å‘½ä»¤" tabindex="-1"><a class="header-anchor" href="#å‘½ä»¤" aria-hidden="true">#</a> å‘½ä»¤</h3><ol><li><p>setbit</p><p>â€‹ <code>setbit&lt;key&gt;&lt;offset&gt;&lt;value&gt;</code></p><p>â€‹ è®¾ç½®Bitmapsä¸­æŸä¸ªåç§»é‡çš„å€¼ï¼ˆ0æˆ–1ï¼‰ï¼Œ*offsetï¼šåç§»é‡ä»0å¼€å§‹</p></li></ol><blockquote><p>ç¤ºä¾‹ï¼š</p><p>â€‹ æ¯ä¸ªç‹¬ç«‹ç”¨æˆ·æ˜¯å¦è®¿é—®è¿‡ç½‘ç«™å­˜æ”¾åœ¨Bitmapsä¸­ï¼Œ å°†è®¿é—®çš„ç”¨æˆ·è®°åš1ï¼Œ æ²¡æœ‰è®¿é—®çš„ç”¨æˆ·è®°åš0ï¼Œ ç”¨åç§»é‡ä½œä¸ºç”¨æˆ·çš„idã€‚è®¾ç½®é”®çš„ç¬¬offsetä¸ªä½çš„å€¼ï¼ˆä»0ç®—èµ·ï¼‰ ï¼Œ å‡è®¾ç°åœ¨æœ‰20ä¸ªç”¨æˆ·ï¼Œuserid=1ï¼Œ 6ï¼Œ 11ï¼Œ 15ï¼Œ 19çš„ç”¨æˆ·å¯¹ç½‘ç«™è¿›è¡Œäº†è®¿é—®ï¼Œ é‚£ä¹ˆå½“å‰Bitmapsåˆå§‹åŒ–ç»“æœå¦‚å›¾ï¼š</p><img src="/assets/image-20221009171946723-5766ae2a.png" alt="image-20221009171946723" style="zoom:80%;"><p>unique:users:20201106ä»£è¡¨2020-11-06è¿™å¤©çš„ç‹¬ç«‹è®¿é—®ç”¨æˆ·çš„Bitmaps</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> setbit unique:user:20220202 <span class="token number">1</span> <span class="token number">1</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> setbit unique:user:20220202 <span class="token number">6</span> <span class="token number">1</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> setbit unique:user:20220202 <span class="token number">11</span> <span class="token number">1</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> setbit unique:user:20220202 <span class="token number">15</span> <span class="token number">1</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> setbit unique:user:20220202 <span class="token number">19</span> <span class="token number">1</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„ï¼š</p><p>â€‹ å¾ˆå¤šåº”ç”¨çš„ç”¨æˆ· id ä»¥ä¸€ä¸ªæŒ‡å®šæ•°å­—ï¼ˆä¾‹å¦‚10000ï¼‰ å¼€å¤´ï¼Œ ç›´æ¥å°†ç”¨æˆ· id å’Œ Bitmaps çš„åç§»é‡å¯¹åº”åŠ¿å¿…ä¼šé€ æˆä¸€å®šçš„æµªè´¹ï¼Œ é€šå¸¸çš„åšæ³•æ˜¯æ¯æ¬¡åš setbit æ“ä½œæ—¶å°†ç”¨æˆ· id å‡å»è¿™ä¸ªæŒ‡å®šæ•°å­—ã€‚</p><p>åœ¨ç¬¬ä¸€æ¬¡åˆå§‹åŒ–Bitmapsæ—¶ï¼Œ å‡å¦‚åç§»é‡éå¸¸å¤§ï¼Œ é‚£ä¹ˆæ•´ä¸ªåˆå§‹åŒ–è¿‡ç¨‹æ‰§è¡Œä¼šæ¯”è¾ƒæ…¢ï¼Œ å¯èƒ½ä¼šé€ æˆRedisçš„é˜»å¡ã€‚</p></blockquote><p>ï¼ˆ2ï¼‰getbit</p><p>â€‹ <code>getbit&lt;key&gt;&lt;offset&gt;</code></p><p>â€‹ è·å–Bitmapsä¸­æŸä¸ªåç§»é‡çš„å€¼ï¼ˆè·å–é”®çš„ç¬¬offsetä½çš„å€¼ï¼ˆä»0å¼€å§‹ç®—ï¼‰ï¼‰</p><blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> getbit unique:user:20220202 <span class="token number">1</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> getbit unique:user:20220202 <span class="token number">3</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> getbit unique:user:20220202 <span class="token number">6</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></blockquote><p>ï¼ˆ3ï¼‰bitcount</p><p>â€‹ <code>bitcount&lt;key&gt;[start end] </code></p><p>â€‹ ç»Ÿè®¡å­—ç¬¦ä¸²<strong>ä» start å­—èŠ‚åˆ° end å­—èŠ‚</strong>æ¯”ç‰¹å€¼ä¸º1çš„æ•°é‡</p><blockquote><p>â€‹ ç»Ÿè®¡<strong>å­—ç¬¦ä¸²</strong>è¢«è®¾ç½®ä¸º1çš„bitæ•°ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç»™å®šçš„æ•´ä¸ªå­—ç¬¦ä¸²éƒ½ä¼šè¢«è¿›è¡Œè®¡æ•°ï¼Œé€šè¿‡æŒ‡å®šé¢å¤–çš„ start æˆ– end å‚æ•°ï¼Œå¯ä»¥è®©è®¡æ•°åªåœ¨ç‰¹å®šçš„ä½ä¸Šè¿›è¡Œã€‚start å’Œ end å‚æ•°çš„è®¾ç½®ï¼Œéƒ½å¯ä»¥ä½¿ç”¨è´Ÿæ•°å€¼ï¼šæ¯”å¦‚ -1 è¡¨ç¤ºæœ€åä¸€ä¸ªä½ï¼Œè€Œ -2 è¡¨ç¤ºå€’æ•°ç¬¬äºŒä¸ªä½ï¼Œstartã€end æ˜¯æŒ‡bitç»„çš„å­—èŠ‚çš„ä¸‹æ ‡æ•°ï¼ŒäºŒè€…çš†åŒ…å«ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> bitcount unique:user:20220202
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">5</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> bitcount unique:user:20220202 <span class="token number">1</span> <span class="token number">3</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>start å’Œ end ä»£è¡¨èµ·å§‹å’Œç»“æŸå­—èŠ‚æ•°ï¼Œ ä¸‹é¢æ“ä½œè®¡ç®—ç”¨æˆ·idåœ¨ç¬¬1ä¸ªå­—èŠ‚åˆ°ç¬¬3ä¸ªå­—èŠ‚ä¹‹é—´çš„ç‹¬ç«‹è®¿é—®ç”¨æˆ·æ•°ï¼Œ å¯¹åº”çš„ç”¨æˆ·idæ˜¯11ï¼Œ 15ï¼Œ 19ã€‚</p><p>è¯´æ˜ï¼š</p><p>ä¸¾ä¾‹ï¼š K1 ã€01000001 01000000 00000000 00100001ã€‘ï¼Œå¯¹åº”ã€0ï¼Œ1ï¼Œ2ï¼Œ3ã€‘</p><p>bitcount K1 1 2 ï¼š ç»Ÿè®¡ä¸‹æ ‡1ã€2å­—èŠ‚ç»„ä¸­bit=1çš„ä¸ªæ•°ï¼Œå³01000000 00000000 ç»“æœä¸º1</p><p>bitcount K1 1 3 ï¼š ç»Ÿè®¡ä¸‹æ ‡1ã€2å­—èŠ‚ç»„ä¸­bit=1çš„ä¸ªæ•°ï¼Œå³01000000 00000000 00100001 ç»“æœä¸º3</p><p>bitcount K1 0 -2 ï¼š ç»Ÿè®¡ä¸‹æ ‡0åˆ°ä¸‹æ ‡å€’æ•°ç¬¬2ï¼Œå­—èŠ‚ç»„ä¸­bit=1çš„ä¸ªæ•°ï¼Œå³01000001 01000000 00000000 ç»“æœä¸º3</p><p>æ³¨æ„ï¼šredisçš„setbitè®¾ç½®æˆ–æ¸…é™¤çš„æ˜¯bitä½ç½®ï¼Œè€Œbitcountè®¡ç®—çš„æ˜¯byteä½ç½®ã€‚</p></blockquote><p>ï¼ˆ4ï¼‰bitop</p><p>â€‹ <code>bitop and(or/not/xor) &lt;destkey&gt; [keyâ€¦]</code></p><p>â€‹ bitopæ˜¯ä¸€ä¸ªå¤åˆæ“ä½œï¼Œ å®ƒå¯ä»¥åšå¤šä¸ªBitmapsçš„ <strong>andï¼ˆäº¤é›†ï¼‰ ã€ orï¼ˆå¹¶é›†ï¼‰ ã€ notï¼ˆéï¼‰ ã€ xorï¼ˆå¼‚æˆ–ï¼‰</strong> æ“ä½œå¹¶å°†ç»“æœä¿å­˜åœ¨destkeyä¸­ã€‚</p><blockquote><p>2022-02-02 æ—¥è®¿é—®ç½‘ç«™çš„userid=1, 2, 5, 9ã€‚</p><p>setbit unique:users:20220202 1 1</p><p>setbit unique:users:20220202 2 1</p><p>setbit unique:users:20220202 5 1</p><p>setbit unique:users:20220202 9 1</p><p>2022-02-03 æ—¥è®¿é—®ç½‘ç«™çš„userid=0, 1, 4, 9ã€‚</p><p>setbit unique:users:20220203 0 1</p><p>setbit unique:users:20220203 1 1</p><p>setbit unique:users:20220203 4 1</p><p>setbit unique:users:20220203 9 1</p><p>è®¡ç®—å‡ºä¸¤å¤©éƒ½è®¿é—®è¿‡ç½‘ç«™çš„ç”¨æˆ·æ•°é‡ï¼š</p><p>bitop and unique:users:and:20220202_03 unique:users:20220203 unique:users:20220202</p><p>è®¡ç®—å‡ºä»»æ„ä¸€å¤©éƒ½è®¿é—®è¿‡ç½‘ç«™çš„ç”¨æˆ·æ•°é‡ï¼ˆä¾‹å¦‚æœˆæ´»è·ƒå°±æ˜¯ç±»ä¼¼è¿™ç§ï¼‰ ï¼Œ å¯ä»¥ä½¿ç”¨oræ±‚å¹¶é›†</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> BITOP and unique:users:and:20220202_03 unique:users:20220203 unique:users:20220202
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> BITOP or unique:users:and:20220202_03 unique:users:20220203 unique:users:20220202
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></blockquote><h3 id="bitmaps-ä¸-set-å¯¹æ¯”" tabindex="-1"><a class="header-anchor" href="#bitmaps-ä¸-set-å¯¹æ¯”" aria-hidden="true">#</a> Bitmaps ä¸ set å¯¹æ¯”</h3><p>å‡è®¾ç½‘ç«™æœ‰ 1 äº¿ç”¨æˆ·ï¼Œ æ¯å¤©ç‹¬ç«‹è®¿é—®çš„ç”¨æˆ·æœ‰ 5 åƒä¸‡ï¼Œ å¦‚æœæ¯å¤©ç”¨é›†åˆç±»å‹å’Œ Bitmaps åˆ†åˆ«å­˜å‚¨æ´»è·ƒç”¨æˆ·å¯ä»¥å¾—åˆ°è¡¨ï¼š</p><table><thead><tr><th>setå’ŒBitmapså­˜å‚¨ä¸€å¤©æ´»è·ƒç”¨æˆ·å¯¹æ¯”</th><th></th><th></th><th></th></tr></thead><tbody><tr><td>æ•°æ® ç±»å‹</td><td>æ¯ä¸ªç”¨æˆ·idå ç”¨ç©ºé—´</td><td>éœ€è¦å­˜å‚¨çš„ç”¨æˆ·é‡</td><td>å…¨éƒ¨å†…å­˜é‡</td></tr><tr><td>é›†åˆ ç±»å‹</td><td>64ä½</td><td>50000000</td><td>64ä½*50000000 = 400MB</td></tr><tr><td>Bitmaps</td><td>1ä½</td><td>100000000</td><td>1ä½*100000000 = 12.5MB</td></tr></tbody></table><p>å¾ˆæ˜æ˜¾ï¼Œ è¿™ç§æƒ…å†µä¸‹ä½¿ç”¨Bitmapsèƒ½èŠ‚çœå¾ˆå¤šçš„å†…å­˜ç©ºé—´ï¼Œ å°¤å…¶æ˜¯éšç€æ—¶é—´æ¨ç§»èŠ‚çœçš„å†…å­˜è¿˜æ˜¯éå¸¸å¯è§‚çš„ã€‚</p><table><thead><tr><th>setå’ŒBitmapså­˜å‚¨ç‹¬ç«‹ç”¨æˆ·ç©ºé—´å¯¹æ¯”</th><th></th><th></th><th></th></tr></thead><tbody><tr><td>æ•°æ®ç±»å‹</td><td>ä¸€å¤©</td><td>ä¸€ä¸ªæœˆ</td><td>ä¸€å¹´</td></tr><tr><td>é›†åˆç±»å‹</td><td>400MB</td><td>12GB</td><td>144GB</td></tr><tr><td>Bitmaps</td><td>12.5MB</td><td>375MB</td><td>4.5GB</td></tr></tbody></table><p>ä½†Bitmapså¹¶ä¸æ˜¯ä¸‡é‡‘æ²¹ï¼Œ å‡å¦‚è¯¥ç½‘ç«™æ¯å¤©çš„ç‹¬ç«‹è®¿é—®ç”¨æˆ·å¾ˆå°‘ï¼Œ ä¾‹å¦‚åªæœ‰10ä¸‡ï¼ˆå¤§é‡çš„åƒµå°¸ç”¨æˆ·ï¼‰ ï¼Œ é‚£ä¹ˆä¸¤è€…çš„å¯¹æ¯”å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼Œ å¾ˆæ˜¾ç„¶ï¼Œ è¿™æ—¶å€™ä½¿ç”¨Bitmapså°±ä¸å¤ªåˆé€‚äº†ï¼Œ å› ä¸ºåŸºæœ¬ä¸Šå¤§éƒ¨åˆ†ä½éƒ½æ˜¯0ã€‚</p><table><thead><tr><th>setå’ŒBitmapså­˜å‚¨ä¸€å¤©æ´»è·ƒç”¨æˆ·å¯¹æ¯” ç‹¬ç«‹ç”¨æˆ·æ¯”è¾ƒå°‘ï¼‰</th><th></th><th></th><th></th></tr></thead><tbody><tr><td>æ•°æ®ç±»å‹</td><td>æ¯ä¸ªuseridå ç”¨ç©ºé—´</td><td>éœ€è¦å­˜å‚¨çš„ç”¨æˆ·é‡</td><td>å…¨éƒ¨å†…å­˜é‡</td></tr><tr><td>é›†åˆç±»å‹</td><td>64ä½</td><td>100000</td><td>64ä½*100000 = 800KB</td></tr><tr><td>Bitmaps</td><td>1ä½</td><td>100000000</td><td>1ä½*100000000 = 12.5MB</td></tr></tbody></table><h2 id="hyperloglog" tabindex="-1"><a class="header-anchor" href="#hyperloglog" aria-hidden="true">#</a> HyperLogLog</h2><h3 id="ç®€ä»‹-6" tabindex="-1"><a class="header-anchor" href="#ç®€ä»‹-6" aria-hidden="true">#</a> ç®€ä»‹</h3><p>â€‹ åœ¨å·¥ä½œå½“ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°ä¸ç»Ÿè®¡ç›¸å…³çš„åŠŸèƒ½éœ€æ±‚ï¼Œæ¯”å¦‚ç»Ÿè®¡ç½‘ç«™PVï¼ˆPageViewé¡µé¢è®¿é—®é‡ï¼‰,å¯ä»¥ä½¿ç”¨Redisçš„incrã€incrbyè½»æ¾å®ç°ã€‚</p><p>â€‹ ä½†åƒUVï¼ˆUniqueVisitorï¼Œç‹¬ç«‹è®¿å®¢ï¼‰ã€ç‹¬ç«‹IPæ•°ã€æœç´¢è®°å½•æ•°ç­‰éœ€è¦å»é‡å’Œè®¡æ•°çš„é—®é¢˜å¦‚ä½•è§£å†³ï¼Ÿè¿™ç§æ±‚é›†åˆä¸­ä¸é‡å¤å…ƒç´ ä¸ªæ•°çš„é—®é¢˜ç§°ä¸ºåŸºæ•°é—®é¢˜ã€‚</p><p>è§£å†³åŸºæ•°é—®é¢˜æœ‰å¾ˆå¤šç§æ–¹æ¡ˆï¼š</p><p>ï¼ˆ1ï¼‰æ•°æ®å­˜å‚¨åœ¨MySQLè¡¨ä¸­ï¼Œä½¿ç”¨distinct countè®¡ç®—ä¸é‡å¤ä¸ªæ•°</p><p>ï¼ˆ2ï¼‰ä½¿ç”¨Redisæä¾›çš„hashã€setã€bitmapsç­‰æ•°æ®ç»“æ„æ¥å¤„ç†</p><p>ä»¥ä¸Šçš„æ–¹æ¡ˆç»“æœç²¾ç¡®ï¼Œä½†éšç€æ•°æ®ä¸æ–­å¢åŠ ï¼Œå¯¼è‡´å ç”¨ç©ºé—´è¶Šæ¥è¶Šå¤§ï¼Œå¯¹äºéå¸¸å¤§çš„æ•°æ®é›†æ˜¯ä¸åˆ‡å®é™…çš„ã€‚</p><p>èƒ½å¦èƒ½å¤Ÿé™ä½ä¸€å®šçš„ç²¾åº¦æ¥å¹³è¡¡å­˜å‚¨ç©ºé—´ï¼ŸRedisæ¨å‡ºäº†HyperLogLog</p><p>Redis HyperLogLog æ˜¯ç”¨æ¥åšåŸºæ•°ç»Ÿè®¡çš„ç®—æ³•ï¼ŒHyperLogLog çš„ä¼˜ç‚¹æ˜¯ï¼Œåœ¨è¾“å…¥å…ƒç´ çš„æ•°é‡æˆ–è€…ä½“ç§¯éå¸¸éå¸¸å¤§æ—¶ï¼Œè®¡ç®—åŸºæ•°æ‰€éœ€çš„ç©ºé—´æ€»æ˜¯å›ºå®šçš„ã€å¹¶ä¸”æ˜¯å¾ˆå°çš„ã€‚</p><p>åœ¨ Redis é‡Œé¢ï¼Œæ¯ä¸ª HyperLogLog é”®åªéœ€è¦èŠ±è´¹ 12 KB å†…å­˜ï¼Œå°±å¯ä»¥è®¡ç®—æ¥è¿‘ 2^64 ä¸ªä¸åŒå…ƒç´ çš„åŸºæ•°ã€‚è¿™å’Œè®¡ç®—åŸºæ•°æ—¶ï¼Œå…ƒç´ è¶Šå¤šè€—è´¹å†…å­˜å°±è¶Šå¤šçš„é›†åˆå½¢æˆé²œæ˜å¯¹æ¯”ã€‚</p><p>ä½†æ˜¯ï¼Œå› ä¸º HyperLogLog åªä¼šæ ¹æ®è¾“å…¥å…ƒç´ æ¥è®¡ç®—åŸºæ•°ï¼Œè€Œä¸ä¼šå‚¨å­˜è¾“å…¥å…ƒç´ æœ¬èº«ï¼Œæ‰€ä»¥ HyperLogLog ä¸èƒ½åƒé›†åˆé‚£æ ·ï¼Œè¿”å›è¾“å…¥çš„å„ä¸ªå…ƒç´ ã€‚</p><p>ä»€ä¹ˆæ˜¯åŸºæ•°?</p><p>æ¯”å¦‚æ•°æ®é›† {1, 3, 5, 7, 5, 7, 8}ï¼Œ é‚£ä¹ˆè¿™ä¸ªæ•°æ®é›†çš„åŸºæ•°é›†ä¸º {1, 3, 5 ,7, 8}, åŸºæ•°(ä¸é‡å¤å…ƒç´ )ä¸º5ã€‚ åŸºæ•°ä¼°è®¡å°±æ˜¯åœ¨è¯¯å·®å¯æ¥å—çš„èŒƒå›´å†…ï¼Œå¿«é€Ÿè®¡ç®—åŸºæ•°ã€‚</p><h3 id="å‘½ä»¤-1" tabindex="-1"><a class="header-anchor" href="#å‘½ä»¤-1" aria-hidden="true">#</a> å‘½ä»¤</h3><p>ï¼ˆ1ï¼‰pfadd</p><p>â€‹ <code>pfadd &lt;key&gt;&lt; element&gt; [element ...] </code></p><p>â€‹ æ·»åŠ æŒ‡å®šå…ƒç´ åˆ° HyperLogLog ä¸­</p><blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> pfadd hll1 <span class="token string">&quot;redis&quot;</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> pfadd hll1 <span class="token string">&quot;mysql&quot;</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> pfadd hll1 <span class="token string">&quot;redis&quot;</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>â€‹ å°†æ‰€æœ‰å…ƒç´ æ·»åŠ åˆ°æŒ‡å®šHyperLogLogæ•°æ®ç»“æ„ä¸­ã€‚å¦‚æœæ‰§è¡Œå‘½ä»¤åHLLä¼°è®¡çš„è¿‘ä¼¼åŸºæ•°å‘ç”Ÿå˜åŒ–ï¼Œåˆ™è¿”å›1ï¼Œå¦åˆ™è¿”å›0ã€‚</p></blockquote><p>ï¼ˆ2ï¼‰pfcount</p><p>â€‹ <code>pfcount&lt;key&gt; [key ...] </code></p><p>â€‹ è®¡ç®—HLLçš„è¿‘ä¼¼åŸºæ•°ï¼Œå¯ä»¥è®¡ç®—å¤šä¸ªHLLï¼Œæ¯”å¦‚ç”¨HLLå­˜å‚¨æ¯å¤©çš„UVï¼Œè®¡ç®—ä¸€å‘¨çš„UVå¯ä»¥ä½¿ç”¨7å¤©çš„UVåˆå¹¶è®¡ç®—å³å¯</p><blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> pfadd hll1 <span class="token string">&quot;redis&quot;</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> pfadd hll1 <span class="token string">&quot;mysql&quot;</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> pfadd hll1 <span class="token string">&quot;redis&quot;</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> pfcount hll1
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> pfadd hll2 <span class="token string">&quot;kafka&quot;</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> pfadd hll2 <span class="token string">&quot;nginx&quot;</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> pfcount hll1 hll2
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">4</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></blockquote><p>ï¼ˆ3ï¼‰pfmerge</p><p>â€‹ <code>pfmerge&lt;destkey&gt;&lt;sourcekey&gt; [sourcekey ...] </code></p><p>â€‹ å°†ä¸€ä¸ªæˆ–å¤šä¸ªHLLåˆå¹¶åçš„ç»“æœå­˜å‚¨åœ¨å¦ä¸€ä¸ªHLLä¸­ï¼Œæ¯”å¦‚æ¯æœˆæ´»è·ƒç”¨æˆ·å¯ä»¥ä½¿ç”¨æ¯å¤©çš„æ´»è·ƒç”¨æˆ·æ¥åˆå¹¶è®¡ç®—å¯å¾—</p><blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> pfcount hll1 hll2
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">4</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> pfmerge hll3 hll1 hll2
OK
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> pfcount hll3
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">4</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></blockquote><h2 id="geospatial" tabindex="-1"><a class="header-anchor" href="#geospatial" aria-hidden="true">#</a> Geospatial</h2><h3 id="ç®€ä»‹-7" tabindex="-1"><a class="header-anchor" href="#ç®€ä»‹-7" aria-hidden="true">#</a> ç®€ä»‹</h3><p>â€‹ Redis 3.2 ä¸­å¢åŠ äº†å¯¹ GEO ç±»å‹çš„æ”¯æŒã€‚GEOï¼ŒGeographicï¼Œåœ°ç†ä¿¡æ¯çš„ç¼©å†™ã€‚è¯¥ç±»å‹ï¼Œå°±æ˜¯å…ƒç´ çš„äºŒç»´åæ ‡ï¼Œåœ¨åœ°å›¾ä¸Šå°±æ˜¯ç»çº¬åº¦ã€‚redis åŸºäºè¯¥ç±»å‹ï¼Œæä¾›äº†ç»çº¬åº¦è®¾ç½®ï¼ŒæŸ¥è¯¢ï¼ŒèŒƒå›´æŸ¥è¯¢ï¼Œè·ç¦»æŸ¥è¯¢ï¼Œç»çº¬åº¦ Hash ç­‰å¸¸è§æ“ä½œã€‚</p><h3 id="å‘½ä»¤-2" tabindex="-1"><a class="header-anchor" href="#å‘½ä»¤-2" aria-hidden="true">#</a> å‘½ä»¤</h3><p>ï¼ˆ1ï¼‰geoadd</p><p>â€‹ <code>geoadd&lt;key&gt;&lt; longitude&gt;&lt;latitude&gt;&lt;member&gt; [longitude latitude member...] </code></p><p>â€‹ æ·»åŠ åœ°ç†ä½ç½®ï¼ˆç»åº¦ï¼Œçº¬åº¦ï¼Œåç§°ï¼‰</p><blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> geoadd china:city <span class="token number">121.47</span> <span class="token number">31.23</span> shanghai
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> geoadd china:city <span class="token number">106.50</span> <span class="token number">29.53</span> chongqing <span class="token number">114.05</span> <span class="token number">22.52</span> shenzhen <span class="token number">116.38</span> <span class="token number">39.90</span> beijing
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> geoadd china:city <span class="token number">121.47</span> <span class="token number">31.23</span> shanghai
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ä¸¤ææ— æ³•ç›´æ¥æ·»åŠ ï¼Œä¸€èˆ¬ä¼šä¸‹è½½åŸå¸‚æ•°æ®ï¼Œç›´æ¥é€šè¿‡ Java ç¨‹åºä¸€æ¬¡æ€§å¯¼å…¥ã€‚</li><li>æœ‰æ•ˆçš„ç»åº¦ä» -180 åº¦åˆ° 180 åº¦ã€‚æœ‰æ•ˆçš„çº¬åº¦ä» -85.05112878 åº¦åˆ° 85.05112878 åº¦ã€‚</li><li>å½“åæ ‡ä½ç½®è¶…å‡ºæŒ‡å®šèŒƒå›´æ—¶ï¼Œè¯¥å‘½ä»¤å°†ä¼šè¿”å›ä¸€ä¸ªé”™è¯¯ã€‚</li><li><strong>å·²ç»æ·»åŠ çš„æ•°æ®ï¼Œæ˜¯æ— æ³•å†æ¬¡å¾€é‡Œé¢æ·»åŠ çš„ã€‚</strong></li></ul></blockquote><p>ï¼ˆ2ï¼‰geopos</p><p>â€‹ <code>geopos &lt;key&gt;&lt;member&gt; [member...]</code></p><p>â€‹ è·å¾—æŒ‡å®šåœ°åŒºçš„åæ ‡å€¼</p><blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> geopos china:city shanghai
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;121.47000163793563843&quot;</span>
   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;31.22999903975783553&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></blockquote><p>ï¼ˆ3ï¼‰geodist</p><p>â€‹ <code>geodist&lt;key&gt;&lt;member1&gt;&lt;member2&gt; [m|km|ft|mi ] </code></p><p>â€‹ è·å–ä¸¤ä¸ªä½ç½®ä¹‹é—´çš„ç›´çº¿è·ç¦»</p><blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> geodist china:city beijing shanghai
<span class="token string">&quot;1068153.5181&quot;</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> geodist china:city beijing shanghai km
<span class="token string">&quot;1068.1535&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å•ä½ï¼š</p><ul><li><p>m è¡¨ç¤ºå•ä½ä¸ºç±³[é»˜è®¤å€¼]ã€‚</p></li><li><p>km è¡¨ç¤ºå•ä½ä¸ºåƒç±³ã€‚</p></li><li><p>mi è¡¨ç¤ºå•ä½ä¸ºè‹±é‡Œã€‚</p></li><li><p>ft è¡¨ç¤ºå•ä½ä¸ºè‹±å°ºã€‚</p><p>å¦‚æœç”¨æˆ·æ²¡æœ‰æ˜¾å¼åœ°æŒ‡å®šå•ä½å‚æ•°ï¼Œ é‚£ä¹ˆ GEODIST é»˜è®¤ä½¿ç”¨ç±³ä½œä¸ºå•ä½</p></li></ul></blockquote><p>ï¼ˆ4ï¼‰georadius</p><p>â€‹ <code>georadius&lt;key&gt;&lt; longitude&gt;&lt;latitude&gt;radius m|km|ft|mi </code></p><p>â€‹ ä»¥ç»™å®šçš„ç»çº¬åº¦ä¸ºä¸­å¿ƒï¼Œæ‰¾å‡ºæŸä¸€åŠå¾„å†…çš„å…ƒç´ </p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> georadius china:city <span class="token number">110</span> <span class="token number">30</span> <span class="token number">1000</span> km
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;chongqing&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;shenzhen&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="jedis-è¿æ¥-redis" tabindex="-1"><a class="header-anchor" href="#jedis-è¿æ¥-redis" aria-hidden="true">#</a> Jedis è¿æ¥ Redis</h1><p>åˆ›å»ºå·¥ç¨‹ <code>RedisTest</code></p><h2 id="pom-xml" tabindex="-1"><a class="header-anchor" href="#pom-xml" aria-hidden="true">#</a> pom.xml</h2><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>redis.clients<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jedis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.2.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="è¿æ¥-redis-æ³¨æ„äº‹é¡¹" tabindex="-1"><a class="header-anchor" href="#è¿æ¥-redis-æ³¨æ„äº‹é¡¹" aria-hidden="true">#</a> è¿æ¥ Redis æ³¨æ„äº‹é¡¹</h2><p>ç¦ç”¨ Linux çš„é˜²ç«å¢™ï¼šLinuxï¼ˆCentOS7ï¼‰æ‰§è¡Œå‘½ä»¤</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>systemctl stop/disable firewalld.service
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æˆ–è€…å¼€æ”¾ç«¯å£ 6379</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># æŸ¥çœ‹å¼€æ”¾çš„ç«¯å£å·</span>
firewall-cmd --list-all
<span class="token comment"># è®¾ç½®å¼€æ”¾çš„ç«¯å£å·</span>
firewall-cmd --add-service<span class="token operator">=</span>redis <span class="token parameter variable">--permanent</span>
firewall-cmd --add-port<span class="token operator">=</span><span class="token number">6379</span>/tcp <span class="token parameter variable">--permanent</span>
<span class="token comment"># é‡å¯é˜²ç«å¢™</span>
firewall-cmd <span class="token parameter variable">--reload</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>redis.conf ä¸­æ³¨é‡Šæ‰ bind 127.0.0.1ï¼Œå¹¶ä¸”è®¾ç½®ï¼š protected-mode no</p><p>ã€<strong>æ”¹é…ç½®å‰å¿…é¡»å…³æ‰ redisï¼Œå¦åˆ™ä¸ç”Ÿæ•ˆ</strong>ã€‘</p><div class="language-tex line-numbers-mode" data-ext="tex"><pre class="language-tex"><code>-DENIED Redis is running in protected mode because protected mode is enabled, no bind address was specified, no authentication password is requested to clients. In this mode connections are only accepted from the loopback interface. If you want to connect from external computers to Redis you may adopt one of the following solutions: 
1) Just disable protected mode sending the command &#39;CONFIG SET protected-mode no&#39; from the loopback interface by connecting to Redis from the same host the server is running, however MAKE SURE Redis is not publicly accessible from internet if you do so. Use CONFIG REWRITE to make this change permanent. 
2) Alternatively you can just disable the protected mode by editing the Redis configuration file, and setting the protected mode option to &#39;no&#39;, and then restarting the server. 
3) If you started the server manually just for testing, restart it with the &#39;--protected-mode no&#39; option. 
4) Setup a bind address or an authentication password. 
NOTE: You only need to do one of the above things in order for the server to start accepting connections from the outside. 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="æµ‹è¯•è¿æ¥" tabindex="-1"><a class="header-anchor" href="#æµ‹è¯•è¿æ¥" aria-hidden="true">#</a> æµ‹è¯•è¿æ¥</h2><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JedisTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">REDIS_HOST</span> <span class="token operator">=</span> <span class="token string">&quot;192.168.100.100&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">REDIS_PORT</span> <span class="token operator">=</span> <span class="token number">6379</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token constant">REDIS_HOST</span><span class="token punctuation">,</span> <span class="token constant">REDIS_PORT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> pong <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">ping</span><span class="token punctuation">(</span><span class="token string">&quot;Hello Redis!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;pong: &quot;</span> <span class="token operator">+</span> pong<span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="æµ‹è¯•æ•°æ®ç±»å‹" tabindex="-1"><a class="header-anchor" href="#æµ‹è¯•æ•°æ®ç±»å‹" aria-hidden="true">#</a> æµ‹è¯•æ•°æ®ç±»å‹</h2><h3 id="key" tabindex="-1"><a class="header-anchor" href="#key" aria-hidden="true">#</a> key</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DataTypeTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">REDIS_HOST</span> <span class="token operator">=</span> <span class="token string">&quot;192.168.100.100&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">REDIS_PORT</span> <span class="token operator">=</span> <span class="token number">6379</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Before</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token constant">REDIS_HOST</span><span class="token punctuation">,</span> <span class="token constant">REDIS_PORT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">flushDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@After</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>  
    <span class="token doc-comment comment">/**
     * æµ‹è¯• key
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        jedis<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;k1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;v1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;k2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;v2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;k3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;v3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> keys <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        keys<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token string">&quot;k1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">ttl</span><span class="token punctuation">(</span><span class="token string">&quot;k1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;k1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="string" tabindex="-1"><a class="header-anchor" href="#string" aria-hidden="true">#</a> string</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>    <span class="token doc-comment comment">/**
     * æµ‹è¯• string
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        jedis<span class="token punctuation">.</span><span class="token function">mset</span><span class="token punctuation">(</span><span class="token string">&quot;k1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;v1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;k2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;v2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;k3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;v3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">mget</span><span class="token punctuation">(</span><span class="token string">&quot;k1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;k2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;k3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="list" tabindex="-1"><a class="header-anchor" href="#list" aria-hidden="true">#</a> list</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>    <span class="token doc-comment comment">/**
     * æµ‹è¯• list
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        jedis<span class="token punctuation">.</span><span class="token function">rpush</span><span class="token punctuation">(</span><span class="token string">&quot;list01&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;A&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;B&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;C&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">lrange</span><span class="token punctuation">(</span><span class="token string">&quot;list01&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="set" tabindex="-1"><a class="header-anchor" href="#set" aria-hidden="true">#</a> set</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>    <span class="token doc-comment comment">/**
     * æµ‹è¯• set
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        jedis<span class="token punctuation">.</span><span class="token function">sadd</span><span class="token punctuation">(</span><span class="token string">&quot;set01&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;A&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;A&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;B&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;C&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">smembers</span><span class="token punctuation">(</span><span class="token string">&quot;set01&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="hash" tabindex="-1"><a class="header-anchor" href="#hash" aria-hidden="true">#</a> hash</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>    <span class="token doc-comment comment">/**
     * æµ‹è¯• hash
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;tom&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;address&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;NewYork&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;12&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">hmset</span><span class="token punctuation">(</span><span class="token string">&quot;hash01&quot;</span><span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">hmget</span><span class="token punctuation">(</span><span class="token string">&quot;hash01&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;address&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="zset" tabindex="-1"><a class="header-anchor" href="#zset" aria-hidden="true">#</a> zset</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>    <span class="token doc-comment comment">/**
     * æµ‹è¯• zset
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testZset</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        jedis<span class="token punctuation">.</span><span class="token function">zadd</span><span class="token punctuation">(</span><span class="token string">&quot;zset01&quot;</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token string">&quot;A&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">zadd</span><span class="token punctuation">(</span><span class="token string">&quot;zset01&quot;</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token string">&quot;B&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">zadd</span><span class="token punctuation">(</span><span class="token string">&quot;zset01&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">&quot;C&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">zrange</span><span class="token punctuation">(</span><span class="token string">&quot;zset01&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="jedis-éªŒè¯ç ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#jedis-éªŒè¯ç ç¤ºä¾‹" aria-hidden="true">#</a> Jedis éªŒè¯ç ç¤ºä¾‹</h2><p>éœ€æ±‚ï¼š</p><ol><li><p>è¾“å…¥æ‰‹æœºå·ï¼Œç‚¹å‡»å‘é€åéšæœºç”Ÿæˆ 6 ä½æ•°å­—ç ï¼Œ2 åˆ†é’Ÿæœ‰æ•ˆ</p></li><li><p>è¾“å…¥éªŒè¯ç ï¼Œç‚¹å‡»éªŒè¯ï¼Œè¿”å›æˆåŠŸæˆ–å¤±è´¥</p></li><li><p>æ¯ä¸ªæ‰‹æœºå·æ¯å¤©åªèƒ½è¾“å…¥ 3 æ¬¡</p></li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>jedis</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">redis<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>jedis<span class="token punctuation">.</span></span><span class="token class-name">Jedis</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Random</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * 1. è¾“å…¥æ‰‹æœºå·ï¼Œç‚¹å‡»å‘é€åéšæœºç”Ÿæˆ 6 ä½æ•°å­—ç ï¼Œ2 åˆ†é’Ÿæœ‰æ•ˆã€éªŒè¯ç å­˜å…¥ redisã€‘
 * 2. è¾“å…¥éªŒè¯ç ï¼Œç‚¹å‡»éªŒè¯ï¼Œè¿”å›æˆåŠŸæˆ–å¤±è´¥
 * 3. æ¯ä¸ªæ‰‹æœºå·æ¯å¤©åªèƒ½è¾“å…¥ 3 æ¬¡ ã€å‘é€æ¬¡æ•°å­˜å…¥ redisã€‘
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">VerifyCode</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">REDIS_HOST</span> <span class="token operator">=</span> <span class="token string">&quot;192.168.100.100&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">REDIS_PORT</span> <span class="token operator">=</span> <span class="token number">6379</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> alphas <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>
            <span class="token char">&#39;a&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;b&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;c&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;d&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;e&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;f&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;g&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;h&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;i&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;j&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;k&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;l&#39;</span><span class="token punctuation">,</span>
            <span class="token char">&#39;m&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;n&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;o&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;p&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;q&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;r&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;s&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;t&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;u&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;v&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;w&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;x&#39;</span><span class="token punctuation">,</span>
            <span class="token char">&#39;y&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;z&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;0&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;1&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;2&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;3&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;4&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;5&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;6&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;7&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;8&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;9&#39;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Random</span> random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">VerifyCode</span> verifyCode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VerifyCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> phone <span class="token operator">=</span> <span class="token string">&quot;18220549581&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">// verifyCode.sendCode(phone);</span>
        verifyCode<span class="token punctuation">.</span><span class="token function">checkCode</span><span class="token punctuation">(</span>phone<span class="token punctuation">,</span> <span class="token string">&quot;rg105r&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">sendCode</span><span class="token punctuation">(</span><span class="token class-name">String</span> phone<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// åˆ¤æ–­ä¸€å¤©å†…çš„å‘é€æ¬¡æ•°</span>
        <span class="token class-name">String</span> phoneCountKey <span class="token operator">=</span> <span class="token string">&quot;code:&quot;</span> <span class="token operator">+</span> phone <span class="token operator">+</span> <span class="token string">&quot;:count&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token constant">REDIS_HOST</span><span class="token punctuation">,</span> <span class="token constant">REDIS_PORT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> phoneCount <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>phoneCountKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>phoneCount <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            jedis<span class="token punctuation">.</span><span class="token function">setex</span><span class="token punctuation">(</span>phoneCountKey<span class="token punctuation">,</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>phoneCount<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            jedis<span class="token punctuation">.</span><span class="token function">incr</span><span class="token punctuation">(</span>phoneCountKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;éªŒè¯ç å‘é€å·²ç»è¶…è¿‡ä¸‰æ¬¡&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">String</span> code <span class="token operator">=</span> <span class="token function">createCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;createCode: &quot;</span> <span class="token operator">+</span> code<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> phoneCodeKey <span class="token operator">=</span> <span class="token string">&quot;code:&quot;</span> <span class="token operator">+</span> phone <span class="token operator">+</span> <span class="token string">&quot;:code&quot;</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">setex</span><span class="token punctuation">(</span>phoneCodeKey<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token number">60</span><span class="token punctuation">,</span> code<span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">createCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">StringBuilder</span> stringBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">6</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            stringBuilder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>alphas<span class="token punctuation">[</span>random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span>alphas<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> stringBuilder<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * åˆ¤æ–­éªŒè¯ç æ˜¯å¦æ­£ç¡®
     * <span class="token keyword">@param</span> <span class="token parameter">phone</span>
     * <span class="token keyword">@param</span> <span class="token parameter">code</span>
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">checkCode</span><span class="token punctuation">(</span><span class="token class-name">String</span> phone<span class="token punctuation">,</span> <span class="token class-name">String</span> code<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>phone <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> code <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;phone æˆ–è€… code ä¸ä¸º null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token constant">REDIS_HOST</span><span class="token punctuation">,</span> <span class="token constant">REDIS_PORT</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> phoneCodeKey <span class="token operator">=</span> <span class="token string">&quot;code:&quot;</span> <span class="token operator">+</span> phone <span class="token operator">+</span> <span class="token string">&quot;:code&quot;</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> redisCode <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>phoneCodeKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>code<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>redisCode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;éªŒè¯ç æ­£ç¡®ï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;éªŒè¯ç é”™è¯¯ï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="springboot-æ•´åˆ-redis" tabindex="-1"><a class="header-anchor" href="#springboot-æ•´åˆ-redis" aria-hidden="true">#</a> SpringBoot æ•´åˆ Redis</h1><h2 id="å¼•å…¥ä¾èµ–" tabindex="-1"><a class="header-anchor" href="#å¼•å…¥ä¾èµ–" aria-hidden="true">#</a> å¼•å…¥ä¾èµ–</h2><p>åˆ›å»º SpringBoot å·¥ç¨‹ <code>SpringBootRedisTest</code>ï¼Œå¼•å…¥ä¾èµ–</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>
    
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.7.14<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>relativePath</span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>
    
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.example<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>SpringBootRedisTest<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.0.1-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>SpringBootRedisTest<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>SpringBootRedisTest<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
    
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>java.version</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>java.version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>
    
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        
        <span class="token comment">&lt;!-- spring2.X é›†æˆ redis æ‰€éœ€ common-pool2ï¼Œå¯ä»¥ä¸ç”¨å¼•å…¥--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.commons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-pool2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--æ³¨æ„è¯¥ç‰ˆæœ¬åº”è¯¥ç”±spring bootä»²è£--&gt;</span>
            <span class="token comment">&lt;!--&lt;version&gt;2.6.0&lt;/version&gt;--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
		
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="é…ç½®" tabindex="-1"><a class="header-anchor" href="#é…ç½®" aria-hidden="true">#</a> é…ç½®</h2><p>application.properties</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token comment">#RedisæœåŠ¡å™¨åœ°å€</span>
<span class="token key attr-name">spring.redis.host</span><span class="token punctuation">=</span><span class="token value attr-value">192.168.100.100</span>
<span class="token comment">#RedisæœåŠ¡å™¨è¿æ¥ç«¯å£</span>
<span class="token key attr-name">spring.redis.port</span><span class="token punctuation">=</span><span class="token value attr-value">6379</span>
<span class="token comment">#Redisæ•°æ®åº“ç´¢å¼•ï¼ˆé»˜è®¤ä¸º0ï¼‰</span>
<span class="token key attr-name">spring.redis.database</span><span class="token punctuation">=</span> <span class="token value attr-value">0</span>
<span class="token comment">#è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</span>
<span class="token key attr-name">spring.redis.timeout</span><span class="token punctuation">=</span><span class="token value attr-value">1800000</span>
<span class="token comment">#è¿æ¥æ± æœ€å¤§è¿æ¥æ•°ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰</span>
<span class="token key attr-name">spring.redis.lettuce.pool.max-active</span><span class="token punctuation">=</span><span class="token value attr-value">20</span>
<span class="token comment">#æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´(è´Ÿæ•°è¡¨ç¤ºæ²¡é™åˆ¶)</span>
<span class="token key attr-name">spring.redis.lettuce.pool.max-wait</span><span class="token punctuation">=</span><span class="token value attr-value">-1</span>
<span class="token comment">#è¿æ¥æ± ä¸­çš„æœ€å¤§ç©ºé—²è¿æ¥</span>
<span class="token key attr-name">spring.redis.lettuce.pool.max-idle</span><span class="token punctuation">=</span><span class="token value attr-value">5</span>
<span class="token comment">#è¿æ¥æ± ä¸­çš„æœ€å°ç©ºé—²è¿æ¥</span>
<span class="token key attr-name">spring.redis.lettuce.pool.min-idle</span><span class="token punctuation">=</span><span class="token value attr-value">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>application.yml</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token key atrule">database</span><span class="token punctuation">:</span> <span class="token number">0</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> 192.168.100.100
    <span class="token key atrule">lettuce</span><span class="token punctuation">:</span>
      <span class="token key atrule">pool</span><span class="token punctuation">:</span>
        <span class="token key atrule">max-active</span><span class="token punctuation">:</span> <span class="token number">20</span>
        <span class="token key atrule">max-idle</span><span class="token punctuation">:</span> <span class="token number">5</span>
        <span class="token key atrule">max-wait</span><span class="token punctuation">:</span> <span class="token number">-1</span>
        <span class="token key atrule">min-idle</span><span class="token punctuation">:</span> <span class="token number">0</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6379</span>
    <span class="token key atrule">timeout</span><span class="token punctuation">:</span> <span class="token number">1800000</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é…ç½®ç±» RedisConfig</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>springbootredis<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">JsonAutoDetect</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PropertyAccessor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>databind<span class="token punctuation">.</span></span><span class="token class-name">ObjectMapper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cache<span class="token punctuation">.</span></span><span class="token class-name">CacheManager</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cache<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">CachingConfigurerSupport</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cache<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">EnableCaching</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>cache<span class="token punctuation">.</span></span><span class="token class-name">RedisCacheConfiguration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>cache<span class="token punctuation">.</span></span><span class="token class-name">RedisCacheManager</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>connection<span class="token punctuation">.</span></span><span class="token class-name">RedisConnectionFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">RedisTemplate</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>serializer<span class="token punctuation">.</span></span><span class="token class-name">Jackson2JsonRedisSerializer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>serializer<span class="token punctuation">.</span></span><span class="token class-name">RedisSerializationContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>serializer<span class="token punctuation">.</span></span><span class="token class-name">RedisSerializer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>serializer<span class="token punctuation">.</span></span><span class="token class-name">StringRedisSerializer</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@EnableCaching</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisConfig</span> <span class="token keyword">extends</span> <span class="token class-name">CachingConfigurerSupport</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">redisTemplate</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> factory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> template <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">RedisSerializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> redisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Jackson2JsonRedisSerializer</span> jackson2JsonRedisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jackson2JsonRedisSerializer</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">ObjectMapper</span> om <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        om<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">PropertyAccessor</span><span class="token punctuation">.</span><span class="token constant">ALL</span><span class="token punctuation">,</span> <span class="token class-name">JsonAutoDetect<span class="token punctuation">.</span>Visibility</span><span class="token punctuation">.</span><span class="token constant">ANY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        om<span class="token punctuation">.</span><span class="token function">enableDefaultTyping</span><span class="token punctuation">(</span><span class="token class-name">ObjectMapper<span class="token punctuation">.</span>DefaultTyping</span><span class="token punctuation">.</span><span class="token constant">NON_FINAL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jackson2JsonRedisSerializer<span class="token punctuation">.</span><span class="token function">setObjectMapper</span><span class="token punctuation">(</span>om<span class="token punctuation">)</span><span class="token punctuation">;</span>

        template<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>factory<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// key åºåˆ—åŒ–æ–¹å¼</span>
        template<span class="token punctuation">.</span><span class="token function">setKeySerializer</span><span class="token punctuation">(</span>redisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// value åºåˆ—åŒ–</span>
        template<span class="token punctuation">.</span><span class="token function">setValueSerializer</span><span class="token punctuation">(</span>jackson2JsonRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// value hashmap åºåˆ—åŒ–</span>
        template<span class="token punctuation">.</span><span class="token function">setHashValueSerializer</span><span class="token punctuation">(</span>jackson2JsonRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> template<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">CacheManager</span> <span class="token function">cacheManager</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> factory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">RedisSerializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> redisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Jackson2JsonRedisSerializer</span> jackson2JsonRedisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jackson2JsonRedisSerializer</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è§£å†³æŸ¥è¯¢ç¼“å­˜è½¬æ¢å¼‚å¸¸çš„é—®é¢˜</span>
        <span class="token class-name">ObjectMapper</span> om <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        om<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">PropertyAccessor</span><span class="token punctuation">.</span><span class="token constant">ALL</span><span class="token punctuation">,</span> <span class="token class-name">JsonAutoDetect<span class="token punctuation">.</span>Visibility</span><span class="token punctuation">.</span><span class="token constant">ANY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        om<span class="token punctuation">.</span><span class="token function">enableDefaultTyping</span><span class="token punctuation">(</span><span class="token class-name">ObjectMapper<span class="token punctuation">.</span>DefaultTyping</span><span class="token punctuation">.</span><span class="token constant">NON_FINAL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jackson2JsonRedisSerializer<span class="token punctuation">.</span><span class="token function">setObjectMapper</span><span class="token punctuation">(</span>om<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// é…ç½®åºåˆ—åŒ–ï¼ˆè§£å†³ä¹±ç çš„é—®é¢˜ï¼‰,è¿‡æœŸæ—¶é—´ 600 ç§’</span>
        <span class="token class-name">RedisCacheConfiguration</span> config <span class="token operator">=</span> <span class="token class-name">RedisCacheConfiguration</span><span class="token punctuation">.</span><span class="token function">defaultCacheConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">entryTtl</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">600</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">serializeKeysWith</span><span class="token punctuation">(</span><span class="token class-name">RedisSerializationContext<span class="token punctuation">.</span>SerializationPair</span><span class="token punctuation">.</span><span class="token function">fromSerializer</span><span class="token punctuation">(</span>redisSerializer<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">serializeValuesWith</span><span class="token punctuation">(</span><span class="token class-name">RedisSerializationContext<span class="token punctuation">.</span>SerializationPair</span><span class="token punctuation">.</span><span class="token function">fromSerializer</span><span class="token punctuation">(</span>jackson2JsonRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">disableCachingNullValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RedisCacheManager</span> cacheManager <span class="token operator">=</span> <span class="token class-name">RedisCacheManager</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>factory<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">cacheDefaults</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> cacheManager<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#æµ‹è¯•" aria-hidden="true">#</a> æµ‹è¯•</h2><p>RedisTestController</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">RedisTemplate</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Set</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisTestController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> redisTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/string&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">stringTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;str&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Java&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;str&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/set&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Set</span> <span class="token function">setTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">opsForSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;set&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;A&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;B&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;A&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">members</span><span class="token punctuation">(</span><span class="token string">&quot;set&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="redis-äº‹åŠ¡ä¸é”" tabindex="-1"><a class="header-anchor" href="#redis-äº‹åŠ¡ä¸é”" aria-hidden="true">#</a> Redis äº‹åŠ¡ä¸é”</h1><h2 id="redisäº‹åŠ¡å®šä¹‰" tabindex="-1"><a class="header-anchor" href="#redisäº‹åŠ¡å®šä¹‰" aria-hidden="true">#</a> Redisäº‹åŠ¡å®šä¹‰</h2><p>â€‹ Redis äº‹åŠ¡æ˜¯ä¸€ä¸ªå•ç‹¬çš„éš”ç¦»æ“ä½œï¼šäº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šåºåˆ—åŒ–ã€æŒ‰é¡ºåºåœ°æ‰§è¡Œã€‚äº‹åŠ¡åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¸ä¼šè¢«å…¶ä»–å®¢æˆ·ç«¯å‘é€æ¥çš„å‘½ä»¤è¯·æ±‚æ‰€æ‰“æ–­ã€‚<mark>Redis äº‹åŠ¡çš„ä¸»è¦ä½œç”¨å°±æ˜¯ä¸²è”å¤šä¸ªå‘½ä»¤é˜²æ­¢åˆ«çš„å‘½ä»¤æ’é˜Ÿã€‚</mark></p><h2 id="multiã€execã€discard" tabindex="-1"><a class="header-anchor" href="#multiã€execã€discard" aria-hidden="true">#</a> Multiã€Execã€discard</h2><p>â€‹ ä»è¾“å…¥ Multi å‘½ä»¤å¼€å§‹ï¼Œè¾“å…¥çš„å‘½ä»¤éƒ½ä¼šä¾æ¬¡è¿›å…¥å‘½ä»¤é˜Ÿåˆ—ä¸­ï¼Œä½†ä¸ä¼šæ‰§è¡Œï¼Œç›´åˆ°è¾“å…¥ Exec åï¼ŒRedis ä¼šå°†ä¹‹å‰çš„å‘½ä»¤é˜Ÿåˆ—ä¸­çš„å‘½ä»¤ä¾æ¬¡æ‰§è¡Œã€‚<mark>ç»„é˜Ÿçš„è¿‡ç¨‹ä¸­å¯ä»¥é€šè¿‡ discard æ¥æ”¾å¼ƒç»„é˜Ÿã€‚</mark></p><figure><img src="/assets/image-20220513194048072-b2a484ad.png" alt="image-20220513194048072" tabindex="0" loading="lazy"><figcaption>image-20220513194048072</figcaption></figure><p>äº‹åŠ¡ç¤ºä¾‹ï¼š</p><ol><li><p>ç»„é˜ŸæˆåŠŸï¼Œæäº¤æˆåŠŸ</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> multi
OK
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> k1 v1
QUEUED
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> k2 v2
QUEUED
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token builtin class-name">exec</span>
<span class="token number">1</span><span class="token punctuation">)</span> OK
<span class="token number">2</span><span class="token punctuation">)</span> OK
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>ç»„é˜Ÿé˜¶æ®µæŠ¥é”™ï¼Œæäº¤å¤±è´¥</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> multi
OK
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> k1 v1
QUEUED
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> k2
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> ERR wrong number of arguments <span class="token keyword">for</span> <span class="token string">&#39;set&#39;</span> <span class="token builtin class-name">command</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token builtin class-name">exec</span>
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> EXECABORT Transaction discarded because of previous errors.
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>ç»„é˜ŸæˆåŠŸï¼Œæäº¤æœ‰æˆåŠŸæœ‰å¤±è´¥æƒ…å†µ</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> multi
OK
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> k1 v1
QUEUED
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> k2 v2
QUEUED
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">&gt;</span> incr k2
QUEUED
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token builtin class-name">exec</span>
<span class="token number">1</span><span class="token punctuation">)</span> OK
<span class="token number">2</span><span class="token punctuation">)</span> OK
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> ERR value is not an integer or out of range
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get k1
<span class="token string">&quot;v1&quot;</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get k2
<span class="token string">&quot;v2&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h2 id="äº‹åŠ¡çš„é”™è¯¯å¤„ç†" tabindex="-1"><a class="header-anchor" href="#äº‹åŠ¡çš„é”™è¯¯å¤„ç†" aria-hidden="true">#</a> äº‹åŠ¡çš„é”™è¯¯å¤„ç†</h2><p>ç»„é˜Ÿä¸­æŸä¸ªå‘½ä»¤å‡ºç°äº†æŠ¥å‘Šé”™è¯¯ï¼Œæ‰§è¡Œæ—¶æ•´ä¸ªçš„æ‰€æœ‰é˜Ÿåˆ—éƒ½ä¼šè¢«å–æ¶ˆã€‚</p><p>å¦‚æœæ‰§è¡Œé˜¶æ®µæŸä¸ªå‘½ä»¤æŠ¥é”™ï¼Œåˆ™åªæœ‰æŠ¥é”™çš„å‘½ä»¤ä¸ä¼šè¢«æ‰§è¡Œï¼Œè€Œå…¶ä»–çš„å‘½ä»¤éƒ½ä¼šæ‰§è¡Œï¼Œä¸ä¼šå›æ»šã€‚</p><h2 id="äº‹åŠ¡å†²çª" tabindex="-1"><a class="header-anchor" href="#äº‹åŠ¡å†²çª" aria-hidden="true">#</a> äº‹åŠ¡å†²çª</h2><h3 id="æ‚²è§‚é”" tabindex="-1"><a class="header-anchor" href="#æ‚²è§‚é”" aria-hidden="true">#</a> æ‚²è§‚é”</h3><figure><img src="/assets/image-20221007171853393-73149e36.png" alt="image-20221007171853393" tabindex="0" loading="lazy"><figcaption>image-20221007171853393</figcaption></figure><p>â€‹ <strong>æ‚²è§‚é”(Pessimistic Lock)</strong>, é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¾ˆæ‚²è§‚ï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·åˆ«äººæƒ³æ‹¿è¿™ä¸ªæ•°æ®å°±ä¼šblockç›´åˆ°å®ƒæ‹¿åˆ°é”ã€‚<strong>ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“é‡Œè¾¹å°±ç”¨åˆ°äº†å¾ˆå¤šè¿™ç§é”æœºåˆ¶</strong>ï¼Œæ¯”å¦‚<strong>è¡Œé”</strong>ï¼Œ<strong>è¡¨é”</strong>ç­‰ï¼Œ<strong>è¯»é”</strong>ï¼Œ<strong>å†™é”</strong>ç­‰ï¼Œéƒ½æ˜¯åœ¨åšæ“ä½œä¹‹å‰å…ˆä¸Šé”ã€‚</p><h3 id="ä¹è§‚é”" tabindex="-1"><a class="header-anchor" href="#ä¹è§‚é”" aria-hidden="true">#</a> <strong>ä¹è§‚é”</strong></h3><figure><img src="/assets/image-20221007172000166-3e687266.png" alt="image-20221007172000166" tabindex="0" loading="lazy"><figcaption>image-20221007172000166</figcaption></figure><p>â€‹ **ä¹è§‚é”(Optimistic Lock)ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¾ˆä¹è§‚ï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¸ä¼šä¿®æ”¹ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”ï¼Œä½†æ˜¯åœ¨æ›´æ–°çš„æ—¶å€™ä¼šåˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´åˆ«äººæœ‰æ²¡æœ‰å»æ›´æ–°è¿™ä¸ªæ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ç‰ˆæœ¬å·ç­‰æœºåˆ¶ã€‚**ä¹è§‚é”é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œè¿™æ ·å¯ä»¥æé«˜ååé‡ã€‚Redis å°±æ˜¯åˆ©ç”¨è¿™ç§ check-and-set æœºåˆ¶å®ç°äº‹åŠ¡çš„ã€‚</p><h3 id="watch-key" tabindex="-1"><a class="header-anchor" href="#watch-key" aria-hidden="true">#</a> <strong>WATCH</strong> <strong>key</strong></h3><p>â€‹ åœ¨æ‰§è¡Œ multi ä¹‹å‰ï¼Œå…ˆæ‰§è¡Œ watch key1 [key2]ï¼Œå¯ä»¥ç›‘è§†ä¸€ä¸ª(æˆ–å¤šä¸ª) key ï¼Œ<strong>å¦‚æœåœ¨äº‹åŠ¡æ‰§è¡Œä¹‹å‰è¿™ä¸ª(æˆ–è¿™äº›) keyè¢«å…¶ä»–å‘½ä»¤æ‰€æ”¹åŠ¨ï¼Œé‚£ä¹ˆäº‹åŠ¡å°†è¢«æ‰“æ–­ã€‚</strong></p><p>ç¤ºä¾‹ï¼šå¼€å¯ä¸¤ä¸ªå®¢æˆ·ç«¯æµ‹è¯•</p><p>å®¢æˆ·ç«¯ä¸€ï¼š</p><blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token function">watch</span> balance
OK
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> multi
OK
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">&gt;</span> decrby balance <span class="token number">20</span>
QUEUED
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token builtin class-name">exec</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">80</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></blockquote><p>å®¢æˆ·ç«¯äºŒï¼š</p><blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token function">watch</span> balance
OK
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> multi
OK
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">&gt;</span> incrby balance <span class="token number">10</span>
QUEUED
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token builtin class-name">exec</span>
<span class="token punctuation">(</span>nil<span class="token punctuation">)</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®¢æˆ·ç«¯äºŒ exec æ—¶ï¼Œä¸ä¼šæ‰§è¡Œæ“ä½œï¼Œè¿”å› nilã€‚</p></blockquote><h3 id="unwatch" tabindex="-1"><a class="header-anchor" href="#unwatch" aria-hidden="true">#</a> <strong>unwatch</strong></h3><p>å–æ¶ˆ WATCH å‘½ä»¤å¯¹æ‰€æœ‰ key çš„ç›‘è§†ã€‚</p><p>å¦‚æœåœ¨æ‰§è¡Œ WATCH å‘½ä»¤ä¹‹åï¼ŒEXEC å‘½ä»¤æˆ–DISCARD å‘½ä»¤å…ˆè¢«æ‰§è¡Œäº†çš„è¯ï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦å†æ‰§è¡ŒUNWATCH äº†ã€‚</p><p><a href="http://doc.redisfans.com/transaction/exec.html" target="_blank" rel="noopener noreferrer">http://doc.redisfans.com/transaction/exec.html<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="redis-äº‹åŠ¡ä¸‰ç‰¹æ€§" tabindex="-1"><a class="header-anchor" href="#redis-äº‹åŠ¡ä¸‰ç‰¹æ€§" aria-hidden="true">#</a> Redis äº‹åŠ¡ä¸‰ç‰¹æ€§</h2><ol><li><p>å•ç‹¬çš„éš”ç¦»æ“ä½œ</p><p>â€‹ äº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šåºåˆ—åŒ–ã€æŒ‰é¡ºåºåœ°æ‰§è¡Œã€‚äº‹åŠ¡åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¸ä¼šè¢«å…¶ä»–å®¢æˆ·ç«¯å‘é€æ¥çš„å‘½ä»¤è¯·æ±‚æ‰€æ‰“æ–­ã€‚</p></li><li><p>æ²¡æœ‰éš”ç¦»çº§åˆ«çš„æ¦‚å¿µ</p><p>â€‹ é˜Ÿåˆ—ä¸­çš„å‘½ä»¤æ²¡æœ‰æäº¤ä¹‹å‰éƒ½ä¸ä¼šå®é™…è¢«æ‰§è¡Œï¼Œå› ä¸ºäº‹åŠ¡æäº¤å‰ä»»ä½•æŒ‡ä»¤éƒ½ä¸ä¼šè¢«å®é™…æ‰§è¡Œ</p></li><li><p>ä¸ä¿è¯åŸå­æ€§</p><p>â€‹ äº‹åŠ¡ä¸­å¦‚æœæœ‰ä¸€æ¡å‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼Œå…¶åçš„å‘½ä»¤ä»ç„¶ä¼šè¢«æ‰§è¡Œï¼Œæ²¡æœ‰å›æ»š</p></li></ol><h2 id="redisäº‹åŠ¡-ç§’æ€ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#redisäº‹åŠ¡-ç§’æ€ç¤ºä¾‹" aria-hidden="true">#</a> Redisäº‹åŠ¡ï¼šç§’æ€ç¤ºä¾‹</h2><p>å°†åº“å­˜ä¿¡æ¯ä»¥åŠç§’æ€æˆåŠŸç”¨æˆ·æ”¾å…¥Redis</p><h3 id="åŸºæœ¬ä»£ç " tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬ä»£ç " aria-hidden="true">#</a> åŸºæœ¬ä»£ç </h3><p>Idea å»ºç«‹ web å·¥ç¨‹ï¼š</p><p>index.jsp</p><blockquote><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code>&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
         pageEncoding=&quot;UTF-8&quot; %&gt;
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span> <span class="token name">PUBLIC</span> <span class="token string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span> <span class="token string">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Content-Type<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/html; charset=UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Insert title here<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>å•†å“ç§’æ€ï¼ï¼ï¼<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>msform<span class="token punctuation">&quot;</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${pageContext.request.contextPath}/doseckill<span class="token punctuation">&quot;</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>application/x-www-form-urlencoded<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>prodid<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>prodId<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0101<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>miaosha_btn<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>seckill_btn<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ç‚¹å‡»ç§’æ€<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/javascript<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${pageContext.request.contextPath}/script/jquery/jquery-3.1.0.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/javascript<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#miaosha_btn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#msform&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;action&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            $<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#msform&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>data <span class="token operator">==</span> <span class="token string">&quot;false&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;æŠ¢å…‰äº†&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#miaosha_btn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;disabled&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></blockquote><p>servletï¼š</p><blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>servlet</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">ServletException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServlet</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletResponse</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Random</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SecondKillServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">1L</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">doPost</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * ä½¿ç”¨ ab å·¥å…·æ¨¡æ‹Ÿæµ‹è¯•ï¼š
     * vim postfile
     *      prodId=0101&amp;
     * ab -n 2000 -c 200 -p ~/postfile -T application/x-www-form-urlencoded http://192.168.50.211:8080/seckill/doseckill
     * <span class="token keyword">@param</span> <span class="token parameter">request</span>
     * <span class="token keyword">@param</span> <span class="token parameter">response</span>
     */</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> userId <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">50000</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> prodId <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;prodId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// æ¨¡æ‹Ÿåº“å­˜ï¼šset sc:0101:qt 10</span>
        <span class="token keyword">boolean</span> result <span class="token operator">=</span> <span class="token class-name">SecondKill_redis</span><span class="token punctuation">.</span><span class="token function">doSecondKill</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> prodId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></blockquote><p><strong>è¿æ¥æ± ï¼šä½¿ç”¨è¿æ¥æ± è§£å†³è¯·æ±‚æ•°é‡è¿‡å¤šæ—¶é€ æˆçš„è¿æ¥è¶…æ—¶é—®é¢˜ã€‚</strong></p><p>è¿æ¥æ± å‚æ•°ï¼š</p><ul><li>MaxTotalï¼šæ§åˆ¶ä¸€ä¸ªpoolå¯åˆ†é…å¤šå°‘ä¸ªjediså®ä¾‹ï¼Œé€šè¿‡pool.getResource()æ¥è·å–ï¼›å¦‚æœèµ‹å€¼ä¸º-1ï¼Œåˆ™è¡¨ç¤ºä¸é™åˆ¶ï¼›å¦‚æœpoolå·²ç»åˆ†é…äº†MaxTotalä¸ªjediså®ä¾‹ï¼Œåˆ™æ­¤æ—¶poolçš„çŠ¶æ€ä¸ºexhaustedã€‚</li><li>maxIdleï¼šæ§åˆ¶ä¸€ä¸ªpoolæœ€å¤šæœ‰å¤šå°‘ä¸ªçŠ¶æ€ä¸ºidle(ç©ºé—²)çš„jediså®ä¾‹ã€‚</li><li>MaxWaitMillisï¼šè¡¨ç¤ºå½“borrowä¸€ä¸ªjediså®ä¾‹æ—¶ï¼Œæœ€å¤§çš„ç­‰å¾…æ¯«ç§’æ•°ï¼Œå¦‚æœè¶…è¿‡ç­‰å¾…æ—¶é—´ï¼Œåˆ™ç›´æ¥æŠ›JedisConnectionExceptionã€‚</li><li>testOnBorrowï¼šè·å¾—ä¸€ä¸ªjediså®ä¾‹çš„æ—¶å€™æ˜¯å¦æ£€æŸ¥è¿æ¥å¯ç”¨æ€§ï¼ˆping()ï¼‰ï¼›å¦‚æœä¸ºtrueï¼Œåˆ™å¾—åˆ°çš„jediså®ä¾‹å‡æ˜¯å¯ç”¨çš„ã€‚</li></ul><blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>servlet</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">redis<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>jedis<span class="token punctuation">.</span></span><span class="token class-name">Jedis</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">redis<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>jedis<span class="token punctuation">.</span></span><span class="token class-name">JedisPool</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">redis<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>jedis<span class="token punctuation">.</span></span><span class="token class-name">JedisPoolConfig</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JedisPoolUtil</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">volatile</span> <span class="token class-name">JedisPool</span> jedisPool<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">JedisPoolUtil</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">JedisPool</span> <span class="token function">getJedisPoolInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>jedisPool <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">JedisPoolUtil</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>jedisPool <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">JedisPoolConfig</span> poolConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JedisPoolConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    poolConfig<span class="token punctuation">.</span><span class="token function">setMaxTotal</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    poolConfig<span class="token punctuation">.</span><span class="token function">setMaxIdle</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    poolConfig<span class="token punctuation">.</span><span class="token function">setMaxWaitMillis</span><span class="token punctuation">(</span><span class="token number">100</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    poolConfig<span class="token punctuation">.</span><span class="token function">setBlockWhenExhausted</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    poolConfig<span class="token punctuation">.</span><span class="token function">setTestOnBorrow</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    jedisPool <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JedisPool</span><span class="token punctuation">(</span>poolConfig<span class="token punctuation">,</span> <span class="token string">&quot;192.168.100.100&quot;</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">,</span> <span class="token number">60000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> jedisPool<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">release</span><span class="token punctuation">(</span><span class="token class-name">JedisPool</span> jedisPool<span class="token punctuation">,</span> <span class="token class-name">Jedis</span> jedis<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>jedis <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            jedisPool<span class="token punctuation">.</span><span class="token function">returnResource</span><span class="token punctuation">(</span>jedis<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></blockquote><p>ç§’æ€ä»£ç ï¼š</p><blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>servlet</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">redis<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>jedis<span class="token punctuation">.</span></span><span class="token class-name">Jedis</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">redis<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>jedis<span class="token punctuation">.</span></span><span class="token class-name">JedisPool</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SecondKill_redis</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">doSecondKill</span><span class="token punctuation">(</span><span class="token class-name">String</span> userId<span class="token punctuation">,</span> <span class="token class-name">String</span> prodId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>userId <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> prodId <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">JedisPool</span> jedisPool <span class="token operator">=</span> <span class="token class-name">JedisPoolUtil</span><span class="token punctuation">.</span><span class="token function">getJedisPoolInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> jedisPool<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> kcKey <span class="token operator">=</span> <span class="token string">&quot;sk:&quot;</span> <span class="token operator">+</span> prodId <span class="token operator">+</span> <span class="token string">&quot;:qt&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> userKey <span class="token operator">=</span> <span class="token string">&quot;sk:&quot;</span> <span class="token operator">+</span> prodId <span class="token operator">+</span> <span class="token string">&quot;:user&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> kc <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>kcKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>kc <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ç§’æ€è¿˜æ²¡å¼€å§‹ï¼Œè¯·ç­‰å¾…...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">sismember</span><span class="token punctuation">(</span>userKey<span class="token punctuation">,</span> userId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ç§’æ€å·²ç»æˆåŠŸï¼Œä¸èƒ½é‡å¤ç§’æ€...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>kc<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ç§’æ€å·²ç»ç»“æŸ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        jedis<span class="token punctuation">.</span><span class="token function">decr</span><span class="token punctuation">(</span>kcKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">sadd</span><span class="token punctuation">(</span>userKey<span class="token punctuation">,</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ç§’æ€æˆåŠŸ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></blockquote><p>æµ‹è¯•ï¼š</p><p>redis è®¾ç½®å•†å“åº“å­˜ï¼šset sk:0101:qt 10</p><h3 id="ab-å·¥å…·ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#ab-å·¥å…·ä½¿ç”¨" aria-hidden="true">#</a> ab å·¥å…·ä½¿ç”¨</h3><p>ä½¿ç”¨ ab å·¥å…·æ¨¡æ‹Ÿå¹¶å‘æ“ä½œã€‚</p><p>CentOS6 é»˜è®¤å®‰è£…</p><p>CentOS7 éœ€è¦æ‰‹åŠ¨å®‰è£…ï¼šyum install httpd-tools</p><p><strong>æ— ç½‘ç»œ</strong></p><p>ï¼ˆ1ï¼‰ è¿›å…¥cd /run/media/root/CentOS 7 x86_64/Packagesï¼ˆè·¯å¾„è·Ÿcentos6ä¸åŒï¼‰</p><p>ï¼ˆ2ï¼‰ é¡ºåºå®‰è£…</p><ul><li>apr-1.4.8-3.el7.x86_64.rpm</li><li>apr-util-1.5.2-6.el7.x86_64.rpm</li><li>httpd-tools-2.4.6-67.el7.centos.x86_64.rpm</li></ul><p>ab å‘½ä»¤ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>ab -n 2000 -c 200 -p ~/postfile -T application/x-www-form-urlencoded http://192.168.50.211:8080/seckill/doseckill
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>-n è¯·æ±‚æ•°é‡</p><p>-c å¹¶å‘æ•°é‡</p><p>-T application/x-www-form-urlencoded</p><p>-p postè¯·æ±‚æ–‡ä»¶ï¼Œéœ€è¦åˆ›å»ºè¯¥æ–‡ä»¶</p><p>â€‹ vim postfile æ¨¡æ‹Ÿè¡¨å•æäº¤å‚æ•°ï¼Œä»¥&amp;ç¬¦å·ç»“å°¾;å­˜æ”¾å½“å‰ç›®å½•ã€‚</p><p>â€‹ å†…å®¹ï¼šprodId=0101&amp;</p><p>æµ‹è¯•ï¼š</p><p>å‡ºç°è¶…å–é—®é¢˜ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get sk:0101:qt
<span class="token string">&quot;-4&quot;</span><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> SMEMBERS sk:0101:user
 <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;311&quot;</span>
 <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;1862&quot;</span>
 <span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;4314&quot;</span>
 <span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">&quot;7396&quot;</span>
 <span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">&quot;21514&quot;</span>
 <span class="token number">6</span><span class="token punctuation">)</span> <span class="token string">&quot;22009&quot;</span>
 <span class="token number">7</span><span class="token punctuation">)</span> <span class="token string">&quot;24781&quot;</span>
 <span class="token number">8</span><span class="token punctuation">)</span> <span class="token string">&quot;24884&quot;</span>
 <span class="token number">9</span><span class="token punctuation">)</span> <span class="token string">&quot;29747&quot;</span>
<span class="token number">10</span><span class="token punctuation">)</span> <span class="token string">&quot;33970&quot;</span>
<span class="token number">11</span><span class="token punctuation">)</span> <span class="token string">&quot;35109&quot;</span>
<span class="token number">12</span><span class="token punctuation">)</span> <span class="token string">&quot;35508&quot;</span>
<span class="token number">13</span><span class="token punctuation">)</span> <span class="token string">&quot;36228&quot;</span>
<span class="token number">14</span><span class="token punctuation">)</span> <span class="token string">&quot;49708&quot;</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get sk:0101:qt
<span class="token string">&quot;-&quot;</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="è¶…å–é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#è¶…å–é—®é¢˜" aria-hidden="true">#</a> è¶…å–é—®é¢˜</h3><img src="/assets/image-20221009174213877-ed2779cc.png" alt="image-20221009174213877" style="zoom:80%;"><p><strong>åˆ©ç”¨ä¹è§‚é”æ·˜æ±°ç”¨æˆ·ï¼Œè§£å†³è¶…å–é—®é¢˜ã€‚</strong>ã€watch multi execã€‘</p><p>ä¿®æ”¹ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>servlet</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">redis<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>jedis<span class="token punctuation">.</span></span><span class="token class-name">Jedis</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">redis<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>jedis<span class="token punctuation">.</span></span><span class="token class-name">JedisPool</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">redis<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>jedis<span class="token punctuation">.</span></span><span class="token class-name">Transaction</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SecondKill_redis_chaomai</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">doSecondKill</span><span class="token punctuation">(</span><span class="token class-name">String</span> userId<span class="token punctuation">,</span> <span class="token class-name">String</span> prodId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>userId <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> prodId <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">JedisPool</span> jedisPool <span class="token operator">=</span> <span class="token class-name">JedisPoolUtil</span><span class="token punctuation">.</span><span class="token function">getJedisPoolInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> jedisPool<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> kcKey <span class="token operator">=</span> <span class="token string">&quot;sk:&quot;</span> <span class="token operator">+</span> prodId <span class="token operator">+</span> <span class="token string">&quot;:qt&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> userKey <span class="token operator">=</span> <span class="token string">&quot;sk:&quot;</span> <span class="token operator">+</span> prodId <span class="token operator">+</span> <span class="token string">&quot;:user&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">// ç›‘è§†åº“å­˜</span>
        jedis<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span>kcKey<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> kc <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>kcKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>kc <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ç§’æ€è¿˜æ²¡å¼€å§‹ï¼Œè¯·ç­‰å¾…...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">sismember</span><span class="token punctuation">(</span>userKey<span class="token punctuation">,</span> userId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ç§’æ€å·²ç»æˆåŠŸï¼Œä¸èƒ½é‡å¤ç§’æ€...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>kc<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ç§’æ€å·²ç»ç»“æŸ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// ä½¿ç”¨äº‹åŠ¡</span>
        <span class="token class-name">Transaction</span> multi <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">multi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        multi<span class="token punctuation">.</span><span class="token function">decr</span><span class="token punctuation">(</span>kcKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        multi<span class="token punctuation">.</span><span class="token function">sadd</span><span class="token punctuation">(</span>userKey<span class="token punctuation">,</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> exec <span class="token operator">=</span> multi<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>exec <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> exec<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ç§’æ€å¤±è´¥....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ç§’æ€æˆåŠŸ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å†æ¬¡æµ‹è¯•ï¼Œæ²¡æœ‰è¶…å–é—®é¢˜ã€‚</p><p>ä¿®æ”¹åº“å­˜æ•°é‡ï¼šset sk:0101:qt 500</p><p>å‡ºç°äº†åº“å­˜é—ç•™é—®é¢˜ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">set</span> sk:0101:qt <span class="token number">500</span>
OK
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get sk:0101:qt
<span class="token string">&quot;463&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="åº“å­˜é—ç•™é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#åº“å­˜é—ç•™é—®é¢˜" aria-hidden="true">#</a> åº“å­˜é—ç•™é—®é¢˜</h3><p>åº“å­˜é—ç•™é—®é¢˜æ˜¯ç”±äºä¹è§‚é”äº§ç”Ÿçš„ã€‚</p><p>ä½¿ç”¨ä¹è§‚é”æ—¶ï¼Œä¼šé”å®šå½“å‰æ“ä½œçš„æ•°æ®ç‰ˆæœ¬ï¼Œå…¶ä»–è¯·æ±‚ä¸ä¼šå¤„ç†ï¼Œé€ æˆåº“å­˜é—ç•™ã€‚</p><p>è§£å†³æ–¹æ¡ˆï¼š<strong>LUA</strong>è„šæœ¬</p><p>Lua æ˜¯ä¸€ä¸ªå°å·§çš„ <a href="http://baike.baidu.com/item/%E8%84%9A%E6%9C%AC%E8%AF%AD%E8%A8%80" target="_blank" rel="noopener noreferrer">è„šæœ¬è¯­è¨€<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼ŒLuaè„šæœ¬å¯ä»¥å¾ˆå®¹æ˜“çš„è¢«C/C++ ä»£ç è°ƒç”¨ï¼Œä¹Ÿå¯ä»¥åè¿‡æ¥è°ƒç”¨C/C++çš„å‡½æ•°ï¼ŒLuaå¹¶æ²¡æœ‰æä¾›å¼ºå¤§çš„åº“ï¼Œä¸€ä¸ªå®Œæ•´çš„Luaè§£é‡Šå™¨ä¸è¿‡200kï¼Œæ‰€ä»¥Luaä¸é€‚åˆä½œä¸ºå¼€å‘ç‹¬ç«‹åº”ç”¨ç¨‹åºçš„è¯­è¨€ï¼Œè€Œæ˜¯ä½œä¸ºåµŒå…¥å¼è„šæœ¬è¯­è¨€ã€‚</p><p>å¾ˆå¤šåº”ç”¨ç¨‹åºã€æ¸¸æˆä½¿ç”¨LUAä½œä¸ºè‡ªå·±çš„åµŒå…¥å¼è„šæœ¬è¯­è¨€ï¼Œä»¥æ­¤æ¥å®ç°å¯é…ç½®æ€§ã€å¯æ‰©å±•æ€§ã€‚</p><p><a href="https://www.w3cschool.cn/lua/" target="_blank" rel="noopener noreferrer">https://www.w3cschool.cn/lua/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><strong>Lua è„šæœ¬å¤„ç†åº“å­˜é—ç•™é—®é¢˜ï¼š</strong></p><p><strong>å°†å¤æ‚çš„æˆ–è€…å¤šæ­¥çš„ redis æ“ä½œï¼Œå†™ä¸ºä¸€ä¸ªè„šæœ¬ï¼Œä¸€æ¬¡æäº¤ç»™ redis æ‰§è¡Œï¼Œå‡å°‘åå¤è¿æ¥ redis çš„æ¬¡æ•°ã€‚æå‡æ€§èƒ½ã€‚</strong></p><p>LUA è„šæœ¬æ˜¯ç±»ä¼¼ redis äº‹åŠ¡ï¼Œæœ‰ä¸€å®šçš„åŸå­æ€§ï¼Œä¸ä¼šè¢«å…¶ä»–å‘½ä»¤æ’é˜Ÿï¼Œå¯ä»¥å®Œæˆä¸€äº› redis äº‹åŠ¡æ€§çš„æ“ä½œã€‚</p><p>ä½†æ˜¯æ³¨æ„ redis çš„ lua è„šæœ¬åŠŸèƒ½ï¼Œåªæœ‰åœ¨ Redis 2.6 ä»¥ä¸Šçš„ç‰ˆæœ¬æ‰å¯ä»¥ä½¿ç”¨ã€‚</p><p>åˆ©ç”¨ lua è„šæœ¬æ·˜æ±°ç”¨æˆ·ï¼Œè§£å†³è¶…å–é—®é¢˜ã€‚</p><p>redis 2.6 ç‰ˆæœ¬ä»¥åï¼Œé€šè¿‡ lua è„šæœ¬è§£å†³<strong>äº‰æŠ¢é—®é¢˜</strong>ï¼Œå®é™…ä¸Šæ˜¯ <strong>redis</strong> <strong>åˆ©ç”¨å…¶å•çº¿ç¨‹çš„ç‰¹æ€§ï¼Œç”¨ä»»åŠ¡é˜Ÿåˆ—çš„æ–¹å¼è§£å†³å¤šä»»åŠ¡å¹¶å‘é—®é¢˜</strong>ã€‚</p><p>Luaï¼š</p><blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">local</span> <span class="token assign-left variable">userid</span><span class="token operator">=</span>KEYS<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token builtin class-name">local</span> <span class="token assign-left variable">prodid</span><span class="token operator">=</span>KEYS<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token builtin class-name">local</span> <span class="token assign-left variable">qtkey</span><span class="token operator">=</span><span class="token string">&quot;sk:&quot;</span><span class="token punctuation">..</span>prodid<span class="token punctuation">..</span><span class="token string">&quot;:qt&quot;</span><span class="token punctuation">;</span>
<span class="token builtin class-name">local</span> <span class="token assign-left variable">usersKey</span><span class="token operator">=</span><span class="token string">&quot;sk:&quot;</span><span class="token punctuation">..</span>prodid.<span class="token string">&quot;:usr&#39;; 
local userExists=redis.call(&quot;</span>sismember<span class="token string">&quot;,usersKey,userid);
if tonumber(userExists)==1 then 
  return 2;
end
local num= redis.call(&quot;</span>get<span class="token string">&quot; ,qtkey);
if tonumber(num)&lt;=0 then 
  return 0; 
else 
  redis.call(&quot;</span>decr<span class="token string">&quot;,qtkey);
  redis.call(&quot;</span>sadd&quot;,usersKey,userid<span class="token punctuation">)</span><span class="token punctuation">;</span>
end
<span class="token builtin class-name">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></blockquote><p>ä»£ç ä¿®æ”¹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>servlet</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">redis<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>jedis<span class="token punctuation">.</span></span><span class="token class-name">Jedis</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">redis<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>jedis<span class="token punctuation">.</span></span><span class="token class-name">JedisPool</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SecondKill_Redis_LuaScript</span> <span class="token punctuation">{</span>
    
    <span class="token keyword">static</span> <span class="token class-name">String</span> secKillScript <span class="token operator">=</span> <span class="token string">&quot;local userId=KEYS[1];\r\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;local prodId=KEYS[2];\r\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;local qtkey=&#39;sk:&#39;..prodId..\&quot;:qt\&quot;;\r\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;local usersKey=&#39;sk:&#39;..prodId..\&quot;:usr\&quot;;\r\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;local userExists=redis.call(\&quot;sismember\&quot;,usersKey,userId);\r\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;if tonumber(userExists)==1 then \r\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;   return 2;\r\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;end\r\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;local num= redis.call(\&quot;get\&quot; ,qtkey);\r\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;if tonumber(num)&lt;=0 then \r\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;   return 0;\r\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;else \r\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;   redis.call(\&quot;decr\&quot;,qtkey);\r\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;   redis.call(\&quot;sadd\&quot;,usersKey,userId);\r\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;end\r\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;return 1&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">static</span> <span class="token class-name">String</span> secKillScript2 <span class="token operator">=</span>
            <span class="token string">&quot;local userExists=redis.call(\&quot;sismember\&quot;,\&quot;{sk}:0101:usr\&quot;,userid);\r\n&quot;</span> <span class="token operator">+</span>
                    <span class="token string">&quot; return 1&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">doSecKill</span><span class="token punctuation">(</span><span class="token class-name">String</span> userId<span class="token punctuation">,</span> <span class="token class-name">String</span> prodId<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>

        <span class="token class-name">JedisPool</span> jedispool <span class="token operator">=</span> <span class="token class-name">JedisPoolUtil</span><span class="token punctuation">.</span><span class="token function">getJedisPoolInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> jedispool<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//String sha1=  .secKillScript;</span>
        <span class="token class-name">String</span> sha1 <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">scriptLoad</span><span class="token punctuation">(</span>secKillScript<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> result <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">evalsha</span><span class="token punctuation">(</span>sha1<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> userId<span class="token punctuation">,</span> prodId<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> reString <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>reString<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å·²æŠ¢ç©ºï¼ï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>reString<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æŠ¢è´­æˆåŠŸï¼ï¼ï¼ï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>reString<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è¯¥ç”¨æˆ·å·²æŠ¢è¿‡ï¼ï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æŠ¢è´­å¼‚å¸¸ï¼ï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="redis-æŒä¹…åŒ–" tabindex="-1"><a class="header-anchor" href="#redis-æŒä¹…åŒ–" aria-hidden="true">#</a> Redis æŒä¹…åŒ–</h1><p>Redis æä¾›äº† 2 ç§ä¸åŒå½¢å¼çš„æŒä¹…åŒ–æ–¹å¼ã€‚</p><p>æ–‡æ¡£è¯´æ˜ï¼š<a href="https://redis.io/docs/management/persistence/" target="_blank" rel="noopener noreferrer">https://redis.io/docs/management/persistence/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><ul><li>RDBï¼ˆRedis DataBaseï¼‰</li><li>AOFï¼ˆAppend Of Fileï¼‰</li></ul><blockquote><h1 id="redis-persistence" tabindex="-1"><a class="header-anchor" href="#redis-persistence" aria-hidden="true">#</a> Redis persistence</h1><p>How Redis writes data to disk</p><p>Persistence refers to the writing of data to durable storage, such as a solid-state disk (SSD). Redis provides a range of persistence options. These include:</p><ul><li><strong>RDB</strong> (Redis Database): RDB persistence performs point-in-time snapshots of your dataset at specified intervals.</li><li><strong>AOF</strong> (Append Only File): AOF persistence logs every write operation received by the server. These operations can then be replayed again at server startup, reconstructing the original dataset. Commands are logged using the same format as the Redis protocol itself.</li><li><strong>No persistence</strong>: You can disable persistence completely. This is sometimes used when caching.</li><li><strong>RDB + AOF</strong>: You can also combine both AOF and RDB in the same instance.</li></ul><p>If you&#39;d rather not think about the tradeoffs between these different persistence strategies, you may want to consider <a href="https://docs.redis.com/latest/rs/databases/configure/database-persistence/" target="_blank" rel="noopener noreferrer">Redis Enterprise&#39;s persistence options<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>, which can be pre-configured using a UI.</p></blockquote><h2 id="rdb-redis-database" tabindex="-1"><a class="header-anchor" href="#rdb-redis-database" aria-hidden="true">#</a> RDB (Redis DataBase)</h2><h3 id="å®˜ç½‘ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#å®˜ç½‘ä»‹ç»" aria-hidden="true">#</a> å®˜ç½‘ä»‹ç»</h3><blockquote><h2 id="rdb-advantages" tabindex="-1"><a class="header-anchor" href="#rdb-advantages" aria-hidden="true">#</a> RDB advantages</h2><ul><li>RDB is a very compact single-file point-in-time representation of your Redis data. RDB files are perfect for backups. For instance you may want to archive your RDB files every hour for the latest 24 hours, and to save an RDB snapshot every day for 30 days. This allows you to easily restore different versions of the data set in case of disasters.</li><li>RDB is very good for disaster recovery, being a single compact file that can be transferred to far data centers, or onto Amazon S3 (possibly encrypted).</li><li>RDB maximizes Redis performances since the only work the Redis parent process needs to do in order to persist is forking a child that will do all the rest. The parent process will never perform disk I/O or alike.</li><li>RDB allows faster restarts with big datasets compared to AOF.</li><li>On replicas, RDB supports <a href="https://redis.io/topics/replication#partial-resynchronizations-after-restarts-and-failovers" target="_blank" rel="noopener noreferrer">partial resynchronizations after restarts and failovers<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</li></ul><h2 id="rdb-disadvantages" tabindex="-1"><a class="header-anchor" href="#rdb-disadvantages" aria-hidden="true">#</a> RDB disadvantages</h2><ul><li>RDB is NOT good if you need to minimize the chance of data loss in case Redis stops working (for example after a power outage). You can configure different <em>save points</em> where an RDB is produced (for instance after at least five minutes and 100 writes against the data set, you can have multiple save points). However you&#39;ll usually create an RDB snapshot every five minutes or more, so in case of Redis stopping working without a correct shutdown for any reason you should be prepared to lose the latest minutes of data.</li><li>RDB needs to fork() often in order to persist on disk using a child process. fork() can be time consuming if the dataset is big, and may result in Redis stopping serving clients for some milliseconds or even for one second if the dataset is very big and the CPU performance is not great. AOF also needs to fork() but less frequently and you can tune how often you want to rewrite your logs without any trade-off on durability.</li></ul></blockquote><h3 id="å®šä¹‰" tabindex="-1"><a class="header-anchor" href="#å®šä¹‰" aria-hidden="true">#</a> å®šä¹‰</h3><p>â€‹ <strong>åœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…å°†å†…å­˜ä¸­çš„æ•°æ®é›†å¿«ç…§å†™å…¥ç£ç›˜ï¼Œ å³ Snapshot å¿«ç…§ï¼Œå®ƒæ¢å¤æ—¶æ˜¯å°†å¿«ç…§æ–‡ä»¶ç›´æ¥è¯»åˆ°å†…å­˜é‡Œã€‚</strong></p><h3 id="å¤‡ä»½æ–‡ä»¶çš„æ‰§è¡Œ" tabindex="-1"><a class="header-anchor" href="#å¤‡ä»½æ–‡ä»¶çš„æ‰§è¡Œ" aria-hidden="true">#</a> å¤‡ä»½æ–‡ä»¶çš„æ‰§è¡Œ</h3><ul><li><p>Redis ä¼šå•ç‹¬åˆ›å»ºï¼ˆforkï¼‰ä¸€ä¸ªå­è¿›ç¨‹æ¥è¿›è¡ŒæŒä¹…åŒ–ï¼Œä¼šå…ˆå°†æ•°æ®å†™å…¥åˆ° ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œå¾…æŒä¹…åŒ–è¿‡ç¨‹éƒ½ç»“æŸäº†ï¼Œå†ç”¨è¿™ä¸ªä¸´æ—¶æ–‡ä»¶æ›¿æ¢ä¸Šæ¬¡æŒä¹…åŒ–å¥½çš„æ–‡ä»¶ï¼ˆé˜²æ­¢ä¸­é—´å‡ºç°å®•æœºå¯¼è‡´æ•°æ®ä¸¢å¤±ï¼‰ã€‚</p></li><li><p>æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¸»è¿›ç¨‹æ˜¯ä¸è¿›è¡Œä»»ä½• IO æ“ä½œçš„ï¼Œè¿™å°±ç¡®ä¿äº†æé«˜çš„æ€§èƒ½ã€‚<strong>å¦‚æœéœ€è¦è¿›è¡Œå¤§è§„æ¨¡æ•°æ®çš„æ¢å¤ï¼Œä¸”å¯¹äºæ•°æ®æ¢å¤çš„å®Œæ•´æ€§ä¸æ˜¯éå¸¸æ•æ„Ÿï¼Œé‚£ RDB æ–¹å¼è¦æ¯” AOF æ–¹å¼æ›´åŠ çš„é«˜æ•ˆã€‚RDB çš„ç¼ºç‚¹æ˜¯æœ€åä¸€æ¬¡æŒä¹…åŒ–åçš„æ•°æ®å¯èƒ½ä¸¢å¤±ã€‚</strong></p></li></ul><h3 id="fork" tabindex="-1"><a class="header-anchor" href="#fork" aria-hidden="true">#</a> Fork</h3><ol><li><p>Fork çš„ä½œç”¨æ˜¯å¤åˆ¶ä¸€ä¸ªä¸å½“å‰è¿›ç¨‹ä¸€æ ·çš„è¿›ç¨‹ã€‚æ–°è¿›ç¨‹çš„æ‰€æœ‰æ•°æ®ï¼ˆå˜é‡ã€ç¯å¢ƒå˜é‡ã€ç¨‹åºè®¡æ•°å™¨ç­‰ï¼‰ æ•°å€¼éƒ½å’ŒåŸè¿›ç¨‹ä¸€è‡´ï¼Œä½†æ˜¯æ˜¯ä¸€ä¸ªå…¨æ–°çš„è¿›ç¨‹ï¼Œå¹¶ä½œä¸ºåŸè¿›ç¨‹çš„å­è¿›ç¨‹ã€‚</p></li><li><p>åœ¨ Linux ç¨‹åºä¸­ï¼Œfork() ä¼šäº§ç”Ÿä¸€ä¸ªå’Œçˆ¶è¿›ç¨‹å®Œå…¨ç›¸åŒçš„å­è¿›ç¨‹ï¼Œä½†å­è¿›ç¨‹åœ¨æ­¤åå¤šä¼š exec ç³»ç»Ÿè°ƒç”¨ï¼Œå‡ºäºæ•ˆç‡è€ƒè™‘ï¼ŒLinux ä¸­å¼•å…¥äº†<strong>å†™æ—¶å¤åˆ¶æŠ€æœ¯</strong></p></li><li><p><strong>ä¸€èˆ¬æƒ…å†µçˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ä¼šå…±ç”¨åŒä¸€æ®µç‰©ç†å†…å­˜</strong>ï¼Œåªæœ‰è¿›ç¨‹ç©ºé—´çš„å„æ®µçš„å†…å®¹è¦å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‰ä¼šå°†çˆ¶è¿›ç¨‹çš„å†…å®¹å¤åˆ¶ä¸€ä»½ç»™å­è¿›ç¨‹ã€‚</p></li></ol><h3 id="rdb-æŒä¹…åŒ–æµç¨‹" tabindex="-1"><a class="header-anchor" href="#rdb-æŒä¹…åŒ–æµç¨‹" aria-hidden="true">#</a> RDB æŒä¹…åŒ–æµç¨‹</h3><figure><img src="/assets/image-20221008151945129-fc2170f6.png" alt="image-20221008151945129" tabindex="0" loading="lazy"><figcaption>image-20221008151945129</figcaption></figure><h3 id="rdb-æ–‡ä»¶é…ç½®" tabindex="-1"><a class="header-anchor" href="#rdb-æ–‡ä»¶é…ç½®" aria-hidden="true">#</a> rdb æ–‡ä»¶é…ç½®</h3><p>â€‹ åœ¨ redis.conf ä¸­é…ç½®æ–‡ä»¶åç§°ï¼Œé»˜è®¤ä¸º dump.rdbã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code> <span class="token number">406</span> <span class="token comment"># Enables or disables full sanitation checks for ziplist and listpack etc when</span>
 <span class="token number">407</span> <span class="token comment"># loading an RDB or RESTORE payload. This reduces the chances of a assertion or</span>
 <span class="token number">408</span> <span class="token comment"># crash later on while processing commands.</span>
 <span class="token number">409</span> <span class="token comment"># Options:</span>
 <span class="token number">410</span> <span class="token comment">#   no         - Never perform full sanitation</span>
 <span class="token number">411</span> <span class="token comment">#   yes        - Always perform full sanitation</span>
 <span class="token number">412</span> <span class="token comment">#   clients    - Perform full sanitation only for user connections.</span>
 <span class="token number">413</span> <span class="token comment">#                Excludes: RDB files, RESTORE commands received from the master</span>
 <span class="token number">414</span> <span class="token comment">#                connection, and client connections which have the</span>
 <span class="token number">415</span> <span class="token comment">#                skip-sanitize-payload ACL flag.</span>
 <span class="token number">416</span> <span class="token comment"># The default should be &#39;clients&#39; but since it currently affects cluster</span>
 <span class="token number">417</span> <span class="token comment"># resharding via MIGRATE, it is temporarily set to &#39;no&#39; by default.</span>
 <span class="token number">418</span> <span class="token comment">#</span>
 <span class="token number">419</span> <span class="token comment"># sanitize-dump-payload no</span>
 <span class="token number">420</span>
 <span class="token number">421</span> <span class="token comment"># The filename where to dump the DB</span>
 <span class="token number">422</span> dbfilename dump.rdb

 <span class="token comment"># The working directory.</span>
 <span class="token number">438</span> <span class="token comment">#</span>
 <span class="token number">439</span> <span class="token comment"># The DB will be written inside this directory, with the filename specified</span>
 <span class="token number">440</span> <span class="token comment"># above using the &#39;dbfilename&#39; configuration directive.</span>
 <span class="token number">441</span> <span class="token comment">#</span>
 <span class="token number">442</span> <span class="token comment"># The Append Only File will also be created inside this directory.</span>
 <span class="token number">443</span> <span class="token comment">#</span>
 <span class="token number">444</span> <span class="token comment"># Note that you must specify a directory here, not a file name.</span>
 <span class="token comment"># é»˜è®¤å½“å‰å¯åŠ¨ç›®å½•ä¸‹çš„ dump.rdb</span>
 <span class="token number">445</span> <span class="token function">dir</span> ./
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="rdb-å¿«ç…§è§¦å‘" tabindex="-1"><a class="header-anchor" href="#rdb-å¿«ç…§è§¦å‘" aria-hidden="true">#</a> RDB å¿«ç…§è§¦å‘</h3><h4 id="é»˜è®¤é…ç½®" tabindex="-1"><a class="header-anchor" href="#é»˜è®¤é…ç½®" aria-hidden="true">#</a> é»˜è®¤é…ç½®</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code> <span class="token number">351</span> <span class="token comment">################################ SNAPSHOTTING  ################################</span>
 <span class="token number">352</span>
 <span class="token number">353</span> <span class="token comment"># Save the DB to disk.</span>
 <span class="token number">354</span> <span class="token comment">#</span>
 <span class="token number">355</span> <span class="token comment"># save &lt;seconds&gt; &lt;changes&gt;</span>
 <span class="token number">356</span> <span class="token comment">#</span>
 <span class="token number">357</span> <span class="token comment"># Redis will save the DB if both the given number of seconds and the given</span>
 <span class="token number">358</span> <span class="token comment"># number of write operations against the DB occurred.</span>
 <span class="token number">359</span> <span class="token comment">#</span>
 <span class="token number">360</span> <span class="token comment"># Snapshotting can be completely disabled with a single empty string argument</span>
 <span class="token number">361</span> <span class="token comment"># as in following example:</span>
 <span class="token number">362</span> <span class="token comment">#</span>
 <span class="token number">363</span> <span class="token comment"># save &quot;&quot;</span>
 <span class="token number">364</span> <span class="token comment">#</span>
 <span class="token number">365</span> <span class="token comment"># Unless specified otherwise, by default Redis will save the DB:</span>
 <span class="token number">366</span> <span class="token comment">#   * After 3600 seconds (an hour) if at least 1 key changed</span>
 <span class="token number">367</span> <span class="token comment">#   * After 300 seconds (5 minutes) if at least 100 keys changed</span>
 <span class="token number">368</span> <span class="token comment">#   * After 60 seconds if at least 10000 keys changed</span>
 <span class="token number">369</span> <span class="token comment">#</span>
 <span class="token number">370</span> <span class="token comment"># You can set these explicitly by uncommenting the three following lines.</span>
 <span class="token number">371</span> <span class="token comment">#</span>
 <span class="token number">372</span> <span class="token comment"># save 3600 1</span>
 <span class="token number">373</span> <span class="token comment"># save 300 100</span>
 <span class="token number">374</span> <span class="token comment"># save 60 10000</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¯´æ˜ï¼š</p><p>é»˜è®¤ 1 å°æ—¶å†…è‡³å°‘æœ‰ä¸ª key å‘ç”Ÿæ”¹å˜</p><p>5 åˆ†é’Ÿå†…è‡³å°‘æœ‰ 100 ä¸ª key å‘ç”Ÿæ”¹å˜</p><p>1 åˆ†é’Ÿå†…è‡³å°‘æœ‰ 10000 ä¸ªkeyå‘ç”Ÿæ”¹å˜ã€‚</p><p>æ ¼å¼ï¼šsave ç§’é’Ÿ å†™æ“ä½œæ¬¡æ•°</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># æ”¹å˜çš„è¶Šé¢‘ç¹ï¼Œå¤‡ä»½çš„é—´éš”æ—¶é—´è¶Šå°ã€‚</span>
save <span class="token number">20</span> <span class="token number">3</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>RDB æ˜¯æ•´ä¸ªå†…å­˜çš„å‹ç¼©è¿‡çš„ Snapshotï¼ŒRDB çš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥é…ç½®å¤åˆçš„å¿«ç…§è§¦å‘æ¡ä»¶ã€‚</p><p>ä¸è®¾ç½® save æŒ‡ä»¤ï¼Œæˆ–è€…ç»™ save ä¼ å…¥ç©ºå­—ç¬¦ä¸²ï¼šsave &quot;&quot;</p><h4 id="save-ä¸-bgsave-å‘½ä»¤" tabindex="-1"><a class="header-anchor" href="#save-ä¸-bgsave-å‘½ä»¤" aria-hidden="true">#</a> save ä¸ bgsave å‘½ä»¤</h4><ul><li>save ï¼šsave æ—¶åªç®¡ä¿å­˜ï¼Œå…¶å®ƒä¸ç®¡ï¼Œå…¨éƒ¨é˜»å¡ã€‚<strong>æ‰‹åŠ¨ä¿å­˜ï¼Œä¸å»ºè®®ã€‚</strong></li><li><strong>bgsave</strong>ï¼šRedis ä¼šåœ¨åå°å¼‚æ­¥è¿›è¡Œå¿«ç…§æ“ä½œï¼Œå¿«ç…§åŒæ—¶è¿˜å¯ä»¥å“åº”å®¢æˆ·ç«¯è¯·æ±‚ã€‚</li></ul><p>å¯ä»¥é€šè¿‡ lastsave å‘½ä»¤è·å–æœ€åä¸€æ¬¡æˆåŠŸæ‰§è¡Œå¿«ç…§çš„æ—¶é—´</p><h4 id="flushall-å‘½ä»¤" tabindex="-1"><a class="header-anchor" href="#flushall-å‘½ä»¤" aria-hidden="true">#</a> flushall å‘½ä»¤</h4><p>â€‹ æ‰§è¡Œ flushall å‘½ä»¤ï¼Œä¹Ÿä¼šäº§ç”Ÿ dump.rdb æ–‡ä»¶ï¼Œä½†é‡Œé¢æ˜¯ç©ºçš„ï¼Œæ— æ„ä¹‰</p><h4 id="stop-writes-on-bgsave-error" tabindex="-1"><a class="header-anchor" href="#stop-writes-on-bgsave-error" aria-hidden="true">#</a> stop-writes-on-bgsave-error</h4><p>â€‹ å½“ Redis æ— æ³•å†™å…¥ç£ç›˜çš„è¯ï¼Œç›´æ¥å…³æ‰ Redis çš„å†™æ“ä½œã€‚æ¨è yes</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code> <span class="token number">376</span> <span class="token comment"># By default Redis will stop accepting writes if RDB snapshots are enabled</span>
 <span class="token number">377</span> <span class="token comment"># (at least one save point) and the latest background save failed.</span>
 <span class="token number">378</span> <span class="token comment"># This will make the user aware (in a hard way) that data is not persisting</span>
 <span class="token number">379</span> <span class="token comment"># on disk properly, otherwise chances are that no one will notice and some</span>
 <span class="token number">380</span> <span class="token comment"># disaster will happen.</span>
 <span class="token number">381</span> <span class="token comment">#</span>
 <span class="token number">382</span> <span class="token comment"># If the background saving process will start working again Redis will</span>
 <span class="token number">383</span> <span class="token comment"># automatically allow writes again.</span>
 <span class="token number">384</span> <span class="token comment">#</span>
 <span class="token number">385</span> <span class="token comment"># However if you have setup your proper monitoring of the Redis server</span>
 <span class="token number">386</span> <span class="token comment"># and persistence, you may want to disable this feature so that Redis will</span>
 <span class="token number">387</span> <span class="token comment"># continue to work as usual even if there are problems with disk,</span>
 <span class="token number">388</span> <span class="token comment"># permissions, and so forth.</span>
 <span class="token number">389</span> stop-writes-on-bgsave-error <span class="token function">yes</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>rdbcompression</strong> <strong>å‹ç¼©æ–‡ä»¶</strong></p><p>å¯¹äºå­˜å‚¨åˆ°ç£ç›˜ä¸­çš„å¿«ç…§ï¼Œå¯ä»¥è®¾ç½®æ˜¯å¦è¿›è¡Œå‹ç¼©å­˜å‚¨ã€‚å¦‚æœæ˜¯çš„è¯ï¼Œredis ä¼šé‡‡ç”¨ LZF ç®—æ³•è¿›è¡Œå‹ç¼©ã€‚</p><p>å¦‚æœä½ ä¸æƒ³æ¶ˆè€— CPU æ¥è¿›è¡Œå‹ç¼©çš„è¯ï¼Œå¯ä»¥è®¾ç½®ä¸ºå…³é—­æ­¤åŠŸèƒ½ã€‚æ¨è yesã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code> <span class="token number">391</span> <span class="token comment"># Compress string objects using LZF when dump .rdb databases?</span>
 <span class="token number">392</span> <span class="token comment"># By default compression is enabled as it&#39;s almost always a win.</span>
 <span class="token number">393</span> <span class="token comment"># If you want to save some CPU in the saving child set it to &#39;no&#39; but</span>
 <span class="token number">394</span> <span class="token comment"># the dataset will likely be bigger if you have compressible values or keys.</span>
 <span class="token number">395</span> rdbcompression <span class="token function">yes</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>rdbchecksum æ£€æŸ¥å®Œæ•´æ€§</strong></p><p>åœ¨å­˜å‚¨å¿«ç…§åï¼Œè¿˜å¯ä»¥è®© redis ä½¿ç”¨ CRC64 ç®—æ³•æ¥è¿›è¡Œæ•°æ®æ ¡éªŒï¼Œä½†æ˜¯è¿™æ ·åšä¼šå¢åŠ å¤§çº¦ 10% çš„æ€§èƒ½æ¶ˆè€—ï¼Œå¦‚æœå¸Œæœ›è·å–åˆ°æœ€å¤§çš„æ€§èƒ½æå‡ï¼Œå¯ä»¥å…³é—­æ­¤åŠŸèƒ½ï¼Œæ¨è yesã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code> <span class="token number">391</span> <span class="token comment"># Compress string objects using LZF when dump .rdb databases?</span>
 <span class="token number">392</span> <span class="token comment"># By default compression is enabled as it&#39;s almost always a win.</span>
 <span class="token number">393</span> <span class="token comment"># If you want to save some CPU in the saving child set it to &#39;no&#39; but</span>
 <span class="token number">394</span> <span class="token comment"># the dataset will likely be bigger if you have compressible values or keys.</span>
 <span class="token number">395</span> rdbcompression <span class="token function">yes</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="rdb-çš„å¤‡ä»½" tabindex="-1"><a class="header-anchor" href="#rdb-çš„å¤‡ä»½" aria-hidden="true">#</a> rdb çš„å¤‡ä»½</h4><p>å…ˆé€šè¿‡ config get dir æŸ¥è¯¢ rdb æ–‡ä»¶çš„ç›®å½• ï¼Œå°† *.rdb çš„æ–‡ä»¶æ‹·è´åˆ°åˆ«çš„åœ°æ–¹ã€‚</p><p>rdb çš„æ¢å¤</p><ul><li>å…³é—­ Redis</li><li>å…ˆæŠŠå¤‡ä»½çš„æ–‡ä»¶æ‹·è´åˆ°å·¥ä½œç›®å½•ä¸‹ cp dump2.rdb dump.rdb</li><li>å¯åŠ¨ Redisï¼Œå¤‡ä»½æ•°æ®ä¼šç›´æ¥åŠ è½½</li></ul><h3 id="rdb-ä¼˜åŠ¿" tabindex="-1"><a class="header-anchor" href="#rdb-ä¼˜åŠ¿" aria-hidden="true">#</a> RDB ä¼˜åŠ¿</h3><ol><li>é€‚åˆå¤§è§„æ¨¡æ•°æ®çš„æ¢å¤</li><li>å¯¹æ•°æ®çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§è¦æ±‚ä¸é«˜æ—¶é€‚åˆä½¿ç”¨</li><li>èŠ‚çœç£ç›˜ç©ºé—´ï¼ˆç›¸æ¯”è¾ƒäº AOFï¼Œæ²¡æœ‰å‘½ä»¤å­˜å‚¨ï¼‰</li><li>æ¢å¤é€Ÿåº¦å¿«</li></ol><h3 id="rdb-åŠ£åŠ¿" tabindex="-1"><a class="header-anchor" href="#rdb-åŠ£åŠ¿" aria-hidden="true">#</a> RDB åŠ£åŠ¿</h3><ol><li><p>Fork çš„æ—¶å€™ï¼Œå†…å­˜ä¸­çš„æ•°æ®è¢«å…‹éš†äº†ä¸€ä»½ï¼Œå¤§è‡´ 2 å€çš„è†¨èƒ€æ€§éœ€è¦è€ƒè™‘</p></li><li><p>è™½ç„¶ Redis åœ¨ fork æ—¶ä½¿ç”¨äº†<strong>å†™æ—¶æ‹·è´æŠ€æœ¯</strong>ï¼Œä½†æ˜¯å¦‚æœæ•°æ®åºå¤§æ—¶è¿˜æ˜¯æ¯”è¾ƒæ¶ˆè€—æ€§èƒ½ã€‚</p></li><li><p>åœ¨å¤‡ä»½å‘¨æœŸåœ¨ä¸€å®šé—´éš”æ—¶é—´åšä¸€æ¬¡å¤‡ä»½ï¼Œæ‰€ä»¥å¦‚æœ Redis æ„å¤– down æ‰çš„è¯ï¼Œå°±ä¼šä¸¢å¤±æœ€åä¸€æ¬¡å¿«ç…§åçš„æ‰€æœ‰ä¿®æ”¹ã€‚</p></li></ol><h3 id="åŠ¨æ€åœæ­¢rdb" tabindex="-1"><a class="header-anchor" href="#åŠ¨æ€åœæ­¢rdb" aria-hidden="true">#</a> åŠ¨æ€åœæ­¢RDB</h3><p>åŠ¨æ€åœæ­¢ RDBï¼šredis-cli config set save &quot;&quot; # saveåç»™ç©ºå€¼ï¼Œè¡¨ç¤ºç¦ç”¨ä¿å­˜ç­–ç•¥</p><h3 id="rdb-æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#rdb-æ€»ç»“" aria-hidden="true">#</a> RDB æ€»ç»“</h3><figure><img src="/assets/image-20221008153853024-a35941cb.png" alt="image-20221008153853024" tabindex="0" loading="lazy"><figcaption>image-20221008153853024</figcaption></figure><h2 id="aof-append-only-file" tabindex="-1"><a class="header-anchor" href="#aof-append-only-file" aria-hidden="true">#</a> AOFï¼ˆAppend Only Fileï¼‰</h2><h3 id="å®šä¹‰-1" tabindex="-1"><a class="header-anchor" href="#å®šä¹‰-1" aria-hidden="true">#</a> å®šä¹‰</h3><p>â€‹ ä»¥<strong>æ—¥å¿—</strong>çš„å½¢å¼æ¥è®°å½•æ¯ä¸ªå†™æ“ä½œï¼ˆå¢é‡ä¿å­˜ï¼‰ï¼Œå°† Redis æ‰§è¡Œè¿‡çš„æ‰€æœ‰å†™æŒ‡ä»¤è®°å½•ä¸‹æ¥ï¼ˆ<strong>è¯»æ“ä½œä¸è®°å½•</strong>ï¼‰ï¼Œ <strong>åªè®¸è¿½åŠ æ–‡ä»¶ä½†ä¸å¯ä»¥æ”¹å†™æ–‡ä»¶</strong>ï¼Œredis å¯åŠ¨ä¹‹åˆä¼šè¯»å–è¯¥æ–‡ä»¶é‡æ–°æ„å»ºæ•°æ®ï¼Œæ¢è¨€ä¹‹ï¼Œredis é‡å¯çš„è¯å°±æ ¹æ®æ—¥å¿—æ–‡ä»¶çš„å†…å®¹å°†å†™æŒ‡ä»¤ä»å‰åˆ°åæ‰§è¡Œä¸€æ¬¡ä»¥å®Œæˆæ•°æ®çš„æ¢å¤å·¥ä½œã€‚</p><h3 id="aof-æŒä¹…åŒ–æµç¨‹" tabindex="-1"><a class="header-anchor" href="#aof-æŒä¹…åŒ–æµç¨‹" aria-hidden="true">#</a> AOF æŒä¹…åŒ–æµç¨‹</h3><p>ï¼ˆ1ï¼‰å®¢æˆ·ç«¯çš„è¯·æ±‚å†™å‘½ä»¤ä¼šè¢« append è¿½åŠ åˆ° AOF ç¼“å†²åŒºå†…</p><p>ï¼ˆ2ï¼‰AOF ç¼“å†²åŒºæ ¹æ® AOF æŒä¹…åŒ–ç­–ç•¥ <strong>[always, everysec, no]</strong> å°†æ“ä½œ sync åŒæ­¥åˆ°ç£ç›˜çš„ AOF æ–‡ä»¶ä¸­</p><p>ï¼ˆ3ï¼‰AOF æ–‡ä»¶å¤§å°è¶…è¿‡é‡å†™ç­–ç•¥æˆ–æ‰‹åŠ¨é‡å†™æ—¶ï¼Œä¼šå¯¹ AOF æ–‡ä»¶ rewrite é‡å†™ï¼Œå‹ç¼© AOF æ–‡ä»¶å®¹é‡</p><p>ï¼ˆ4ï¼‰Redis æœåŠ¡é‡å¯æ—¶ï¼Œä¼šé‡æ–° load åŠ è½½ AOF æ–‡ä»¶ä¸­çš„å†™æ“ä½œè¾¾åˆ°æ•°æ®æ¢å¤çš„ç›®çš„</p><img src="/assets/image-20221008154119947-fb680f3f.png" alt="image-20221008154119947" style="zoom:67%;"><h3 id="aof-é»˜è®¤é…ç½®" tabindex="-1"><a class="header-anchor" href="#aof-é»˜è®¤é…ç½®" aria-hidden="true">#</a> AOF é»˜è®¤é…ç½®</h3><p>åœ¨ redis.conf ä¸­é…ç½®æ–‡ä»¶åç§°ï¼Œé»˜è®¤ä¸º appendonly.aofï¼ŒAOF æ–‡ä»¶çš„ä¿å­˜è·¯å¾„ï¼ŒåŒ RDB çš„è·¯å¾„ä¸€è‡´ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">1211</span> <span class="token comment">############################## APPEND ONLY MODE ###############################</span>
<span class="token number">1212</span>
<span class="token number">1213</span> <span class="token comment"># By default Redis asynchronously dumps the dataset on disk. This mode is</span>
<span class="token number">1214</span> <span class="token comment"># good enough in many applications, but an issue with the Redis process or</span>
<span class="token number">1215</span> <span class="token comment"># a power outage may result into a few minutes of writes lost (depending on</span>
<span class="token number">1216</span> <span class="token comment"># the configured save points).</span>
<span class="token number">1217</span> <span class="token comment">#</span>
<span class="token number">1218</span> <span class="token comment"># The Append Only File is an alternative persistence mode that provides</span>
<span class="token number">1219</span> <span class="token comment"># much better durability. For instance using the default data fsync policy</span>
<span class="token number">1220</span> <span class="token comment"># (see later in the config file) Redis can lose just one second of writes in a</span>
<span class="token number">1221</span> <span class="token comment"># dramatic event like a server power outage, or a single write if something</span>
<span class="token number">1222</span> <span class="token comment"># wrong with the Redis process itself happens, but the operating system is</span>
<span class="token number">1223</span> <span class="token comment"># still running correctly.</span>
<span class="token number">1224</span> <span class="token comment">#</span>
<span class="token number">1225</span> <span class="token comment"># AOF and RDB persistence can be enabled at the same time without problems.</span>
<span class="token number">1226</span> <span class="token comment"># If the AOF is enabled on startup Redis will load the AOF, that is the file</span>
<span class="token number">1227</span> <span class="token comment"># with the better durability guarantees.</span>
<span class="token number">1228</span> <span class="token comment">#</span>
<span class="token number">1229</span> <span class="token comment"># Please check http://redis.io/topics/persistence for more information.</span>
<span class="token number">1230</span>
<span class="token number">1231</span> appendonly no
<span class="token number">1232</span>
<span class="token number">1233</span> <span class="token comment"># The name of the append only file (default: &quot;appendonly.aof&quot;)</span>
<span class="token number">1234</span>
<span class="token number">1235</span> appendfilename <span class="token string">&quot;appendonly.aof&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="aof-å’Œ-rdb-åŒæ—¶å¼€å¯" tabindex="-1"><a class="header-anchor" href="#aof-å’Œ-rdb-åŒæ—¶å¼€å¯" aria-hidden="true">#</a> AOF å’Œ RDB åŒæ—¶å¼€å¯</h3><p><strong>AOF å’Œ RDB åŒæ—¶å¼€å¯ï¼Œç³»ç»Ÿé»˜è®¤å– AOF çš„æ•°æ®ï¼ˆæ•°æ®ä¸ä¼šå­˜åœ¨ä¸¢å¤±ï¼‰</strong>ï¼Œå¦‚æœ aof æ–‡ä»¶ä¸ºç©ºï¼Œåˆ™é‡å¯åçš„ redis æ²¡æœ‰æ•°æ®ã€‚</p><p>ç¤ºä¾‹ï¼š</p><h3 id="aof-å¯åŠ¨ã€æ¢å¤" tabindex="-1"><a class="header-anchor" href="#aof-å¯åŠ¨ã€æ¢å¤" aria-hidden="true">#</a> AOF å¯åŠ¨ã€æ¢å¤</h3><p>AOF çš„å¤‡ä»½æœºåˆ¶å’Œæ€§èƒ½è™½ç„¶å’Œ RDB ä¸åŒï¼Œä½†æ˜¯å¤‡ä»½å’Œæ¢å¤çš„æ“ä½œåŒ RDBä¸€æ ·ï¼Œéƒ½æ˜¯æ‹·è´å¤‡ä»½æ–‡ä»¶ï¼Œéœ€è¦æ¢å¤æ—¶å†æ‹·è´åˆ° Redis å·¥ä½œç›®å½•ä¸‹ï¼Œå¯åŠ¨ç³»ç»Ÿå³åŠ è½½ã€‚</p><p>æ­£å¸¸æ¢å¤</p><ul><li>â€‹ ä¿®æ”¹é»˜è®¤çš„ appendonly noï¼Œæ”¹ä¸º yes</li><li>â€‹ å°†æœ‰æ•°æ®çš„ aof æ–‡ä»¶å¤åˆ¶ä¸€ä»½ä¿å­˜åˆ°å¯¹åº”ç›®å½•ï¼ˆæŸ¥çœ‹ç›®å½•ï¼šconfig get dirï¼‰</li><li>â€‹ æ¢å¤ï¼šé‡å¯ redis ç„¶åé‡æ–°åŠ è½½</li></ul><p>å¼‚å¸¸æ¢å¤</p><ul><li>â€‹ ä¿®æ”¹é»˜è®¤çš„ appendonly noï¼Œæ”¹ä¸º yes</li><li>â€‹ å¦‚é‡åˆ° <strong>AOF</strong> æ–‡ä»¶æŸåï¼Œé€šè¿‡ <code>/usr/local/bin/redis-check-aof--fix appendonly.aof --fixed</code> è¿›è¡Œæ¢å¤</li><li>â€‹ å¤‡ä»½è¢«å†™åçš„ AOF æ–‡ä»¶</li><li>â€‹ æ¢å¤ï¼šé‡å¯ redisï¼Œç„¶åé‡æ–°åŠ è½½</li></ul><p>ç¤ºä¾‹ï¼š</p><h3 id="aof-åŒæ­¥é¢‘ç‡è®¾ç½®" tabindex="-1"><a class="header-anchor" href="#aof-åŒæ­¥é¢‘ç‡è®¾ç½®" aria-hidden="true">#</a> AOF åŒæ­¥é¢‘ç‡è®¾ç½®</h3><ol><li><p>appendfsync always</p><p>â€‹ å§‹ç»ˆåŒæ­¥ï¼Œæ¯æ¬¡ Redis çš„å†™å…¥éƒ½ä¼šç«‹åˆ»è®°å…¥æ—¥å¿—ï¼Œæ€§èƒ½è¾ƒå·®ä½†æ•°æ®å®Œæ•´æ€§æ¯”è¾ƒå¥½</p></li><li><p>appendfsync everysec</p><p>â€‹ æ¯ç§’åŒæ­¥ï¼Œæ¯ç§’è®°å…¥æ—¥å¿—ä¸€æ¬¡ï¼Œå¦‚æœå®•æœºï¼Œæœ¬ç§’çš„æ•°æ®å¯èƒ½ä¸¢å¤±</p></li><li><p>appendfsync no</p><p>â€‹ redis ä¸ä¸»åŠ¨è¿›è¡ŒåŒæ­¥ï¼ŒæŠŠåŒæ­¥æ—¶æœºäº¤ç»™æ“ä½œç³»ç»Ÿ</p></li></ol><h3 id="rewrite-å‹ç¼©" tabindex="-1"><a class="header-anchor" href="#rewrite-å‹ç¼©" aria-hidden="true">#</a> Rewrite å‹ç¼©</h3><h4 id="å®šä¹‰-2" tabindex="-1"><a class="header-anchor" href="#å®šä¹‰-2" aria-hidden="true">#</a> å®šä¹‰</h4><p>â€‹ AOF é‡‡ç”¨æ–‡ä»¶è¿½åŠ æ–¹å¼ï¼Œæ–‡ä»¶ä¼šè¶Šæ¥è¶Šå¤§ä¸ºé¿å…å‡ºç°æ­¤ç§æƒ…å†µï¼Œæ–°å¢äº†é‡å†™æœºåˆ¶ï¼Œå½“ AOF æ–‡ä»¶çš„å¤§å°è¶…è¿‡æ‰€è®¾å®šçš„é˜ˆå€¼æ—¶ï¼ŒRedis å°±ä¼šå¯åŠ¨ AOF æ–‡ä»¶çš„å†…å®¹å‹ç¼©ï¼Œ åªä¿ç•™å¯ä»¥æ¢å¤æ•°æ®çš„æœ€å°æŒ‡ä»¤é›†ï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤ bgrewriteaof</p><h4 id="é‡å†™åŸç†-å¦‚ä½•å®ç°é‡å†™" tabindex="-1"><a class="header-anchor" href="#é‡å†™åŸç†-å¦‚ä½•å®ç°é‡å†™" aria-hidden="true">#</a> é‡å†™åŸç†ï¼Œå¦‚ä½•å®ç°é‡å†™</h4><p>AOF æ–‡ä»¶æŒç»­å¢é•¿è€Œè¿‡å¤§æ—¶ï¼Œä¼š fork å‡ºä¸€æ¡æ–°è¿›ç¨‹æ¥å°†æ–‡ä»¶é‡å†™ï¼ˆä¹Ÿæ˜¯å…ˆå†™ä¸´æ—¶æ–‡ä»¶æœ€åå† renameï¼‰ï¼Œ<strong>redis4.0 ç‰ˆæœ¬åçš„é‡å†™ï¼Œæ˜¯æŒ‡æŠŠ rdb çš„å¿«ç…§ï¼Œä»¥äºŒè¿›åˆ¶çš„å½¢å¼é™„åœ¨æ–°çš„ aof å¤´éƒ¨ï¼Œä½œä¸ºå·²æœ‰çš„å†å²æ•°æ®ï¼Œæ›¿æ¢æ‰åŸæ¥çš„æµæ°´è´¦æ“ä½œã€‚</strong></p><p><strong>no-appendfsync-on-rewriteï¼š</strong></p><p>å¦‚æœ no-appendfsync-on-rewrite=yes ï¼Œä¸å†™å…¥ aof æ–‡ä»¶åªå†™å…¥ç¼“å­˜ï¼Œç”¨æˆ·è¯·æ±‚ä¸ä¼šé˜»å¡ï¼Œä½†æ˜¯åœ¨è¿™æ®µæ—¶é—´å¦‚æœå®•æœºä¼šä¸¢å¤±è¿™æ®µæ—¶é—´çš„ç¼“å­˜æ•°æ®ã€‚ï¼ˆé™ä½æ•°æ®å®‰å…¨æ€§ï¼Œæé«˜æ€§èƒ½ï¼‰</p><p>å¦‚æœ no-appendfsync-on-rewrite=noï¼Œè¿˜æ˜¯ä¼šæŠŠæ•°æ®å¾€ç£ç›˜é‡Œåˆ·ï¼Œä½†æ˜¯é‡åˆ°é‡å†™æ“ä½œï¼Œå¯èƒ½ä¼šå‘ç”Ÿé˜»å¡ã€‚ï¼ˆæ•°æ®å®‰å…¨ï¼Œä½†æ˜¯æ€§èƒ½é™ä½ï¼‰</p><h4 id="è§¦å‘æœºåˆ¶-ä½•æ—¶é‡å†™" tabindex="-1"><a class="header-anchor" href="#è§¦å‘æœºåˆ¶-ä½•æ—¶é‡å†™" aria-hidden="true">#</a> è§¦å‘æœºåˆ¶ï¼Œä½•æ—¶é‡å†™</h4><p>Redis ä¼šè®°å½•ä¸Šæ¬¡é‡å†™æ—¶çš„ AOF å¤§å°ï¼Œé»˜è®¤é…ç½®æ˜¯å½“ AOF æ–‡ä»¶å¤§å°æ˜¯ä¸Šæ¬¡ rewrite åå¤§å°çš„ä¸€å€ä¸”æ–‡ä»¶å¤§äº 64M æ—¶è§¦å‘</p><p>é‡å†™è™½ç„¶å¯ä»¥èŠ‚çº¦å¤§é‡ç£ç›˜ç©ºé—´ï¼Œå‡å°‘æ¢å¤æ—¶é—´ã€‚ä½†æ˜¯æ¯æ¬¡é‡å†™è¿˜æ˜¯æœ‰ä¸€å®šçš„è´Ÿæ‹…çš„ï¼Œå› æ­¤è®¾å®š Redis è¦æ»¡è¶³ä¸€å®šæ¡ä»¶æ‰ä¼šè¿›è¡Œé‡å†™ã€‚</p><p>auto-aof-rewrite-percentageï¼šè®¾ç½®é‡å†™çš„åŸºå‡†å€¼ï¼Œæ–‡ä»¶è¾¾åˆ° 100% æ—¶å¼€å§‹é‡å†™ï¼ˆæ–‡ä»¶æ˜¯åŸæ¥é‡å†™åæ–‡ä»¶çš„ 2 å€æ—¶è§¦å‘ï¼‰</p><p>auto-aof-rewrite-min-sizeï¼šè®¾ç½®é‡å†™çš„åŸºå‡†å€¼ï¼Œæœ€å°æ–‡ä»¶ 64MBã€‚è¾¾åˆ°è¿™ä¸ªå€¼å¼€å§‹é‡å†™ã€‚</p><p>ä¾‹å¦‚ï¼šæ–‡ä»¶è¾¾åˆ° 70MB å¼€å§‹é‡å†™ï¼Œé™åˆ° 50MBï¼Œä¸‹æ¬¡åˆ™ 100MB å¼€å§‹é‡å†™ã€‚</p><p>ç³»ç»Ÿè½½å…¥æ—¶æˆ–è€…ä¸Šæ¬¡é‡å†™å®Œæ¯•æ—¶ï¼ŒRedis ä¼šè®°å½•æ­¤æ—¶ AOF å¤§å°ï¼Œè®¾ä¸º base_sizeï¼Œ</p><p>å¦‚æœ Redis çš„ AOF å½“å‰å¤§å° &gt;= base_size + base_size * 100% ï¼ˆé»˜è®¤ï¼‰ä¸”å½“å‰å¤§å° &gt;= 64mbï¼ˆé»˜è®¤ï¼‰çš„æƒ…å†µä¸‹ï¼ŒRedis ä¼šå¯¹ AOF è¿›è¡Œé‡å†™ã€‚</p><h4 id="é‡å†™æµç¨‹" tabindex="-1"><a class="header-anchor" href="#é‡å†™æµç¨‹" aria-hidden="true">#</a> é‡å†™æµç¨‹</h4><p>ï¼ˆ1ï¼‰bgrewriteaofè§¦å‘é‡å†™ï¼Œåˆ¤æ–­æ˜¯å¦å½“å‰æœ‰bgsaveæˆ–bgrewriteaofåœ¨è¿è¡Œï¼Œå¦‚æœæœ‰ï¼Œåˆ™ç­‰å¾…è¯¥å‘½ä»¤ç»“æŸåå†ç»§ç»­æ‰§è¡Œã€‚</p><p>ï¼ˆ2ï¼‰ä¸»è¿›ç¨‹forkå‡ºå­è¿›ç¨‹æ‰§è¡Œé‡å†™æ“ä½œï¼Œä¿è¯ä¸»è¿›ç¨‹ä¸ä¼šé˜»å¡ã€‚</p><p>ï¼ˆ3ï¼‰å­è¿›ç¨‹éå†rediså†…å­˜ä¸­æ•°æ®åˆ°ä¸´æ—¶æ–‡ä»¶ï¼Œå®¢æˆ·ç«¯çš„å†™è¯·æ±‚åŒæ—¶å†™å…¥aof_bufç¼“å†²åŒºå’Œaof_rewrite_bufé‡å†™ç¼“å†²åŒºä¿è¯åŸAOFæ–‡ä»¶å®Œæ•´ä»¥åŠæ–°AOFæ–‡ä»¶ç”ŸæˆæœŸé—´çš„æ–°çš„æ•°æ®ä¿®æ”¹åŠ¨ä½œä¸ä¼šä¸¢å¤±ã€‚</p><p>ï¼ˆ4ï¼‰å­è¿›ç¨‹å†™å®Œæ–°çš„AOFæ–‡ä»¶åï¼Œå‘ä¸»è¿›ç¨‹å‘ä¿¡å·ï¼Œçˆ¶è¿›ç¨‹æ›´æ–°ç»Ÿè®¡ä¿¡æ¯ã€‚2).ä¸»è¿›ç¨‹æŠŠaof_rewrite_bufä¸­çš„æ•°æ®å†™å…¥åˆ°æ–°çš„AOFæ–‡ä»¶ã€‚</p><p>ï¼ˆ5ï¼‰ä½¿ç”¨æ–°çš„AOFæ–‡ä»¶è¦†ç›–æ—§çš„AOFæ–‡ä»¶ï¼Œå®ŒæˆAOFé‡å†™ã€‚</p><figure><img src="/assets/image-20221008155125490-4b992bbd.png" alt="image-20221008155125490" tabindex="0" loading="lazy"><figcaption>image-20221008155125490</figcaption></figure><h3 id="ä¼˜åŠ¿" tabindex="-1"><a class="header-anchor" href="#ä¼˜åŠ¿" aria-hidden="true">#</a> ä¼˜åŠ¿</h3><ol><li><p>å¤‡ä»½æœºåˆ¶æ›´ç¨³å¥ï¼Œä¸¢å¤±æ•°æ®æ¦‚ç‡æ›´ä½ã€‚</p></li><li><p>å¯è¯»çš„æ—¥å¿—æ–‡æœ¬ï¼Œé€šè¿‡æ“ä½œ AOF ç¨³å¥ï¼Œå¯ä»¥å¤„ç†è¯¯æ“ä½œã€‚</p></li></ol><h3 id="åŠ£åŠ¿" tabindex="-1"><a class="header-anchor" href="#åŠ£åŠ¿" aria-hidden="true">#</a> åŠ£åŠ¿</h3><ul><li>æ¯”èµ· RDB å ç”¨æ›´å¤šçš„ç£ç›˜ç©ºé—´ã€‚</li><li>æ¢å¤å¤‡ä»½é€Ÿåº¦è¦æ…¢ã€‚</li><li>æ¯æ¬¡è¯»å†™éƒ½åŒæ­¥çš„è¯ï¼Œæœ‰ä¸€å®šçš„æ€§èƒ½å‹åŠ›ã€‚</li><li>å­˜åœ¨ä¸ªåˆ« Bugï¼Œé€ æˆæ¢å¤ä¸èƒ½ã€‚</li></ul><figure><img src="/assets/image-20221008155241481-1b33e192.png" alt="image-20221008155241481" tabindex="0" loading="lazy"><figcaption>image-20221008155241481</figcaption></figure><h2 id="åº”è¯¥ä½¿ç”¨é‚£ä¸ªç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#åº”è¯¥ä½¿ç”¨é‚£ä¸ªç­–ç•¥" aria-hidden="true">#</a> åº”è¯¥ä½¿ç”¨é‚£ä¸ªç­–ç•¥</h2><h3 id="å®˜æ–¹æ¨è" tabindex="-1"><a class="header-anchor" href="#å®˜æ–¹æ¨è" aria-hidden="true">#</a> å®˜æ–¹æ¨è</h3><ul><li>å®˜æ–¹æ¨èä¸¤ä¸ªéƒ½å¯ç”¨ã€‚</li><li>å¦‚æœå¯¹æ•°æ®ä¸æ•æ„Ÿï¼Œå¯ä»¥é€‰å•ç‹¬ç”¨ RDBã€‚</li><li>ä¸å»ºè®®å•ç‹¬ç”¨ AOFï¼Œå› ä¸ºå¯èƒ½ä¼šå‡ºç° Bugã€‚</li><li>å¦‚æœåªæ˜¯åšçº¯å†…å­˜ç¼“å­˜ï¼Œå¯ä»¥éƒ½ä¸ç”¨ã€‚</li></ul><figure><img src="/assets/image-20221008155404670-001f2fa6.png" alt="image-20221008155404670" tabindex="0" loading="lazy"><figcaption>image-20221008155404670</figcaption></figure><ul><li>RDB æŒä¹…åŒ–æ–¹å¼èƒ½å¤Ÿåœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”èƒ½å¯¹ä½ çš„æ•°æ®è¿›è¡Œå¿«ç…§å­˜å‚¨</li><li>AOF æŒä¹…åŒ–æ–¹å¼è®°å½•æ¯æ¬¡å¯¹æœåŠ¡å™¨å†™çš„æ“ä½œï¼Œå½“æœåŠ¡å™¨é‡å¯çš„æ—¶å€™ä¼šé‡æ–°æ‰§è¡Œè¿™äº›å‘½ä»¤æ¥æ¢å¤åŸå§‹çš„æ•°æ®ï¼ŒAOF å‘½ä»¤ä»¥ Redis åè®®è¿½åŠ ä¿å­˜æ¯æ¬¡å†™çš„æ“ä½œåˆ°æ–‡ä»¶æœ«å°¾ã€‚</li><li>Redis è¿˜èƒ½å¯¹ AOF æ–‡ä»¶è¿›è¡Œåå°é‡å†™ï¼Œä½¿å¾— AOF æ–‡ä»¶çš„ä½“ç§¯ä¸è‡³äºè¿‡å¤§</li><li>åªåšç¼“å­˜ï¼šå¦‚æœä½ åªå¸Œæœ›ä½ çš„æ•°æ®åœ¨æœåŠ¡å™¨è¿è¡Œçš„æ—¶å€™å­˜åœ¨ï¼Œä¹Ÿå¯ä»¥ä¸ä½¿ç”¨ä»»ä½•æŒä¹…åŒ–æ–¹å¼ã€‚</li><li>åŒæ—¶å¼€å¯ä¸¤ç§æŒä¹…åŒ–æ–¹å¼ <ul><li>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå½“ Redis é‡å¯çš„æ—¶å€™ä¼šä¼˜å…ˆè½½å…¥ AOF æ–‡ä»¶æ¥æ¢å¤åŸå§‹çš„æ•°æ®ï¼Œå› ä¸ºåœ¨é€šå¸¸æƒ…å†µä¸‹ AOF æ–‡ä»¶ä¿å­˜çš„æ•°æ®é›†è¦æ¯” RDB æ–‡ä»¶ä¿å­˜çš„æ•°æ®é›†è¦å®Œæ•´ã€‚</li><li>RDB çš„æ•°æ®ä¸å®æ—¶ï¼ŒåŒæ—¶ä½¿ç”¨ä¸¤è€…æ—¶æœåŠ¡å™¨é‡å¯ä¹Ÿåªä¼šæ‰¾ AOF æ–‡ä»¶ã€‚é‚£è¦ä¸è¦åªä½¿ç”¨ AOFå‘¢ï¼Ÿ</li><li>å»ºè®®ä¸è¦ï¼Œå› ä¸º RDB æ›´é€‚åˆç”¨äºå¤‡ä»½æ•°æ®åº“ï¼ˆAOF åœ¨ä¸æ–­å˜åŒ–ä¸å¥½å¤‡ä»½ï¼‰ï¼Œ å¿«é€Ÿé‡å¯ï¼Œè€Œä¸”ä¸ä¼šæœ‰ AOF å¯èƒ½æ½œåœ¨çš„ bugï¼Œç•™ç€ä½œä¸ºä¸€ä¸ªä¸‡ä¸€çš„æ‰‹æ®µã€‚</li></ul></li></ul><h3 id="æ€§èƒ½å»ºè®®" tabindex="-1"><a class="header-anchor" href="#æ€§èƒ½å»ºè®®" aria-hidden="true">#</a> æ€§èƒ½å»ºè®®</h3><ol><li><p>å› ä¸º RDB æ–‡ä»¶åªç”¨ä½œåå¤‡ç”¨é€”ï¼Œå»ºè®®åªåœ¨ Slaveä¸ŠæŒä¹…åŒ– RDB æ–‡ä»¶ï¼Œè€Œä¸”åªè¦ 15 åˆ†é’Ÿå¤‡ä»½ä¸€æ¬¡å³å¯ï¼Œåªä¿ç•™ save 900 1 è¿™æ¡è§„åˆ™ã€‚</p></li><li><p>å¦‚æœä½¿ç”¨ AOFï¼Œå¥½å¤„æ˜¯åœ¨æœ€æ¶åŠ£æƒ…å†µä¸‹ä¹Ÿåªä¼šä¸¢å¤±ä¸è¶…è¿‡ä¸¤ç§’æ•°æ®ï¼Œå¯åŠ¨è„šæœ¬è¾ƒç®€å•åª load è‡ªå·±çš„ AOF æ–‡ä»¶å°±å¯ä»¥äº†ã€‚ ä»£ä»·ï¼šä¸€æ˜¯å¸¦æ¥äº†æŒç»­çš„ IOï¼ŒäºŒæ˜¯ AOF rewrite çš„æœ€åå°† rewrite è¿‡ç¨‹ä¸­äº§ç”Ÿçš„æ–°æ•°æ®å†™åˆ°æ–°æ–‡ä»¶é€ æˆçš„é˜»å¡å‡ ä¹æ˜¯ä¸å¯é¿å…çš„ã€‚</p></li><li><p><strong>åªè¦ç¡¬ç›˜è®¸å¯ï¼Œåº”è¯¥å°½é‡å‡å°‘ AOF rewriteçš„é¢‘ç‡</strong>ï¼ŒAOF é‡å†™çš„åŸºç¡€å¤§å°é»˜è®¤å€¼ 64M å¤ªå°äº†ï¼Œå¯ä»¥è®¾åˆ° 5G ä»¥ä¸Šã€‚ é»˜è®¤è¶…è¿‡åŸå¤§å°100%å¤§å°æ—¶é‡å†™å¯ä»¥æ”¹åˆ°é€‚å½“çš„æ•°å€¼ã€‚</p></li></ol><h1 id="redis-ä¸»ä»å¤åˆ¶" tabindex="-1"><a class="header-anchor" href="#redis-ä¸»ä»å¤åˆ¶" aria-hidden="true">#</a> Redis ä¸»ä»å¤åˆ¶</h1><h2 id="å®šä¹‰-3" tabindex="-1"><a class="header-anchor" href="#å®šä¹‰-3" aria-hidden="true">#</a> å®šä¹‰</h2><p>â€‹ ä¸»æœºæ•°æ®æ›´æ–°åæ ¹æ®é…ç½®å’Œç­–ç•¥ï¼Œ è‡ªåŠ¨åŒæ­¥åˆ°å¤‡æœºçš„ master/slaver æœºåˆ¶ï¼Œ<strong>Master</strong> ä»¥å†™ä¸ºä¸»ï¼Œ<strong>Slave</strong> ä»¥è¯»ä¸ºä¸»ã€‚</p><h2 id="ä½œç”¨" tabindex="-1"><a class="header-anchor" href="#ä½œç”¨" aria-hidden="true">#</a> ä½œç”¨</h2><ol><li><p>è¯»å†™åˆ†ç¦»ï¼Œæ€§èƒ½æ‰©å±•</p></li><li><p>å®¹ç¾å¿«é€Ÿæ¢å¤</p></li></ol><img src="/assets/ä¸»ä»å¤åˆ¶-b8a68683.png" alt="Redis ä¸»ä»å¤åˆ¶" style="zoom:67%;"><p><strong>è¯´æ˜ï¼šå¦‚æœæœ‰å¤šä¸ªä¸»æœºï¼Œå¤šä¸ªä¸»æœºå†™å…¥ç›¸åŒçš„æ•°æ®ï¼Œåˆ™ä»æœºè¯»å–æ—¶æ— æ³•åˆ†è¾¨</strong></p><h2 id="æ­å»ºä¸»ä»å¤åˆ¶" tabindex="-1"><a class="header-anchor" href="#æ­å»ºä¸»ä»å¤åˆ¶" aria-hidden="true">#</a> æ­å»ºä¸»ä»å¤åˆ¶</h2><p>ã€æ­¤å¤„åœ¨ä¸€å°ä¸»æœºä¸Šæ­å»ºä¸»ä»å¤åˆ¶ï¼Œéœ€è¦ä¿®æ”¹ç«¯å£ï¼ŒPID æ–‡ä»¶ç­‰ä¿¡æ¯ã€‘</p><p>æ–°å»ºå¤šä»½ redis.conf æ–‡ä»¶ï¼Œä½¿ç”¨ include å‘½ä»¤å¼•å…¥ /etc/redis.conf</p><ul><li>å¼€å¯ daemonize yes</li><li>Pid æ–‡ä»¶åå­— pidfile</li><li>æŒ‡å®šç«¯å£ port</li><li>Log æ–‡ä»¶åå­—</li><li>dump.rdb åå­— dbfilename</li><li>Appendonly å…³æ‰æˆ–è€…æ›¿æ¢åå­—</li></ul><h3 id="ç¬¬ä¸€æ­¥-æ–°å»ºé…ç½®æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#ç¬¬ä¸€æ­¥-æ–°å»ºé…ç½®æ–‡ä»¶" aria-hidden="true">#</a> ç¬¬ä¸€æ­¥ï¼šæ–°å»ºé…ç½®æ–‡ä»¶</h3><p>åœ¨ /opt/redis/redisConf ä¸‹æ–°å»ºé…ç½®æ–‡ä»¶ redis6379.confï¼Œredis6380.confï¼Œredis6381.conf</p><p>redis6379.confï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>include /etc/redis.conf
pidfile /var/run/redis_6379.pid
port <span class="token number">6379</span>
dbfilename dump6379.rdb
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>redis6380.confï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>include /etc/redis.conf
pidfile /var/run/redis_6380.pid
port <span class="token number">6380</span>
dbfilename dump6380.rdb
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>redis6381.confï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>include /etc/redis.conf
pidfile /var/run/redis_6381.pid
port <span class="token number">6381</span>
dbfilename dump6381.rdb
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç¬¬äºŒæ­¥-å¯åŠ¨ä¸‰å°-redis-æŸ¥çœ‹è¿›ç¨‹" tabindex="-1"><a class="header-anchor" href="#ç¬¬äºŒæ­¥-å¯åŠ¨ä¸‰å°-redis-æŸ¥çœ‹è¿›ç¨‹" aria-hidden="true">#</a> ç¬¬äºŒæ­¥ï¼šå¯åŠ¨ä¸‰å° Redisï¼ŒæŸ¥çœ‹è¿›ç¨‹</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost redis<span class="token punctuation">]</span><span class="token comment"># redis-server /opt/redis/redisConf/redis6379.conf</span>
<span class="token punctuation">[</span>root@localhost redis<span class="token punctuation">]</span><span class="token comment"># redis-server /opt/redis/redisConf/redis6380.conf</span>
<span class="token punctuation">[</span>root@localhost redis<span class="token punctuation">]</span><span class="token comment"># redis-server /opt/redis/redisConf/redis6381.conf</span>
<span class="token punctuation">[</span>root@localhost redis<span class="token punctuation">]</span><span class="token comment"># ps -ef|grep redis</span>
root       <span class="token number">1279</span>      <span class="token number">1</span>  <span class="token number">0</span> <span class="token number">15</span>:22 ?        00:00:12 redis-server *:6379
root       <span class="token number">1365</span>      <span class="token number">1</span>  <span class="token number">0</span> <span class="token number">16</span>:12 ?        00:00:00 redis-server *:6380
root       <span class="token number">1371</span>      <span class="token number">1</span>  <span class="token number">1</span> <span class="token number">16</span>:12 ?        00:00:00 redis-server *:6381
root       <span class="token number">1377</span>   <span class="token number">1254</span>  <span class="token number">0</span> <span class="token number">16</span>:12 pts/0    00:00:00 <span class="token function">grep</span> <span class="token parameter variable">--color</span><span class="token operator">=</span>auto redis
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç¬¬ä¸‰æ­¥-ä½¿ç”¨-info-replication-æ‰“å°ä¸»ä»å¤åˆ¶ä¿¡æ¯" tabindex="-1"><a class="header-anchor" href="#ç¬¬ä¸‰æ­¥-ä½¿ç”¨-info-replication-æ‰“å°ä¸»ä»å¤åˆ¶ä¿¡æ¯" aria-hidden="true">#</a> ç¬¬ä¸‰æ­¥ï¼šä½¿ç”¨ info replication æ‰“å°ä¸»ä»å¤åˆ¶ä¿¡æ¯</h3><p>ä½¿ç”¨å‘½ä»¤ <code>redis-cli -p 6379 </code>è¿æ¥ï¼Œæ­¤æ—¶ä¸‰å° Redis æ²¡æœ‰ç›¸å…³æ€§ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost redis<span class="token punctuation">]</span><span class="token comment"># redis-cli -p 6379</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> info replication
<span class="token comment"># Replication</span>
role:master
connected_slaves:0
master_failover_state:no-failover
master_replid:b000a8297805ddb0f87b16a334ac5192fc090a9b
master_replid2:0000000000000000000000000000000000000000
master_repl_offset:0
second_repl_offset:-1
repl_backlog_active:0
repl_backlog_size:1048576
repl_backlog_first_byte_offset:0
repl_backlog_histlen:0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç¬¬å››æ­¥-é…ç½®ä¸»æœºå’Œä»æœº" tabindex="-1"><a class="header-anchor" href="#ç¬¬å››æ­¥-é…ç½®ä¸»æœºå’Œä»æœº" aria-hidden="true">#</a> ç¬¬å››æ­¥ï¼šé…ç½®ä¸»æœºå’Œä»æœº</h3><p>ä½¿ç”¨ <code>slaveof &lt;ip&gt;&lt;port&gt;</code> å‘½ä»¤ï¼Œåœ¨ä»æœºä¸Šé…ç½®å®ƒçš„ä¸»æœºã€‚</p><p>redis6379ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost redis<span class="token punctuation">]</span><span class="token comment"># redis-cli -p 6379</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> info replication
<span class="token comment"># Replication</span>
role:master
connected_slaves:2
slave0:ip<span class="token operator">=</span><span class="token number">127.0</span>.0.1,port<span class="token operator">=</span><span class="token number">6380</span>,state<span class="token operator">=</span>online,offset<span class="token operator">=</span><span class="token number">56</span>,lag<span class="token operator">=</span><span class="token number">0</span>
slave1:ip<span class="token operator">=</span><span class="token number">127.0</span>.0.1,port<span class="token operator">=</span><span class="token number">6381</span>,state<span class="token operator">=</span>online,offset<span class="token operator">=</span><span class="token number">56</span>,lag<span class="token operator">=</span><span class="token number">0</span>
master_failover_state:no-failover
master_replid:8c04d0a2552ad18119aa3b0d037e957646a294ac
master_replid2:0000000000000000000000000000000000000000
master_repl_offset:56
second_repl_offset:-1
repl_backlog_active:1
repl_backlog_size:1048576
repl_backlog_first_byte_offset:1
repl_backlog_histlen:56
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>redis6380ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># redis-cli -p 6380</span>
<span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> slaveof <span class="token number">127.0</span>.0.1 <span class="token number">6379</span>
OK
<span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> info replication
<span class="token comment"># Replication</span>
role:slave
master_host:127.0.0.1
master_port:6379
master_link_status:up
master_last_io_seconds_ago:2
master_sync_in_progress:0
slave_repl_offset:56
slave_priority:100
slave_read_only:1
connected_slaves:0
master_failover_state:no-failover
master_replid:8c04d0a2552ad18119aa3b0d037e957646a294ac
master_replid2:0000000000000000000000000000000000000000
master_repl_offset:56
second_repl_offset:-1
repl_backlog_active:1
repl_backlog_size:1048576
repl_backlog_first_byte_offset:1
repl_backlog_histlen:56
<span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>redis6381ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># redis-cli -p 6381</span>
<span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> slaveof <span class="token number">127.0</span>.0.1 <span class="token number">6379</span>
OK
<span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> info replication
<span class="token comment"># Replication</span>
role:slave
master_host:127.0.0.1
master_port:6379
master_link_status:up
master_last_io_seconds_ago:2
master_sync_in_progress:0
slave_repl_offset:42
slave_priority:100
slave_read_only:1
connected_slaves:0
master_failover_state:no-failover
master_replid:8c04d0a2552ad18119aa3b0d037e957646a294ac
master_replid2:0000000000000000000000000000000000000000
master_repl_offset:42
second_repl_offset:-1
repl_backlog_active:1
repl_backlog_size:1048576
repl_backlog_first_byte_offset:29
repl_backlog_histlen:14
<span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç¬¬äº”æ­¥-è¯»å†™æ•°æ®" tabindex="-1"><a class="header-anchor" href="#ç¬¬äº”æ­¥-è¯»å†™æ•°æ®" aria-hidden="true">#</a> ç¬¬äº”æ­¥ï¼šè¯»å†™æ•°æ®</h3><p>åœ¨ä¸»æœºä¸Šå†™ï¼Œåœ¨ä»æœºä¸Šå¯ä»¥è¯»å–æ•°æ®ï¼Œåœ¨ä»æœºä¸Šå†™æ•°æ®æŠ¥é”™ï¼š</p><p>åœ¨ä¸»æœºä¸Šå†™æ•°æ®ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost redisConf<span class="token punctuation">]</span><span class="token comment"># redis-cli -p 6379</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">set</span> k1 v1
OK
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä»æœºä¸Šè¯»å–æ•°æ®ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># redis-cli -p 6381</span>
<span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> get k1
<span class="token string">&quot;v1&quot;</span>
<span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> <span class="token builtin class-name">set</span> k2 v2
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> READONLY You can&#39;t <span class="token function">write</span> against a <span class="token builtin class-name">read</span> only replica.
<span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç¬¬å…­æ­¥-ä¸»æœºæŒ‚æ‰-é‡å¯ä»æ˜¯-master" tabindex="-1"><a class="header-anchor" href="#ç¬¬å…­æ­¥-ä¸»æœºæŒ‚æ‰-é‡å¯ä»æ˜¯-master" aria-hidden="true">#</a> ç¬¬å…­æ­¥ï¼šä¸»æœºæŒ‚æ‰ï¼Œé‡å¯ä»æ˜¯ master</h3><p>ä»æœº 6380ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> info replication
<span class="token comment"># Replication</span>
<span class="token comment"># ä»æœºä»ç„¶æ˜¯ slave</span>
role:slave
master_host:127.0.0.1
master_port:6379
<span class="token comment"># ä¸»æœºçŠ¶æ€ä¸º down</span>
master_link_status:down
master_last_io_seconds_ago:-1
master_sync_in_progress:0
slave_repl_offset:56
master_link_down_since_seconds:4
slave_priority:100
slave_read_only:1
connected_slaves:0
master_replid:17ec7bb8d09e2e792490ff387061ad90760aa93b
master_replid2:0000000000000000000000000000000000000000
master_repl_offset:56
second_repl_offset:-1
repl_backlog_active:1
repl_backlog_size:1048576
repl_backlog_first_byte_offset:1
repl_backlog_histlen:56

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é‡å¯ä¸»æœºï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> info replication
<span class="token comment"># Replication</span>
role:master
connected_slaves:2
slave0:ip<span class="token operator">=</span><span class="token number">127.0</span>.0.1,port<span class="token operator">=</span><span class="token number">6380</span>,state<span class="token operator">=</span>online,offset<span class="token operator">=</span><span class="token number">140</span>,lag<span class="token operator">=</span><span class="token number">1</span>
slave1:ip<span class="token operator">=</span><span class="token number">127.0</span>.0.1,port<span class="token operator">=</span><span class="token number">6381</span>,state<span class="token operator">=</span>online,offset<span class="token operator">=</span><span class="token number">140</span>,lag<span class="token operator">=</span><span class="token number">1</span>
master_replid:fdaabc55beb3a80fd3e6833cd2733aee63577bc0
master_replid2:0000000000000000000000000000000000000000
master_repl_offset:140
second_repl_offset:-1
repl_backlog_active:1
repl_backlog_size:1048576
repl_backlog_first_byte_offset:1
repl_backlog_histlen:140

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç¬¬ä¸ƒæ­¥-ä»æœºé‡å¯-éœ€è¦é‡æ–°è®¾ç½®-slaveof" tabindex="-1"><a class="header-anchor" href="#ç¬¬ä¸ƒæ­¥-ä»æœºé‡å¯-éœ€è¦é‡æ–°è®¾ç½®-slaveof" aria-hidden="true">#</a> ç¬¬ä¸ƒæ­¥ï¼šä»æœºé‡å¯ï¼Œéœ€è¦é‡æ–°è®¾ç½® slaveof</h3><p>å¯ä»¥å°†é…ç½®å¢åŠ åˆ°æ–‡ä»¶ä¸­ï¼Œæ°¸ä¹…ç”Ÿæ•ˆã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># ps -ef |grep redis</span>
root       <span class="token number">1459</span>      <span class="token number">1</span>  <span class="token number">0</span> <span class="token number">16</span>:19 ?        00:00:02 redis-server *:6379
root       <span class="token number">1466</span>      <span class="token number">1</span>  <span class="token number">0</span> <span class="token number">16</span>:19 ?        00:00:02 redis-server *:6380
root       <span class="token number">1472</span>      <span class="token number">1</span>  <span class="token number">0</span> <span class="token number">16</span>:20 ?        00:00:02 redis-server *:6381
root       <span class="token number">1483</span>   <span class="token number">1254</span>  <span class="token number">0</span> <span class="token number">16</span>:25 pts/0    00:00:00 redis-cli <span class="token parameter variable">-p</span> <span class="token number">6379</span>
root       <span class="token number">1485</span>   <span class="token number">1386</span>  <span class="token number">0</span> <span class="token number">16</span>:25 pts/2    00:00:00 redis-cli <span class="token parameter variable">-p</span> <span class="token number">6380</span>
root       <span class="token number">1492</span>   <span class="token number">1424</span>  <span class="token number">0</span> <span class="token number">16</span>:28 pts/1    00:00:00 <span class="token function">grep</span> <span class="token parameter variable">--color</span><span class="token operator">=</span>auto redis
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># kill -9 1466</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># redis-server /opt/redis/redisConf/redis6380.conf</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># redis-cli -p 6380</span>
<span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> keys *
<span class="token punctuation">(</span>empty array<span class="token punctuation">)</span>
<span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> info replication
<span class="token comment"># Replication</span>
role:master
connected_slaves:0
master_failover_state:no-failover
master_replid:8628d72c430b24fa92275794735788802033a865
master_replid2:0000000000000000000000000000000000000000
master_repl_offset:0
second_repl_offset:-1
repl_backlog_active:0
repl_backlog_size:1048576
repl_backlog_first_byte_offset:0
repl_backlog_histlen:0
<span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> slaveof <span class="token number">127.0</span>.0.1 <span class="token number">6379</span>
OK
<span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> keys *
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;k2&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;k1&quot;</span>
<span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„é—®é¢˜ï¼šå…³é—­ redis æ—¶æŠ¥é”™</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost redis<span class="token punctuation">]</span><span class="token comment">#  redis-cli -p 6379 shutdown</span>
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> ERR Errors trying to SHUTDOWN. Check logs.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>åŸå› ï¼šéœ€è¦åˆ›å»ºæ—¥å¿—æ–‡ä»¶</p><p>è§£å†³æ–¹æ¡ˆï¼šéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½® logfileï¼Œé»˜è®¤ä¸ºç©ºï¼ˆæŒ‡å®šæ—¥å¿—è·¯å¾„ä¸å­˜åœ¨æ—¶åˆ™å¿…é¡»å…ˆåˆ›å»ºè·¯å¾„æ–‡ä»¶å¤¹ï¼‰</p><p><strong>æ³¨æ„ï¼šRedis åœ¨å…³é—­æ—¶ä¼šåˆ›å»º dump.rdb æ–‡ä»¶</strong></p><h2 id="ä¸»ä»å¤åˆ¶åŸç†" tabindex="-1"><a class="header-anchor" href="#ä¸»ä»å¤åˆ¶åŸç†" aria-hidden="true">#</a> ä¸»ä»å¤åˆ¶åŸç†</h2><blockquote><ol><li>Slave å¯åŠ¨æˆåŠŸè¿æ¥åˆ° master åä¸»åŠ¨ä¼šå‘é€ä¸€ä¸ª sync å‘½ä»¤</li><li>Master æ¥åˆ°å‘½ä»¤å¯åŠ¨åå°çš„å­˜ç›˜è¿›ç¨‹ï¼ŒåŒæ—¶æ”¶é›†æ‰€æœ‰æ¥æ”¶åˆ°çš„ç”¨äºä¿®æ”¹æ•°æ®é›†å‘½ä»¤ï¼Œ åœ¨åå°è¿›ç¨‹æ‰§è¡Œå®Œæ¯•ä¹‹åï¼ŒMaster å°†ä¼ é€æ•´ä¸ªæ•°æ®æ–‡ä»¶åˆ° Slaveï¼Œä»¥å®Œæˆä¸€æ¬¡å®Œå…¨åŒæ­¥</li><li>å…¨é‡å¤åˆ¶ï¼šè€Œ Slave æœåŠ¡åœ¨æ¥æ”¶åˆ°æ•°æ®åº“æ–‡ä»¶æ•°æ®åï¼Œå°†å…¶å­˜ç›˜å¹¶åŠ è½½åˆ°å†…å­˜ä¸­</li><li>å¢é‡å¤åˆ¶ï¼šMaster ç»§ç»­å°†æ–°çš„æ‰€æœ‰æ”¶é›†åˆ°çš„ä¿®æ”¹å‘½ä»¤ä¾æ¬¡ä¼ ç»™ Slaveï¼Œå®ŒæˆåŒæ­¥</li><li><strong>ä½†æ˜¯åªè¦æ˜¯é‡æ–°è¿æ¥ Masterï¼Œä¸€æ¬¡å®Œå…¨åŒæ­¥ï¼ˆå…¨é‡å¤åˆ¶ï¼‰å°†è¢«è‡ªåŠ¨æ‰§è¡Œ</strong></li></ol></blockquote><h2 id="é—®é¢˜-ä¸»æœºä»æœºå®•æœºæ•°æ®å¤åˆ¶é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#é—®é¢˜-ä¸»æœºä»æœºå®•æœºæ•°æ®å¤åˆ¶é—®é¢˜" aria-hidden="true">#</a> é—®é¢˜ï¼šä¸»æœºä»æœºå®•æœºæ•°æ®å¤åˆ¶é—®é¢˜</h2><ol><li>ä»æœº slave æ˜¯å…¨é‡èµ‹å€¼ï¼Œä»å¤´å¼€å§‹å¤åˆ¶ï¼Œæ–°å¢çš„é”®ä¼šé‡æ–°å¤åˆ¶</li><li>ä»æœº slave å¯ä»¥åªèƒ½è¯»ï¼Œä¸èƒ½å†™</li><li>ä¸»æœº shutdown åï¼Œä»æœºåŸåœ°å¾…å‘½ï¼Œä¸ä¼šå˜ä¸ºä¸»æœº</li><li>ä¸»æœº shutdown åï¼Œåˆé‡æ–°å¯åŠ¨ï¼Œä»æœºä»èƒ½æ¥å—æ•°æ®</li><li>ä»æœº shutdown åï¼Œé‡æ–°å¯åŠ¨ï¼Œä¼šé‡å¤´å¼€å§‹å¯åŠ¨</li></ol><p>ç¤ºä¾‹ï¼š</p><h2 id="é—®é¢˜-slave-ä¹Ÿå¯ä»¥æ˜¯-master" tabindex="-1"><a class="header-anchor" href="#é—®é¢˜-slave-ä¹Ÿå¯ä»¥æ˜¯-master" aria-hidden="true">#</a> é—®é¢˜ï¼šSlave ä¹Ÿå¯ä»¥æ˜¯ Master</h2><p>ä¸Šä¸€ä¸ª Slave å¯ä»¥æ˜¯ä¸‹ä¸€ä¸ª Slave çš„ Masterï¼ŒSlave åŒæ ·å¯ä»¥æ¥æ”¶å…¶ä»– Slaves çš„è¿æ¥å’ŒåŒæ­¥è¯·æ±‚ï¼Œé‚£ä¹ˆè¯¥ Slave ä½œä¸ºäº†é“¾æ¡ä¸­ä¸‹ä¸€ä¸ªçš„ Master,ï¼Œå¯ä»¥æœ‰æ•ˆå‡è½» Master çš„å†™å‹åŠ›ï¼Œå»ä¸­å¿ƒåŒ–é™ä½é£é™©ã€‚</p><p>ç”¨ <code>Slaveof &lt;ip&gt;&lt;port&gt;</code></p><p>ä¸­é€”å˜æ›´è½¬å‘ï¼šä¼šæ¸…é™¤ä¹‹å‰çš„æ•°æ®ï¼Œé‡æ–°å»ºç«‹æ‹·è´æœ€æ–°çš„</p><p>é£é™©æ˜¯ä¸€æ—¦æŸä¸ª Slave å®•æœºï¼Œåé¢çš„ Slave éƒ½æ²¡æ³•å¤‡ä»½</p><p>ä¸»æœºæŒ‚äº†ï¼Œä»æœºè¿˜æ˜¯ä»æœºï¼Œæ— æ³•å†™æ•°æ®äº†</p><h2 id="é—®é¢˜-master-å®•æœºå-ä»æœºå˜ä¸ºä¸»æœº" tabindex="-1"><a class="header-anchor" href="#é—®é¢˜-master-å®•æœºå-ä»æœºå˜ä¸ºä¸»æœº" aria-hidden="true">#</a> é—®é¢˜ï¼šMaster å®•æœºåï¼Œä»æœºå˜ä¸ºä¸»æœº</h2><p>å½“ä¸€ä¸ª master å®•æœºåï¼Œä½¿ç”¨<code>slaveof NO ONE </code>å°†ä»æœºå˜ä¸ºä¸»æœºï¼Œæ³¨æ„å¤§å°å†™é—®é¢˜ï¼Œå¦åˆ™æŠ¥é”™</p><p>åé¢çš„ slave å¯ä»¥ç«‹åˆ»å‡ä¸º masterï¼Œå…¶åé¢çš„ slave ä¸ç”¨åšä»»ä½•ä¿®æ”¹ã€‚</p><p>æ³¨æ„ï¼šæ­¤ç§æ–¹å¼éœ€è¦æ‰‹åŠ¨ä¿®æ”¹ä»æœºä¸ºä¸»æœºï¼Œå®é™…ä¸­ä¸ä¼šä½¿ç”¨ï¼Œè€Œé‡‡ç”¨å“¨å…µæ¨¡å¼ã€‚</p><p>ç¤ºä¾‹ï¼š</p><p>redis6379 å®•æœºï¼Œè®¾ç½® redis6380 ä¸ºä¸»æœºï¼š</p><p>redis6380ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> info replication
<span class="token comment"># Replication</span>
role:slave
master_host:127.0.0.1
master_port:6379
master_link_status:down
master_last_io_seconds_ago:-1
master_sync_in_progress:0
slave_repl_offset:2884
master_link_down_since_seconds:292
slave_priority:100
slave_read_only:1
connected_slaves:0
master_replid:ef720453975f27b514fe9479b10054384431cf2c
master_replid2:fdaabc55beb3a80fd3e6833cd2733aee63577bc0
master_repl_offset:2884
second_repl_offset:2885
repl_backlog_active:1
repl_backlog_size:1048576
repl_backlog_first_byte_offset:1
repl_backlog_histlen:2884
<span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> slaveof on one
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> ERR value is not an integer or out of range
<span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> slaveof NO ONE
OK
<span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> info replication
<span class="token comment"># Replication</span>
role:master
connected_slaves:0
master_replid:9e0cda03f2dd441051e71f406639b11f9caa9425
master_replid2:a2455197aa3b1b3fe3008e07ed298c13474b7624
master_repl_offset:0
second_repl_offset:1
repl_backlog_active:1
repl_backlog_size:1048576
repl_backlog_first_byte_offset:1
repl_backlog_histlen:0

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="å“¨å…µæ¨¡å¼-sentinel" tabindex="-1"><a class="header-anchor" href="#å“¨å…µæ¨¡å¼-sentinel" aria-hidden="true">#</a> å“¨å…µæ¨¡å¼ï¼ˆsentinelï¼‰</h2><p>ä¸»æœº shutdown åï¼Œåœ¨ä»æœºä¸­é€‰å‡ºä¸»æœºã€‚</p><p>é€šè¿‡å“¨å…µèƒ½å¤Ÿåå°ç›‘æ§ä¸»æœºæ˜¯å¦æ•…éšœï¼Œå¦‚æœå‡ºç°æ•…éšœï¼Œåˆ™æ ¹æ®æŠ•ç¥¨æ•°è‡ªåŠ¨å°†ä»åº“è½¬æ¢ä¸ºä¸»åº“ã€‚</p><h3 id="ç¬¬ä¸€æ­¥-æ–°å»º-sentinel-conf-æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#ç¬¬ä¸€æ­¥-æ–°å»º-sentinel-conf-æ–‡ä»¶" aria-hidden="true">#</a> ç¬¬ä¸€æ­¥ï¼šæ–°å»º sentinel.conf æ–‡ä»¶</h3><p><strong>æ–‡ä»¶åå¿…é¡»åŒ¹é…</strong></p><h3 id="ç¬¬äºŒæ­¥-é…ç½®æ–‡ä»¶å†…å®¹" tabindex="-1"><a class="header-anchor" href="#ç¬¬äºŒæ­¥-é…ç½®æ–‡ä»¶å†…å®¹" aria-hidden="true">#</a> ç¬¬äºŒæ­¥ï¼šé…ç½®æ–‡ä»¶å†…å®¹</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># mymaster: ä¸»æœºåˆ«åï¼Œ1ï¼šè‡³å°‘æœ‰å¤šå°‘ä¸ªå“¨å…µåŒæ„è¿ç§»çš„æ•°é‡ã€‚ </span>
sentinel monitor mymaster <span class="token number">127.0</span>.0.1 <span class="token number">6379</span> <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç¬¬ä¸‰æ­¥-å¯åŠ¨-redis-ä»¥åŠå“¨å…µ" tabindex="-1"><a class="header-anchor" href="#ç¬¬ä¸‰æ­¥-å¯åŠ¨-redis-ä»¥åŠå“¨å…µ" aria-hidden="true">#</a> ç¬¬ä¸‰æ­¥ï¼šå¯åŠ¨ Redis ä»¥åŠå“¨å…µ</h3><p>å¯åŠ¨ Redis å¹¶é…ç½®å¥½ <code>slaveof host port</code></p><p>æ³¨æ„ç«¯å£ï¼š26379</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost redis<span class="token punctuation">]</span><span class="token comment"># vim redisConf/sentinel.conf</span>
sentinel monitor mymaster <span class="token number">127.0</span>.0.1 <span class="token number">6379</span> <span class="token number">1</span>
<span class="token punctuation">[</span>root@localhost redis<span class="token punctuation">]</span><span class="token comment"># ls /usr/local/bin/</span>
redis-benchmark  redis-check-aof  redis-check-rdb  redis-cli  redis-sentinel  redis-server
<span class="token punctuation">[</span>root@localhost redis<span class="token punctuation">]</span><span class="token comment"># redis-sentinel /opt/redis/redisConf/sentinel.conf</span>
<span class="token punctuation">[</span>root@localhost redisConf<span class="token punctuation">]</span><span class="token comment"># redis-sentinel /opt/redis/redisConf/sentinel.conf</span>
<span class="token number">86752</span>:X <span class="token number">17</span> Aug <span class="token number">2023</span> <span class="token number">17</span>:45:44.016 <span class="token comment"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span>
<span class="token number">86752</span>:X <span class="token number">17</span> Aug <span class="token number">2023</span> <span class="token number">17</span>:45:44.016 <span class="token comment"># Redis version=6.0.16, bits=64, commit=00000000, modified=0, pid=86752, just st                                         arted</span>
<span class="token number">86752</span>:X <span class="token number">17</span> Aug <span class="token number">2023</span> <span class="token number">17</span>:45:44.016 <span class="token comment"># Configuration loaded</span>
<span class="token number">86752</span>:X <span class="token number">17</span> Aug <span class="token number">2023</span> <span class="token number">17</span>:45:44.018 * Increased maximum number of <span class="token function">open</span> files to <span class="token number">10032</span> <span class="token punctuation">(</span>it was originally <span class="token builtin class-name">set</span> to <span class="token number">1024</span>                                         <span class="token punctuation">)</span>.
                _._
           _.-`<span class="token variable"><span class="token variable">`</span>__ <span class="token string">&#39;&#39;</span>-._
      _.-<span class="token variable">`</span></span><span class="token variable"><span class="token variable">`</span>    <span class="token variable">`</span></span><span class="token builtin class-name">.</span>  <span class="token variable"><span class="token variable">`</span>_.  <span class="token string">&#39;&#39;</span>-._           Redis <span class="token number">6.0</span>.16 <span class="token punctuation">(</span>00000000/0<span class="token punctuation">)</span> <span class="token number">64</span> bit
  .-<span class="token variable">`</span></span><span class="token variable"><span class="token variable">`</span> .-<span class="token variable">`</span></span>`<span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">.</span>  <span class="token variable">`</span></span>`<span class="token variable"><span class="token variable">`</span><span class="token punctuation">\</span>/    _.,_ <span class="token string">&#39;&#39;</span>-._
 <span class="token punctuation">(</span>    &#39;      ,       .-<span class="token variable">`</span></span>  <span class="token operator">|</span> <span class="token variable"><span class="token variable">`</span>,    <span class="token punctuation">)</span>     Running <span class="token keyword">in</span> sentinel mode
 <span class="token operator">|</span><span class="token variable">`</span></span>-._<span class="token variable"><span class="token variable">`</span>-<span class="token punctuation">..</span>.-<span class="token variable">`</span></span> __<span class="token punctuation">..</span>.-.`<span class="token variable"><span class="token variable">`</span>-._<span class="token operator">|</span>&#39;<span class="token variable">`</span></span> _.-<span class="token string">&#39;|     Port: 26379
 |    `-._   `._    /     _.-&#39;</span>    <span class="token operator">|</span>     PID: <span class="token number">86752</span>
  <span class="token variable"><span class="token variable">`</span>-._    <span class="token variable">`</span></span>-._  <span class="token variable"><span class="token variable">`</span>-./  _.-<span class="token string">&#39;    _.-&#39;</span>
 <span class="token operator">|</span><span class="token variable">`</span></span>-._<span class="token variable"><span class="token variable">`</span>-._    <span class="token variable">`</span></span>-.__.-<span class="token string">&#39;    _.-&#39;</span>_.-<span class="token string">&#39;|
 |    `-._`-._        _.-&#39;</span>_.-<span class="token string">&#39;    |           http://redis.io
  `-._    `-._`-.__.-&#39;</span>_.-<span class="token string">&#39;    _.-&#39;</span>
 <span class="token operator">|</span><span class="token variable"><span class="token variable">`</span>-._<span class="token variable">`</span></span>-._    <span class="token variable"><span class="token variable">`</span>-.__.-<span class="token string">&#39;    _.-&#39;</span>_.-&#39;<span class="token operator">|</span>
 <span class="token operator">|</span>    <span class="token variable">`</span></span>-._<span class="token variable"><span class="token variable">`</span>-._        _.-<span class="token string">&#39;_.-&#39;</span>    <span class="token operator">|</span>
  <span class="token variable">`</span></span>-._    <span class="token variable"><span class="token variable">`</span>-._<span class="token variable">`</span></span>-.__.-<span class="token string">&#39;_.-&#39;</span>    _.-<span class="token string">&#39;
      `-._    `-.__.-&#39;</span>    _.-<span class="token string">&#39;
          `-._        _.-&#39;</span>
              `-.__.-&#39;

<span class="token number">86752</span>:X <span class="token number">17</span> Aug <span class="token number">2023</span> <span class="token number">17</span>:45:44.019 <span class="token comment"># WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/n                                         et/core/somaxconn is set to the lower value of 128.</span>
<span class="token number">86752</span>:X <span class="token number">17</span> Aug <span class="token number">2023</span> <span class="token number">17</span>:45:44.033 <span class="token comment"># Sentinel ID is e72532c059847cdad42c737a8bd0a7e7fd2da106</span>
<span class="token number">86752</span>:X <span class="token number">17</span> Aug <span class="token number">2023</span> <span class="token number">17</span>:45:44.033 <span class="token comment"># +monitor master mymaster 127.0.0.1 6379 quorum 1</span>
<span class="token number">86752</span>:X <span class="token number">17</span> Aug <span class="token number">2023</span> <span class="token number">17</span>:48:04.560 * +slave slave <span class="token number">127.0</span>.0.1:6380 <span class="token number">127.0</span>.0.1 <span class="token number">6380</span> @ mymaster <span class="token number">127.0</span>.0.1 <span class="token number">6379</span>
<span class="token number">86752</span>:X <span class="token number">17</span> Aug <span class="token number">2023</span> <span class="token number">17</span>:48:24.675 * +slave slave <span class="token number">127.0</span>.0.1:6381 <span class="token number">127.0</span>.0.1 <span class="token number">6381</span> @ mymaster <span class="token number">127.0</span>.0.1 <span class="token number">6379</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç¬¬å››æ­¥-å½“ä¸»æœºæŒ‚æ‰-åœ¨ä»æœºé€‰ä¸¾ä¸­äº§ç”Ÿæ–°çš„ä¸»æœº" tabindex="-1"><a class="header-anchor" href="#ç¬¬å››æ­¥-å½“ä¸»æœºæŒ‚æ‰-åœ¨ä»æœºé€‰ä¸¾ä¸­äº§ç”Ÿæ–°çš„ä¸»æœº" aria-hidden="true">#</a> ç¬¬å››æ­¥ï¼šå½“ä¸»æœºæŒ‚æ‰ï¼Œåœ¨ä»æœºé€‰ä¸¾ä¸­äº§ç”Ÿæ–°çš„ä¸»æœº</h3><p>é€‰ä¸¾åŸåˆ™ï¼šæ ¹æ®ä¼˜å…ˆçº§åˆ«ï¼šslave-priority ï¼ŒåŸä¸»æœºé‡å¯åä¼šå˜ä¸ºä»æœºã€‚</p><p>slave-priority é»˜è®¤100ï¼Œæ•°å€¼è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">86752</span>:X <span class="token number">17</span> Aug <span class="token number">2023</span> <span class="token number">17</span>:50:29.032 <span class="token comment"># +sdown master mymaster 127.0.0.1 6379</span>
<span class="token number">86752</span>:X <span class="token number">17</span> Aug <span class="token number">2023</span> <span class="token number">17</span>:50:29.032 <span class="token comment"># +odown master mymaster 127.0.0.1 6379 #quorum 1/1</span>
<span class="token number">86752</span>:X <span class="token number">17</span> Aug <span class="token number">2023</span> <span class="token number">17</span>:50:29.032 <span class="token comment"># +new-epoch 1</span>
<span class="token number">86752</span>:X <span class="token number">17</span> Aug <span class="token number">2023</span> <span class="token number">17</span>:50:29.032 <span class="token comment"># +try-failover master mymaster 127.0.0.1 6379</span>
<span class="token number">86752</span>:X <span class="token number">17</span> Aug <span class="token number">2023</span> <span class="token number">17</span>:50:29.038 <span class="token comment"># +vote-for-leader e72532c059847cdad42c737a8bd0a7e7fd2da106 1</span>
<span class="token number">86752</span>:X <span class="token number">17</span> Aug <span class="token number">2023</span> <span class="token number">17</span>:50:29.038 <span class="token comment"># +elected-leader master mymaster 127.0.0.1 6379</span>
<span class="token number">86752</span>:X <span class="token number">17</span> Aug <span class="token number">2023</span> <span class="token number">17</span>:50:29.038 <span class="token comment"># +failover-state-select-slave master mymaster 127.0.0.1 6379</span>
<span class="token number">86752</span>:X <span class="token number">17</span> Aug <span class="token number">2023</span> <span class="token number">17</span>:50:29.143 <span class="token comment"># +selected-slave slave 127.0.0.1:6381 127.0.0.1 6381 @ mymaster 127.0.0.1 6379</span>
<span class="token number">86752</span>:X <span class="token number">17</span> Aug <span class="token number">2023</span> <span class="token number">17</span>:50:29.143 * +failover-state-send-slaveof-noone slave <span class="token number">127.0</span>.0.1:6381 <span class="token number">127.0</span>.0.1 <span class="token number">6381</span> @ mymaster <span class="token number">127.0</span>.0.1 <span class="token number">6379</span>
<span class="token number">86752</span>:X <span class="token number">17</span> Aug <span class="token number">2023</span> <span class="token number">17</span>:50:29.238 * +failover-state-wait-promotion slave <span class="token number">127.0</span>.0.1:6381 <span class="token number">127.0</span>.0.1 <span class="token number">6381</span> @ mymaster <span class="token number">127.0</span>.0.1 <span class="token number">6379</span>
<span class="token number">86752</span>:X <span class="token number">17</span> Aug <span class="token number">2023</span> <span class="token number">17</span>:50:29.318 <span class="token comment"># +promoted-slave slave 127.0.0.1:6381 127.0.0.1 6381 @ mymaster 127.0.0.1 6379</span>
<span class="token number">86752</span>:X <span class="token number">17</span> Aug <span class="token number">2023</span> <span class="token number">17</span>:50:29.318 <span class="token comment"># +failover-state-reconf-slaves master mymaster 127.0.0.1 6379</span>
<span class="token number">86752</span>:X <span class="token number">17</span> Aug <span class="token number">2023</span> <span class="token number">17</span>:50:29.390 * +slave-reconf-sent slave <span class="token number">127.0</span>.0.1:6380 <span class="token number">127.0</span>.0.1 <span class="token number">6380</span> @ mymaster <span class="token number">127.0</span>.0.1 <span class="token number">6379</span>
<span class="token number">86752</span>:X <span class="token number">17</span> Aug <span class="token number">2023</span> <span class="token number">17</span>:50:30.377 * +slave-reconf-inprog slave <span class="token number">127.0</span>.0.1:6380 <span class="token number">127.0</span>.0.1 <span class="token number">6380</span> @ mymaster <span class="token number">127.0</span>.0.1 <span class="token number">6379</span>
<span class="token number">86752</span>:X <span class="token number">17</span> Aug <span class="token number">2023</span> <span class="token number">17</span>:50:30.377 * +slave-reconf-done slave <span class="token number">127.0</span>.0.1:6380 <span class="token number">127.0</span>.0.1 <span class="token number">6380</span> @ mymaster <span class="token number">127.0</span>.0.1 <span class="token number">6379</span>
<span class="token number">86752</span>:X <span class="token number">17</span> Aug <span class="token number">2023</span> <span class="token number">17</span>:50:30.436 <span class="token comment"># +failover-end master mymaster 127.0.0.1 6379</span>
<span class="token number">86752</span>:X <span class="token number">17</span> Aug <span class="token number">2023</span> <span class="token number">17</span>:50:30.436 <span class="token comment"># +switch-master mymaster 127.0.0.1 6379 127.0.0.1 6381</span>
<span class="token number">86752</span>:X <span class="token number">17</span> Aug <span class="token number">2023</span> <span class="token number">17</span>:50:30.436 * +slave slave <span class="token number">127.0</span>.0.1:6380 <span class="token number">127.0</span>.0.1 <span class="token number">6380</span> @ mymaster <span class="token number">127.0</span>.0.1 <span class="token number">6381</span>
<span class="token number">86752</span>:X <span class="token number">17</span> Aug <span class="token number">2023</span> <span class="token number">17</span>:50:30.436 * +slave slave <span class="token number">127.0</span>.0.1:6379 <span class="token number">127.0</span>.0.1 <span class="token number">6379</span> @ mymaster <span class="token number">127.0</span>.0.1 <span class="token number">6381</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>redis6379 å®•æœºåå‡ ç§’é’Ÿé€‰ä¸¾å‡º redis6381 ä¸ºæ–°çš„ä¸»æœºï¼ŒåŸå…ˆçš„ redis6379 å’Œ redis6380 ä¸ºä»æœº</p><p>redis6381ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> info replication
<span class="token comment"># Replication</span>
role:master
connected_slaves:1
slave0:ip<span class="token operator">=</span><span class="token number">127.0</span>.0.1,port<span class="token operator">=</span><span class="token number">6380</span>,state<span class="token operator">=</span>online,offset<span class="token operator">=</span><span class="token number">16631</span>,lag<span class="token operator">=</span><span class="token number">0</span>
master_replid:d6304564cdf08a1902ada73ec7e6eb309eefe669
master_replid2:25027d0c70d2abeec01c16e13bf023d2a1186019
master_repl_offset:16764
second_repl_offset:7649
repl_backlog_active:1
repl_backlog_size:1048576
repl_backlog_first_byte_offset:1102
repl_backlog_histlen:15663
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é‡æ–°å¯åŠ¨ redis6379ï¼Œç­‰ä¸€ä¼šå„¿åï¼Œå‘ç° redis6379 ä¸ºä»æœº</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> info replication
<span class="token comment"># Replication</span>
<span class="token comment"># åˆšå¼€å§‹å¯åŠ¨æ—¶ä»æ˜¾ç¤º master</span>
role:master
connected_slaves:0
master_replid:f0f45da62ad3a063372458f647b2c2da24cb35be
master_replid2:0000000000000000000000000000000000000000
master_repl_offset:0
second_repl_offset:-1
repl_backlog_active:0
repl_backlog_size:1048576
repl_backlog_first_byte_offset:0
repl_backlog_histlen:0
<span class="token comment"># ç­‰ä¸€ä¼šå„¿æ˜¾ç¤ºä¸º slave</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> info replication
<span class="token comment"># Replication</span>
role:slave
master_host:127.0.0.1
master_port:6381
master_link_status:up
master_last_io_seconds_ago:1
master_sync_in_progress:0
slave_repl_offset:30913
slave_priority:100
slave_read_only:1
connected_slaves:0
master_replid:d6304564cdf08a1902ada73ec7e6eb309eefe669
master_replid2:0000000000000000000000000000000000000000
master_repl_offset:30913
second_repl_offset:-1
repl_backlog_active:1
repl_backlog_size:1048576
repl_backlog_first_byte_offset:22477
repl_backlog_histlen:8437
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å¤åˆ¶å»¶æ—¶" tabindex="-1"><a class="header-anchor" href="#å¤åˆ¶å»¶æ—¶" aria-hidden="true">#</a> å¤åˆ¶å»¶æ—¶</h3><p><strong>ç”±äºæ‰€æœ‰çš„å†™æ“ä½œéƒ½æ˜¯å…ˆåœ¨ Master ä¸Šæ“ä½œï¼Œç„¶ååŒæ­¥æ›´æ–°åˆ° Slave ä¸Šï¼Œæ‰€ä»¥ä» Master åŒæ­¥åˆ° Slave æœºå™¨æœ‰ä¸€å®šçš„å»¶è¿Ÿï¼Œå½“ç³»ç»Ÿå¾ˆç¹å¿™çš„æ—¶å€™ï¼Œå»¶è¿Ÿé—®é¢˜ä¼šæ›´åŠ ä¸¥é‡ï¼ŒSlave æœºå™¨æ•°é‡çš„å¢åŠ ä¹Ÿä¼šä½¿è¿™ä¸ªé—®é¢˜æ›´åŠ ä¸¥é‡ã€‚</strong></p><h3 id="æ•…éšœæ¢å¤" tabindex="-1"><a class="header-anchor" href="#æ•…éšœæ¢å¤" aria-hidden="true">#</a> æ•…éšœæ¢å¤</h3><h4 id="é€‰æ‹©æ¡ä»¶" tabindex="-1"><a class="header-anchor" href="#é€‰æ‹©æ¡ä»¶" aria-hidden="true">#</a> é€‰æ‹©æ¡ä»¶</h4><p>é€‰ä¸¾çš„ç­–ç•¥ï¼š</p><p>é€‰æ‹©ä¼˜å…ˆçº§é«˜çš„ï¼Œåç§»é‡å¤§çš„ï¼Œrunid æœ€å°çš„æœåŠ¡ã€‚</p><ul><li><p>ä¼˜å…ˆçº§åœ¨ redis.conf ä¸­é»˜è®¤ï¼šslave-priority 100ï¼Œå€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼ˆé«˜ç‰ˆæœ¬é‡‡ç”¨ replica-priorityï¼‰</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># The replica priority is an integer number published by Redis in the INFO</span>
<span class="token comment"># output. It is used by Redis Sentinel in order to select a replica to promote</span>
<span class="token comment"># into a master if the master is no longer working correctly.</span>
<span class="token comment">#</span>
<span class="token comment"># A replica with a low priority number is considered better for promotion, so</span>
<span class="token comment"># for instance if there are three replicas with priority 10, 100, 25 Sentinel</span>
<span class="token comment"># will pick the one with priority 10, that is the lowest.</span>
<span class="token comment">#</span>
<span class="token comment"># However a special priority of 0 marks the replica as not able to perform the</span>
<span class="token comment"># role of master, so a replica with priority of 0 will never be selected by</span>
<span class="token comment"># Redis Sentinel for promotion.</span>
<span class="token comment">#</span>
<span class="token comment"># By default the priority is 100.</span>
replica-priority <span class="token number">100</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>åç§»é‡ï¼šæŒ‡è·å¾—åŸä¸»æœºæ•°æ®æœ€å…¨çš„</p></li><li><p>æ¯ä¸ª redis å®ä¾‹å¯åŠ¨åéƒ½ä¼šéšæœºç”Ÿæˆä¸€ä¸ª40ä½çš„ runid</p></li></ul><p>æŒ‘é€‰å‡ºæ–°çš„ä¸»æœåŠ¡åï¼Œsentinel ä¼šå‘åŸä¸»æœåŠ¡çš„ä»æœåŠ¡å‘é€ slaveof æ–°ä¸»æœºçš„å‘½ä»¤ï¼Œå¤åˆ¶æ–°çš„ masterã€‚</p><p>å½“åŸä¸»æœºé‡æ–°ä¸Šçº¿åï¼Œsentinel åŒæ ·ä¼šå‘é€ slaveof å‘½ä»¤ï¼Œè®©å…¶æˆä¸ºæ–°ä¸»æœºçš„ä»æœºã€‚</p><h2 id="java-ä»£ç å®ç°ä¸»ä»å¤åˆ¶" tabindex="-1"><a class="header-anchor" href="#java-ä»£ç å®ç°ä¸»ä»å¤åˆ¶" aria-hidden="true">#</a> Java ä»£ç å®ç°ä¸»ä»å¤åˆ¶</h2><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">JedisSentinelPool</span> jedisSentinelPool<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">static</span>  <span class="token class-name">Jedis</span> <span class="token function">getJedisFromSentinel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>jedisSentinelPool<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> sentinelSet<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            sentinelSet<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.100.100:26379&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">JedisPoolConfig</span> jedisPoolConfig <span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">JedisPoolConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            jedisPoolConfig<span class="token punctuation">.</span><span class="token function">setMaxTotal</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//æœ€å¤§å¯ç”¨è¿æ¥æ•°</span>
jedisPoolConfig<span class="token punctuation">.</span><span class="token function">setMaxIdle</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//æœ€å¤§é—²ç½®è¿æ¥æ•°</span>
jedisPoolConfig<span class="token punctuation">.</span><span class="token function">setMinIdle</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//æœ€å°é—²ç½®è¿æ¥æ•°</span>
jedisPoolConfig<span class="token punctuation">.</span><span class="token function">setBlockWhenExhausted</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//è¿æ¥è€—å°½æ˜¯å¦ç­‰å¾…</span>
jedisPoolConfig<span class="token punctuation">.</span><span class="token function">setMaxWaitMillis</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//ç­‰å¾…æ—¶é—´</span>
jedisPoolConfig<span class="token punctuation">.</span><span class="token function">setTestOnBorrow</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//å–è¿æ¥çš„æ—¶å€™è¿›è¡Œä¸€ä¸‹æµ‹è¯• ping pong</span>

jedisSentinelPool<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">JedisSentinelPool</span><span class="token punctuation">(</span><span class="token string">&quot;mymaster&quot;</span><span class="token punctuation">,</span>sentinelSet<span class="token punctuation">,</span>jedisPoolConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> jedisSentinelPool<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
<span class="token keyword">return</span> jedisSentinelPool<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="redis-é›†ç¾¤" tabindex="-1"><a class="header-anchor" href="#redis-é›†ç¾¤" aria-hidden="true">#</a> Redis é›†ç¾¤</h1><h2 id="è§£å†³çš„é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#è§£å†³çš„é—®é¢˜" aria-hidden="true">#</a> è§£å†³çš„é—®é¢˜</h2><ul><li><p>å®¹é‡ä¸å¤Ÿï¼ŒRedis æ‰©å®¹é—®é¢˜</p></li><li><p>å¹¶å‘å†™æ“ä½œï¼Œ Redis åˆ†æ‘Šæ“ä½œ</p><p>å¦‚ä¸åŒçš„è¯·æ±‚æ•°æ®ä¼šæ”¾åœ¨ä¸åŒçš„ Redis ä¸­è¿›è¡Œç¼“å­˜ï¼Œæ—©æœŸå¯ä»¥é€šè¿‡<strong>ä»£ç†ä¸»æœº</strong>è¿›è¡Œè§£å†³ã€‚</p></li><li><p>ä½†æ˜¯ Redis3.0 ä¸­æä¾›äº†è§£å†³æ–¹æ¡ˆã€‚å°±æ˜¯ <strong>æ— ä¸­å¿ƒåŒ–é›†ç¾¤é…ç½®</strong>ï¼šæ¯ä¸€ä¸ª Redis æœåŠ¡éƒ½ä¼šè½¬å‘ç»™å…¶ä»–çš„ Redisã€‚</p><figure><img src="/assets/Redisé›†ç¾¤æ— ä¸­å¿ƒåŒ–é…ç½®-32d33265.png" alt="Redisé›†ç¾¤æ— ä¸­å¿ƒåŒ–é…ç½®" tabindex="0" loading="lazy"><figcaption>Redisé›†ç¾¤æ— ä¸­å¿ƒåŒ–é…ç½®</figcaption></figure></li></ul><h2 id="æ­å»ºé›†ç¾¤ç¯å¢ƒ" tabindex="-1"><a class="header-anchor" href="#æ­å»ºé›†ç¾¤ç¯å¢ƒ" aria-hidden="true">#</a> æ­å»ºé›†ç¾¤ç¯å¢ƒ</h2><p>Redis é›†ç¾¤å®ç°äº†å¯¹ Redis çš„æ°´å¹³æ‰©å®¹ï¼Œå³å¯åŠ¨ N ä¸ª redis èŠ‚ç‚¹ï¼Œå°†æ•´ä¸ªæ•°æ®åº“åˆ†å¸ƒå­˜å‚¨åœ¨è¿™ N ä¸ªèŠ‚ç‚¹ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨æ€»æ•°æ®çš„1/Nã€‚</p><p><strong>Redis é›†ç¾¤é€šè¿‡åˆ†åŒºï¼ˆpartitionï¼‰æ¥æä¾›ä¸€å®šç¨‹åº¦çš„å¯ç”¨æ€§ï¼ˆavailabilityï¼‰</strong>ï¼š å³ä½¿é›†ç¾¤ä¸­æœ‰ä¸€éƒ¨åˆ†èŠ‚ç‚¹å¤±æ•ˆæˆ–è€…æ— æ³•è¿›è¡Œé€šè®¯ï¼Œ é›†ç¾¤ä¹Ÿå¯ä»¥ç»§ç»­å¤„ç†å‘½ä»¤è¯·æ±‚ã€‚</p><p>æ­¤å¤„ä»¥ 3 å°ä¸ºä¾‹ã€‚</p><h3 id="ç¬¬ä¸€æ­¥-æ–°å»ºé…ç½®æ–‡ä»¶-1" tabindex="-1"><a class="header-anchor" href="#ç¬¬ä¸€æ­¥-æ–°å»ºé…ç½®æ–‡ä»¶-1" aria-hidden="true">#</a> ç¬¬ä¸€æ­¥ï¼šæ–°å»ºé…ç½®æ–‡ä»¶</h3><p>åœ¨ /opt/redis/redisClusterConf ä¸‹æ–°å»º redis6379.conf é…ç½®</p><p>ä½¿ç”¨ç«¯å£ï¼š6379 6380 6381 6389 6390 6391</p><p><strong>é…ç½®ä¿¡æ¯ï¼š</strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>include /etc/redis.conf
pidfile /var/run/redis_6379.pid
port <span class="token number">6379</span>
dbfilename dump6379.rdb

<span class="token comment"># æ‰“å¼€é›†ç¾¤æ¨¡å¼</span>
cluster-enabled <span class="token function">yes</span>
<span class="token comment"># è®¾å®šèŠ‚ç‚¹é…ç½®æ–‡ä»¶å</span>
cluster-config-file nodes-6379.conf
<span class="token comment"># è®¾å®šèŠ‚ç‚¹å¤±è”æ—¶é—´ï¼Œè¶…è¿‡è¯¥æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œé›†ç¾¤è‡ªåŠ¨è¿›è¡Œä¸»ä»åˆ‡æ¢</span>
cluster-node-timeout <span class="token number">15000</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ‹·è´å¤šä»½æ–‡ä»¶ï¼Œå¹¶åœ¨ vim ä¸­ä½¿ç”¨å‘½ä»¤æ›¿æ¢ :%s/6379/6380</strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost redisClusterConf<span class="token punctuation">]</span><span class="token comment"># ll</span>
æ€»ç”¨é‡ <span class="token number">24</span>
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">318</span> <span class="token number">10</span>æœˆ  <span class="token number">8</span> <span class="token number">17</span>:40 redis6379.conf
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">318</span> <span class="token number">10</span>æœˆ  <span class="token number">8</span> <span class="token number">17</span>:42 redis6380.conf
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">318</span> <span class="token number">10</span>æœˆ  <span class="token number">8</span> <span class="token number">17</span>:42 redis6381.conf
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">318</span> <span class="token number">10</span>æœˆ  <span class="token number">8</span> <span class="token number">17</span>:42 redis6389.conf
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">318</span> <span class="token number">10</span>æœˆ  <span class="token number">8</span> <span class="token number">17</span>:43 redis6390.conf
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">318</span> <span class="token number">10</span>æœˆ  <span class="token number">8</span> <span class="token number">17</span>:44 redis6391.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç¬¬äºŒæ­¥-å¯åŠ¨-6-ä¸ªå®ä¾‹" tabindex="-1"><a class="header-anchor" href="#ç¬¬äºŒæ­¥-å¯åŠ¨-6-ä¸ªå®ä¾‹" aria-hidden="true">#</a> ç¬¬äºŒæ­¥ï¼šå¯åŠ¨ 6 ä¸ªå®ä¾‹</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost redisClusterConf<span class="token punctuation">]</span><span class="token comment"># redis-server /opt/redis/redisClusterConf/redis6379.conf</span>
<span class="token punctuation">[</span>root@localhost redisClusterConf<span class="token punctuation">]</span><span class="token comment"># redis-server /opt/redis/redisClusterConf/redis6380.conf</span>
<span class="token punctuation">[</span>root@localhost redisClusterConf<span class="token punctuation">]</span><span class="token comment"># redis-server /opt/redis/redisClusterConf/redis6381.conf</span>
<span class="token punctuation">[</span>root@localhost redisClusterConf<span class="token punctuation">]</span><span class="token comment"># redis-server /opt/redis/redisClusterConf/redis6389.conf</span>
<span class="token punctuation">[</span>root@localhost redisClusterConf<span class="token punctuation">]</span><span class="token comment"># redis-server /opt/redis/redisClusterConf/redis6390.conf</span>
<span class="token punctuation">[</span>root@localhost redisClusterConf<span class="token punctuation">]</span><span class="token comment"># redis-server /opt/redis/redisClusterConf/redis6391.conf</span>
<span class="token punctuation">[</span>root@localhost redisClusterConf<span class="token punctuation">]</span><span class="token comment"># ps -ef|grep redis</span>
root       <span class="token number">1620</span>      <span class="token number">1</span>  <span class="token number">0</span> <span class="token number">17</span>:58 ?        00:00:00 redis-server *:6379 <span class="token punctuation">[</span>cluster<span class="token punctuation">]</span>
root       <span class="token number">1626</span>      <span class="token number">1</span>  <span class="token number">0</span> <span class="token number">17</span>:58 ?        00:00:00 redis-server *:6380 <span class="token punctuation">[</span>cluster<span class="token punctuation">]</span>
root       <span class="token number">1632</span>      <span class="token number">1</span>  <span class="token number">0</span> <span class="token number">17</span>:58 ?        00:00:00 redis-server *:6381 <span class="token punctuation">[</span>cluster<span class="token punctuation">]</span>
root       <span class="token number">1638</span>      <span class="token number">1</span>  <span class="token number">1</span> <span class="token number">17</span>:58 ?        00:00:00 redis-server *:6389 <span class="token punctuation">[</span>cluster<span class="token punctuation">]</span>
root       <span class="token number">1644</span>      <span class="token number">1</span>  <span class="token number">1</span> <span class="token number">17</span>:58 ?        00:00:00 redis-server *:6390 <span class="token punctuation">[</span>cluster<span class="token punctuation">]</span>
root       <span class="token number">1650</span>      <span class="token number">1</span>  <span class="token number">1</span> <span class="token number">17</span>:58 ?        00:00:00 redis-server *:6391 <span class="token punctuation">[</span>cluster<span class="token punctuation">]</span>
root       <span class="token number">1656</span>   <span class="token number">1254</span>  <span class="token number">0</span> <span class="token number">17</span>:59 pts/0    00:00:00 <span class="token function">grep</span> <span class="token parameter variable">--color</span><span class="token operator">=</span>auto redis
<span class="token punctuation">[</span>root@localhost redisClusterConf<span class="token punctuation">]</span><span class="token comment">#</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç¬¬ä¸‰æ­¥-å¯åŠ¨é›†ç¾¤" tabindex="-1"><a class="header-anchor" href="#ç¬¬ä¸‰æ­¥-å¯åŠ¨é›†ç¾¤" aria-hidden="true">#</a> ç¬¬ä¸‰æ­¥ï¼šå¯åŠ¨é›†ç¾¤</h3><p>Redis é›†ç¾¤éœ€è¦ ruby ç¯å¢ƒï¼Œé«˜ç‰ˆæœ¬çš„ Redis å·²ç»é›†æˆäº† ruby</p><p>å‘½ä»¤ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost redisClusterConf<span class="token punctuation">]</span><span class="token comment"># redis-cli --cluster create --cluster-replicas 1 192.168.100.100:6379 192.168.100.100:6380 192.168.100.100:6381 192.168.100.100:6389 192.168.100.100:6390 192.168.100.100:6391</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æ³¨æ„ï¼šæ­¤å¤„ä¸è¦ç”¨ 127.0.0.1ï¼Œ è¯·ç”¨çœŸå® IP åœ°å€ï¼Œ<strong>--replicas 1 é‡‡ç”¨æœ€ç®€å•çš„æ–¹å¼é…ç½®é›†ç¾¤ï¼ˆä¸€å°ä¸»æœºï¼Œä¸€å°ä»æœºï¼Œæ­£å¥½ä¸‰ç»„ï¼‰</strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost redisClusterConf<span class="token punctuation">]</span><span class="token comment"># redis-cli --cluster create --cluster-replicas 1 192.168.100.100:6379 192.168.100.100:6380 192.168.100.100:6381 192.168.100.100:6389 192.168.100.100:6390 192.168.100.100:6391</span>

<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Performing <span class="token builtin class-name">hash</span> slots allocation on <span class="token number">6</span> nodes<span class="token punctuation">..</span>.
Master<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> -<span class="token operator">&gt;</span> Slots <span class="token number">0</span> - <span class="token number">5460</span>
Master<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> -<span class="token operator">&gt;</span> Slots <span class="token number">5461</span> - <span class="token number">10922</span>
Master<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> -<span class="token operator">&gt;</span> Slots <span class="token number">10923</span> - <span class="token number">16383</span>
Adding replica <span class="token number">192.168</span>.100.100:6390 to <span class="token number">192.168</span>.100.100:6379
Adding replica <span class="token number">192.168</span>.100.100:6391 to <span class="token number">192.168</span>.100.100:6380
Adding replica <span class="token number">192.168</span>.100.100:6389 to <span class="token number">192.168</span>.100.100:6381
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Trying to optimize slaves allocation <span class="token keyword">for</span> anti-affinity
<span class="token punctuation">[</span>WARNING<span class="token punctuation">]</span> Some slaves are <span class="token keyword">in</span> the same <span class="token function">host</span> as their master
M: a0db3d6715900a287d3222ae4b40cc43f8857a95 <span class="token number">192.168</span>.100.100:6379
   slots:<span class="token punctuation">[</span><span class="token number">0</span>-5460<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
M: e37ee97bc6f1479f01515f51dc595ede9a21a0de <span class="token number">192.168</span>.100.100:6380
   slots:<span class="token punctuation">[</span><span class="token number">5461</span>-10922<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5462</span> slots<span class="token punctuation">)</span> master
M: 622309a93a73692b81b62481c89c5098da6232f4 <span class="token number">192.168</span>.100.100:6381
   slots:<span class="token punctuation">[</span><span class="token number">10923</span>-16383<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
S: 2a7798be8210b18bac7bbdbaed7a51d76e9a0a59 <span class="token number">192.168</span>.100.100:6389
   replicates 622309a93a73692b81b62481c89c5098da6232f4
S: d265240801f512f9df68562029dc6df65afe6ddc <span class="token number">192.168</span>.100.100:6390
   replicates a0db3d6715900a287d3222ae4b40cc43f8857a95
S: dc245aad961e75cb71d0ff86de5f83aa3c4bee22 <span class="token number">192.168</span>.100.100:6391
   replicates e37ee97bc6f1479f01515f51dc595ede9a21a0de
Can I <span class="token builtin class-name">set</span> the above configuration? <span class="token punctuation">(</span>type <span class="token string">&#39;yes&#39;</span> to accept<span class="token punctuation">)</span>: <span class="token function">yes</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Nodes configuration updated
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Assign a different config epoch to each <span class="token function">node</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Sending CLUSTER MEET messages to <span class="token function">join</span> the cluster
Waiting <span class="token keyword">for</span> the cluster to <span class="token function">join</span>
<span class="token builtin class-name">.</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Performing Cluster Check <span class="token punctuation">(</span>using <span class="token function">node</span> <span class="token number">192.168</span>.100.100:6379<span class="token punctuation">)</span>
M: a0db3d6715900a287d3222ae4b40cc43f8857a95 <span class="token number">192.168</span>.100.100:6379
   slots:<span class="token punctuation">[</span><span class="token number">0</span>-5460<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
S: dc245aad961e75cb71d0ff86de5f83aa3c4bee22 <span class="token number">192.168</span>.100.100:6391
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates e37ee97bc6f1479f01515f51dc595ede9a21a0de
S: 2a7798be8210b18bac7bbdbaed7a51d76e9a0a59 <span class="token number">192.168</span>.100.100:6389
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 622309a93a73692b81b62481c89c5098da6232f4
M: 622309a93a73692b81b62481c89c5098da6232f4 <span class="token number">192.168</span>.100.100:6381
   slots:<span class="token punctuation">[</span><span class="token number">10923</span>-16383<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
S: d265240801f512f9df68562029dc6df65afe6ddc <span class="token number">192.168</span>.100.100:6390
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates a0db3d6715900a287d3222ae4b40cc43f8857a95
M: e37ee97bc6f1479f01515f51dc595ede9a21a0de <span class="token number">192.168</span>.100.100:6380
   slots:<span class="token punctuation">[</span><span class="token number">5461</span>-10922<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5462</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All nodes agree about slots configuration.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check <span class="token keyword">for</span> <span class="token function">open</span> slots<span class="token punctuation">..</span>.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check slots coverage<span class="token punctuation">..</span>.
<span class="token comment"># æ³¨æ„ slot ä¸º 16384</span>
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All <span class="token number">16384</span> slots covered.
<span class="token punctuation">[</span>root@localhost redisClusterConf<span class="token punctuation">]</span><span class="token comment">#</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç¬¬å››æ­¥-è¿æ¥" tabindex="-1"><a class="header-anchor" href="#ç¬¬å››æ­¥-è¿æ¥" aria-hidden="true">#</a> ç¬¬å››æ­¥ï¼šè¿æ¥</h3><p><strong>æ™®é€šæ–¹å¼ç™»å½•</strong></p><p>â€‹ å¯èƒ½ç›´æ¥è¿›å…¥è¯»ä¸»æœºï¼Œå­˜å‚¨æ•°æ®æ—¶ï¼Œä¼šå‡ºç° MOVED é‡å®šå‘æ“ä½œã€‚åº”è¯¥ä»¥é›†ç¾¤æ–¹å¼ç™»å½•ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost redisClusterConf<span class="token punctuation">]</span><span class="token comment"># redis-cli -p 6379</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> keys *
<span class="token punctuation">(</span>empty array<span class="token punctuation">)</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">set</span> k1 v1
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> MOVED <span class="token number">12706</span> <span class="token number">192.168</span>.100.100:6381
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>é›†ç¾¤æ–¹å¼ç™»å½•</strong></p><p><strong>-c</strong> <strong>é‡‡ç”¨é›†ç¾¤ç­–ç•¥è¿æ¥ï¼Œè®¾ç½®æ•°æ®ä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°ç›¸åº”çš„å†™ä¸»æœº</strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># redis-cli -c -p 6379</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> keys *
<span class="token punctuation">(</span>empty array<span class="token punctuation">)</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">set</span> k1 v1
-<span class="token operator">&gt;</span> Redirected to slot <span class="token punctuation">[</span><span class="token number">12706</span><span class="token punctuation">]</span> located at <span class="token number">192.168</span>.100.100:6381
OK
<span class="token number">192.168</span>.100.100:638<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿æ¥é›†ç¾¤ï¼Œå†™å…¥æ•°æ®æ—¶ï¼Œä¼šå°†æ•°æ®æ”¾å…¥ slot ä¸º 12706 ä¸­ï¼Œå¹¶é‡å®šå‘åˆ°è¯¥ä¸»æœºã€‚</p><h3 id="æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯" tabindex="-1"><a class="header-anchor" href="#æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯" aria-hidden="true">#</a> æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯</h3><p>é€šè¿‡ <strong>cluster nodes</strong> å‘½ä»¤æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯ï¼š</p><p>myself è¡¨ç¤ºå½“å‰ç™»å½•çš„ä¸»æœº</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">192.168</span>.100.100:638<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> cluster nodes
d58b3cbb999444e6f1d14ff77a8e285972b4255e <span class="token number">192.168</span>.100.100:6391@16391 slave fbfda518ed93656657965b5a7a8b36394c107641 <span class="token number">0</span> <span class="token number">1692270860991</span> <span class="token number">3</span> connected
8586a71a7496be626a2e0113db3f1248dfa6e856 <span class="token number">192.168</span>.100.100:6380@16380 master - <span class="token number">0</span> <span class="token number">1692270863091</span> <span class="token number">2</span> connected <span class="token number">5461</span>-10922
cb4627d4d0c15333131c60b59006a340625364fb <span class="token number">192.168</span>.100.100:6390@16390 slave 8586a71a7496be626a2e0113db3f1248dfa6e856 <span class="token number">0</span> <span class="token number">1692270860000</span> <span class="token number">2</span> connected
c8679dad6e06520599fc4af76f0b26be70cb2df7 <span class="token number">192.168</span>.100.100:6379@16379 master - <span class="token number">0</span> <span class="token number">1692270862078</span> <span class="token number">1</span> connected <span class="token number">0</span>-5460
d400f02a38d346b96d12d85ae2cf008a08caba38 <span class="token number">192.168</span>.100.100:6389@16389 slave c8679dad6e06520599fc4af76f0b26be70cb2df7 <span class="token number">0</span> <span class="token number">1692270860000</span> <span class="token number">1</span> connected
<span class="token comment"># myself è¡¨ç¤ºå½“å‰ç™»å½•çš„ä¸»æœº</span>
fbfda518ed93656657965b5a7a8b36394c107641 <span class="token number">192.168</span>.100.100:6381@16381 myself,master - <span class="token number">0</span> <span class="token number">1692270858000</span> <span class="token number">3</span> connected <span class="token number">10923</span>-16383

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="redis-cluster-èŠ‚ç‚¹åˆ†é…" tabindex="-1"><a class="header-anchor" href="#redis-cluster-èŠ‚ç‚¹åˆ†é…" aria-hidden="true">#</a> redis cluster èŠ‚ç‚¹åˆ†é…</h3><p>é€‰é¡¹ <strong>--cluster-replicas 1</strong> è¡¨ç¤ºï¼šå¸Œæœ›ä¸ºé›†ç¾¤ä¸­çš„æ¯ä¸ªä¸»èŠ‚ç‚¹åˆ›å»ºä¸€ä¸ªä»èŠ‚ç‚¹ã€‚</p><p>åˆ†é…åŸåˆ™å°½é‡ä¿è¯æ¯ä¸ªä¸»æ•°æ®åº“è¿è¡Œåœ¨ä¸åŒçš„ IP åœ°å€ï¼Œæ¯ä¸ªä»åº“å’Œä¸»åº“ä¸åœ¨ä¸€ä¸ª IP åœ°å€ä¸Šã€‚</p><h2 id="slots" tabindex="-1"><a class="header-anchor" href="#slots" aria-hidden="true">#</a> slots</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All nodes agree about slots configuration.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check <span class="token keyword">for</span> <span class="token function">open</span> slots<span class="token punctuation">..</span>.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check slots coverage<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All <span class="token number">16384</span> slots covered.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li><p>ä¸€ä¸ª Redis é›†ç¾¤åŒ…å« 16384 ä¸ªæ’æ§½ï¼ˆhash slotï¼‰ï¼Œ æ•°æ®åº“ä¸­çš„æ¯ä¸ªé”®éƒ½å±äºè¿™ 16384 ä¸ªæ’æ§½çš„å…¶ä¸­ä¸€ä¸ªã€‚</p></li><li><p>é›†ç¾¤ä½¿ç”¨å…¬å¼ CRC16(key) % 16384 æ¥è®¡ç®—é”® key å±äºå“ªä¸ªæ§½ï¼Œ CRC16(key) è¯­å¥ç”¨äºè®¡ç®—é”® key çš„ CRC16 æ ¡éªŒå’Œ</p></li><li><p>é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£å¤„ç†ä¸€éƒ¨åˆ†æ’æ§½ã€‚ å¦‚ä¸€ä¸ªé›†ç¾¤ä¸­ï¼š</p><p>èŠ‚ç‚¹ A è´Ÿè´£å¤„ç† 0 å·è‡³ 5460 å·æ’æ§½ã€‚</p><p>èŠ‚ç‚¹ B è´Ÿè´£å¤„ç† 5461 å·è‡³ 10922 å·æ’æ§½ã€‚</p><p>èŠ‚ç‚¹ C è´Ÿè´£å¤„ç† 10923 å·è‡³ 16383 å·æ’æ§½ã€‚</p></li></ol><h2 id="é›†ç¾¤ä¸­è¯»å†™æ•°æ®" tabindex="-1"><a class="header-anchor" href="#é›†ç¾¤ä¸­è¯»å†™æ•°æ®" aria-hidden="true">#</a> é›†ç¾¤ä¸­è¯»å†™æ•°æ®</h2><ul><li><p>åœ¨ redis-cli æ¯æ¬¡å½•å…¥ã€æŸ¥è¯¢é”®å€¼ï¼Œredis éƒ½ä¼šè®¡ç®—å‡ºè¯¥ key åº”è¯¥é€å¾€çš„æ’æ§½ï¼Œå¦‚æœä¸æ˜¯è¯¥å®¢æˆ·ç«¯å¯¹åº”æœåŠ¡å™¨çš„æ’æ§½ï¼Œredis ä¼šæŠ¥é”™ï¼Œå¹¶å‘ŠçŸ¥åº”å‰å¾€çš„ redis å®ä¾‹åœ°å€å’Œç«¯å£ã€‚</p></li><li><p>redis-cli å®¢æˆ·ç«¯æä¾›äº† â€“c å‚æ•°å®ç°è‡ªåŠ¨é‡å®šå‘ã€‚</p><p>å¦‚ redis-cli -c â€“p 6379 ç™»å…¥åï¼Œå†å½•å…¥ã€æŸ¥è¯¢é”®å€¼å¯¹<strong>å¯ä»¥è‡ªåŠ¨é‡å®šå‘</strong>ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost redisClusterConf<span class="token punctuation">]</span><span class="token comment"># redis-cli -c -p 6379</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">set</span> k1 v1
-<span class="token operator">&gt;</span> Redirected to slot <span class="token punctuation">[</span><span class="token number">12706</span><span class="token punctuation">]</span> located at <span class="token number">192.168</span>.100.100:6381
OK
<span class="token number">192.168</span>.100.100:638<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> get k1
<span class="token string">&quot;v1&quot;</span>
<span class="token punctuation">[</span>root@localhost redisClusterConf<span class="token punctuation">]</span><span class="token comment">#</span>
<span class="token punctuation">[</span>root@localhost redisClusterConf<span class="token punctuation">]</span><span class="token comment"># redis-cli -c -p 6379</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get k1
-<span class="token operator">&gt;</span> Redirected to slot <span class="token punctuation">[</span><span class="token number">12706</span><span class="token punctuation">]</span> located at <span class="token number">192.168</span>.100.100:6381
<span class="token string">&quot;v1&quot;</span>
<span class="token number">192.168</span>.100.100:638<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>ä¸åœ¨ä¸€ä¸ª slot ä¸‹çš„é”®å€¼ï¼Œæ˜¯ä¸èƒ½ä½¿ç”¨ mgetï¼Œmset ç­‰å¤šé”®æ“ä½œï¼Œä½†å¯ä»¥é€šè¿‡ { } æ¥å®šä¹‰ç»„çš„æ¦‚å¿µï¼Œä»è€Œä½¿ key ä¸­ { } å†…ç›¸åŒå†…å®¹çš„é”®å€¼å¯¹æ”¾åˆ°ä¸€ä¸ª slot ä¸­å»ï¼Œå¯ä»¥é€šè¿‡ keys * æŸ¥çœ‹å½“å‰ä¸»æœºçš„é”®å€¼å†…å®¹</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> mset k1 v1 k2 v2 k3 v3
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> CROSSSLOT Keys <span class="token keyword">in</span> request don&#39;t <span class="token builtin class-name">hash</span> to the same slot
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> mset k1<span class="token punctuation">{</span>cust<span class="token punctuation">}</span> v1 k2<span class="token punctuation">{</span>cust<span class="token punctuation">}</span> v2 k3<span class="token punctuation">{</span>cust<span class="token punctuation">}</span> v3
OK
<span class="token number">192.168</span>.100.100:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> keys *
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;k2{cust}&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;k1{cust}&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;k3{cust}&quot;</span>
<span class="token number">192.168</span>.100.100:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get k1<span class="token punctuation">{</span>cust<span class="token punctuation">}</span>
<span class="token string">&quot;v1&quot;</span>
<span class="token number">192.168</span>.100.100:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get k2<span class="token punctuation">{</span>cust<span class="token punctuation">}</span>
<span class="token string">&quot;v2&quot;</span>
<span class="token number">192.168</span>.100.100:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get k3<span class="token punctuation">{</span>cust<span class="token punctuation">}</span>
<span class="token string">&quot;v3&quot;</span>
<span class="token number">192.168</span>.100.100:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> cluster keyslot k2<span class="token punctuation">{</span>cust<span class="token punctuation">}</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">4847</span>
<span class="token number">192.168</span>.100.100:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> cluster keyslot k1<span class="token punctuation">{</span>cust<span class="token punctuation">}</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">4847</span>
<span class="token number">192.168</span>.100.100:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> cluster keyslot k3<span class="token punctuation">{</span>cust<span class="token punctuation">}</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">4847</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>å¸¸è§å‘½ä»¤</p><ul><li><code>cluster keyslot cust</code> æŸ¥çœ‹é”® cust æ‰€åœ¨çš„æ’æ§½</li><li><code> cluster countKeysinslot &lt;slot&gt;</code> è¿”å›æ’æ§½çš„é”®çš„ä¸ªæ•°</li><li><code>CLUSTER GETKEYSINSLOT &lt;slot&gt;&lt;count&gt; è¿”å› count ä¸ª slot æ§½ä¸­çš„é”®ã€‚</code></li></ul><p><strong>æ³¨æ„ï¼šå„å®¢æˆ·ç«¯åªèƒ½çœ‹è‡ªå·±æ’æ§½èŒƒå›´å†…çš„å€¼ã€‚</strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> cluster keyslot k1
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">12706</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> CLUSTER COUNTKEYSINSLOT <span class="token number">12706</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>

<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> cluster keyslot cust
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">4847</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> cluster countKeysinslot <span class="token number">4847</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> CLUSTER GETKEYSINSLOT <span class="token number">4847</span> <span class="token number">5</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;k1{cust}&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;k2{cust}&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;k3{cust}&quot;</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get k1<span class="token punctuation">{</span>cust<span class="token punctuation">}</span>
<span class="token string">&quot;v1&quot;</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get k1
-<span class="token operator">&gt;</span> Redirected to slot <span class="token punctuation">[</span><span class="token number">12706</span><span class="token punctuation">]</span> located at <span class="token number">192.168</span>.100.100:6381
<span class="token string">&quot;v1&quot;</span>
<span class="token number">192.168</span>.100.100:638<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>
<span class="token punctuation">[</span>root@localhost redisClusterConf<span class="token punctuation">]</span><span class="token comment">#</span>
<span class="token number">192.168</span>.100.100:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> CLUSTER COUNTKEYSINSLOT <span class="token number">12706</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>
<span class="token number">192.168</span>.100.100:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span>
<span class="token punctuation">[</span>root@localhost redisClusterConf<span class="token punctuation">]</span><span class="token comment"># redis-cli -c -p 6381</span>
<span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> CLUSTER COUNTKEYSINSLOT <span class="token number">12706</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h2 id="æ•…éšœæ¢å¤-1" tabindex="-1"><a class="header-anchor" href="#æ•…éšœæ¢å¤-1" aria-hidden="true">#</a> æ•…éšœæ¢å¤</h2><p>å¦‚æœä¸»èŠ‚ç‚¹ä¸‹çº¿ï¼Œä»èŠ‚ç‚¹ä¼šå‡ä¸ºä¸»èŠ‚ç‚¹ï¼Œä¸»èŠ‚ç‚¹æ¢å¤åï¼Œä¸»èŠ‚ç‚¹ä¼šå˜ä¸ºä»æœºã€‚</p><p>ç¤ºä¾‹ï¼šå…³æ‰ 6379ï¼Œåˆ™ 6389 æˆä¸ºä¸»æœºï¼Œé‡å¯ 6379 ä¹‹åï¼Œ6379 æˆä¸ºä¸»æœº</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> cluster nodes
d400f02a38d346b96d12d85ae2cf008a08caba38 <span class="token number">192.168</span>.100.100:6389@16389 slave c8679dad6e06520599fc4af76f0b26be70cb2df7 <span class="token number">0</span> <span class="token number">1692277887747</span> <span class="token number">1</span> connected
fbfda518ed93656657965b5a7a8b36394c107641 <span class="token number">192.168</span>.100.100:6381@16381 master - <span class="token number">0</span> <span class="token number">1692277889000</span> <span class="token number">3</span> connected <span class="token number">10923</span>-16383
c8679dad6e06520599fc4af76f0b26be70cb2df7 <span class="token number">192.168</span>.100.100:6379@16379 myself,master - <span class="token number">0</span> <span class="token number">1692277889000</span> <span class="token number">1</span> connected <span class="token number">0</span>-5460
d58b3cbb999444e6f1d14ff77a8e285972b4255e <span class="token number">192.168</span>.100.100:6391@16391 slave fbfda518ed93656657965b5a7a8b36394c107641 <span class="token number">0</span> <span class="token number">1692277888000</span> <span class="token number">3</span> connected
8586a71a7496be626a2e0113db3f1248dfa6e856 <span class="token number">192.168</span>.100.100:6380@16380 master - <span class="token number">0</span> <span class="token number">1692277889817</span> <span class="token number">2</span> connected <span class="token number">5461</span>-10922
cb4627d4d0c15333131c60b59006a340625364fb <span class="token number">192.168</span>.100.100:6390@16390 slave 8586a71a7496be626a2e0113db3f1248dfa6e856 <span class="token number">0</span> <span class="token number">1692277888808</span> <span class="token number">2</span> connected
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token function">shutdown</span>
not connected<span class="token operator">&gt;</span>
<span class="token punctuation">[</span>root@localhost redisClusterConf<span class="token punctuation">]</span><span class="token comment"># redis-cli -c -p 6380</span>
<span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> cluster nodes
8586a71a7496be626a2e0113db3f1248dfa6e856 <span class="token number">192.168</span>.100.100:6380@16380 myself,master - <span class="token number">0</span> <span class="token number">1692278026000</span> <span class="token number">2</span> connected <span class="token number">5461</span>-10922
d58b3cbb999444e6f1d14ff77a8e285972b4255e <span class="token number">192.168</span>.100.100:6391@16391 slave fbfda518ed93656657965b5a7a8b36394c107641 <span class="token number">0</span> <span class="token number">1692278028814</span> <span class="token number">3</span> connected
fbfda518ed93656657965b5a7a8b36394c107641 <span class="token number">192.168</span>.100.100:6381@16381 master - <span class="token number">0</span> <span class="token number">1692278028000</span> <span class="token number">3</span> connected <span class="token number">10923</span>-16383
d400f02a38d346b96d12d85ae2cf008a08caba38 <span class="token number">192.168</span>.100.100:6389@16389 slave c8679dad6e06520599fc4af76f0b26be70cb2df7 <span class="token number">0</span> <span class="token number">1692278027000</span> <span class="token number">1</span> connected
c8679dad6e06520599fc4af76f0b26be70cb2df7 <span class="token number">192.168</span>.100.100:6379@16379 master - <span class="token number">1692278014952</span> <span class="token number">1692278007377</span> <span class="token number">1</span> disconnected <span class="token number">0</span>-5460
cb4627d4d0c15333131c60b59006a340625364fb <span class="token number">192.168</span>.100.100:6390@16390 slave 8586a71a7496be626a2e0113db3f1248dfa6e856 <span class="token number">0</span> <span class="token number">1692278027792</span> <span class="token number">2</span> connected
<span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> cluster nodes
8586a71a7496be626a2e0113db3f1248dfa6e856 <span class="token number">192.168</span>.100.100:6380@16380 myself,master - <span class="token number">0</span> <span class="token number">1692278116000</span> <span class="token number">2</span> connected <span class="token number">5461</span>-10922
d58b3cbb999444e6f1d14ff77a8e285972b4255e <span class="token number">192.168</span>.100.100:6391@16391 slave fbfda518ed93656657965b5a7a8b36394c107641 <span class="token number">0</span> <span class="token number">1692278118000</span> <span class="token number">3</span> connected
fbfda518ed93656657965b5a7a8b36394c107641 <span class="token number">192.168</span>.100.100:6381@16381 master - <span class="token number">0</span> <span class="token number">1692278117964</span> <span class="token number">3</span> connected <span class="token number">10923</span>-16383
d400f02a38d346b96d12d85ae2cf008a08caba38 <span class="token number">192.168</span>.100.100:6389@16389 master - <span class="token number">0</span> <span class="token number">1692278117000</span> <span class="token number">7</span> connected <span class="token number">0</span>-5460
c8679dad6e06520599fc4af76f0b26be70cb2df7 <span class="token number">192.168</span>.100.100:6379@16379 master,fail - <span class="token number">1692278014952</span> <span class="token number">1692278007377</span> <span class="token number">1</span> disconnected
cb4627d4d0c15333131c60b59006a340625364fb <span class="token number">192.168</span>.100.100:6390@16390 slave 8586a71a7496be626a2e0113db3f1248dfa6e856 <span class="token number">0</span> <span class="token number">1692278118989</span> <span class="token number">2</span> connected
<span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>
<span class="token comment"># é‡å¯ redis6379</span>
<span class="token punctuation">[</span>root@localhost redisClusterConf<span class="token punctuation">]</span><span class="token comment"># redis-server /opt/redis/redisClusterConf/redis6379.conf</span>
<span class="token punctuation">[</span>root@localhost redisClusterConf<span class="token punctuation">]</span><span class="token comment"># redis-cli -c -p 6379</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> cluster nodes
d400f02a38d346b96d12d85ae2cf008a08caba38 <span class="token number">192.168</span>.100.100:6389@16389 master - <span class="token number">0</span> <span class="token number">1692278176000</span> <span class="token number">7</span> connected <span class="token number">0</span>-5460
fbfda518ed93656657965b5a7a8b36394c107641 <span class="token number">192.168</span>.100.100:6381@16381 master - <span class="token number">0</span> <span class="token number">1692278174013</span> <span class="token number">3</span> connected <span class="token number">10923</span>-16383
d58b3cbb999444e6f1d14ff77a8e285972b4255e <span class="token number">192.168</span>.100.100:6391@16391 slave fbfda518ed93656657965b5a7a8b36394c107641 <span class="token number">0</span> <span class="token number">1692278174000</span> <span class="token number">3</span> connected
8586a71a7496be626a2e0113db3f1248dfa6e856 <span class="token number">192.168</span>.100.100:6380@16380 master - <span class="token number">0</span> <span class="token number">1692278174000</span> <span class="token number">2</span> connected <span class="token number">5461</span>-10922
c8679dad6e06520599fc4af76f0b26be70cb2df7 <span class="token number">192.168</span>.100.100:6379@16379 myself,slave d400f02a38d346b96d12d85ae2cf008a08caba38 <span class="token number">0</span> <span class="token number">1692278173000</span> <span class="token number">7</span> connected
cb4627d4d0c15333131c60b59006a340625364fb <span class="token number">192.168</span>.100.100:6390@16390 slave 8586a71a7496be626a2e0113db3f1248dfa6e856 <span class="token number">0</span> <span class="token number">1692278176141</span> <span class="token number">2</span> connected
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœæ‰€æœ‰æŸä¸€æ®µæ’æ§½çš„ä¸»ä»èŠ‚ç‚¹éƒ½å®•æ‰ï¼ŒredisæœåŠ¡æ˜¯å¦è¿˜èƒ½ç»§ç»­?</p><p>å¦‚æœæŸä¸€æ®µæ’æ§½çš„ä¸»ä»éƒ½æŒ‚æ‰ï¼Œè€Œ cluster-require-full-coverage ä¸º yes ï¼Œé‚£ä¹ˆæ•´ä¸ªé›†ç¾¤éƒ½æŒ‚æ‰</p><p>å¦‚æœæŸä¸€æ®µæ’æ§½çš„ä¸»ä»éƒ½æŒ‚æ‰ï¼Œè€Œ cluster-require-full-coverage ä¸º no ï¼Œé‚£ä¹ˆè¯¥æ’æ§½æ•°æ®å…¨éƒ½ä¸èƒ½ä½¿ç”¨ï¼Œä¹Ÿæ— æ³•å­˜å‚¨ã€‚</p><p><strong>redis.conf</strong> ä¸­çš„å‚æ•° <strong>cluster-require-full-coverage</strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># By default Redis Cluster nodes stop accepting queries if they detect there</span>
<span class="token comment"># is at least a hash slot uncovered (no available node is serving it).</span>
<span class="token comment"># This way if the cluster is partially down (for example a range of hash slots</span>
<span class="token comment"># are no longer covered) all the cluster becomes, eventually, unavailable.</span>
<span class="token comment"># It automatically returns available as soon as all the slots are covered again.</span>
<span class="token comment">#</span>
<span class="token comment"># However sometimes you want the subset of the cluster which is working,</span>
<span class="token comment"># to continue to accept queries for the part of the key space that is still</span>
<span class="token comment"># covered. In order to do so, just set the cluster-require-full-coverage</span>
<span class="token comment"># option to no.</span>
<span class="token comment">#</span>
<span class="token comment"># cluster-require-full-coverage yes</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="é›†ç¾¤çš„-jedis-å¼€å‘" tabindex="-1"><a class="header-anchor" href="#é›†ç¾¤çš„-jedis-å¼€å‘" aria-hidden="true">#</a> é›†ç¾¤çš„ Jedis å¼€å‘</h2><p>å³ä½¿è¿æ¥çš„ä¸æ˜¯ä¸»æœºï¼Œé›†ç¾¤ä¼šè‡ªåŠ¨åˆ‡æ¢ä¸»æœºå­˜å‚¨ã€‚ä¸»æœºå†™ï¼Œä»æœºè¯»ã€‚</p><p>æ— ä¸­å¿ƒåŒ–ä¸»ä»é›†ç¾¤ã€‚æ— è®ºä»å“ªå°ä¸»æœºå†™çš„æ•°æ®ï¼Œå…¶ä»–ä¸»æœºä¸Šéƒ½èƒ½è¯»åˆ°æ•°æ®ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">redis<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>jedis<span class="token punctuation">.</span></span><span class="token class-name">HostAndPort</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">redis<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>jedis<span class="token punctuation">.</span></span><span class="token class-name">JedisCluster</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashSet</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * Redis é›†ç¾¤æµ‹è¯•ï¼šå…³é—­é˜²ç«å¢™
 * å³ä½¿è¿æ¥çš„ä¸æ˜¯ä¸»æœºï¼Œé›†ç¾¤ä¼šè‡ªåŠ¨åˆ‡æ¢ä¸»æœºå­˜å‚¨ã€‚ä¸»æœºå†™ï¼Œä»æœºè¯»ã€‚
 * æ— ä¸­å¿ƒåŒ–ä¸»ä»é›†ç¾¤ã€‚æ— è®ºä»å“ªå°ä¸»æœºå†™çš„æ•°æ®ï¼Œå…¶ä»–ä¸»æœºä¸Šéƒ½èƒ½è¯»åˆ°æ•°æ®ã€‚
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JedisClusterTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HostAndPort</span><span class="token punctuation">&gt;</span></span> set <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HostAndPort</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.100.100&quot;</span><span class="token punctuation">,</span><span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">JedisCluster</span> jedisCluster <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JedisCluster</span><span class="token punctuation">(</span>set<span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedisCluster<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;k&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;v&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedisCluster<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;k&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="redis-é›†ç¾¤ä¼˜ç‚¹" tabindex="-1"><a class="header-anchor" href="#redis-é›†ç¾¤ä¼˜ç‚¹" aria-hidden="true">#</a> Redis é›†ç¾¤ä¼˜ç‚¹</h2><ul><li>å®ç°æ‰©å®¹</li><li>åˆ†æ‘Šå‹åŠ›</li><li>æ— ä¸­å¿ƒé…ç½®ç›¸å¯¹ç®€å•</li></ul><h2 id="redis-é›†ç¾¤çš„ä¸è¶³" tabindex="-1"><a class="header-anchor" href="#redis-é›†ç¾¤çš„ä¸è¶³" aria-hidden="true">#</a> Redis é›†ç¾¤çš„ä¸è¶³</h2><ul><li>å¤šé”®æ“ä½œæ˜¯ä¸è¢«æ”¯æŒçš„</li><li>å¤šé”®çš„Redisäº‹åŠ¡æ˜¯ä¸è¢«æ”¯æŒçš„ã€‚luaè„šæœ¬ä¸è¢«æ”¯æŒ</li><li>ç”±äºé›†ç¾¤æ–¹æ¡ˆå‡ºç°è¾ƒæ™šï¼Œå¾ˆå¤šå…¬å¸å·²ç»é‡‡ç”¨äº†å…¶ä»–çš„é›†ç¾¤æ–¹æ¡ˆï¼Œè€Œä»£ç†æˆ–è€…å®¢æˆ·ç«¯åˆ†ç‰‡çš„æ–¹æ¡ˆæƒ³è¦è¿ç§»è‡³redis clusterï¼Œéœ€è¦æ•´ä½“è¿ç§»è€Œä¸æ˜¯é€æ­¥è¿‡æ¸¡ï¼Œå¤æ‚åº¦è¾ƒå¤§ã€‚</li></ul><h1 id="redis-åº”ç”¨é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#redis-åº”ç”¨é—®é¢˜" aria-hidden="true">#</a> Redis åº”ç”¨é—®é¢˜</h1><h2 id="ç¼“å­˜ç©¿é€" tabindex="-1"><a class="header-anchor" href="#ç¼“å­˜ç©¿é€" aria-hidden="true">#</a> ç¼“å­˜ç©¿é€</h2><h3 id="é—®é¢˜æè¿°" tabindex="-1"><a class="header-anchor" href="#é—®é¢˜æè¿°" aria-hidden="true">#</a> é—®é¢˜æè¿°</h3><p>â€‹ key å¯¹åº”çš„æ•°æ®åœ¨æ•°æ®æºå¹¶ä¸å­˜åœ¨ï¼Œæ¯æ¬¡é’ˆå¯¹æ­¤ key çš„è¯·æ±‚ä»ç¼“å­˜è·å–ä¸åˆ°ï¼Œè¯·æ±‚éƒ½ä¼šå‹åˆ°æ•°æ®æºï¼Œä»è€Œå¯èƒ½å‹å®æ•°æ®æºã€‚æ¯”å¦‚ç”¨ä¸€ä¸ªä¸å­˜åœ¨çš„ç”¨æˆ· id è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œä¸è®ºç¼“å­˜è¿˜æ˜¯æ•°æ®åº“éƒ½æ²¡æœ‰ï¼Œè‹¥é»‘å®¢åˆ©ç”¨æ­¤æ¼æ´è¿›è¡Œæ”»å‡»å¯èƒ½å‹å®æ•°æ®åº“ã€‚</p><h3 id="è§£å†³æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#è§£å†³æ–¹æ¡ˆ" aria-hidden="true">#</a> è§£å†³æ–¹æ¡ˆ</h3><p>â€‹ ä¸€ä¸ªä¸€å®šä¸å­˜åœ¨ç¼“å­˜åŠæŸ¥è¯¢ä¸åˆ°çš„æ•°æ®ï¼Œç”±äºç¼“å­˜æ˜¯ä¸å‘½ä¸­æ—¶è¢«åŠ¨å†™çš„ï¼Œå¹¶ä¸”å‡ºäºå®¹é”™è€ƒè™‘ï¼Œå¦‚æœä»å­˜å‚¨å±‚æŸ¥ä¸åˆ°æ•°æ®åˆ™ä¸å†™å…¥ç¼“å­˜ï¼Œè¿™å°†å¯¼è‡´è¿™ä¸ªä¸å­˜åœ¨çš„æ•°æ®æ¯æ¬¡è¯·æ±‚éƒ½è¦åˆ°å­˜å‚¨å±‚å»æŸ¥è¯¢ï¼Œå¤±å»äº†ç¼“å­˜çš„æ„ä¹‰ã€‚</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><p>ï¼ˆ1ï¼‰ **å¯¹ç©ºå€¼ç¼“å­˜ï¼š**å¦‚æœä¸€ä¸ªæŸ¥è¯¢è¿”å›çš„æ•°æ®ä¸ºç©ºï¼ˆä¸ç®¡æ˜¯æ•°æ®æ˜¯å¦ä¸å­˜åœ¨ï¼‰ï¼Œæˆ‘ä»¬ä»ç„¶æŠŠè¿™ä¸ªç©ºç»“æœï¼ˆnullï¼‰è¿›è¡Œç¼“ å­˜ï¼Œè®¾ç½®ç©ºç»“æœçš„è¿‡æœŸæ—¶é—´ä¼šå¾ˆçŸ­ï¼Œæœ€é•¿ä¸è¶…è¿‡äº”åˆ†é’Ÿ</p><p>ï¼ˆ2ï¼‰ <strong>è®¾ç½®å¯è®¿é—®çš„åå•ï¼ˆç™½åå•ï¼‰ï¼š</strong></p><p>â€‹ ä½¿ç”¨ bitmaps ç±»å‹å®šä¹‰ä¸€ä¸ªå¯ä»¥è®¿é—®çš„åå•ï¼Œåå• id ä½œä¸º bitmaps çš„åç§»é‡ï¼Œæ¯æ¬¡è®¿é—®å’Œ bitmap é‡Œé¢çš„ id è¿›è¡Œ æ¯”è¾ƒï¼Œå¦‚æœè®¿é—® id ä¸åœ¨ bitmaps é‡Œé¢ï¼Œè¿›è¡Œæ‹¦æˆªï¼Œä¸å…è®¸è®¿é—®ã€‚</p><p>ï¼ˆ3ï¼‰ <strong>é‡‡ç”¨å¸ƒéš†è¿‡æ»¤å™¨</strong>ï¼š(å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆBloom Filterï¼‰æ˜¯1970å¹´ç”±å¸ƒéš†æå‡ºçš„ã€‚å®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªå¾ˆé•¿çš„äºŒè¿›åˆ¶å‘é‡(ä½å›¾) å’Œä¸€ç³»åˆ—éšæœºæ˜ å°„å‡½æ•°ï¼ˆå“ˆå¸Œå‡½æ•°ï¼‰ã€‚</p><p>â€‹ å¸ƒéš†è¿‡æ»¤å™¨å¯ä»¥ç”¨äºæ£€ç´¢ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨ä¸€ä¸ªé›†åˆä¸­ã€‚å®ƒçš„ä¼˜ç‚¹æ˜¯ç©ºé—´æ•ˆç‡å’ŒæŸ¥è¯¢æ—¶é—´éƒ½è¿œè¿œè¶…è¿‡ä¸€èˆ¬çš„ç®—æ³•ï¼Œç¼º ç‚¹æ˜¯æœ‰ä¸€å®šçš„è¯¯è¯†åˆ«ç‡å’Œåˆ é™¤å›°éš¾ã€‚)</p><p>â€‹ å°†æ‰€æœ‰å¯èƒ½å­˜åœ¨çš„æ•°æ®å“ˆå¸Œåˆ°ä¸€ä¸ªè¶³å¤Ÿå¤§çš„ bitmaps ä¸­ï¼Œä¸€ä¸ªä¸€å®šä¸å­˜åœ¨çš„æ•°æ®ä¼šè¢«è¿™ä¸ª bitmaps æ‹¦æˆªæ‰ï¼Œä»è€Œ é¿å…äº†å¯¹åº•å±‚å­˜å‚¨ç³»ç»Ÿçš„æŸ¥è¯¢å‹åŠ›ã€‚</p><p><strong>ï¼ˆ4ï¼‰</strong> **è¿›è¡Œå®æ—¶ç›‘æ§ï¼š**å½“å‘ç° Redis çš„å‘½ä¸­ç‡å¼€å§‹æ€¥é€Ÿé™ä½ï¼Œéœ€è¦æ’æŸ¥è®¿é—®å¯¹è±¡å’Œè®¿é—®çš„æ•°æ®ï¼Œå’Œè¿ç»´äººå‘˜é…åˆï¼Œå¯ä»¥è®¾ ç½®é»‘åå•é™åˆ¶æœåŠ¡ã€‚</p><h2 id="ç¼“å­˜å‡»ç©¿" tabindex="-1"><a class="header-anchor" href="#ç¼“å­˜å‡»ç©¿" aria-hidden="true">#</a> ç¼“å­˜å‡»ç©¿</h2><h3 id="é—®é¢˜æè¿°-1" tabindex="-1"><a class="header-anchor" href="#é—®é¢˜æè¿°-1" aria-hidden="true">#</a> é—®é¢˜æè¿°</h3><p>â€‹ key å¯¹åº”çš„æ•°æ®å­˜åœ¨ï¼Œä½†åœ¨ redis ä¸­è¿‡æœŸï¼Œæ­¤æ—¶è‹¥æœ‰å¤§é‡å¹¶å‘è¯·æ±‚è¿‡æ¥ï¼Œè¿™äº›è¯·æ±‚å‘ç°ç¼“å­˜è¿‡æœŸä¸€èˆ¬éƒ½ä¼šä»åç«¯DBåŠ è½½æ•°æ®å¹¶å›è®¾åˆ°ç¼“å­˜ï¼Œè¿™ä¸ªæ—¶å€™å¤§å¹¶å‘çš„è¯·æ±‚å¯èƒ½ä¼šç¬é—´æŠŠåç«¯DBå‹å®ã€‚</p><h3 id="è§£å†³æ–¹æ¡ˆ-1" tabindex="-1"><a class="header-anchor" href="#è§£å†³æ–¹æ¡ˆ-1" aria-hidden="true">#</a> è§£å†³æ–¹æ¡ˆ</h3><p>â€‹ key å¯èƒ½ä¼šåœ¨æŸäº›æ—¶é—´ç‚¹è¢«è¶…é«˜å¹¶å‘åœ°è®¿é—®ï¼Œæ˜¯ä¸€ç§éå¸¸ â€œçƒ­ç‚¹â€ çš„æ•°æ®ã€‚è¿™ä¸ªæ—¶å€™ï¼Œéœ€è¦è€ƒè™‘ä¸€ä¸ªé—®é¢˜ï¼šç¼“å­˜è¢« â€œå‡»ç©¿â€ çš„é—®é¢˜ã€‚</p><p>è§£å†³é—®é¢˜ï¼š</p><p>ï¼ˆ1ï¼‰é¢„å…ˆè®¾ç½®çƒ­é—¨æ•°æ®ï¼šåœ¨redisé«˜å³°è®¿é—®ä¹‹å‰ï¼ŒæŠŠä¸€äº›çƒ­é—¨æ•°æ®æå‰å­˜å…¥åˆ°redisé‡Œé¢ï¼ŒåŠ å¤§è¿™äº›çƒ­é—¨æ•°æ®keyçš„æ—¶é•¿</p><p>ï¼ˆ2ï¼‰å®æ—¶è°ƒæ•´ï¼šç°åœºç›‘æ§å“ªäº›æ•°æ®çƒ­é—¨ï¼Œå®æ—¶è°ƒæ•´ key çš„è¿‡æœŸæ—¶é•¿</p><p>ï¼ˆ3ï¼‰ä½¿ç”¨é”ï¼š</p><ul><li>å°±æ˜¯åœ¨ç¼“å­˜å¤±æ•ˆçš„æ—¶å€™ï¼ˆåˆ¤æ–­æ‹¿å‡ºæ¥çš„å€¼ä¸ºç©ºï¼‰ï¼Œä¸æ˜¯ç«‹å³å»load dbã€‚</li><li>å…ˆä½¿ç”¨ç¼“å­˜å·¥å…·çš„æŸäº›å¸¦æˆåŠŸæ“ä½œè¿”å›å€¼çš„æ“ä½œï¼ˆæ¯”å¦‚ Redis çš„ SETNXï¼‰å»setä¸€ä¸ªmutex key</li><li>å½“æ“ä½œè¿”å›æˆåŠŸæ—¶ï¼Œå†è¿›è¡Œload dbçš„æ“ä½œï¼Œå¹¶å›è®¾ç¼“å­˜ï¼Œæœ€ååˆ é™¤ mutex keyï¼›</li><li>å½“æ“ä½œè¿”å›å¤±è´¥ï¼Œè¯æ˜æœ‰çº¿ç¨‹åœ¨load dbï¼Œå½“å‰çº¿ç¨‹ç¡çœ ä¸€æ®µæ—¶é—´å†é‡è¯•æ•´ä¸ª get ç¼“å­˜çš„æ–¹æ³•ã€‚</li></ul><img src="/assets/image-20221008200000951-b78ca7f1.png" alt="image-20221008200000951" style="zoom:67%;"><h2 id="ç¼“å­˜é›ªå´©" tabindex="-1"><a class="header-anchor" href="#ç¼“å­˜é›ªå´©" aria-hidden="true">#</a> ç¼“å­˜é›ªå´©</h2><h3 id="é—®é¢˜æè¿°-2" tabindex="-1"><a class="header-anchor" href="#é—®é¢˜æè¿°-2" aria-hidden="true">#</a> é—®é¢˜æè¿°</h3><p>â€‹ key å¯¹åº”çš„æ•°æ®å­˜åœ¨ï¼Œä½†åœ¨ redis ä¸­è¿‡æœŸï¼Œæ­¤æ—¶è‹¥æœ‰å¤§é‡å¹¶å‘è¯·æ±‚è¿‡æ¥ï¼Œè¿™äº›è¯·æ±‚å‘ç°ç¼“å­˜è¿‡æœŸä¸€èˆ¬éƒ½ä¼šä»åç«¯DBåŠ è½½æ•°æ®å¹¶å›è®¾åˆ°ç¼“å­˜ï¼Œè¿™ä¸ªæ—¶å€™å¤§å¹¶å‘çš„è¯·æ±‚å¯èƒ½ä¼šç¬é—´æŠŠåç«¯DBå‹å®ã€‚</p><p><strong>ç¼“å­˜é›ªå´©ä¸ç¼“å­˜å‡»ç©¿çš„åŒºåˆ«åœ¨äºè¿™é‡Œé’ˆå¯¹å¾ˆå¤škeyç¼“å­˜ï¼Œå‰è€…åˆ™æ˜¯æŸä¸€ä¸ªkeyã€‚</strong></p><h3 id="è§£å†³æ–¹æ¡ˆ-2" tabindex="-1"><a class="header-anchor" href="#è§£å†³æ–¹æ¡ˆ-2" aria-hidden="true">#</a> è§£å†³æ–¹æ¡ˆ</h3><p>ç¼“å­˜å¤±æ•ˆæ—¶çš„é›ªå´©æ•ˆåº”å¯¹åº•å±‚ç³»ç»Ÿçš„å†²å‡»éå¸¸å¯æ€•ï¼</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><p><strong>ï¼ˆ1ï¼‰</strong> **æ„å»ºå¤šçº§ç¼“å­˜æ¶æ„ï¼š**nginxç¼“å­˜ + redisç¼“å­˜ +å…¶ä»–ç¼“å­˜ï¼ˆehcacheç­‰ï¼‰</p><p><strong>ï¼ˆ2ï¼‰</strong> <strong>ä½¿ç”¨é”æˆ–é˜Ÿåˆ—ï¼š</strong></p><p>â€‹ ç”¨åŠ é”æˆ–è€…é˜Ÿåˆ—çš„æ–¹å¼ä¿è¯æ¥ä¿è¯ä¸ä¼šæœ‰å¤§é‡çš„çº¿ç¨‹å¯¹æ•°æ®åº“ä¸€æ¬¡æ€§è¿›è¡Œè¯»å†™ï¼Œä»è€Œé¿å…å¤±æ•ˆæ—¶å¤§é‡çš„å¹¶å‘è¯·æ±‚è½åˆ° åº•å±‚å­˜å‚¨ç³»ç»Ÿä¸Šã€‚ä¸é€‚ç”¨é«˜å¹¶å‘æƒ…å†µã€‚</p><p><strong>ï¼ˆ3ï¼‰</strong> <strong>è®¾ç½®è¿‡æœŸæ ‡å¿—æ›´æ–°ç¼“å­˜ï¼š</strong></p><p>â€‹ è®°å½•ç¼“å­˜æ•°æ®æ˜¯å¦è¿‡æœŸï¼ˆè®¾ç½®æå‰é‡ï¼‰ï¼Œå¦‚æœè¿‡æœŸä¼šè§¦å‘é€šçŸ¥å¦å¤–çš„çº¿ç¨‹åœ¨åå°å»æ›´æ–°å®é™…keyçš„ç¼“å­˜ã€‚</p><p><strong>ï¼ˆ4ï¼‰</strong> <strong>å°†ç¼“å­˜å¤±æ•ˆæ—¶é—´åˆ†æ•£å¼€ï¼š</strong></p><p>â€‹ æ¯”å¦‚æˆ‘ä»¬å¯ä»¥åœ¨åŸæœ‰çš„å¤±æ•ˆæ—¶é—´åŸºç¡€ä¸Šå¢åŠ ä¸€ä¸ªéšæœºå€¼ï¼Œæ¯”å¦‚1-5åˆ†é’Ÿéšæœºï¼Œè¿™æ ·æ¯ä¸€ä¸ªç¼“å­˜çš„è¿‡æœŸæ—¶é—´çš„é‡å¤ç‡å°±ä¼š é™ä½ï¼Œå°±å¾ˆéš¾å¼•å‘é›†ä½“å¤±æ•ˆçš„äº‹ä»¶ã€‚</p><h2 id="åˆ†å¸ƒå¼é”" tabindex="-1"><a class="header-anchor" href="#åˆ†å¸ƒå¼é”" aria-hidden="true">#</a> åˆ†å¸ƒå¼é”</h2><p>â€‹ éšç€ä¸šåŠ¡å‘å±•çš„éœ€è¦ï¼ŒåŸå•ä½“å•æœºéƒ¨ç½²çš„ç³»ç»Ÿè¢«æ¼”åŒ–æˆåˆ†å¸ƒå¼é›†ç¾¤ç³»ç»Ÿåï¼Œç”±äºåˆ†å¸ƒå¼ç³»ç»Ÿå¤šçº¿ç¨‹ã€å¤šè¿›ç¨‹å¹¶ä¸”åˆ†å¸ƒåœ¨ä¸åŒæœºå™¨ä¸Šï¼Œè¿™å°†ä½¿åŸå•æœºéƒ¨ç½²æƒ…å†µä¸‹çš„å¹¶å‘æ§åˆ¶é”ç­–ç•¥å¤±æ•ˆï¼Œå•çº¯çš„ Java API å¹¶ä¸èƒ½æä¾›åˆ†å¸ƒå¼é”çš„èƒ½åŠ›ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜å°±éœ€è¦ä¸€ç§è·¨ JVM çš„äº’æ–¥æœºåˆ¶æ¥æ§åˆ¶å…±äº«èµ„æºçš„è®¿é—®ï¼Œè¿™å°±æ˜¯åˆ†å¸ƒå¼é”è¦è§£å†³çš„é—®é¢˜ã€‚</p><p>åˆ†å¸ƒå¼é”ä¸»æµçš„å®ç°æ–¹æ¡ˆï¼š</p><ol><li><p>åŸºäºæ•°æ®åº“å®ç°åˆ†å¸ƒå¼é”</p></li><li><p>åŸºäºç¼“å­˜ï¼ˆRedisç­‰ï¼‰</p></li><li><p>åŸºäºZookeeper</p></li></ol><p>æ¯ä¸€ç§åˆ†å¸ƒå¼é”è§£å†³æ–¹æ¡ˆéƒ½æœ‰å„è‡ªçš„ä¼˜ç¼ºç‚¹ï¼š</p><ol><li><p>æ€§èƒ½ï¼šredisæœ€é«˜</p></li><li><p>å¯é æ€§ï¼šzookeeperæœ€é«˜</p><p>è¿™é‡Œï¼Œæˆ‘ä»¬å°±åŸºäº redis å®ç°åˆ†å¸ƒå¼é”ã€‚</p></li></ol><h3 id="rediså®ç°åˆ†å¸ƒå¼é”" tabindex="-1"><a class="header-anchor" href="#rediså®ç°åˆ†å¸ƒå¼é”" aria-hidden="true">#</a> Rediså®ç°åˆ†å¸ƒå¼é”</h3><h3 id="è®¾ç½®é”çš„è¿‡æœŸæ—¶é—´" tabindex="-1"><a class="header-anchor" href="#è®¾ç½®é”çš„è¿‡æœŸæ—¶é—´" aria-hidden="true">#</a> è®¾ç½®é”çš„è¿‡æœŸæ—¶é—´</h3><p>å‘½ä»¤ï¼šset k v nx px 10000</p><p>ä»¥ä¸Šå¯ä»¥ä¿è¯åŸå­æ€§ï¼Œå¦‚æœ Setnx ååœ¨ expireï¼Œä¸­é—´ Server å®•æœºä¸èƒ½ä¿è¯åŸå­æ€§ã€‚</p><p>EX second</p><p>â€‹ è®¾ç½®é”®çš„è¿‡æœŸæ—¶é—´ä¸º Second ç§’ã€‚ SET key value EX second æ•ˆæœç­‰åŒäº SETEX key second value ã€‚</p><p>PX millisecond</p><p>â€‹ è®¾ç½®é”®çš„è¿‡æœŸæ—¶é—´ä¸º millisecond æ¯«ç§’ã€‚ SET key value PX millisecond æ•ˆæœç­‰åŒäº PSETEX key millisecond value</p><p>NX åªåœ¨é”®ä¸å­˜åœ¨æ—¶ï¼Œæ‰å¯¹é”®è¿›è¡Œè®¾ç½®æ“ä½œã€‚ SET key value NX æ•ˆæœç­‰åŒäº SETNX key value ã€‚</p><p>XX åªåœ¨é”®å·²ç»å­˜åœ¨æ—¶ï¼Œæ‰å¯¹é”®è¿›è¡Œè®¾ç½®æ“ä½œã€‚</p><p>ç¤ºä¾‹ï¼š</p><ol><li><p>å¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶è·å–é”ï¼ˆsetnxï¼‰</p></li><li><p>è·å–æˆåŠŸï¼Œæ‰§è¡Œä¸šåŠ¡é€»è¾‘{ä»dbè·å–æ•°æ®ï¼Œæ”¾å…¥ç¼“å­˜}ï¼Œæ‰§è¡Œå®Œæˆé‡Šæ”¾é”ï¼ˆdelï¼‰</p></li><li><p>å…¶ä»–å®¢æˆ·ç«¯ç­‰å¾…é‡è¯•</p></li></ol><p>ä»£ç ç¤ºä¾‹ï¼š</p><p>application.propertiesï¼šæ³¨æ„é›†ç¾¤ç‰ˆå’Œå•æœºç‰ˆçš„åŒºåˆ«</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token comment"># Redis: å•æœºé…ç½®</span>
<span class="token comment">#spring.redis.host=192.168.100.100</span>
<span class="token comment">##RedisæœåŠ¡å™¨è¿æ¥ç«¯å£</span>
<span class="token comment">#spring.redis.port=6379</span>

<span class="token comment"># Redisé›†ç¾¤é…ç½®</span>
<span class="token key attr-name">spring.redis.cluster.nodes</span><span class="token punctuation">=</span><span class="token value attr-value">192.168.100.100:6379</span>

<span class="token comment">#Redisæ•°æ®åº“ç´¢å¼•ï¼ˆé»˜è®¤ä¸º0ï¼‰</span>
<span class="token key attr-name">spring.redis.database</span><span class="token punctuation">=</span> <span class="token value attr-value">0</span>
<span class="token comment">#è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</span>
<span class="token key attr-name">spring.redis.timeout</span><span class="token punctuation">=</span><span class="token value attr-value">1800000</span>
<span class="token comment">#è¿æ¥æ± æœ€å¤§è¿æ¥æ•°ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰</span>
<span class="token key attr-name">spring.redis.lettuce.pool.max-active</span><span class="token punctuation">=</span><span class="token value attr-value">20</span>
<span class="token comment">#æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´(è´Ÿæ•°è¡¨ç¤ºæ²¡é™åˆ¶)</span>
<span class="token key attr-name">spring.redis.lettuce.pool.max-wait</span><span class="token punctuation">=</span><span class="token value attr-value">-1</span>
<span class="token comment">#è¿æ¥æ± ä¸­çš„æœ€å¤§ç©ºé—²è¿æ¥</span>
<span class="token key attr-name">spring.redis.lettuce.pool.max-idle</span><span class="token punctuation">=</span><span class="token value attr-value">5</span>
<span class="token comment">#è¿æ¥æ± ä¸­çš„æœ€å°ç©ºé—²è¿æ¥</span>
<span class="token key attr-name">spring.redis.lettuce.pool.min-idle</span><span class="token punctuation">=</span><span class="token value attr-value">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>controllerï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">RedisTemplate</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">StringUtils</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * æµ‹è¯•Redisåˆ†å¸ƒå¼é”ï¼š
 * æå‰è®¾ç½® num å€¼
 */</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/test&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LockController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisTemplate</span> redisTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/testLock&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// è·å–é”</span>
        <span class="token class-name">Boolean</span> lock <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setIfAbsent</span><span class="token punctuation">(</span><span class="token string">&quot;lock&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>lock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è·å¾—é”ï¼š&quot;</span><span class="token operator">+</span>lock<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Object</span> value <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;num&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// åˆ¤ç©º</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// ä¸šåŠ¡é€»è¾‘</span>
            <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;num&quot;</span><span class="token punctuation">,</span> <span class="token operator">++</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// é‡Šæ”¾é”</span>
            <span class="token class-name">Boolean</span> released <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">&quot;lock&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;é‡Šæ”¾é”ï¼š&quot;</span><span class="token operator">+</span>released<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// è·å–é”å¤±è´¥ï¼Œæ¯éš”0.1ç§’å†è¯•</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">testLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æµ‹è¯•ï¼š</p><p>å…ˆè®¾ç½® num çš„å€¼ set num 0</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">192.168</span>.100.100:639<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> <span class="token builtin class-name">set</span> num <span class="token number">0</span>
-<span class="token operator">&gt;</span> Redirected to slot <span class="token punctuation">[</span><span class="token number">2765</span><span class="token punctuation">]</span> located at <span class="token number">192.168</span>.100.100:6379
OK
<span class="token number">192.168</span>.100.100:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨ <a href="http://192.168.25.211:8080/test/testLock" target="_blank" rel="noopener noreferrer">http://192.168.25.211:8080/test/testLock<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> æµ‹è¯•ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">192.168</span>.100.100:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get num
<span class="token string">&quot;1000&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>é—®é¢˜ï¼š</p><p>å¦‚æœä¸Šé”ä¹‹åå‡ºç°å¼‚å¸¸ï¼Œé”æ— æ³•é‡Šæ”¾ï¼Œé”åº”è¯¥è®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´ã€‚</p><p>ä¿®æ”¹ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">Boolean</span> lock <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setIfAbsent</span><span class="token punctuation">(</span><span class="token string">&quot;lock&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;001&quot;</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="uuidé˜²æ­¢è¯¯åˆ " tabindex="-1"><a class="header-anchor" href="#uuidé˜²æ­¢è¯¯åˆ " aria-hidden="true">#</a> UUIDé˜²æ­¢è¯¯åˆ </h3><p>é—®é¢˜ï¼šæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½åº”è¯¥æœ‰è‡ªå·±çš„ä¸€æŠŠé”</p><img src="/assets/image-20221008220617532-73abe309.png" alt="image-20221008220617532" style="zoom:50%;"><p>ä»£ç ä¿®æ”¹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">RedisTemplate</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">StringUtils</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">UUID</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * æµ‹è¯•Redisåˆ†å¸ƒå¼é”ï¼š
 * æå‰è®¾ç½® num å€¼
 */</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/test&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LockController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisTemplate</span> redisTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/testLock&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// è·å–é”</span>
        <span class="token comment">// Boolean lock = redisTemplate.opsForValue().setIfAbsent(&quot;lock&quot;, &quot;001&quot;,3, TimeUnit.SECONDS);</span>
        <span class="token comment">// ä½¿ç”¨ UUID ä¼˜åŒ–é˜²æ­¢è¯¯åˆ </span>
        <span class="token class-name">String</span> uuid <span class="token operator">=</span> <span class="token constant">UUID</span><span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Boolean</span> lock <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setIfAbsent</span><span class="token punctuation">(</span><span class="token string">&quot;lock&quot;</span><span class="token punctuation">,</span> uuid<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>lock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è·å¾—é”ï¼š&quot;</span> <span class="token operator">+</span> lock<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Object</span> value <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;num&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// åˆ¤ç©º</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// ä¸šåŠ¡é€»è¾‘</span>
            <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;num&quot;</span><span class="token punctuation">,</span> <span class="token operator">++</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// é‡Šæ”¾é”: åˆ¤æ–­UUIDæ˜¯å¦ç›¸åŒ</span>
            <span class="token class-name">Object</span> lockUuid <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;lock&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>uuid<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>lockUuid<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Boolean</span> released <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">&quot;lock&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;é‡Šæ”¾é”ï¼š&quot;</span> <span class="token operator">+</span> released<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// è·å–é”å¤±è´¥ï¼Œæ¯éš”0.1ç§’å†è¯•</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">testLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="lua-è„šæœ¬ä¼˜åŒ–-åŸå­æ€§é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#lua-è„šæœ¬ä¼˜åŒ–-åŸå­æ€§é—®é¢˜" aria-hidden="true">#</a> Lua è„šæœ¬ä¼˜åŒ–ï¼šåŸå­æ€§é—®é¢˜</h3><p>â€‹ åœ¨åˆ¤æ–­UUIDæ˜¯å¦ç›¸åŒåï¼Œè¯¥é”å¯¹è±¡è¿‡æœŸæ—¶é—´ç»“æŸï¼Œè‡ªåŠ¨é‡Šæ”¾é”ï¼Œæ­¤æ—¶å…¶ä»–çº¿ç¨‹æ‹¿åˆ°é”ï¼Œä¹‹åå½“å‰çº¿ç¨‹å†æ¬¡é€šè¿‡æ‰‹åŠ¨é‡Šæ”¾é”ï¼Œåˆ¤æ–­ç›¸ç­‰çš„è¿‡ç¨‹å·²ç»ç»“æŸï¼Œé‡Šæ”¾çš„æ˜¯å…¶ä»–çº¿ç¨‹çš„é”ï¼Œè¯¥è¿‡ç¨‹åº”è¯¥æ˜¯åŸå­æ€§çš„ï¼Œä½¿ç”¨Luaè„šæœ¬ç¡®ä¿åŸå­æ€§ã€‚</p><img src="/assets/image-20221008224023193-2206204d.png" alt="image-20221008224023193" style="zoom:50%;"><p>ä»£ç ä¿®æ”¹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;testLockLua&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testLockLua</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å£°æ˜ä¸€ä¸ªuuid ,å°†åšä¸ºä¸€ä¸ªvalue æ”¾å…¥æˆ‘ä»¬çš„keyæ‰€å¯¹åº”çš„å€¼ä¸­</span>
        <span class="token class-name">String</span> uuid <span class="token operator">=</span> <span class="token constant">UUID</span><span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å®šä¹‰ä¸€ä¸ªé”ï¼šlua è„šæœ¬å¯ä»¥ä½¿ç”¨åŒä¸€æŠŠé”ï¼Œæ¥å®ç°åˆ é™¤ï¼</span>
        <span class="token class-name">String</span> skuId <span class="token operator">=</span> <span class="token string">&quot;25&quot;</span><span class="token punctuation">;</span> <span class="token comment">// è®¿é—®skuId ä¸º25å·çš„å•†å“ 100008348542</span>
        <span class="token class-name">String</span> locKey <span class="token operator">=</span> <span class="token string">&quot;lock:&quot;</span> <span class="token operator">+</span> skuId<span class="token punctuation">;</span> <span class="token comment">// é”ä½çš„æ˜¯æ¯ä¸ªå•†å“çš„æ•°æ®</span>
        <span class="token comment">// è·å–é”</span>
        <span class="token class-name">Boolean</span> lock <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setIfAbsent</span><span class="token punctuation">(</span>locKey<span class="token punctuation">,</span> uuid<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>lock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// æ‰§è¡Œçš„ä¸šåŠ¡é€»è¾‘å¼€å§‹</span>
            <span class="token class-name">Object</span> value <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;num&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// ä¸æ˜¯ç©º å¦‚æœè¯´åœ¨è¿™å‡ºç°äº†å¼‚å¸¸ï¼ é‚£ä¹ˆdelete å°±åˆ é™¤å¤±è´¥ï¼ ä¹Ÿå°±æ˜¯è¯´é”æ°¸è¿œå­˜åœ¨ï¼</span>
            <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>value <span class="token operator">+</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// ä½¿num æ¯æ¬¡+1 æ”¾å…¥ç¼“å­˜</span>
            redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;num&quot;</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token operator">++</span>num<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">/*ä½¿ç”¨luaè„šæœ¬æ¥é”*/</span>
            <span class="token comment">// å®šä¹‰lua è„šæœ¬</span>
            <span class="token class-name">String</span> script <span class="token operator">=</span> <span class="token string">&quot;if redis.call(&#39;get&#39;, KEYS[1]) == ARGV[1] then return redis.call(&#39;del&#39;, KEYS[1]) else return 0 end&quot;</span><span class="token punctuation">;</span>
            <span class="token comment">// ä½¿ç”¨redisæ‰§è¡Œluaæ‰§è¡Œ</span>
            <span class="token class-name">DefaultRedisScript</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> redisScript <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultRedisScript</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            redisScript<span class="token punctuation">.</span><span class="token function">setScriptText</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// è®¾ç½®ä¸€ä¸‹è¿”å›å€¼ç±»å‹ä¸º Long</span>
            <span class="token comment">// å› ä¸ºåˆ é™¤åˆ¤æ–­çš„æ—¶å€™ï¼Œè¿”å›çš„0, ç»™å…¶å°è£…ä¸ºæ•°æ®ç±»å‹ã€‚</span>
            <span class="token comment">// å¦‚æœä¸å°è£…é‚£ä¹ˆé»˜è®¤è¿”å›String ç±»å‹ï¼Œé‚£ä¹ˆè¿”å›å­—ç¬¦ä¸²ä¸ 0 ä¼šæœ‰å‘ç”Ÿé”™è¯¯ã€‚</span>
            redisScript<span class="token punctuation">.</span><span class="token function">setResultType</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// ç¬¬ä¸€ä¸ªè¦æ˜¯script è„šæœ¬ ï¼Œç¬¬äºŒä¸ªéœ€è¦åˆ¤æ–­çš„keyï¼Œç¬¬ä¸‰ä¸ªå°±æ˜¯keyæ‰€å¯¹åº”çš„å€¼ã€‚</span>
            redisTemplate<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>redisScript<span class="token punctuation">,</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>locKey<span class="token punctuation">)</span><span class="token punctuation">,</span> uuid<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">testLockLua</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“" aria-hidden="true">#</a> æ€»ç»“</h3><p>ä¸ºäº†ç¡®ä¿åˆ†å¸ƒå¼é”å¯ç”¨ï¼Œæˆ‘ä»¬è‡³å°‘è¦ç¡®ä¿é”çš„å®ç°åŒæ—¶<strong>æ»¡è¶³ä»¥ä¸‹å››ä¸ªæ¡ä»¶</strong>ï¼š</p><ol><li>äº’æ–¥æ€§ã€‚åœ¨ä»»æ„æ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯èƒ½æŒæœ‰é”ã€‚</li><li>ä¸ä¼šå‘ç”Ÿæ­»é”ã€‚å³ä½¿æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯åœ¨æŒæœ‰é”çš„æœŸé—´å´©æºƒè€Œæ²¡æœ‰ä¸»åŠ¨è§£é”ï¼Œä¹Ÿèƒ½ä¿è¯åç»­å…¶ä»–å®¢æˆ·ç«¯èƒ½åŠ é”ã€‚</li><li>è§£é“ƒè¿˜é¡»ç³»é“ƒäººã€‚åŠ é”å’Œè§£é”å¿…é¡»æ˜¯åŒä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯è‡ªå·±ä¸èƒ½æŠŠåˆ«äººåŠ çš„é”ç»™è§£äº†ã€‚</li><li>åŠ é”å’Œè§£é”å¿…é¡»å…·æœ‰åŸå­æ€§ã€‚</li></ol><h1 id="redis6-æ–°åŠŸèƒ½" tabindex="-1"><a class="header-anchor" href="#redis6-æ–°åŠŸèƒ½" aria-hidden="true">#</a> Redis6 æ–°åŠŸèƒ½</h1><h2 id="acl" tabindex="-1"><a class="header-anchor" href="#acl" aria-hidden="true">#</a> ACL</h2><h3 id="ç®€ä»‹-8" tabindex="-1"><a class="header-anchor" href="#ç®€ä»‹-8" aria-hidden="true">#</a> ç®€ä»‹</h3><p>â€‹ Redis ACLæ˜¯Access Control Listï¼ˆè®¿é—®æ§åˆ¶åˆ—è¡¨ï¼‰çš„ç¼©å†™ï¼Œè¯¥åŠŸèƒ½å…è®¸æ ¹æ®å¯ä»¥æ‰§è¡Œçš„å‘½ä»¤å’Œå¯ä»¥è®¿é—®çš„é”®æ¥é™åˆ¶æŸäº›è¿æ¥ã€‚åœ¨Redis 5ç‰ˆæœ¬ä¹‹å‰ï¼ŒRedis å®‰å…¨è§„åˆ™åªæœ‰å¯†ç æ§åˆ¶ï¼Œè¿˜æœ‰é€šè¿‡ rename æ¥è°ƒæ•´é«˜å±å‘½ä»¤æ¯”å¦‚ flushdb ï¼Œ KEYS* ï¼Œ shutdown ç­‰ã€‚Redis 6 åˆ™æä¾›ACLçš„åŠŸèƒ½å¯¹ç”¨æˆ·è¿›è¡Œæ›´ç»†ç²’åº¦çš„æƒé™æ§åˆ¶ ï¼š</p><p>ï¼ˆ1ï¼‰æ¥å…¥æƒé™ï¼šç”¨æˆ·åå’Œå¯†ç </p><p>ï¼ˆ2ï¼‰å¯ä»¥æ‰§è¡Œçš„å‘½ä»¤</p><p>ï¼ˆ3ï¼‰å¯ä»¥æ“ä½œçš„ KEY</p><p>å‚è€ƒå®˜ç½‘ï¼š<a href="https://redis.io/topics/acl" target="_blank" rel="noopener noreferrer">https://redis.io/topics/acl<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="å‘½ä»¤-3" tabindex="-1"><a class="header-anchor" href="#å‘½ä»¤-3" aria-hidden="true">#</a> å‘½ä»¤</h3><ol><li>ä½¿ç”¨ acl list å‘½ä»¤å±•ç°ç”¨æˆ·æƒé™åˆ—è¡¨</li></ol><p>ï¼ˆ1ï¼‰æ•°æ®è¯´æ˜</p><p>â€‹ user ç”¨æˆ·å æ˜¯å¦å¯ç”¨ æ²¡æœ‰å¯†ç  å¯æ“ä½œçš„Key å¯æ‰§è¡Œçš„å‘½ä»¤</p><figure><img src="/assets/image-20221008234251310-5c9f9400.png" alt="image-20221008234251310" tabindex="0" loading="lazy"><figcaption>image-20221008234251310</figcaption></figure><ol start="2"><li><p>ä½¿ç”¨ acl whoami å‘½ä»¤æŸ¥çœ‹å½“å‰ç”¨æˆ·</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> ACL WHOAMI
<span class="token string">&quot;default&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>ä½¿ç”¨ acl cat å‘½ä»¤</p></li></ol><p>ï¼ˆ1ï¼‰æŸ¥çœ‹æ·»åŠ æƒé™æŒ‡ä»¤ç±»åˆ«</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">192.168</span>.100.100:639<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> acl <span class="token function">cat</span>
 <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;keyspace&quot;</span>
 <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;read&quot;</span>
 <span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;write&quot;</span>
 <span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">&quot;set&quot;</span>
 <span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">&quot;sortedset&quot;</span>
 <span class="token number">6</span><span class="token punctuation">)</span> <span class="token string">&quot;list&quot;</span>
 <span class="token number">7</span><span class="token punctuation">)</span> <span class="token string">&quot;hash&quot;</span>
 <span class="token number">8</span><span class="token punctuation">)</span> <span class="token string">&quot;string&quot;</span>
 <span class="token number">9</span><span class="token punctuation">)</span> <span class="token string">&quot;bitmap&quot;</span>
<span class="token number">10</span><span class="token punctuation">)</span> <span class="token string">&quot;hyperloglog&quot;</span>
<span class="token number">11</span><span class="token punctuation">)</span> <span class="token string">&quot;geo&quot;</span>
<span class="token number">12</span><span class="token punctuation">)</span> <span class="token string">&quot;stream&quot;</span>
<span class="token number">13</span><span class="token punctuation">)</span> <span class="token string">&quot;pubsub&quot;</span>
<span class="token number">14</span><span class="token punctuation">)</span> <span class="token string">&quot;admin&quot;</span>
<span class="token number">15</span><span class="token punctuation">)</span> <span class="token string">&quot;fast&quot;</span>
<span class="token number">16</span><span class="token punctuation">)</span> <span class="token string">&quot;slow&quot;</span>
<span class="token number">17</span><span class="token punctuation">)</span> <span class="token string">&quot;blocking&quot;</span>
<span class="token number">18</span><span class="token punctuation">)</span> <span class="token string">&quot;dangerous&quot;</span>
<span class="token number">19</span><span class="token punctuation">)</span> <span class="token string">&quot;connection&quot;</span>
<span class="token number">20</span><span class="token punctuation">)</span> <span class="token string">&quot;transaction&quot;</span>
<span class="token number">21</span><span class="token punctuation">)</span> <span class="token string">&quot;scripting&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ï¼ˆ2ï¼‰åŠ å‚æ•°ç±»å‹åå¯ä»¥æŸ¥çœ‹ç±»å‹ä¸‹å…·ä½“å‘½ä»¤</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> acl <span class="token function">cat</span> string
 <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;msetnx&quot;</span>
 <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;setrange&quot;</span>
 <span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;get&quot;</span>
 <span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">&quot;getrange&quot;</span>
 <span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">&quot;setnx&quot;</span>
 <span class="token number">6</span><span class="token punctuation">)</span> <span class="token string">&quot;getset&quot;</span>
 <span class="token number">7</span><span class="token punctuation">)</span> <span class="token string">&quot;decrby&quot;</span>
 <span class="token number">8</span><span class="token punctuation">)</span> <span class="token string">&quot;getex&quot;</span>
 <span class="token number">9</span><span class="token punctuation">)</span> <span class="token string">&quot;mset&quot;</span>
<span class="token number">10</span><span class="token punctuation">)</span> <span class="token string">&quot;substr&quot;</span>
<span class="token number">11</span><span class="token punctuation">)</span> <span class="token string">&quot;stralgo&quot;</span>
<span class="token number">12</span><span class="token punctuation">)</span> <span class="token string">&quot;incr&quot;</span>
<span class="token number">13</span><span class="token punctuation">)</span> <span class="token string">&quot;setex&quot;</span>
<span class="token number">14</span><span class="token punctuation">)</span> <span class="token string">&quot;set&quot;</span>
<span class="token number">15</span><span class="token punctuation">)</span> <span class="token string">&quot;incrby&quot;</span>
<span class="token number">16</span><span class="token punctuation">)</span> <span class="token string">&quot;decr&quot;</span>
<span class="token number">17</span><span class="token punctuation">)</span> <span class="token string">&quot;append&quot;</span>
<span class="token number">18</span><span class="token punctuation">)</span> <span class="token string">&quot;incrbyfloat&quot;</span>
<span class="token number">19</span><span class="token punctuation">)</span> <span class="token string">&quot;strlen&quot;</span>
<span class="token number">20</span><span class="token punctuation">)</span> <span class="token string">&quot;mget&quot;</span>
<span class="token number">21</span><span class="token punctuation">)</span> <span class="token string">&quot;psetex&quot;</span>
<span class="token number">22</span><span class="token punctuation">)</span> <span class="token string">&quot;getdel&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li>ä½¿ç”¨ aclsetuser å‘½ä»¤åˆ›å»ºå’Œç¼–è¾‘ç”¨æˆ·ACL</li></ol><p>ï¼ˆ1ï¼‰ACLè§„åˆ™</p><p>â€‹ ä¸‹é¢æ˜¯æœ‰æ•ˆACLè§„åˆ™çš„åˆ—è¡¨ã€‚æŸäº›è§„åˆ™åªæ˜¯ç”¨äºæ¿€æ´»æˆ–åˆ é™¤æ ‡å¿—ï¼Œæˆ–å¯¹ç”¨æˆ·ACLæ‰§è¡Œç»™å®šæ›´æ”¹çš„å•ä¸ªå•è¯ã€‚å…¶ä»–è§„åˆ™æ˜¯å­—ç¬¦å‰ç¼€ï¼Œå®ƒä»¬ä¸å‘½ä»¤æˆ–ç±»åˆ«åç§°ã€é”®æ¨¡å¼ç­‰è¿æ¥åœ¨ä¸€èµ·ã€‚</p><table><thead><tr><th>ACLè§„åˆ™</th><th></th><th></th></tr></thead><tbody><tr><td>ç±»å‹</td><td>å‚æ•°</td><td>è¯´æ˜</td></tr><tr><td>å¯åŠ¨å’Œç¦ç”¨ç”¨æˆ·</td><td><strong>on</strong></td><td>æ¿€æ´»æŸç”¨æˆ·è´¦å·</td></tr><tr><td><strong>off</strong></td><td>ç¦ç”¨æŸç”¨æˆ·è´¦å·ã€‚æ³¨æ„ï¼Œå·²éªŒè¯çš„è¿æ¥ä»ç„¶å¯ä»¥å·¥ä½œã€‚å¦‚æœé»˜è®¤ç”¨æˆ·è¢«æ ‡è®°ä¸ºoffï¼Œåˆ™æ–°è¿æ¥å°†åœ¨æœªè¿›è¡Œèº«ä»½éªŒè¯çš„æƒ…å†µä¸‹å¯åŠ¨ï¼Œå¹¶è¦æ±‚ç”¨æˆ·ä½¿ç”¨AUTHé€‰é¡¹å‘é€AUTHæˆ–HELLOï¼Œä»¥ä¾¿ä»¥æŸç§æ–¹å¼è¿›è¡Œèº«ä»½éªŒè¯ã€‚</td><td></td></tr><tr><td>æƒé™çš„æ·»åŠ åˆ é™¤</td><td><code>+&lt;command&gt;</code></td><td>å°†æŒ‡ä»¤æ·»åŠ åˆ°ç”¨æˆ·å¯ä»¥è°ƒç”¨çš„æŒ‡ä»¤åˆ—è¡¨ä¸­</td></tr><tr><td><code>-&lt;command&gt;</code></td><td>ä»ç”¨æˆ·å¯æ‰§è¡ŒæŒ‡ä»¤åˆ—è¡¨ç§»é™¤æŒ‡ä»¤</td><td></td></tr><tr><td><code>+@&lt;category&gt;</code></td><td>æ·»åŠ è¯¥ç±»åˆ«ä¸­ç”¨æˆ·è¦è°ƒç”¨çš„æ‰€æœ‰æŒ‡ä»¤ï¼Œæœ‰æ•ˆç±»åˆ«ä¸º@adminã€@setã€@sortedsetâ€¦ç­‰ï¼Œé€šè¿‡è°ƒç”¨ACL CATå‘½ä»¤æŸ¥çœ‹å®Œæ•´åˆ—è¡¨ã€‚ç‰¹æ®Šç±»åˆ«@allè¡¨ç¤ºæ‰€æœ‰å‘½ä»¤ï¼ŒåŒ…æ‹¬å½“å‰å­˜åœ¨äºæœåŠ¡å™¨ä¸­çš„å‘½ä»¤ï¼Œä»¥åŠå°†æ¥å°†é€šè¿‡æ¨¡å—åŠ è½½çš„å‘½ä»¤ã€‚</td><td></td></tr><tr><td><code>-@&lt;actegory&gt;</code></td><td>ä»ç”¨æˆ·å¯è°ƒç”¨æŒ‡ä»¤ä¸­ç§»é™¤ç±»åˆ«</td><td></td></tr><tr><td><code>allcommands</code></td><td>+@allçš„åˆ«å</td><td></td></tr><tr><td><code>nocommand</code></td><td>-@allçš„åˆ«å</td><td></td></tr><tr><td>å¯æ“ä½œé”®çš„æ·»åŠ æˆ–åˆ é™¤</td><td><code>~&lt;pattern&gt;</code></td><td>æ·»åŠ å¯ä½œä¸ºç”¨æˆ·å¯æ“ä½œçš„é”®çš„æ¨¡å¼ã€‚ä¾‹å¦‚~*å…è®¸æ‰€æœ‰çš„é”®</td></tr></tbody></table><p>ï¼ˆ2ï¼‰é€šè¿‡å‘½ä»¤åˆ›å»ºæ–°ç”¨æˆ·é»˜è®¤æƒé™</p><p>â€‹ acl setuser user1</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> acl setuser user01
OK
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> acl list
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;user default on nopass ~* &amp;* +@all&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;user user01 off &amp;* -@all&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>â€‹ ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œå¦‚æœç”¨æˆ·ä¸å­˜åœ¨ï¼Œè¿™å°†ä½¿ç”¨ just created çš„é»˜è®¤å±æ€§æ¥åˆ›å»ºç”¨æˆ·ã€‚å¦‚æœç”¨æˆ·å·²ç»å­˜åœ¨ï¼Œåˆ™ä¸Šé¢çš„å‘½ä»¤å°†ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚</p><p>ï¼ˆ3ï¼‰è®¾ç½®æœ‰ç”¨æˆ·åã€å¯†ç ã€ACLæƒé™ã€å¹¶å¯ç”¨çš„ç”¨æˆ·</p><p>â€‹ acl setuser user02 on &gt;password ~cached:* +get</p><p>â€‹ <em><em>&gt;åæ¥å¯†ç ï¼ˆpassword å³ä¸ºå¯†ç )ï¼Œ~cached:</em> ä»¥ cached å¼€å¤´çš„é”®å¯ä»¥è¢«æ“ä½œ +get åªèƒ½ä½¿ç”¨ get å‘½ä»¤</em>*</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> acl setuser user02 on <span class="token operator">&gt;</span>password ~cached:* +get
OK
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> acl list
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;user default on nopass ~* &amp;* +@all&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;user user01 off &amp;* -@all&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;user user02 on #5e884898da28047151d0e56f8dc6292773603d0d6aabbdd62a11ef721d1542d8 ~cached:* &amp;* -@all +get&quot;</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ï¼ˆ4ï¼‰åˆ‡æ¢ç”¨æˆ·ï¼ŒéªŒè¯æƒé™</p><p>â€‹ auth user02 password</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># redis-cli -c -p 6379</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> acl <span class="token function">whoami</span>
<span class="token string">&quot;default&quot;</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> acl list
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;user default on nopass ~* &amp;* +@all&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;user user01 off &amp;* -@all&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;user user02 on #5e884898da28047151d0e56f8dc6292773603d0d6aabbdd62a11ef721d1542d8 ~cached:* &amp;* -@all +get&quot;</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> auth user02 password
OK
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">set</span> k1 v1
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> NOPERM this user has no permissions to run the <span class="token string">&#39;set&#39;</span> <span class="token builtin class-name">command</span> or its subcommand
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get k1
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> NOPERM this user has no permissions to access one of the keys used as arguments
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get cached:001
-<span class="token operator">&gt;</span> Redirected to slot <span class="token punctuation">[</span><span class="token number">8807</span><span class="token punctuation">]</span> located at <span class="token number">192.168</span>.100.100:6391
<span class="token punctuation">(</span>nil<span class="token punctuation">)</span>
<span class="token number">192.168</span>.100.100:639<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="io-å¤šçº¿ç¨‹" tabindex="-1"><a class="header-anchor" href="#io-å¤šçº¿ç¨‹" aria-hidden="true">#</a> <strong>IO</strong> å¤šçº¿ç¨‹</h2><h3 id="ç®€ä»‹-9" tabindex="-1"><a class="header-anchor" href="#ç®€ä»‹-9" aria-hidden="true">#</a> <strong>ç®€ä»‹</strong></h3><p>Redis6ç»ˆäºæ”¯æŒå¤šçº¿ç¨‹äº†ï¼Œå‘Šåˆ«å•çº¿ç¨‹äº†å—ï¼Ÿ</p><p>IOå¤šçº¿ç¨‹å…¶å®æŒ‡ <strong>å®¢æˆ·ç«¯äº¤äº’éƒ¨åˆ†</strong>çš„<strong>ç½‘ç»œIO</strong> äº¤äº’å¤„ç†æ¨¡å—<strong>å¤šçº¿ç¨‹</strong>ï¼Œè€Œé<strong>æ‰§è¡Œå‘½ä»¤å¤šçº¿ç¨‹</strong>ã€‚Redis6æ‰§è¡Œå‘½ä»¤ä¾ç„¶æ˜¯å•çº¿ç¨‹ã€‚</p><h3 id="åŸç†æ¶æ„" tabindex="-1"><a class="header-anchor" href="#åŸç†æ¶æ„" aria-hidden="true">#</a> <strong>åŸç†æ¶æ„</strong></h3><p>â€‹ Redis 6 åŠ å…¥å¤šçº¿ç¨‹ï¼Œä½†è·Ÿ Memcached è¿™ç§ä» IOå¤„ç†åˆ°æ•°æ®è®¿é—®å¤šçº¿ç¨‹çš„å®ç°æ¨¡å¼æœ‰äº›å·®å¼‚ã€‚<strong>Redis çš„å¤šçº¿ç¨‹éƒ¨åˆ†åªæ˜¯ç”¨æ¥å¤„ç†ç½‘ç»œæ•°æ®çš„è¯»å†™å’Œåè®®è§£æï¼Œæ‰§è¡Œå‘½ä»¤ä»ç„¶æ˜¯å•</strong>çº¿ç¨‹ã€‚ä¹‹æ‰€ä»¥è¿™ä¹ˆè®¾è®¡æ˜¯ä¸æƒ³å› ä¸ºå¤šçº¿ç¨‹è€Œå˜å¾—å¤æ‚ï¼Œéœ€è¦å»æ§åˆ¶ keyã€luaã€äº‹åŠ¡ï¼ŒLPUSH/LPOP ç­‰ç­‰çš„å¹¶å‘é—®é¢˜ã€‚æ•´ä½“çš„è®¾è®¡å¤§ä½“å¦‚ä¸‹ï¼š</p><img src="/assets/image-20221008233535092-76fe24c3.png" alt="image-20221008233535092" style="zoom:80%;"><p>å¦å¤–ï¼Œå¤šçº¿ç¨‹IOé»˜è®¤ä¹Ÿæ˜¯ä¸å¼€å¯çš„ï¼Œéœ€è¦å†é…ç½®æ–‡ä»¶ä¸­é…ç½®</p><ul><li>â€‹ io-threads 4</li><li>â€‹ io-threads-do-reads yes</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">1141</span> <span class="token comment"># So for instance if you have a four cores boxes, try to use 2 or 3 I/O</span>
<span class="token number">1142</span> <span class="token comment"># threads, if you have a 8 cores, try to use 6 threads. In order to</span>
<span class="token number">1143</span> <span class="token comment"># enable I/O threads use the following configuration directive:</span>
<span class="token number">1144</span> <span class="token comment">#</span>
<span class="token number">1145</span> <span class="token comment"># io-threads 4</span>
<span class="token number">1146</span> <span class="token comment">#</span>
<span class="token number">1147</span> <span class="token comment"># Setting io-threads to 1 will just use the main thread as usual.</span>
<span class="token number">1148</span> <span class="token comment"># When I/O threads are enabled, we only use threads for writes, that is</span>
<span class="token number">1149</span> <span class="token comment"># to thread the write(2) syscall and transfer the client buffers to the</span>
<span class="token number">1150</span> <span class="token comment"># socket. However it is also possible to enable threading of reads and</span>
<span class="token number">1151</span> <span class="token comment"># protocol parsing using the following configuration directive, by setting</span>
<span class="token number">1152</span> <span class="token comment"># it to yes:</span>
<span class="token number">1153</span> <span class="token comment">#</span>
<span class="token number">1154</span> <span class="token comment"># io-threads-do-reads no</span>
<span class="token number">1155</span> <span class="token comment">#</span>
<span class="token number">1156</span> <span class="token comment"># Usually threading reads doesn&#39;t help much.</span>
<span class="token number">1157</span> <span class="token comment">#</span>
<span class="token number">1158</span> <span class="token comment"># NOTE 1: This configuration directive cannot be changed at runtime via</span>
<span class="token number">1159</span> <span class="token comment"># CONFIG SET. Aso this feature currently does not work when SSL is</span>
<span class="token number">1160</span> <span class="token comment"># enabled.</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="å·¥å…·æ”¯æŒ-cluster" tabindex="-1"><a class="header-anchor" href="#å·¥å…·æ”¯æŒ-cluster" aria-hidden="true">#</a> <strong>å·¥å…·æ”¯æŒ</strong> <strong>Cluster</strong></h2><p>ä¹‹å‰è€ç‰ˆ Redis æƒ³è¦æ­é›†ç¾¤éœ€è¦å•ç‹¬å®‰è£… ruby ç¯å¢ƒï¼ŒRedis 5 å°† redis-trib.rb çš„åŠŸèƒ½é›†æˆåˆ° redis-cli ã€‚å¦å¤–å®˜æ–¹ redis-benchmark å·¥å…·å¼€å§‹æ”¯æŒ cluster æ¨¡å¼äº†ï¼Œé€šè¿‡å¤šçº¿ç¨‹çš„æ–¹å¼å¯¹å¤šä¸ªåˆ†ç‰‡è¿›è¡Œå‹æµ‹ã€‚</p><h2 id="redis-æ–°åŠŸèƒ½æŒç»­å…³æ³¨" tabindex="-1"><a class="header-anchor" href="#redis-æ–°åŠŸèƒ½æŒç»­å…³æ³¨" aria-hidden="true">#</a> <strong>Redis</strong> æ–°åŠŸèƒ½æŒç»­å…³æ³¨</h2><p>Redis6 æ–°åŠŸèƒ½è¿˜æœ‰ï¼š</p><ol><li><p>RESP3 æ–°çš„ Redis é€šä¿¡åè®®ï¼šä¼˜åŒ–æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯ä¹‹é—´é€šä¿¡</p></li><li><p>Client Side Caching å®¢æˆ·ç«¯ç¼“å­˜ï¼šåŸºäº RESP3 åè®®å®ç°çš„å®¢æˆ·ç«¯ç¼“å­˜åŠŸèƒ½ã€‚ä¸ºäº†è¿›ä¸€æ­¥æå‡ç¼“å­˜çš„æ€§èƒ½ï¼Œå°†å®¢æˆ·ç«¯ç»å¸¸è®¿é—®çš„æ•°æ® Cache åˆ°å®¢æˆ·ç«¯ï¼Œå‡å°‘TCPç½‘ç»œäº¤äº’ã€‚</p></li><li><p>Proxyé›†ç¾¤ä»£ç†æ¨¡å¼ï¼šProxy åŠŸèƒ½ï¼Œè®© Cluster æ‹¥æœ‰åƒå•å®ä¾‹ä¸€æ ·çš„æ¥å…¥æ–¹å¼ï¼Œé™ä½å¤§å®¶ä½¿ç”¨ Cluster çš„é—¨æ§›ã€‚ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ä»£ç†ä¸æ”¹å˜ Cluster çš„åŠŸèƒ½é™åˆ¶ï¼Œä¸æ”¯æŒçš„å‘½ä»¤è¿˜æ˜¯ä¸ä¼šæ”¯æŒï¼Œæ¯”å¦‚è·¨ Slot çš„å¤šKeyæ“ä½œã€‚</p></li><li><p>Modules API</p><p>â€‹ Redis 6 ä¸­æ¨¡å—APIå¼€å‘è¿›å±•éå¸¸å¤§ï¼Œå› ä¸º Redis Labs ä¸ºäº†å¼€å‘å¤æ‚çš„åŠŸèƒ½ï¼Œä»ä¸€å¼€å§‹å°±ç”¨ä¸Š Redis æ¨¡å—ã€‚Rediså¯ä»¥å˜æˆä¸€ä¸ªæ¡†æ¶ï¼Œåˆ©ç”¨ Modules æ¥æ„å»ºä¸åŒç³»ç»Ÿï¼Œè€Œä¸éœ€è¦ä»å¤´å¼€å§‹å†™ç„¶åè¿˜è¦ BSD è®¸å¯ã€‚Redisä¸€å¼€å§‹å°±æ˜¯ä¸€ä¸ªå‘ç¼–å†™å„ç§ç³»ç»Ÿå¼€æ”¾çš„å¹³å°ã€‚</p></li></ol><p>è¯¥æ–‡æ¡£å­˜åœ¨çš„é—®é¢˜ï¼š</p><ol><li>gcc å®‰è£…é—®é¢˜ï¼Œä»…åœ¨ä¸€ä¸ªä¼šè¯ä¸­å®‰è£…</li></ol></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/vuepress-theme-hope/vuepress-theme-hope/edit/main/src/DataBase/Redis.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page on GitHub" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->Edit this page on GitHub<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><!----><!----></div></footer><!----><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><!----><div class="vp-copyright">Copyright Â© 2023 MineTing</div></footer></div><!--]--><!--]--></div>
    <script type="module" src="/assets/app-ae2ce5af.js" defer></script>
  </body>
</html>
