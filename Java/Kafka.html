<!doctype html>
<html lang="en-US" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.67" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://vuepress-theme-hope-docs-MineTing.netlify.app/Java/Kafka.html"><meta property="og:site_name" content="Docs Demo"><meta property="og:title" content="Kafka"><meta property="og:description" content="Kafka 【Refer】 文档： 官网地址：https://kafka.apache.org/ 视频： https://www.bilibili.com/video/BV1vr4y1677k/?spmidfrom=333.337.search-card.all.click Kafka 概述 对于网站，可以通过前端埋点的形式上传用户操作日志，..."><meta property="og:type" content="article"><meta property="og:locale" content="en-US"><meta property="article:author" content="MineTing"><meta property="article:published_time" content="2023-03-21T00:00:00.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Kafka","image":[""],"datePublished":"2023-03-21T00:00:00.000Z","dateModified":null,"author":[{"@type":"Person","name":"MineTing"}]}</script><title>Kafka | Docs Demo</title><meta name="description" content="Kafka 【Refer】 文档： 官网地址：https://kafka.apache.org/ 视频： https://www.bilibili.com/video/BV1vr4y1677k/?spmidfrom=333.337.search-card.all.click Kafka 概述 对于网站，可以通过前端埋点的形式上传用户操作日志，...">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-d97197b4.css" as="style"><link rel="stylesheet" href="/assets/style-d97197b4.css">
    <link rel="modulepreload" href="/assets/app-ae2ce5af.js"><link rel="modulepreload" href="/assets/Kafka.html-25bd84a0.js"><link rel="modulepreload" href="/assets/Kafka.html-944c972c.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-c27b6911.js"><link rel="prefetch" href="/assets/slides.html-d4b68ae3.js" as="script"><link rel="prefetch" href="/assets/MySQL.html-2c3189d9.js" as="script"><link rel="prefetch" href="/assets/Oracle.html-1ddfb32a.js" as="script"><link rel="prefetch" href="/assets/PostgreSQL.html-8d7c3b11.js" as="script"><link rel="prefetch" href="/assets/Redis.html-1871171c.js" as="script"><link rel="prefetch" href="/assets/ActiveMQ.html-7e36c817.js" as="script"><link rel="prefetch" href="/assets/Dubbo.html-a8cd7449.js" as="script"><link rel="prefetch" href="/assets/Effective Java.html-dfcd6599.js" as="script"><link rel="prefetch" href="/assets/Elasticsearch.html-e5846d2c.js" as="script"><link rel="prefetch" href="/assets/Gis.html-ddd37e0c.js" as="script"><link rel="prefetch" href="/assets/Git-Svn.html-af5d4a81.js" as="script"><link rel="prefetch" href="/assets/Http.html-8daf18da.js" as="script"><link rel="prefetch" href="/assets/Interview.html-1b10aa33.js" as="script"><link rel="prefetch" href="/assets/JavaSE.html-9f047d15.js" as="script"><link rel="prefetch" href="/assets/JavaWeb.html-cb212caf.js" as="script"><link rel="prefetch" href="/assets/JVM.html-f072d845.js" as="script"><link rel="prefetch" href="/assets/Maven-Gradle.html-d83ac95f.js" as="script"><link rel="prefetch" href="/assets/Mybatis.html-885e6e8d.js" as="script"><link rel="prefetch" href="/assets/MybatisPlus.html-598dfbea.js" as="script"><link rel="prefetch" href="/assets/Netty.html-8c02d0e8.js" as="script"><link rel="prefetch" href="/assets/Nginx.html-5aa9d1fb.js" as="script"><link rel="prefetch" href="/assets/RabbitMQ.html-0d6d977e.js" as="script"><link rel="prefetch" href="/assets/RocketMQ.html-49e403fa.js" as="script"><link rel="prefetch" href="/assets/ServerLess.html-e22cee80.js" as="script"><link rel="prefetch" href="/assets/Shiro.html-5d17df5c.js" as="script"><link rel="prefetch" href="/assets/Spring.html-97965d72.js" as="script"><link rel="prefetch" href="/assets/SpringBoot2.html-c86a37b5.js" as="script"><link rel="prefetch" href="/assets/SpringCloud.html-9a245adc.js" as="script"><link rel="prefetch" href="/assets/SpringMVC.html-0cc84083.js" as="script"><link rel="prefetch" href="/assets/SpringSecurity.html-f1ecb2f4.js" as="script"><link rel="prefetch" href="/assets/Zookeeper.html-796b6238.js" as="script"><link rel="prefetch" href="/assets/多线程与并发编程.html-db7a7ee6.js" as="script"><link rel="prefetch" href="/assets/常见场景实现.html-45d3f82e.js" as="script"><link rel="prefetch" href="/assets/操作系统.html-4f78fb7f.js" as="script"><link rel="prefetch" href="/assets/数据结构与算法.html-08698f6d.js" as="script"><link rel="prefetch" href="/assets/计算机网络.html-b52dc063.js" as="script"><link rel="prefetch" href="/assets/设计模式.html-21d367ac.js" as="script"><link rel="prefetch" href="/assets/Basic.html-2e318635.js" as="script"><link rel="prefetch" href="/assets/Docker.html-25a77026.js" as="script"><link rel="prefetch" href="/assets/KubeSphere.html-9567c249.js" as="script"><link rel="prefetch" href="/assets/Python.html-1e966dd9.js" as="script"><link rel="prefetch" href="/assets/HtmlCSS.html-7dd20864.js" as="script"><link rel="prefetch" href="/assets/JavaScript.html-7c696a30.js" as="script"><link rel="prefetch" href="/assets/jQuery.html-2a1066fa.js" as="script"><link rel="prefetch" href="/assets/React.html-5412a153.js" as="script"><link rel="prefetch" href="/assets/Vue.html-85fe9f9e.js" as="script"><link rel="prefetch" href="/assets/index.html-67b15fdc.js" as="script"><link rel="prefetch" href="/assets/slides.html-8c03d836.js" as="script"><link rel="prefetch" href="/assets/Notifition.html-ac544339.js" as="script"><link rel="prefetch" href="/assets/disable.html-2dea8664.js" as="script"><link rel="prefetch" href="/assets/encrypt.html-abf55e88.js" as="script"><link rel="prefetch" href="/assets/markdown.html-175f2004.js" as="script"><link rel="prefetch" href="/assets/page.html-0e44d074.js" as="script"><link rel="prefetch" href="/assets/index.html-a29f879c.js" as="script"><link rel="prefetch" href="/assets/index.html-b73e550e.js" as="script"><link rel="prefetch" href="/assets/baz.html-2cb41f02.js" as="script"><link rel="prefetch" href="/assets/index.html-969443a6.js" as="script"><link rel="prefetch" href="/assets/ray.html-62ce5fc6.js" as="script"><link rel="prefetch" href="/assets/index.html-9b626ed8.js" as="script"><link rel="prefetch" href="/assets/404.html-9df708ff.js" as="script"><link rel="prefetch" href="/assets/index.html-f1ef565e.js" as="script"><link rel="prefetch" href="/assets/index.html-7dc05b06.js" as="script"><link rel="prefetch" href="/assets/index.html-94fd5f7d.js" as="script"><link rel="prefetch" href="/assets/index.html-c580c463.js" as="script"><link rel="prefetch" href="/assets/index.html-2e8ee3a7.js" as="script"><link rel="prefetch" href="/assets/index.html-bc51f108.js" as="script"><link rel="prefetch" href="/assets/index.html-de8bd102.js" as="script"><link rel="prefetch" href="/assets/slides.html-35427f3a.js" as="script"><link rel="prefetch" href="/assets/MySQL.html-b4c05c5f.js" as="script"><link rel="prefetch" href="/assets/Oracle.html-31a22ec5.js" as="script"><link rel="prefetch" href="/assets/PostgreSQL.html-4b3a9fee.js" as="script"><link rel="prefetch" href="/assets/Redis.html-5593bcac.js" as="script"><link rel="prefetch" href="/assets/ActiveMQ.html-17e2f150.js" as="script"><link rel="prefetch" href="/assets/Dubbo.html-f1ccf506.js" as="script"><link rel="prefetch" href="/assets/Effective Java.html-611a5b80.js" as="script"><link rel="prefetch" href="/assets/Elasticsearch.html-6a52bfc3.js" as="script"><link rel="prefetch" href="/assets/Gis.html-8abfec19.js" as="script"><link rel="prefetch" href="/assets/Git-Svn.html-52d9c4f5.js" as="script"><link rel="prefetch" href="/assets/Http.html-be7a915b.js" as="script"><link rel="prefetch" href="/assets/Interview.html-e7be77bf.js" as="script"><link rel="prefetch" href="/assets/JavaSE.html-0e3b628d.js" as="script"><link rel="prefetch" href="/assets/JavaWeb.html-41d4b249.js" as="script"><link rel="prefetch" href="/assets/JVM.html-dbd72723.js" as="script"><link rel="prefetch" href="/assets/Maven-Gradle.html-d8008567.js" as="script"><link rel="prefetch" href="/assets/Mybatis.html-ce0c0db3.js" as="script"><link rel="prefetch" href="/assets/MybatisPlus.html-2c5b8712.js" as="script"><link rel="prefetch" href="/assets/Netty.html-d9e9600f.js" as="script"><link rel="prefetch" href="/assets/Nginx.html-98042356.js" as="script"><link rel="prefetch" href="/assets/RabbitMQ.html-789fcfb2.js" as="script"><link rel="prefetch" href="/assets/RocketMQ.html-076b5dec.js" as="script"><link rel="prefetch" href="/assets/ServerLess.html-0737dc3b.js" as="script"><link rel="prefetch" href="/assets/Shiro.html-e3093d4f.js" as="script"><link rel="prefetch" href="/assets/Spring.html-2ac4675c.js" as="script"><link rel="prefetch" href="/assets/SpringBoot2.html-7ab29a5b.js" as="script"><link rel="prefetch" href="/assets/SpringCloud.html-05fe7030.js" as="script"><link rel="prefetch" href="/assets/SpringMVC.html-748abb3f.js" as="script"><link rel="prefetch" href="/assets/SpringSecurity.html-e9f6acd6.js" as="script"><link rel="prefetch" href="/assets/Zookeeper.html-5d8329d4.js" as="script"><link rel="prefetch" href="/assets/多线程与并发编程.html-f6dbec75.js" as="script"><link rel="prefetch" href="/assets/常见场景实现.html-8f6b3fa9.js" as="script"><link rel="prefetch" href="/assets/操作系统.html-5bc15ff2.js" as="script"><link rel="prefetch" href="/assets/数据结构与算法.html-3c552842.js" as="script"><link rel="prefetch" href="/assets/计算机网络.html-1a1a87f0.js" as="script"><link rel="prefetch" href="/assets/设计模式.html-5c7c95ef.js" as="script"><link rel="prefetch" href="/assets/Basic.html-a2d2fe60.js" as="script"><link rel="prefetch" href="/assets/Docker.html-6d4eaef8.js" as="script"><link rel="prefetch" href="/assets/KubeSphere.html-3728deb9.js" as="script"><link rel="prefetch" href="/assets/Python.html-347ee1e7.js" as="script"><link rel="prefetch" href="/assets/HtmlCSS.html-fc50e4d3.js" as="script"><link rel="prefetch" href="/assets/JavaScript.html-b05d397f.js" as="script"><link rel="prefetch" href="/assets/jQuery.html-1c4e954d.js" as="script"><link rel="prefetch" href="/assets/React.html-d9b1e002.js" as="script"><link rel="prefetch" href="/assets/Vue.html-0b3d4dd9.js" as="script"><link rel="prefetch" href="/assets/index.html-acb676ad.js" as="script"><link rel="prefetch" href="/assets/slides.html-40da5346.js" as="script"><link rel="prefetch" href="/assets/Notifition.html-42cb38d5.js" as="script"><link rel="prefetch" href="/assets/disable.html-3b8c1244.js" as="script"><link rel="prefetch" href="/assets/encrypt.html-57f5861e.js" as="script"><link rel="prefetch" href="/assets/markdown.html-a2e16149.js" as="script"><link rel="prefetch" href="/assets/page.html-fee4dd0d.js" as="script"><link rel="prefetch" href="/assets/index.html-a5e39405.js" as="script"><link rel="prefetch" href="/assets/index.html-a7c9ad07.js" as="script"><link rel="prefetch" href="/assets/baz.html-e3cf3d89.js" as="script"><link rel="prefetch" href="/assets/index.html-b7cc2189.js" as="script"><link rel="prefetch" href="/assets/ray.html-295aa4c2.js" as="script"><link rel="prefetch" href="/assets/index.html-cc65b46d.js" as="script"><link rel="prefetch" href="/assets/404.html-3ea6dd0d.js" as="script"><link rel="prefetch" href="/assets/index.html-df589b5a.js" as="script"><link rel="prefetch" href="/assets/index.html-fe03f011.js" as="script"><link rel="prefetch" href="/assets/index.html-0a3b162f.js" as="script"><link rel="prefetch" href="/assets/index.html-f0a5ac48.js" as="script"><link rel="prefetch" href="/assets/index.html-37711430.js" as="script"><link rel="prefetch" href="/assets/index.html-68e0b571.js" as="script"><link rel="prefetch" href="/assets/index.html-2c257328.js" as="script"><link rel="prefetch" href="/assets/auto-fe80bb03.js" as="script"><link rel="prefetch" href="/assets/index-2bf332f6.js" as="script"><link rel="prefetch" href="/assets/flowchart-c441f34d.js" as="script"><link rel="prefetch" href="/assets/mermaid.core-e67e6523.js" as="script"><link rel="prefetch" href="/assets/highlight.esm-75b11b9d.js" as="script"><link rel="prefetch" href="/assets/markdown.esm-abe06b83.js" as="script"><link rel="prefetch" href="/assets/math.esm-70a288c8.js" as="script"><link rel="prefetch" href="/assets/notes.esm-a106bb2c.js" as="script"><link rel="prefetch" href="/assets/reveal.esm-ec5549c1.js" as="script"><link rel="prefetch" href="/assets/search.esm-7e6792e2.js" as="script"><link rel="prefetch" href="/assets/zoom.esm-b83b91d0.js" as="script"><link rel="prefetch" href="/assets/VuePlayground-0382da01.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-5794cde2.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">Skip to main content</a><!--]--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="vp-link vp-brand" href="/"><img class="vp-nav-logo" src="/logo.svg" alt="Docs Demo"><!----><span class="vp-site-name hide-in-pad">MineTing</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><!----><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><div class="nav-item"><div class="dropdown-wrapper i18n-dropdown"><button type="button" class="dropdown-title" aria-label="Select language"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon i18n-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="i18n icon" style="width:1rem;height:1rem;vertical-align:middle;"><path d="M379.392 460.8 494.08 575.488l-42.496 102.4L307.2 532.48 138.24 701.44l-71.68-72.704L234.496 460.8l-45.056-45.056c-27.136-27.136-51.2-66.56-66.56-108.544h112.64c7.68 14.336 16.896 27.136 26.112 35.84l45.568 46.08 45.056-45.056C382.976 312.32 409.6 247.808 409.6 204.8H0V102.4h256V0h102.4v102.4h256v102.4H512c0 70.144-37.888 161.28-87.04 210.944L378.88 460.8zM576 870.4 512 1024H409.6l256-614.4H768l256 614.4H921.6l-64-153.6H576zM618.496 768h196.608L716.8 532.48 618.496 768z"></path></svg><!--]--><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="vp-link nav-link active" href="/Java/Kafka.html"><!---->English<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/zh/"><!---->简体中文<!----></a></li></ul></button></div></div><div class="nav-item vp-repo"><a class="vp-repo-link" href="https://github.com/vuepress-theme-hope/vuepress-theme-hope" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button type="button" class="outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><!----><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/slides.html"><span class="font-icon icon fa-fw fa-sm fas fa-person-chalkboard" style=""></span>Slide page<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable active" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">Java</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><!--[--><a class="vp-link nav-link active vp-sidebar-link vp-sidebar-page active" href="/Java/Kafka.html"><!---->Kafka<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/Java/Kafka.html#kafka-概述"><!---->Kafka 概述<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/Java/Kafka.html#定义"><!---->定义<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/Java/Kafka.html#消息队列"><!---->消息队列<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/Java/Kafka.html#kafka-基础架构"><!---->Kafka 基础架构<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/Java/Kafka.html#kafka-入门示例"><!---->Kafka 入门示例<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/Java/Kafka.html#预先准备"><!---->预先准备<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/Java/Kafka.html#安装步骤"><!---->安装步骤<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/Java/Kafka.html#命令行操作"><!---->命令行操作<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/Java/Kafka.html#kafka-生产者"><!---->kafka 生产者<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/Java/Kafka.html#生产者消息发送流程"><!---->生产者消息发送流程<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/Java/Kafka.html#异步发送-api"><!---->异步发送 API<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/Java/Kafka.html#同步发送-api"><!---->同步发送 API<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/Java/Kafka.html#生产者分区"><!---->生产者分区<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/Java/Kafka.html#生产者如何提高吞吐量"><!---->生产者如何提高吞吐量<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/Java/Kafka.html#数据可靠性"><!---->数据可靠性<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/Java/Kafka.html#数据去重"><!---->数据去重<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/Java/Kafka.html#数据乱序"><!---->数据乱序<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/Java/Kafka.html#数据有序"><!---->数据有序<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/Java/Kafka.html#kafka-broker"><!---->Kafka Broker<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/Java/Kafka.html#kafka-broker-工作流程"><!---->Kafka Broker 工作流程<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/Java/Kafka.html#节点服役与退役"><!---->节点服役与退役<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/Java/Kafka.html#kafka-副本"><!---->Kafka 副本<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/Java/Kafka.html#文件存储"><!---->文件存储<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/Java/Kafka.html#高效读写数据"><!---->高效读写数据<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/Java/Kafka.html#kafka-消费者"><!---->Kafka 消费者<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/Java/Kafka.html#kafka-消费方式"><!---->Kafka 消费方式<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/Java/Kafka.html#kafka-消费者工作流程"><!---->Kafka 消费者工作流程<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/Java/Kafka.html#kafka-eagle-监控"><!---->Kafka-Eagle 监控<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/Java/Kafka.html#mysql-环境准备"><!---->MySQL 环境准备<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/Java/Kafka.html#kafka-kraft-模式"><!---->Kafka-Kraft 模式<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/Java/Kafka.html#集成-flume"><!---->集成 Flume<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/Java/Kafka.html#集成-flink"><!---->集成 Flink<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/Java/Kafka.html#集成-springboot"><!---->集成 SpringBoot<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/Java/Kafka.html#集成-spark"><!---->集成 Spark<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/Java/Kafka.html#环境准备"><!---->环境准备<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/Java/Kafka.html#生产者源码"><!---->生产者源码<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/Java/Kafka.html#消费者源码"><!---->消费者源码<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/Java/Kafka.html#服务器源码"><!---->服务器源码<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/Java/Kafka.html#kafka-硬件配置选择"><!---->Kafka 硬件配置选择<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/Java/Kafka.html#kafka-生产者-1"><!---->Kafka 生产者<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/Java/Kafka.html#kafka-broker-1"><!---->kafka Broker<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/Java/Kafka.html#kafka-消费者-1"><!---->Kafka 消费者<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/Java/Kafka.html#kafka-总体"><!---->kafka 总体<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/Java/JavaSE.html"><!---->JavaSE<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/Java/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95.html"><!---->复杂度分析<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/Java/Algorithms.html"><!---->/Java/Algorithms.md<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/Java/DesignPattern.html"><!---->/Java/DesignPattern.md<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/Java/ConcurrentProgramming.html"><!---->/Java/ConcurrentProgramming.md<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/Java/Netty.html"><!---->Netty<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/Java/JVM.html"><!---->JVM<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/Java/JavaWeb.html"><!---->JavaWeb<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/Java/Spring.html"><!---->Spring<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/Java/SpringMVC.html"><!---->SpringMVC<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/Java/Mybatis.html"><!---->Mybatis<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/Java/MybatisPlus.html"><!---->MybatisPlus<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/Java/Shiro.html"><!---->Shiro<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/Java/SpringSecurity.html"><!---->SpringSecurity<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/Java/SpringBoot.html"><!---->/Java/SpringBoot.md<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/Java/Redis.html"><!---->/Java/Redis.md<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/Java/Zookeeper.html"><!---->Zookeeper<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/Java/Nginx.html"><!---->Nginx<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/Java/RabbitMQ.html"><!---->RabbitMQ<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/Java/RocketMQ.html"><!---->RocketMQ<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/Java/ActiveMQ.html"><!---->ActiveMQ<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/Java/Elasticsearch.html"><!---->Elasticsearch<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">Spring Cloud</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">Specified</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">Tools</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">DevOps</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">BigData</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">Python</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">MachineLearning</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">GIS</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">Web</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">Go</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">C/C++</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->Kafka</h1><div class="page-info"><span class="page-author-info" aria-label="Author🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">MineTing</span></span><span property="author" content="MineTing"></span></span><!----><span class="page-date-info" aria-label="Writing Date📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-03-21T00:00:00.000Z"></span><!----><span class="page-reading-time-info" aria-label="Reading Time⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>About 51 min</span><meta property="timeRequired" content="PT51M"></span><!----><!----></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">On This Page<!----></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#kafka-概述">Kafka 概述</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#定义">定义</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#消息队列">消息队列</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#kafka-基础架构">Kafka 基础架构</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#kafka-入门示例">Kafka 入门示例</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#预先准备">预先准备</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#安装步骤">安装步骤</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#命令行操作">命令行操作</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#kafka-生产者">kafka 生产者</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#生产者消息发送流程">生产者消息发送流程</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#异步发送-api">异步发送 API</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#同步发送-api">同步发送 API</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#生产者分区">生产者分区</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#生产者如何提高吞吐量">生产者如何提高吞吐量</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#数据可靠性">数据可靠性</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#数据去重">数据去重</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#数据乱序">数据乱序</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#数据有序">数据有序</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#kafka-broker">Kafka Broker</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#kafka-broker-工作流程">Kafka Broker 工作流程</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#节点服役与退役">节点服役与退役</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#kafka-副本">Kafka 副本</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#文件存储">文件存储</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#高效读写数据">高效读写数据</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#kafka-消费者">Kafka 消费者</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#kafka-消费方式">Kafka 消费方式</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#kafka-消费者工作流程">Kafka 消费者工作流程</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#kafka-eagle-监控">Kafka-Eagle 监控</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#mysql-环境准备">MySQL 环境准备</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#kafka-kraft-模式">Kafka-Kraft 模式</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#集成-flume">集成 Flume</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#集成-flink">集成 Flink</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#集成-springboot">集成 SpringBoot</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#集成-spark">集成 Spark</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#环境准备">环境准备</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#生产者源码">生产者源码</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#消费者源码">消费者源码</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#服务器源码">服务器源码</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#kafka-硬件配置选择">Kafka 硬件配置选择</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#kafka-生产者-1">Kafka 生产者</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#kafka-broker-1">kafka Broker</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#kafka-消费者-1">Kafka 消费者</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#kafka-总体">kafka 总体</a></li><!----><!--]--></ul><div class="toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!----><div class="theme-hope-content"><div align="center"><!----></div><blockquote><p>【Refer】</p><p>文档：</p><p>官网地址：<a href="https://kafka.apache.org/" target="_blank" rel="noopener noreferrer">https://kafka.apache.org/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>视频：</p><p><a href="https://www.bilibili.com/video/BV1vr4y1677k/?spm_id_from=333.337.search-card.all.click" target="_blank" rel="noopener noreferrer">https://www.bilibili.com/video/BV1vr4y1677k/?spm_id_from=333.337.search-card.all.click<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></blockquote><h1 id="kafka-入门" tabindex="-1"><a class="header-anchor" href="#kafka-入门" aria-hidden="true">#</a> kafka 入门</h1><h2 id="kafka-概述" tabindex="-1"><a class="header-anchor" href="#kafka-概述" aria-hidden="true">#</a> Kafka 概述</h2><p>对于网站，可以通过前端埋点的形式上传用户操作日志，这些数据通过 Flume 采集，采集速度为 100M/S，Hadoop 上传速度为 100M/S，则可以正常消费，如果 Flume 采集速度过快为 200 M/S，则 Hadoop 消费不了，则需要中间件进行辅助，先将数据导入到中间件中，再由 Hadoop 后续慢慢消费。</p><h3 id="定义" tabindex="-1"><a class="header-anchor" href="#定义" aria-hidden="true">#</a> 定义</h3><ul><li><p>Kafka 传统定义：<strong>Kafka 是一个分布式的基于发布/订阅模式的消息队列（Message Queue）</strong>，主要应用于大数据实时处理领域。</p><p>发布/订阅：消息的发布者不会将消息直接发送给特定的订阅者，而是将发布的消息 分为不同的类别，订阅者只接收感兴趣的消息。</p></li><li><p>Kafka 最新定义 ： <strong>Kafka是一个开源的分布式事件流平台 （Event Streaming Platform）</strong>，被数千家公司用于高性能数据管道、流分析、数据集成和关键任务应用。</p></li></ul><h3 id="消息队列" tabindex="-1"><a class="header-anchor" href="#消息队列" aria-hidden="true">#</a> 消息队列</h3><p>消息队列，是消息也是队列；目前企业中常见的消息队列产品主要有 Kafka、ActiveMQ 、RabbitMQ 、 RocketMQ 等。</p><p>在大数据场景主要采用 Kafka 作为消息队列。在 JavaEE 开发中主要采用 ActiveMQ、 RabbitMQ、RocketMQ</p><h4 id="消息队列的应用场景" tabindex="-1"><a class="header-anchor" href="#消息队列的应用场景" aria-hidden="true">#</a> 消息队列的应用场景</h4><p>主要应用场景包括：缓存/消峰、解耦和异步通信</p><ul><li><p>缓冲/消峰：有助于控制和优化数据流经过系统的速度，解决生产消息和消费消息的处理速度不一致的情况。</p><figure><img src="/assets/Kafka消息队列-削峰-300a3533.png" alt="Kafka消息队列-削峰.png" tabindex="0" loading="lazy"><figcaption>Kafka消息队列-削峰.png</figcaption></figure></li><li><p>解耦：允许你独立的扩展或修改两边的处理过程，只要确保它们遵守同样的接口约束。</p><figure><img src="/assets/Kafka消息队列-解耦-034391c4.png" alt="Kafka消息队列-解耦.png" tabindex="0" loading="lazy"><figcaption>Kafka消息队列-解耦.png</figcaption></figure></li><li><p>异步通信：允许用户把一个消息放入队列，但并不立即处理它，然后在需要的时候再去处理它们。</p><figure><img src="/assets/Kafka消息队列-异步-46c550a5.png" alt="Kafka消息队列-异步.png" tabindex="0" loading="lazy"><figcaption>Kafka消息队列-异步.png</figcaption></figure></li></ul><h4 id="消息队列的两种模式" tabindex="-1"><a class="header-anchor" href="#消息队列的两种模式" aria-hidden="true">#</a> 消息队列的两种模式</h4><p><strong>点对点模式</strong></p><ul><li>消费者主动拉取数据，消息收到后清除消息</li></ul><figure><img src="/assets/Kakfa消息队列-点对点模式-0f0d1cca.png" alt="Kakfa消息队列-点对点模式.png" tabindex="0" loading="lazy"><figcaption>Kakfa消息队列-点对点模式.png</figcaption></figure><p><strong>发布 / 订阅模式</strong></p><ul><li><p>可以有多个 topic 主题</p></li><li><p>消费者消费数据之后，不删除数据</p></li><li><p>每个消费者相互独立，都可以消费到数据</p></li><li><p>相比较于点对点模式，可处理更复杂的模式</p><figure><img src="/assets/Kafka消息队列-发布订阅模式-9d9b3261.png" alt="Kafka消息队列-发布订阅模式.png" tabindex="0" loading="lazy"><figcaption>Kafka消息队列-发布订阅模式.png</figcaption></figure></li></ul><h3 id="kafka-基础架构" tabindex="-1"><a class="header-anchor" href="#kafka-基础架构" aria-hidden="true">#</a> Kafka 基础架构</h3><ol><li>为方便扩展，并提高吞吐量，一个 topic 分为多个 partition（防止生产者往一个 Topic 投放的数据太多，机器硬盘不够，因此采用分区，将数据分往不同的机器）</li><li>配合分区的设计，提出消费者组的概念（提高消费能力），组内每个消费者并行消费（一个分区的主题只能由一个消费者进行消费，方式多个消费者消费消费同一个数据）</li><li>为提高可用性，为每个 partition 增加若干副本，类似 NameNode HA（防止一个 broker 挂掉，引入副本 Follower，副本有机会称为 Leader，消费者只针对 Leader 进行消费）</li><li>在 Zookeeper 中记录 Leader，和分区副本，Kafka2.8.0 以后也可以自行配置而不采用 Zookeeper</li></ol><figure><img src="/assets/Kafka基本架构-97fc7f78.png" alt="Kafka基本架构.png" tabindex="0" loading="lazy"><figcaption>Kafka基本架构.png</figcaption></figure><blockquote><p><strong>各个组件说明：</strong></p><ol><li><p><strong>Producer：消息生产者，就是向 Kafka broker 发消息的客户端</strong></p></li><li><p><strong>Consumer：消息消费者，向 Kafka broker 取消息的客户端</strong></p></li><li><p><strong>Consumer Group（CG）：消费者组，由多个 consumer 组成。消费者组内每个消费者负责消费不同分区的数据，一个分区只能由一个组内消费者消费；消费者组之间互不影响。所有的消费者都属于某个消费者组，即消费者组是逻辑上的一个订阅者。</strong></p></li><li><p><strong>Broker：一台 Kafka 服务器就是一个 broker。一个集群由多个 broker 组成。一个 broker 可以容纳多个 topic</strong></p></li><li><p><strong>Topic：可以理解为一个队列，生产者和消费者面向的都是一个 topic</strong></p></li><li><p><strong>Partition：为了实现扩展性，一个非常大的 topic 可以分布到多个 broker（即服 务器）上，一个 topic 可以分为多个 partition，每个 partition 是一个有序的队列。</strong></p></li><li><p><strong>Replica：副本，一个 topic 的每个分区都有若干个副本，一个 Leader 和若干个 Follower。</strong></p></li><li><p><strong>Leader：每个分区多个副本的 “主”，生产者发送数据的对象，以及消费者消费数据的对象都是 Leader。</strong></p></li><li><p><strong>Follower：每个分区多个副本中的 “从”，实时从 Leader 中同步数据，保持和 Leader 数据的同步。Leader 发生故障时，某个 Follower 会成为新的 Leader。</strong></p></li></ol></blockquote><h2 id="kafka-入门示例" tabindex="-1"><a class="header-anchor" href="#kafka-入门示例" aria-hidden="true">#</a> Kafka 入门示例</h2><p>Kafka 下载地址：<a href="https://kafka.apache.org/downloads" target="_blank" rel="noopener noreferrer">https://kafka.apache.org/downloads<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>以 <code>kafka_2.12-3.0.0.tgz</code> 为例，Kafka 由 Scala 和 Java 两种语言编写，Producer 和 Consumer 由 Java 编写，Broker 由 Scala 编写，Scala 版文为 2.12，Kafka 为 3.0</p><h3 id="预先准备" tabindex="-1"><a class="header-anchor" href="#预先准备" aria-hidden="true">#</a> 预先准备</h3><h4 id="配置-java-环境" tabindex="-1"><a class="header-anchor" href="#配置-java-环境" aria-hidden="true">#</a> 配置 Java 环境</h4><ul><li><p>卸载自带的 OpenJDK（可选）</p></li><li><p>配置 Java 环境变量</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># java</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/opt/java/jdk1.8.0_131
<span class="token builtin class-name">export</span> <span class="token assign-left variable">JRE_HOME</span><span class="token operator">=</span>/opt/java/jdk1.8.0_131/jre
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CLASSPATH</span><span class="token operator">=</span>.:%JAVA_HOME%/lib:%JAVA_HOME%/lib
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token variable">$JAVA_HOME</span>/bin:<span class="token environment constant">$PATH</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h4 id="配置集群免密登录" tabindex="-1"><a class="header-anchor" href="#配置集群免密登录" aria-hidden="true">#</a> 配置集群免密登录</h4><ul><li><p>配置集群 ip 映射</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment"># vim /etc/hosts</span>
<span class="token number">127.0</span>.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
<span class="token number">192.168</span>.100.100 <span class="token number">192.168</span>.100.100
<span class="token number">192.168</span>.100.110 <span class="token number">192.168</span>.100.110
<span class="token number">192.168</span>.100.120 <span class="token number">192.168</span>.100.120
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>生成秘钥</p><p>会在 ~ 目录下生成 .ssh 目录</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># ssh-keygen -t rsa</span>
Generating public/private rsa key pair.
Enter <span class="token function">file</span> <span class="token keyword">in</span> <span class="token function">which</span> to save the key <span class="token punctuation">(</span>/root/.ssh/id_rsa<span class="token punctuation">)</span>:
Created directory <span class="token string">&#39;/root/.ssh&#39;</span><span class="token builtin class-name">.</span>
Enter passphrase <span class="token punctuation">(</span>empty <span class="token keyword">for</span> no passphrase<span class="token punctuation">)</span>:
Enter same passphrase again:
Your identification has been saved <span class="token keyword">in</span> /root/.ssh/id_rsa.
Your public key has been saved <span class="token keyword">in</span> /root/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:CjWBGLwuVPnbnMBO8fh5zx8u3L/KJ6uVgn3Sxsk4N80 root@localhost.localdomain
The key&#39;s randomart image is:
+---<span class="token punctuation">[</span>RSA <span class="token number">2048</span><span class="token punctuation">]</span>----+
<span class="token operator">|</span> <span class="token punctuation">..</span>o<span class="token punctuation">..</span>.          <span class="token operator">|</span>
<span class="token operator">|</span>  oo<span class="token punctuation">..</span> <span class="token builtin class-name">.</span>         <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token punctuation">..</span>o *          <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token punctuation">..</span>  B o         <span class="token operator">|</span>
<span class="token operator">|</span><span class="token punctuation">..</span>  + * S        <span class="token operator">|</span>
<span class="token operator">|</span><span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span>  + B .o <span class="token operator">=</span> <span class="token operator">=</span>  <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token builtin class-name">.</span>    <span class="token builtin class-name">.</span> <span class="token punctuation">..</span>+*.<span class="token operator">&amp;</span> E <span class="token operator">|</span>
<span class="token operator">|</span>           <span class="token operator">=</span>@oo. <span class="token operator">|</span>
<span class="token operator">|</span>           .+**o.<span class="token operator">|</span>
+----<span class="token punctuation">[</span>SHA256<span class="token punctuation">]</span>-----+
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>分发秘钥</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># ssh-copy-id 192.168.100.100</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># ssh-copy-id 192.168.100.110</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># ssh-copy-id 192.168.100.120</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h4 id="分发脚本-xsync-sh" tabindex="-1"><a class="header-anchor" href="#分发脚本-xsync-sh" aria-hidden="true">#</a> 分发脚本 <a href="http://xsync.sh" target="_blank" rel="noopener noreferrer">xsync.sh<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><blockquote><ul><li>创建脚本 <a href="http://xsync.sh" target="_blank" rel="noopener noreferrer">xsync.sh<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>，传入要传输的目录名</li><li>shell 脚本要求具有执行权限：chmod +x <a href="http://xsync.sh" target="_blank" rel="noopener noreferrer">xsync.sh<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li>shell 脚本保存或者软链接在 /usr/bin 这样的目录下，以使命令全局有效</li><li>软链接（可选）：ln -s /opt/script/xsync.sh /usr/local/bin/</li></ul></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>
<span class="token comment"># 判断参数个数</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$#</span> <span class="token parameter variable">-lt</span> <span class="token number">1</span> <span class="token punctuation">]</span>
<span class="token keyword">then</span>
        <span class="token builtin class-name">echo</span> <span class="token string">&quot;Not  Enough Arguments&quot;</span>
        <span class="token builtin class-name">exit</span>
<span class="token keyword">fi</span>
<span class="token comment"># 遍历所有主机</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">host</span> <span class="token keyword">in</span> <span class="token number">192.168</span>.100.100 <span class="token number">192.168</span>.100.110 <span class="token number">192.168</span>.100.120
<span class="token keyword">do</span>
        <span class="token builtin class-name">echo</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token variable">$host</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
        <span class="token comment"># 遍历所有目录</span>
        <span class="token keyword">for</span> <span class="token for-or-select variable">file</span> <span class="token keyword">in</span> <span class="token variable">$@</span>
        <span class="token keyword">do</span>
                <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-e</span> <span class="token variable">$file</span> <span class="token punctuation">]</span>
                <span class="token keyword">then</span>
                        <span class="token comment"># 如果文件存在，获取父目录，</span>
                        <span class="token comment"># pwd -P：如果目录是链接时，显示出实际路径，而非使用连接（link）路径。pwd防止传入相对路径</span>
                        <span class="token comment"># cd -P:如果目录是链接时，切换到实际路径的目录。</span>
                        <span class="token assign-left variable">pdir</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">cd</span> <span class="token parameter variable">-P</span> <span class="token punctuation">$(</span>dirname $file<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token builtin class-name">pwd</span><span class="token variable">)</span></span>
                        <span class="token comment"># 获取文件名称</span>
                        <span class="token assign-left variable">filename</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">basename</span> $file<span class="token variable">)</span></span>
                        <span class="token function">ssh</span> <span class="token variable">$host</span> <span class="token string">&quot;mkdir -p <span class="token variable">$pdir</span>&quot;</span>
                        <span class="token function">rsync</span> <span class="token parameter variable">-av</span> <span class="token variable">$pdir</span>/<span class="token variable">$filename</span> <span class="token variable">$host</span><span class="token builtin class-name">:</span><span class="token variable">$pdir</span>
                <span class="token keyword">else</span>
                        <span class="token builtin class-name">echo</span> <span class="token variable">$file</span> not exist<span class="token operator">!</span>
                <span class="token keyword">fi</span>
        <span class="token keyword">done</span>
<span class="token keyword">done</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="查看-java-进程-jpsall-sh" tabindex="-1"><a class="header-anchor" href="#查看-java-进程-jpsall-sh" aria-hidden="true">#</a> 查看 Java 进程 <a href="http://jpsall.sh" target="_blank" rel="noopener noreferrer">jpsall.sh<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><p>创建查看进程脚本，并创建软链接：<code>ln -s /opt/script/jpsall.sh /usr/local/bin/</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">host</span> <span class="token keyword">in</span> <span class="token number">192.168</span>.100.100 <span class="token number">192.168</span>.100.110 <span class="token number">192.168</span>.100.120
<span class="token keyword">do</span>
 <span class="token builtin class-name">echo</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token variable">$host</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
 <span class="token function">ssh</span> <span class="token variable">$host</span>  <span class="token string">&quot;source /etc/profile &amp;&amp; jps | grep -v jps &quot;</span>
<span class="token keyword">done</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="安装步骤" tabindex="-1"><a class="header-anchor" href="#安装步骤" aria-hidden="true">#</a> 安装步骤</h3><p>以 <code>apache-zookeeper-3.5.7-bin.tar.gz</code> 、<code>kafka_2.12-3.0.0.tgz</code> 为例。</p><h4 id="安装-zookeeper" tabindex="-1"><a class="header-anchor" href="#安装-zookeeper" aria-hidden="true">#</a> 安装 Zookeeper</h4><h5 id="单机版" tabindex="-1"><a class="header-anchor" href="#单机版" aria-hidden="true">#</a> 单机版</h5><p>Zookeeper 地址：<a href="https://zookeeper.apache.org/releases.html" target="_blank" rel="noopener noreferrer">https://zookeeper.apache.org/releases.html<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>Zookeeper 版本：apache-zookeeper-3.5.7-bin.tar.gz，解压至 /opt/zookeeper/</p><p>安装准备：安装 JDK，解压至 /opt/zookeeper/，重命名文件夹名称</p><p>配置 Java 环境变量：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># java</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/opt/java/jdk1.8.0_131
<span class="token builtin class-name">export</span> <span class="token assign-left variable">JRE_HOME</span><span class="token operator">=</span>/opt/java/jdk1.8.0_131/jre
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CLASSPATH</span><span class="token operator">=</span>.:%JAVA_HOME%/lib:%JAVA_HOME%/lib
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token variable">$JAVA_HOME</span>/bin:<span class="token environment constant">$PATH</span>

<span class="token comment"># zookeeper</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ZOOKEEPER_HOME</span><span class="token operator">=</span>/opt/zookeeper/zookeeper-3.5.7
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token variable">$ZOOKEEPER_HOME</span>/bin:<span class="token environment constant">$PATH</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>刷新环境变量配置：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">source</span> /etc/profile
<span class="token comment"># 或者修改 ~/.bash_profile， source ~/.bash_profile</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>解压 Zookeeper：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@root zookeeper<span class="token punctuation">]</span><span class="token comment"># ll zookeeper-3.5.7/</span>
总用量 <span class="token number">32</span>
drwxr-xr-x. <span class="token number">2</span>  <span class="token number">502</span> games   <span class="token number">232</span> <span class="token number">2</span>月  <span class="token number">10</span> <span class="token number">2020</span> bin
drwxr-xr-x. <span class="token number">2</span>  <span class="token number">502</span> games    <span class="token number">77</span> <span class="token number">2</span>月   <span class="token number">7</span> <span class="token number">2020</span> conf
drwxr-xr-x. <span class="token number">5</span>  <span class="token number">502</span> games  <span class="token number">4096</span> <span class="token number">2</span>月  <span class="token number">10</span> <span class="token number">2020</span> docs
drwxr-xr-x. <span class="token number">2</span> root root   <span class="token number">4096</span> <span class="token number">9</span>月  <span class="token number">27</span> <span class="token number">18</span>:40 lib
-rw-r--r--. <span class="token number">1</span>  <span class="token number">502</span> games <span class="token number">11358</span> <span class="token number">9</span>月  <span class="token number">13</span> <span class="token number">2018</span> LICENSE.txt
-rw-r--r--. <span class="token number">1</span>  <span class="token number">502</span> games   <span class="token number">432</span> <span class="token number">2</span>月  <span class="token number">10</span> <span class="token number">2020</span> NOTICE.txt
-rw-r--r--. <span class="token number">1</span>  <span class="token number">502</span> games  <span class="token number">1560</span> <span class="token number">2</span>月   <span class="token number">7</span> <span class="token number">2020</span> README.md
-rw-r--r--. <span class="token number">1</span>  <span class="token number">502</span> games  <span class="token number">1347</span> <span class="token number">2</span>月   <span class="token number">7</span> <span class="token number">2020</span> README_packaging.txt
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>修改配置：将 conf 路径下 zoo_sample.cfg 修改为 zoo.cfg，并修改文件中 dataDir 的路径，一般设置为安装目录下的 zkData（mkdir zkData）</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@root conf<span class="token punctuation">]</span><span class="token comment"># mv zoo_sample.cfg zoo.cfg</span>
<span class="token punctuation">[</span>root@root conf<span class="token punctuation">]</span><span class="token comment"># vim zoo.cfg</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># The number of milliseconds of each tick</span>
<span class="token assign-left variable">tickTime</span><span class="token operator">=</span><span class="token number">2000</span>
<span class="token comment"># The number of ticks that the initial</span>
<span class="token comment"># synchronization phase can take</span>
<span class="token assign-left variable">initLimit</span><span class="token operator">=</span><span class="token number">10</span>
<span class="token comment"># The number of ticks that can pass between</span>
<span class="token comment"># sending a request and getting an acknowledgement</span>
<span class="token assign-left variable">syncLimit</span><span class="token operator">=</span><span class="token number">5</span>
<span class="token comment"># the directory where the snapshot is stored.</span>
<span class="token comment"># do not use /tmp for storage, /tmp here is just</span>
<span class="token comment"># example sakes.</span>
<span class="token comment"># dataDir=/tmp/zookeeper</span>
<span class="token assign-left variable">dataDir</span><span class="token operator">=</span>/opt/zookeeper/zookeeper-3.5.7/zkData
<span class="token comment"># the port at which the clients will connect</span>
<span class="token assign-left variable">clientPort</span><span class="token operator">=</span><span class="token number">2181</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>操作 Zookeeper：</p><ol><li><p>启动 Zookeeper：<a href="http://zkServer.sh" target="_blank" rel="noopener noreferrer">zkServer.sh<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> start</p></li><li><p>查看进程是否启动：jps</p></li><li><p>查看状态：<a href="http://zkServer.sh" target="_blank" rel="noopener noreferrer">zkServer.sh<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> status</p></li><li><p>启动客户端：<a href="http://zkCli.sh" target="_blank" rel="noopener noreferrer">zkCli.sh<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></li><li><p>退出客户端：quit</p></li><li><p>停止 Zookeeper：<a href="http://zkServer.sh" target="_blank" rel="noopener noreferrer">zkServer.sh<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> stop</p></li></ol><p>示例：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@root zookeeper-3.5.7<span class="token punctuation">]</span><span class="token comment"># cd bin</span>
<span class="token punctuation">[</span>root@root bin<span class="token punctuation">]</span><span class="token comment"># zkServer.sh start</span>
ZooKeeper JMX enabled by default
Using config: /opt/zookeeper/zookeeper-3.5.7/bin/<span class="token punctuation">..</span>/conf/zoo.cfg
Starting zookeeper <span class="token punctuation">..</span>. STARTED
<span class="token punctuation">[</span>root@root bin<span class="token punctuation">]</span><span class="token comment"># jps</span>
<span class="token number">5191</span> Jps
<span class="token number">5160</span> QuorumPeerMain
<span class="token punctuation">[</span>root@root bin<span class="token punctuation">]</span><span class="token comment"># zkServer.sh status</span>
ZooKeeper JMX enabled by default
Using config: /opt/zookeeper/zookeeper-3.5.7/bin/<span class="token punctuation">..</span>/conf/zoo.cfg
Client port found: <span class="token number">2181</span>. Client address: localhost.
Mode: standalone
<span class="token comment"># 退出</span>
<span class="token punctuation">[</span>root@root bin<span class="token punctuation">]</span><span class="token comment"># zkServer.sh stop</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@root bin<span class="token punctuation">]</span><span class="token comment"># zkCli.sh</span>
<span class="token comment">#.....</span>
<span class="token number">2022</span>-09-27 <span class="token number">19</span>:09:18,427 <span class="token punctuation">[</span>myid:localhost:2181<span class="token punctuation">]</span> - INFO  <span class="token punctuation">[</span>main-SendThread<span class="token punctuation">(</span>localhost:2181<span class="token punctuation">)</span>:ClientCnxn<span class="token variable">$SendThread</span>@1394<span class="token punctuation">]</span> - Session establishment complete on server localhost/127.0.0.1:2181, sessionid <span class="token operator">=</span> 0x10000be49f20002, negotiated <span class="token function">timeout</span> <span class="token operator">=</span> <span class="token number">30000</span>

WATCHER::

WatchedEvent state:SyncConnected type:None path:null
<span class="token punctuation">[</span>zk: localhost:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token function">ls</span> /
<span class="token punctuation">[</span>zookeeper<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>配置参数说明：</p><p>配置文件 zoo.cfg 中参数含义：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># The number of milliseconds of each tick</span>
<span class="token assign-left variable">tickTime</span><span class="token operator">=</span><span class="token number">2000</span>
<span class="token comment"># The number of ticks that the initial</span>
<span class="token comment"># synchronization phase can take</span>
<span class="token assign-left variable">initLimit</span><span class="token operator">=</span><span class="token number">10</span>
<span class="token comment"># The number of ticks that can pass between</span>
<span class="token comment"># sending a request and getting an acknowledgement</span>
<span class="token assign-left variable">syncLimit</span><span class="token operator">=</span><span class="token number">5</span>
<span class="token comment"># the directory where the snapshot is stored.</span>
<span class="token comment"># do not use /tmp for storage, /tmp here is just</span>
<span class="token comment"># example sakes.</span>
<span class="token comment"># dataDir=/tmp/zookeeper</span>
<span class="token assign-left variable">dataDir</span><span class="token operator">=</span>/opt/zookeeper/zookeeper-3.5.7/zkData
<span class="token comment"># the port at which the clients will connect</span>
<span class="token assign-left variable">clientPort</span><span class="token operator">=</span><span class="token number">2181</span>
<span class="token comment"># the maximum number of client connections.</span>
<span class="token comment"># increase this if you need to handle more clients</span>
<span class="token comment">#maxClientCnxns=60</span>
<span class="token comment">#</span>
<span class="token comment"># Be sure to read the maintenance section of the</span>
<span class="token comment"># administrator guide before turning on autopurge.</span>
<span class="token comment">#</span>
<span class="token comment"># http://zookeeper.apache.org/doc/current/zookeeperAdmin.html#sc_maintenance</span>
<span class="token comment">#</span>
<span class="token comment"># The number of snapshots to retain in dataDir</span>
<span class="token comment">#autopurge.snapRetainCount=3</span>
<span class="token comment"># Purge task interval in hours</span>
<span class="token comment"># Set to &quot;0&quot; to disable auto purge feature</span>
<span class="token comment">#autopurge.purgeInterval=1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>tickTime = 2000：通信心跳时间，Zookeeper 服务器与客户端心跳时间，单位毫秒</p><p>initLimit = 10：LF 初始通信时限，Leader 和 Follower初始连接时能容忍的最多心跳数**（tickTime的数量）**</p><p>syncLimit = 5：LF 同步通信时限，Leader 和 Follower之间通信时间如果超过 syncLimit * tickTime，Leader 认为 Follwer 死掉，从服务器列表中删除 Follwer。</p><p>dataDir：保存 Zookeeper 中的数据，默认的 tmp目录，容易被 Linux 系统定期删除，所以一般不用默认的 tmp 目录。</p><p>clientPort = 2181：客户端连接端口，通常不做修改。</p><p>maxClientCnxns=60：客户端最大连接数量</p><p>参数说明：<a href="https://zookeeper.apache.org/doc/current/zookeeperAdmin.html#sc_maintenance" target="_blank" rel="noopener noreferrer">https://zookeeper.apache.org/doc/current/zookeeperAdmin.html#sc_maintenance<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h5 id="集群版" tabindex="-1"><a class="header-anchor" href="#集群版" aria-hidden="true">#</a> 集群版</h5><ol><li><p>在三台机器上安装 Zookeeper</p></li><li><p>配置服务器编号：<strong>在安装目录配置 zkData，在 zkData 下创建 myid 文件，在文件中添加与 server 对应的编号</strong></p></li><li><p>分发 zookeeper 至其他机器</p></li><li><p>配置 zoo.cfg文件，增加如下配置：</p><p>server.0=192.168.100.100:2888:3888</p><p>server.1=192.168.100.110:2888:3888</p><p>server.2=192.168.100.120:2888:3888</p><p>配置参数说明：</p><p>server.A=B:C:D</p><p>A 表示集群模式下，配置一个文件 myid 中的机器编号，Zookeeper 启动时读取此文件，拿到里面的数据与 zoo.cfg 里面的配置信息比较从而判断到底是哪个 server。</p><p>B 是服务器的地址</p><p>C 是这个服务器 Follower 与集群中的 Leader 服务器交换信息的端口</p><p>D 是用来执行选举时服务器相互通信的端口。</p></li><li><p>通过 <a href="http://xsync.sh" target="_blank" rel="noopener noreferrer">xsync.sh<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 分发配置文件，并修改文件 myid 中的编号</p></li><li><p>创建 Zookeeper 集群启动脚本 <code>zk.sh</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>
<span class="token keyword">case</span> <span class="token variable">$1</span> <span class="token keyword">in</span>
<span class="token string">&quot;start&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">for</span> <span class="token for-or-select variable">host</span> <span class="token keyword">in</span> <span class="token number">192.168</span>.100.100 <span class="token number">192.168</span>.100.110 <span class="token number">192.168</span>.100.120
	<span class="token keyword">do</span>
		<span class="token builtin class-name">echo</span> <span class="token string">&quot;========zookeeper <span class="token variable">$host</span> start========&quot;</span>
		<span class="token function">ssh</span> <span class="token variable">$host</span> <span class="token string">&quot;/opt/zookeeper/zookeeper-3.5.7/bin/zkServer.sh start&quot;</span>
	<span class="token keyword">done</span>
<span class="token punctuation">}</span>
<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token string">&quot;status&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">for</span> <span class="token for-or-select variable">host</span> <span class="token keyword">in</span> <span class="token number">192.168</span>.100.100 <span class="token number">192.168</span>.100.110 <span class="token number">192.168</span>.100.120
	<span class="token keyword">do</span>
		<span class="token builtin class-name">echo</span> <span class="token string">&quot;========zookeeper <span class="token variable">$host</span> status========&quot;</span>
		<span class="token function">ssh</span> <span class="token variable">$host</span> <span class="token string">&quot;/opt/zookeeper/zookeeper-3.5.7/bin/zkServer.sh status&quot;</span>
	<span class="token keyword">done</span>
<span class="token punctuation">}</span>
<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token string">&quot;stop&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">for</span> <span class="token for-or-select variable">host</span> <span class="token keyword">in</span> <span class="token number">192.168</span>.100.100 <span class="token number">192.168</span>.100.110 <span class="token number">192.168</span>.100.120
	<span class="token keyword">do</span>
		<span class="token builtin class-name">echo</span> <span class="token string">&quot;========zookeeper <span class="token variable">$host</span> stop========&quot;</span>
		<span class="token function">ssh</span> <span class="token variable">$host</span> <span class="token string">&quot;/opt/zookeeper/zookeeper-3.5.7/bin/zkServer.sh stop&quot;</span>
	<span class="token keyword">done</span>
<span class="token punctuation">}</span>
<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">esac</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>启动 Zookeeper 集群：</p><p>通过 <code>zk.sh</code> 启动集群：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost shell<span class="token punctuation">]</span><span class="token comment"># zk.sh start</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>zookeeper <span class="token number">192.168</span>.100.100 <span class="token assign-left variable">start</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
ZooKeeper JMX enabled by default
Using config: /opt/zookeeper/zookeeper-3.5.7/bin/<span class="token punctuation">..</span>/conf/zoo.cfg
Starting zookeeper <span class="token punctuation">..</span>. STARTED
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>zookeeper <span class="token number">192.168</span>.100.110 <span class="token assign-left variable">start</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
ZooKeeper JMX enabled by default
Using config: /opt/zookeeper/zookeeper-3.5.7/bin/<span class="token punctuation">..</span>/conf/zoo.cfg
Starting zookeeper <span class="token punctuation">..</span>. STARTED
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>zookeeper <span class="token number">192.168</span>.100.120 <span class="token assign-left variable">start</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
ZooKeeper JMX enabled by default
Using config: /opt/zookeeper/zookeeper-3.5.7/bin/<span class="token punctuation">..</span>/conf/zoo.cfg
Starting zookeeper <span class="token punctuation">..</span>. STARTED
<span class="token punctuation">[</span>root@localhost shell<span class="token punctuation">]</span><span class="token comment"># zk.sh status</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>zookeeper <span class="token number">192.168</span>.100.100 <span class="token assign-left variable">status</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
ZooKeeper JMX enabled by default
Using config: /opt/zookeeper/zookeeper-3.5.7/bin/<span class="token punctuation">..</span>/conf/zoo.cfg
Client port found: <span class="token number">2181</span>. Client address: localhost.
Mode: follower 
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>zookeeper <span class="token number">192.168</span>.100.110 <span class="token assign-left variable">status</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
ZooKeeper JMX enabled by default
Using config: /opt/zookeeper/zookeeper-3.5.7/bin/<span class="token punctuation">..</span>/conf/zoo.cfg
Client port found: <span class="token number">2181</span>. Client address: localhost.
Mode: leader
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>zookeeper <span class="token number">192.168</span>.100.120 <span class="token assign-left variable">status</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
ZooKeeper JMX enabled by default
Using config: /opt/zookeeper/zookeeper-3.5.7/bin/<span class="token punctuation">..</span>/conf/zoo.cfg
Client port found: <span class="token number">2181</span>. Client address: localhost.
Mode: follower

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>报错解决：</strong></p><ul><li><p>报错一：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 注意报错</span>
<span class="token punctuation">[</span>root@localhost zookeeper-3.5.7<span class="token punctuation">]</span><span class="token comment"># zk.sh start</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>zookeeper <span class="token number">192.168</span>.100.100 <span class="token assign-left variable">start</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
/usr/bin/java
ZooKeeper JMX enabled by default
Using config: /opt/zookeeper/zookeeper-3.5.7/bin/<span class="token punctuation">..</span>/conf/zoo.cfg
Starting zookeeper <span class="token punctuation">..</span>. FAILED TO START
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>zookeeper <span class="token number">192.168</span>.100.110 <span class="token assign-left variable">start</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
/usr/bin/java
ZooKeeper JMX enabled by default
Using config: /opt/zookeeper/zookeeper-3.5.7/bin/<span class="token punctuation">..</span>/conf/zoo.cfg
Starting zookeeper <span class="token punctuation">..</span>. FAILED TO START
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>zookeeper <span class="token number">192.168</span>.100.120 <span class="token assign-left variable">start</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><p>/usr/bin/java<br> ZooKeeper JMX enabled by default<br> Using config: /opt/zookeeper/zookeeper-3.5.7/bin/../conf/zoo.cfg<br> Starting zookeeper ... FAILED TO START<br> [root@localhost zookeeper-3.5.7]#</p><h1 id="如果报错-error-java-home-is-not-set-and-java-could-not-be-found-in-path" tabindex="-1"><a class="header-anchor" href="#如果报错-error-java-home-is-not-set-and-java-could-not-be-found-in-path" aria-hidden="true">#</a> 如果报错：Error: JAVA_HOME is not set and java could not be found in PATH.</h1><h1 id="单机启动没有问题-但集群启动报错" tabindex="-1"><a class="header-anchor" href="#单机启动没有问题-但集群启动报错" aria-hidden="true">#</a> 单机启动没有问题，但集群启动报错</h1><h1 id="解决-在-zookeeper-bin-zkenv-sh-头部手动添加-java-home-opt-java-jdk1-8-0-131" tabindex="-1"><a class="header-anchor" href="#解决-在-zookeeper-bin-zkenv-sh-头部手动添加-java-home-opt-java-jdk1-8-0-131" aria-hidden="true">#</a> 解决：在 zookeeper/bin/zkEnv.sh 头部手动添加 JAVA_HOME=/opt/java/jdk1.8.0_131</h1><h1 id="修改完成后-重新分发" tabindex="-1"><a class="header-anchor" href="#修改完成后-重新分发" aria-hidden="true">#</a> 修改完成后，重新分发</h1><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>
- 报错二：

```shell
Using config: /opt/zookeeper/zookeeper-3.5.7/bin/../conf/zoo.cfg
Client port found: 2181. Client address: localhost.
Error contacting service. It is probably not running.

原因：
  1. Leader 和 Follower 未选出，或无法连接
  2. 只启动不到一半数量的集群，或者防火墙未关闭
  
     关闭防火墙：
     CentOS7：
	
     systemctl status firewalld.service
     systemctl stop firewalld.service	#关闭
     systemctl disabled firewalld.service	# 禁用

     CentOS6：
     service iptables status
     service iptables stop
     chkconfig iptables off
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h4 id="安装-kafka" tabindex="-1"><a class="header-anchor" href="#安装-kafka" aria-hidden="true">#</a> 安装 Kafka</h4><p>官方下载地址：<a href="http://kafka.apache.org/downloads.html" target="_blank" rel="noopener noreferrer">http://kafka.apache.org/downloads.html<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><ul><li><p>集群主机：<code>192.168.100.100 、192.168.100.110 、192.168.100.120</code></p></li><li><p>上传并解压到 /opt/kafka/kafka3.x</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment"># ll</span>
总用量 <span class="token number">68</span>
drwxr-xr-x. <span class="token number">3</span> root root  <span class="token number">4096</span> <span class="token number">3</span>月  <span class="token number">21</span> <span class="token number">12</span>:55 bin
drwxr-xr-x. <span class="token number">3</span> root root  <span class="token number">4096</span> <span class="token number">3</span>月  <span class="token number">21</span> <span class="token number">11</span>:44 config
drwxr-xr-x. <span class="token number">2</span> root root   <span class="token number">187</span> <span class="token number">3</span>月  <span class="token number">22</span> 00:33 datas
drwxr-xr-x. <span class="token number">2</span> root root  <span class="token number">8192</span> <span class="token number">3</span>月  <span class="token number">21</span> 09:59 libs
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">14521</span> <span class="token number">9</span>月   <span class="token number">9</span> <span class="token number">2021</span> LICENSE
drwxr-xr-x. <span class="token number">2</span> root root   <span class="token number">262</span> <span class="token number">9</span>月   <span class="token number">9</span> <span class="token number">2021</span> licenses
drwxr-xr-x. <span class="token number">2</span> root root  <span class="token number">4096</span> <span class="token number">3</span>月  <span class="token number">22</span> 00:00 logs
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">28184</span> <span class="token number">9</span>月   <span class="token number">9</span> <span class="token number">2021</span> NOTICE
drwxr-xr-x. <span class="token number">2</span> root root    <span class="token number">44</span> <span class="token number">9</span>月   <span class="token number">9</span> <span class="token number">2021</span> site-docs
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>修改配置文件：config/server.properties</p><p>主要修改：<code>broker.id</code> 、 <code>log.dirs</code> 、<code>zookeeper.connect</code></p><ul><li><p><a href="http://broker.id" target="_blank" rel="noopener noreferrer">broker.id<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>：broker 的全局唯一编号，不能重复，只能是数字</p></li><li><p>log.dirs：kafka 运行日志（数据）存放的路径，路径不需要提前创建，kafka 自动创建，可以配置多个磁盘路径，路径与路径之间可以用 &quot;，&quot; 分隔</p></li><li><p>zookeeper.connect：配置连接 Zookeeper 集群地址（在 zk 根目录下创建 /kafka，方便管理）</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># broker 的全局唯一编号，不能重复，只能是数字</span>
<span class="token assign-left variable">broker.id</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token comment"># 处理网络请求的线程数量</span>
<span class="token assign-left variable">num.network.threads</span><span class="token operator">=</span><span class="token number">3</span>
<span class="token comment"># 用来处理磁盘 IO 的线程数量</span>
<span class="token assign-left variable">num.io.threads</span><span class="token operator">=</span><span class="token number">8</span>
<span class="token comment"># 发送套接字的缓冲区大小</span>
<span class="token assign-left variable">socket.send.buffer.bytes</span><span class="token operator">=</span><span class="token number">102400</span>
<span class="token comment"># 接收套接字的缓冲区大小</span>
<span class="token assign-left variable">socket.receive.buffer.bytes</span><span class="token operator">=</span><span class="token number">102400</span>
<span class="token comment"># 请求套接字的缓冲区大小</span>
<span class="token assign-left variable">socket.request.max.bytes</span><span class="token operator">=</span><span class="token number">104857600</span>
<span class="token comment"># kafka 运行日志(数据)存放的路径，路径不需要提前创建，kafka 自动创建，可以</span>
<span class="token comment"># 配置多个磁盘路径，路径与路径之间可以用&quot;，&quot;分隔</span>
<span class="token assign-left variable">log.dirs</span><span class="token operator">=</span>/opt/kafka/kafka3.x/datas
<span class="token comment"># topic 在当前 broker 上的分区个数</span>
<span class="token assign-left variable">num.partitions</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token comment"># 用来恢复和清理 data 下数据的线程数量</span>
<span class="token assign-left variable">num.recovery.threads.per.data.dir</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token comment"># 每个 topic 创建时的副本数，默认时 1 个副本</span>
<span class="token assign-left variable">offsets.topic.replication.factor</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token comment"># segment 文件保留的最长时间，超时将被删除</span>
<span class="token assign-left variable">log.retention.hours</span><span class="token operator">=</span><span class="token number">168</span>
<span class="token comment"># 每个 segment 文件的大小，默认最大 1G</span>
<span class="token assign-left variable">log.segment.bytes</span><span class="token operator">=</span><span class="token number">1073741824</span>
<span class="token comment"># 检查过期数据的时间，默认 5 分钟检查一次是否数据过期</span>
<span class="token assign-left variable">log.retention.check.interval.ms</span><span class="token operator">=</span><span class="token number">300000</span>
<span class="token comment"># 配置连接 Zookeeper 集群地址（在 zk 根目录下创建/kafka，方便管理）</span>
<span class="token assign-left variable">zookeeper.connect</span><span class="token operator">=</span><span class="token number">192.168</span>.100.100:2181,192.168.100.110:2181,192.168.100.120:2181/kafka
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>以及修改监听的主机：</p><ul><li>listeners 和 advertised.listeners</li><li>可以使用 <code>host.name=192.168.100.100</code> 代替以上</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">############################# Server Basics #############################</span>

<span class="token comment"># The id of the broker. This must be set to a unique integer for each broker.</span>
<span class="token assign-left variable">broker.id</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token comment"># host.name=192.168.100.100</span>

<span class="token comment">############################# Socket Server Settings #############################</span>

<span class="token comment"># The address the socket server listens on. It will get the value returned from</span>
<span class="token comment"># java.net.InetAddress.getCanonicalHostName() if not configured.</span>
<span class="token comment">#   FORMAT:</span>
<span class="token comment">#     listeners = listener_name://host_name:port</span>
<span class="token comment">#   EXAMPLE:</span>
<span class="token comment">#     listeners = PLAINTEXT://your.host.name:9092</span>
<span class="token comment">#listeners=PLAINTEXT://:9092</span>
<span class="token assign-left variable">listeners</span><span class="token operator">=</span>PLAINTEXT://192.168.100.100:9092

<span class="token comment"># Hostname and port the broker will advertise to producers and consumers. If not set,</span>
<span class="token comment"># it uses the value for &quot;listeners&quot; if configured.  Otherwise, it will use the value</span>
<span class="token comment"># returned from java.net.InetAddress.getCanonicalHostName().</span>
<span class="token comment">#advertised.listeners=PLAINTEXT://your.host.name:9092</span>
<span class="token assign-left variable">advertised.listeners</span><span class="token operator">=</span>PLAINTEXT://192.168.100.100:9092

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li><li><p>分发 Kafka 目录并修改 <a href="http://broker.id" target="_blank" rel="noopener noreferrer">broker.id<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost kafka<span class="token punctuation">]</span><span class="token comment"># xsync.sh kafka3.x/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>修改 192.168.100.110 、192.168.100.120 的 <code>kafka3.x/config/server.propertis</code> 中的 <a href="http://broker.id" target="_blank" rel="noopener noreferrer">broker.id<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>192.168.100.110 ：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">############################# Server Basics #############################</span>

<span class="token comment"># The id of the broker. This must be set to a unique integer for each broker.</span>
<span class="token assign-left variable">broker.id</span><span class="token operator">=</span><span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>192.168.100.120：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">############################# Server Basics #############################</span>

<span class="token comment"># The id of the broker. This must be set to a unique integer for each broker.</span>
<span class="token assign-left variable">broker.id</span><span class="token operator">=</span><span class="token number">2</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>配置 Kafka 环境变量并刷新</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># java</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/opt/java/jdk1.8.0_131
<span class="token builtin class-name">export</span> <span class="token assign-left variable">JRE_HOME</span><span class="token operator">=</span>/opt/java/jdk1.8.0_131/jre
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CLASSPATH</span><span class="token operator">=</span>.:%JAVA_HOME%/lib:%JAVA_HOME%/lib
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token variable">$JAVA_HOME</span>/bin:<span class="token environment constant">$PATH</span>

<span class="token comment"># zookeeper</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ZOOKEEPER_HOME</span><span class="token operator">=</span>/opt/zookeeper/zookeeper-3.5.7
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token variable">$ZOOKEEPER_HOME</span>/bin:<span class="token environment constant">$PATH</span>

<span class="token comment">#KAFKA_HOME</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">KAFKA_HOME</span><span class="token operator">=</span>/opt/kafka/kafka3.x
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$KAFKA_HOME</span>/bin

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>刷新环境变量：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment">#  source /etc/profile</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>分发环境变量并刷新</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost kafka<span class="token punctuation">]</span><span class="token comment">#  xsync /etc/profile</span>
<span class="token comment">#  192.168.100.110、192.168.100.120</span>
<span class="token punctuation">[</span>root@localhost kafka<span class="token punctuation">]</span><span class="token comment">#  source /etc/profile</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>启动集群</p><ul><li><p>第一步：启动 Zookeeper 集群</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment">#  zk.sh start</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>第二步：依次启动 <code>192.168.100.100 、192.168.100.110 、192.168.100.120</code> 的 Kafka</p><p>【启动命令：<code>kafka-server-start.sh -daemon /opt/kafka/kafka3.x/config/server.properties</code>】</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment"># /opt/kafka/kafka3.x/bin/kafka-server-start.sh -daemon /opt/kafka/kafka3.x/config/server.properties</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>查看进程</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment"># jpsall.sh</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token number">192.168</span>.100.100<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
<span class="token number">4577</span> QuorumPeerMain
<span class="token number">4978</span> Kafka
<span class="token number">5093</span> Jps
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token number">192.168</span>.100.110<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
<span class="token number">11639</span> Kafka
<span class="token number">11738</span> Jps
<span class="token number">11151</span> QuorumPeerMain
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token number">192.168</span>.100.120<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
<span class="token number">11169</span> QuorumPeerMain
<span class="token number">11735</span> Jps
<span class="token number">11644</span> Kafka
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li><li><p>停止集群，依次停止 <code>192.168.100.100 、192.168.100.110 、192.168.100.120</code> 的 Kafka</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment"># /opt/kafka/kafka3.x/bin/kafka-server-stop.sh</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>注意：<strong>停止 Kafka 集群时，需要一定时间，一定要等 Kafka 所有节点进程全部停止后再停止 Zookeeper 集群</strong>。因为 Zookeeper 集群当中记录着 Kafka 集群相关信息，Zookeeper 集群一旦先停止， Kafka 集群就没有办法再获取停止进程的信息，只能手动杀死 Kafka 进程。</p></li><li><p>集群启停脚本 <code>kf.sh</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token shebang important">#! /bin/bash</span>
<span class="token keyword">case</span> <span class="token variable">$1</span> <span class="token keyword">in</span>
<span class="token string">&quot;start&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token number">192.168</span>.100.100 <span class="token number">192.168</span>.100.110 <span class="token number">192.168</span>.100.120
                <span class="token keyword">do</span>
                        <span class="token builtin class-name">echo</span> <span class="token string">&quot; --------Start <span class="token variable">$i</span> Kafka-------&quot;</span>
                        <span class="token function">ssh</span> <span class="token variable">$i</span> <span class="token string">&quot;/opt/kafka/kafka3.x/bin/kafka-server-start.sh -daemon /opt/kafka/kafka3.x/config/server.properties&quot;</span>
                <span class="token keyword">done</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token string">&quot;stop&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token number">192.168</span>.100.100 <span class="token number">192.168</span>.100.110 <span class="token number">192.168</span>.100.120
                <span class="token keyword">do</span>
                        <span class="token builtin class-name">echo</span> <span class="token string">&quot; --------Stop <span class="token variable">$i</span> Kafka-------&quot;</span>
                        <span class="token function">ssh</span> <span class="token variable">$i</span> <span class="token string">&quot;/opt/kafka/kafka3.x/bin/kafka-server-stop.sh &quot;</span>
                <span class="token keyword">done</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">esac</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>**注意：**这里有个问题，单机执行 Kafka 启动命令可以运行，但是使用 <a href="http://kf.sh" target="_blank" rel="noopener noreferrer">kf.sh<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 脚本执行不会启动 Kafka，且会报错：nohup: 无法运行命令&quot;java&quot;: 没有那个文件或目</p><p>录，需要修改 shell 脚本：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token shebang important">#! /bin/bash</span>
<span class="token keyword">case</span> <span class="token variable">$1</span> <span class="token keyword">in</span>
<span class="token string">&quot;start&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token number">192.168</span>.100.100 <span class="token number">192.168</span>.100.110 <span class="token number">192.168</span>.100.120
                <span class="token keyword">do</span>
                        <span class="token builtin class-name">echo</span> <span class="token string">&quot; --------Start <span class="token variable">$i</span> Kafka-------&quot;</span>
                        <span class="token function">ssh</span> <span class="token variable">$i</span> <span class="token string">&quot;source /etc/profile;nohup /opt/kafka/kafka3.x/bin/kafka-server-start.sh -daemon /opt/kafka/kafka3.x/config/server.properties&quot;</span>
                <span class="token keyword">done</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token string">&quot;stop&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token number">192.168</span>.100.100 <span class="token number">192.168</span>.100.110 <span class="token number">192.168</span>.100.120
                <span class="token keyword">do</span>
                        <span class="token builtin class-name">echo</span> <span class="token string">&quot; --------Stop <span class="token variable">$i</span> Kafka-------&quot;</span>
                        <span class="token function">ssh</span> <span class="token variable">$i</span> <span class="token string">&quot;source /etc/profile;nohup /opt/kafka/kafka3.x/bin/kafka-server-stop.sh &quot;</span>
                <span class="token keyword">done</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">esac</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>设置权限并拷贝到 /usr/bin 目录下：（或建立软链接）</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost script<span class="token punctuation">]</span><span class="token comment"># chmod +x kf.sh</span>
<span class="token punctuation">[</span>root@localhost script<span class="token punctuation">]</span><span class="token comment"># cp kf.sh /usr/bin/</span>
<span class="token comment"># [root@localhost kafka3.x]# ln -s /opt/script/kf.sh /usr/local/bin/</span>
<span class="token comment"># 建议使用绝对路径，否则可能报错</span>
<span class="token comment"># [root@localhost script]# kf.sh start</span>
<span class="token comment"># -bash: /usr/local/bin/kf.sh: 符号连接的层数过多</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>注意事项</p><p>启动 Kafka 几秒后进程退出</p><p><strong>解决方案：查看启动日志</strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment"># cat log/server.log</span>
<span class="token punctuation">[</span><span class="token number">2023</span>-01-12 <span class="token number">23</span>:22:11,589<span class="token punctuation">]</span> INFO Cluster ID <span class="token operator">=</span> Zc7nlyfTQ5qPbhY2d8I_3A <span class="token punctuation">(</span>kafka.server.KafkaServer<span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">2023</span>-01-12 <span class="token number">23</span>:22:11,598<span class="token punctuation">]</span> ERROR Fatal error during KafkaServer startup. Prepare to <span class="token function">shutdown</span> <span class="token punctuation">(</span>kafka.server.KafkaServer<span class="token punctuation">)</span>
kafka.common.InconsistentClusterIdException: The Cluster ID 1_3tWXR8Q16qq7H2vwhIng doesn&#39;t match s tored clusterId Some<span class="token punctuation">(</span>ivQZIX9gTB-dj05be_i_-w<span class="token punctuation">)</span> <span class="token keyword">in</span> meta.properties. The broker is trying to <span class="token function">join</span> the wrong cluster. Configured zookeeper.connect may be wrong.
    at kafka.server.KafkaServer.startup<span class="token punctuation">(</span>KafkaServer.scala:228<span class="token punctuation">)</span>
    at kafka.Kafka$.main<span class="token punctuation">(</span>Kafka.scala:109<span class="token punctuation">)</span>
    at kafka.Kafka.main<span class="token punctuation">(</span>Kafka.scala<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>第一步：<strong>确定内存够用，可以修改，Kafka 默认 1G</strong></p><p>第二步：<strong>meta.properties 和 cluster_id 不一致</strong>，要么删除目录 <code>log.dirs=/opt/kafka/kafka3.x/datas</code>后重新启动（推荐），要么手动修改（不推荐）</p></li><li><p>启动报错：查看 logs/server.log 启动日志</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>org.apache.zookeeper.KeeperException<span class="token variable">$NodeExistsException</span><span class="token builtin class-name">:</span> KeeperErrorCode <span class="token operator">=</span> NodeExists
        at org.apache.zookeeper.KeeperException.create<span class="token punctuation">(</span>KeeperException.java:126<span class="token punctuation">)</span>
        at kafka.zk.KafkaZkClient<span class="token variable">$CheckedEphemeral</span>.getAfterNodeExists<span class="token punctuation">(</span>KafkaZkClient.scala:1904<span class="token punctuation">)</span>
        at kafka.zk.KafkaZkClient<span class="token variable">$CheckedEphemeral</span>.create<span class="token punctuation">(</span>KafkaZkClient.scala:1842<span class="token punctuation">)</span>
        at kafka.zk.KafkaZkClient.checkedEphemeralCreate<span class="token punctuation">(</span>KafkaZkClient.scala:1809<span class="token punctuation">)</span>
        at kafka.zk.KafkaZkClient.registerBroker<span class="token punctuation">(</span>KafkaZkClient.scala:96<span class="token punctuation">)</span>
        at kafka.server.KafkaServer.startup<span class="token punctuation">(</span>KafkaServer.scala:319<span class="token punctuation">)</span>
        at kafka.Kafka$.main<span class="token punctuation">(</span>Kafka.scala:109<span class="token punctuation">)</span>
        at kafka.Kafka.main<span class="token punctuation">(</span>Kafka.scala<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>原因：之前 Kafka 在运行时没有正常关闭，导致一些临时节点没有被删除。要解决这个问题，可以尝试删除旧的临时节点并重新启动 Kafka</p></li></ul><h3 id="命令行操作" tabindex="-1"><a class="header-anchor" href="#命令行操作" aria-hidden="true">#</a> 命令行操作</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment"># cd bin &amp;&amp; ls</span>
connect-distributed.sh        kafka-dump-log.sh              kafka-storage.sh
connect-mirror-maker.sh       kafka-features.sh              kafka-streams-application-reset.sh
connect-standalone.sh         kafka-get-offsets.sh           kafka-topics.sh
kafka-acls.sh                 kafka-leader-election.sh       kafka-transactions.sh
kafka-broker-api-versions.sh  kafka-log-dirs.sh              kafka-verifiable-consumer.sh
kafka-cluster.sh              kafka-metadata-shell.sh        kafka-verifiable-producer.sh
kafka-configs.sh              kafka-mirror-maker.sh          trogdor.sh
kafka-console-consumer.sh     kafka-producer-perf-test.sh    windows
kafka-console-producer.sh     kafka-reassign-partitions.sh   zookeeper-security-migration.sh
kafka-consumer-groups.sh      kafka-replica-verification.sh  zookeeper-server-start.sh
kafka-consumer-perf-test.sh   kafka-run-class.sh             zookeeper-server-stop.sh
kafka-delegation-tokens.sh    kafka-server-start.sh          zookeeper-shell.sh
kafka-delete-records.sh       kafka-server-stop.sh
<span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>生产者：<a href="http://kafka-console-producer.sh" target="_blank" rel="noopener noreferrer">kafka-console-producer.sh<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li>消费者：<a href="http://kafka-console-consumer.sh" target="_blank" rel="noopener noreferrer">kafka-console-consumer.sh<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li>主题（集群）：<a href="http://kafka-topics.sh" target="_blank" rel="noopener noreferrer">kafka-topics.sh<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><h4 id="主题相关命令" tabindex="-1"><a class="header-anchor" href="#主题相关命令" aria-hidden="true">#</a> 主题相关命令</h4><p>查看主题操作的相关命令参数：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#主题命令</span>
<span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment"># bin/kafka-topics.sh</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>常用参数：</p><table><thead><tr><th>参数</th><th>描述</th></tr></thead><tbody><tr><td>--bootstrap-server &lt;String: server to connect to&gt;</td><td>连接的 Kafka Broker 主机名称和端口号</td></tr><tr><td>--topic &lt;String: topic&gt;</td><td>topic 的名称</td></tr><tr><td>--create</td><td>创建主题</td></tr><tr><td>--delete</td><td>删除主题</td></tr><tr><td>--alter</td><td>修改主题</td></tr><tr><td>--list</td><td>查看所有主题</td></tr><tr><td>--describe</td><td>查看主题详细描述信息</td></tr><tr><td>--partitions &lt;Integer: # of partitions&gt;</td><td>设置分区数</td></tr><tr><td>--replication-factor</td><td>设置分区副本</td></tr><tr><td>--config &lt;String: name=value&gt;</td><td>更新系统默认的配置</td></tr></tbody></table><p>示例：</p><ul><li><p>查看所有主题</p><p>多个 broker 以逗号隔开**【建议使用】**</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment"># bin/kafka-topics.sh --bootstrap-server 192.168.100.100:9092 --list</span>

<span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment"># bin/kafka-topics.sh --bootstrap-server 192.168.100.100:9092,192.168.100.110:9092 --list</span>

<span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment"># bin/kafka-topics.sh --bootstrap-server 192.168.100.100:9092,192.168.100.110:9092,192.168.100.120:9092 --list</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>创建主题 first</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment"># bin/kafka-topics.sh --bootstrap-server 192.168.100.100:9092 --create --partitions 1 --replication-factor 3 --topic first</span>
Created topic first.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>查看主题详情</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment"># bin/kafka-topics.sh --bootstrap-server 192.168.100.100:9092 --describe --topic first</span>
Topic: first    TopicId: RO0D3TvwR8yI3TX50bRZKQ PartitionCount: <span class="token number">1</span>       ReplicationFactor: <span class="token number">3</span>    Configs: <span class="token assign-left variable">segment.bytes</span><span class="token operator">=</span><span class="token number">1073741824</span>
        Topic: first    Partition: <span class="token number">0</span>    Leader: <span class="token number">2</span>       Replicas: <span class="token number">2,1</span>,0 Isr: <span class="token number">2,1</span>,0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Partition: 0【表示分配了一个分区，下标从 0 开始】</p><p>Leader: 2【表示 Leader 在下标为 2 的 broker 上】</p></li><li><p>增加主题分区数量，只能增加不能减少</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment"># bin/kafka-topics.sh --bootstrap-server 192.168.100.100:9092 --alter --partitions 2 --topic first</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>重新查看</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment"># bin/kafka-topics.sh --bootstrap-server 192.168.100.100:9092 --describe --topic first  </span>
Topic: first    TopicId: RO0D3TvwR8yI3TX50bRZKQ PartitionCount: <span class="token number">2</span>       ReplicationFactor: <span class="token number">3</span>    Configs: <span class="token assign-left variable">segment.bytes</span><span class="token operator">=</span><span class="token number">1073741824</span>
        Topic: first    Partition: <span class="token number">0</span>    Leader: <span class="token number">2</span>       Replicas: <span class="token number">2,1</span>,0 Isr: <span class="token number">2,1</span>,0
        Topic: first    Partition: <span class="token number">1</span>    Leader: <span class="token number">0</span>       Replicas: <span class="token number">0,1</span>,2 Isr: <span class="token number">0,1</span>,2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>此时有两个分区。</p></li><li><p>删除主题</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment"># bin/kafka-topics.sh --bootstrap-server 192.168.100.100:9092 --delete --topic first</span>
<span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h4 id="生产者相关命令" tabindex="-1"><a class="header-anchor" href="#生产者相关命令" aria-hidden="true">#</a> 生产者相关命令</h4><p>生产者操作脚本：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost bin<span class="token punctuation">]</span><span class="token comment"># kafka-console-producer.sh</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>相关参数：</p><table><thead><tr><th>参数</th><th>描述</th></tr></thead><tbody><tr><td>--bootstrap-server &lt;String: server to connect to&gt;</td><td>连接的 Kafka Broker 主机名称和端口号</td></tr><tr><td>--topic &lt;String: topic&gt;</td><td>操作的 topic 名称</td></tr></tbody></table><h4 id="消费者相关命令" tabindex="-1"><a class="header-anchor" href="#消费者相关命令" aria-hidden="true">#</a> 消费者相关命令</h4><p>消费者操作脚本：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost bin<span class="token punctuation">]</span><span class="token comment"># kafka-console-consumer.sh</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>相关参数：</p><table><thead><tr><th>参数</th><th>描述</th></tr></thead><tbody><tr><td>--bootstrap-server &lt;String: server to connect to&gt;</td><td>连接的 Kafka Broker 主机名称和端口号</td></tr><tr><td>--topic &lt;String: topic&gt;</td><td>操作的 topic 名称</td></tr><tr><td>--from-beginning</td><td>从头开始消费</td></tr><tr><td>--group &lt;String: consumer group id&gt;</td><td>指定消费者组名称</td></tr></tbody></table><p><strong>生产消费示例：</strong></p><ul><li><p>注意创建好分区：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost opt<span class="token punctuation">]</span><span class="token comment"># kafka-console-consumer.sh --bootstrap-server 192.168.100.110:9092 --topic first</span>
<span class="token punctuation">[</span><span class="token number">2023</span>-11-20 08:51:06,743<span class="token punctuation">]</span> WARN <span class="token punctuation">[</span>Consumer <span class="token assign-left variable">clientId</span><span class="token operator">=</span>consumer-console-consumer-56686-1, <span class="token assign-left variable">groupId</span><span class="token operator">=</span>console-consumer-56686<span class="token punctuation">]</span> Error <span class="token keyword">while</span> fetching metadata with correlation <span class="token function">id</span> <span class="token number">2</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>first<span class="token operator">=</span>INVALID_REPLICATION_FACTOR<span class="token punctuation">}</span> <span class="token punctuation">(</span>org.apache.kafka.clients.NetworkClient<span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>生产者发送消息</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment"># kafka-console-producer.sh --bootstrap-server 192.168.100.100:9092 --topic first</span>
<span class="token operator">&gt;</span>demo
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>消费者消费消息【消费者只能消费生产者发送消息的主机数据？尽量写全所有的 IP】</p><p>默认只消费主题中新生产的数据，如果包含主题所有的历史数据，需要添加参数 <code>--from-begining</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment"># kafka-console-consumer.sh --bootstrap-server 192.168.100.100:9092 --topic first</span>
<span class="token builtin class-name">test</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h2 id="kafka-生产者" tabindex="-1"><a class="header-anchor" href="#kafka-生产者" aria-hidden="true">#</a> kafka 生产者</h2><h3 id="生产者消息发送流程" tabindex="-1"><a class="header-anchor" href="#生产者消息发送流程" aria-hidden="true">#</a> 生产者消息发送流程</h3><h4 id="发送原理" tabindex="-1"><a class="header-anchor" href="#发送原理" aria-hidden="true">#</a> 发送原理</h4><figure><img src="/assets/Kafka生产者发送流程-525b95f8.png" alt="Kafka生产者发送流程.png" tabindex="0" loading="lazy"><figcaption>Kafka生产者发送流程.png</figcaption></figure><blockquote><ol><li><p>生产者通过 Main 线程发送消息，创建了 Producer 对象，调用 Send() 方法发送数据，根据业务需求经过拦截器对消息进行处理（一般不做处理），再由自己的序列化器进行序列化（跨节点通信），再通过分区器 Partitioner 规定每个数据发往那个分区，一个分区创建一个队列，即发往一个缓存队列中（在内存中创建），队列大小默认 32M，每一批次大小默认为 16K，发送数据时会创建批次大小，每个批次会从<code>内存池</code>中取出内存，当批次中的数据发送到 Kafka 集群中时，会将批次释放至内存池中。</p></li><li><p>再由 Sender 线程主动拉取数据，拉取数据时需要满足两个条件：</p><ul><li><strong>batch.size：只有数据积累到 batch.size 之后，sender 才会发送数据。默认 16K</strong></li><li><strong><a href="http://linger.ms" target="_blank" rel="noopener noreferrer">linger.ms<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>：如果数据迟迟未达到 batch.size，sender 等待 <a href="http://linger.ms" target="_blank" rel="noopener noreferrer">linger.ms<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 设置的时间到了之后就会发送数据。单位ms，默认值是 0ms，表示没有延迟。</strong></li></ul><p>发送数据到 broker 时，每个分区的数据，会以节点的形式发送，每一个节点会有一个队列，如果发送给 broker 的数据没有应答，则队列最多会缓存 5 个 Request。</p></li><li><p>Selector 负责建立 Socket 连接并发送数据，broker 对于发送的数据会进行 ACK 应答，其中：</p><ul><li>0：表示生产者发送过来的数据不需要等待数据落盘应答</li><li>1：表示生产者发送过来的数据，Leader 收到并落盘应答</li><li>-1（all）：表示生产者发送过来的数据，Leader 和 ISR 队列中的所有节点收到数据落盘后应答，-1 和 all 等价</li></ul><p>如果应答成功，则会清除掉 Request 中的数据，并清空分区中的数据，如果应答失败，则会进行重试，重试的最大次数为 Integer.MAX_VALUE</p></li></ol></blockquote><h4 id="重要参数列表" tabindex="-1"><a class="header-anchor" href="#重要参数列表" aria-hidden="true">#</a> 重要参数列表</h4><table><thead><tr><th>参数名称</th><th>描述</th></tr></thead><tbody><tr><td>bootstrap.servers</td><td>生产者连接集群所需的 broker 地址清单 。 例如 192.168.100.100:9092,192.168.100.110:9092,192.168.100.120:9092，可以设置 1 个或者多个，中间用逗号隔开。注意这里并非需要所有的 broker 地址，因为生产者从给定的 broker 里查找到其他 broker 信息</td></tr><tr><td>key.serializer 和 value.serializer</td><td><strong>指定发送消息的 key 和 value 的序列化类型（一定要写全类名）</strong></td></tr><tr><td>buffer.memory</td><td><strong>RecordAccumulator 缓冲区总大小，默认 32m</strong></td></tr><tr><td>batch.size</td><td><strong>缓冲区一批数据最大值，默认 16k。适当增加该值，可以提高吞吐量，但是如果该值设置太大，会导致数据传输延迟增加</strong></td></tr><tr><td><a href="http://linger.ms" target="_blank" rel="noopener noreferrer">linger.ms<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td><strong>如果数据迟迟未达到 batch.size，sender 等待 linger.time 之后就会发送数据。单位 ms，默认值是 0ms，表示没有延迟。生产环境建议该值大小为 5-100ms 之间</strong></td></tr><tr><td>acks</td><td>0：生产者发送过来的数据，不需要等数据落盘应答。<br>1：生产者发送过来的数据，Leader 收到数据后应答。<br>-1（all）：生产者发送过来的数据，Leader 和 ISR 队列里面的所有节点收齐数据后应答。默认值是-1，-1 和 all 是等价</td></tr><tr><td>max.in.flight.requests.per.connection</td><td>允许最多没有返回 ack 的次数，默认为 5，开启幂等性要保证该值是 1-5 的数字。</td></tr><tr><td>retries</td><td>当消息发送出现错误的时候，系统会重发消息。retries 表示重试次数。默认是 int 最大值，2147483647。 如果设置了重试，还想保证消息的有序性，需要设置 MAX_IN_FLIGHT_REQUESTS_PER_CONNECTION=1 否则在重试此失败消息的时候，其他的消息可能发送成功了</td></tr><tr><td><a href="http://retry.backoff.ms" target="_blank" rel="noopener noreferrer">retry.backoff.ms<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td>两次重试之间的时间间隔，默认是 100ms</td></tr><tr><td>enable.idempotence</td><td>是否开启幂等性，默认 true，开启幂等性</td></tr><tr><td>compression.type</td><td><strong>生产者发送的所有数据的压缩方式。默认是 none，也 就是不压缩。 支持压缩类型：none、gzip、snappy、lz4 和 zstd。</strong></td></tr></tbody></table><h3 id="异步发送-api" tabindex="-1"><a class="header-anchor" href="#异步发送-api" aria-hidden="true">#</a> 异步发送 API</h3><h4 id="普通异步发送" tabindex="-1"><a class="header-anchor" href="#普通异步发送" aria-hidden="true">#</a> 普通异步发送</h4><p>生产者发送时的异步指的是，数据发送到 RecordAccumulator 缓冲区中，无需等待 Sender 线程发送数据等待结果返回，即可再次发送数据到 RecordAccumulator 中。</p><p>示例：创建 Kafka 生产者，采用异步的方式发送到 Kafka Broker</p><ul><li><p>创建工程 Kafka_GettingStart</p></li><li><p>引入依赖：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.kafka<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>kafka-clients<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>创建生产者 CustomProducer</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>producer</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">KafkaProducer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">ProducerConfig</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">ProducerRecord</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>common<span class="token punctuation">.</span>serialization<span class="token punctuation">.</span></span><span class="token class-name">StringSerializer</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Properties</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * 生产者
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomProducer</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1. 创建配置对象</span>
        <span class="token class-name">Properties</span> properties <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ProducerConfig</span><span class="token punctuation">.</span><span class="token constant">BOOTSTRAP_SERVERS_CONFIG</span><span class="token punctuation">,</span> <span class="token string">&quot;192.168.100.100:9092,192.168.100.110:9092,192.168.100.120:9092&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 序列化器可以使用全类名或者 class.getName()</span>
        properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ProducerConfig</span><span class="token punctuation">.</span><span class="token constant">KEY_SERIALIZER_CLASS_CONFIG</span><span class="token punctuation">,</span> <span class="token class-name">StringSerializer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ProducerConfig</span><span class="token punctuation">.</span><span class="token constant">VALUE_SERIALIZER_CLASS_CONFIG</span><span class="token punctuation">,</span> <span class="token string">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2. 创建 KafkaProducer 对象</span>
        <span class="token comment">// try(KafkaProducer&lt;String, String&gt; kafkaProducer = new KafkaProducer&lt;&gt;(properties)){}</span>
        <span class="token comment">// public ProducerRecord(String topic, Integer partition, Long timestamp, K key, V value, Iterable&lt;Header&gt; headers)</span>
        <span class="token class-name">KafkaProducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> kafkaProducer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KafkaProducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>properties<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 3. 调用 Send 方法</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            kafkaProducer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ProducerRecord</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;first&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;example: &quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 4. 关闭资源</span>
        kafkaProducer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>启动消费者进行测试：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment"># kafka-console-consumer.sh --bootstrap-server 192.168.100.110:9092 --topic first</span>
example: <span class="token number">0</span>
example: <span class="token number">1</span>
example: <span class="token number">2</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h4 id="异步发送回调" tabindex="-1"><a class="header-anchor" href="#异步发送回调" aria-hidden="true">#</a> 异步发送回调</h4><ul><li><p>添加回调，此处的回调为生产者发送至 RecordAccumulator 后的回调。</p><p>回调函数会在 Producer 收到 Ack 时调用，为异步调用，该方法有两个参数，分别是元数据信息（RecordMetadata）和异常信息（Exception），如果 Exception 为 null，说明消息发送成功，如果 Exception 不为 null，说明消息发送失败</p><p><strong>注意：消息发送失败会自动重试，不需要在回调函数中手动重试</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>producer</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>common<span class="token punctuation">.</span>serialization<span class="token punctuation">.</span></span><span class="token class-name">StringSerializer</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Properties</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * 异步发送
 * 添加回调，此处的回调为生产者发送至 RecordAccumulator 后的回调
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomProducerCallback</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1. 创建配置对象</span>
        <span class="token class-name">Properties</span> properties <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ProducerConfig</span><span class="token punctuation">.</span><span class="token constant">BOOTSTRAP_SERVERS_CONFIG</span><span class="token punctuation">,</span> <span class="token string">&quot;192.168.100.100:9092,192.168.100.110:9092,192.168.100.120:9092&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ProducerConfig</span><span class="token punctuation">.</span><span class="token constant">KEY_SERIALIZER_CLASS_CONFIG</span><span class="token punctuation">,</span> <span class="token class-name">StringSerializer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ProducerConfig</span><span class="token punctuation">.</span><span class="token constant">VALUE_SERIALIZER_CLASS_CONFIG</span><span class="token punctuation">,</span> <span class="token string">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2. 创建 KafkaProducer 对象</span>
        <span class="token comment">// try(KafkaProducer&lt;String, String&gt; kafkaProducer = new KafkaProducer&lt;&gt;(properties)){}</span>
        <span class="token class-name">KafkaProducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> kafkaProducer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KafkaProducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>properties<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 3. 调用 Send 方法</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            kafkaProducer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ProducerRecord</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;first&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;example: &quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 此处的回调为生产者发送至 RecordAccumulator 后的回调</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onCompletion</span><span class="token punctuation">(</span><span class="token class-name">RecordMetadata</span> metadata<span class="token punctuation">,</span> <span class="token class-name">Exception</span> exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>exception <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Topic: &quot;</span> <span class="token operator">+</span> metadata<span class="token punctuation">.</span><span class="token function">topic</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;, Partition: &quot;</span> <span class="token operator">+</span> metadata<span class="token punctuation">.</span><span class="token function">partition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                        exception<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token comment">// 4. 关闭资源</span>
        kafkaProducer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>控制台打印：</p><div class="language-tex line-numbers-mode" data-ext="tex"><pre class="language-tex"><code>Topic: first, Partition: 0
Topic: first, Partition: 0
Topic: first, Partition: 0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="同步发送-api" tabindex="-1"><a class="header-anchor" href="#同步发送-api" aria-hidden="true">#</a> 同步发送 API</h3><p>生产者同步发送指的是，数据发送到 RecordAccumulator 缓冲区中，之后等待 Sender 线程发送数据到 broker ，等待结果返回之后，再次发送下一批数据。</p><ul><li><p>只需在异步发送的基础上，调用 get( ) 方法即可</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>producer</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>common<span class="token punctuation">.</span>serialization<span class="token punctuation">.</span></span><span class="token class-name">StringSerializer</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Properties</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ExecutionException</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * 同步发送
 * 指数据发送到 RecordAccumulator 缓冲区中，之后等待 Sender 线程发送数据到 broker ，等待结果返回之后，再次发送下一批数据。
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomProducerSync</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1. 创建配置对象</span>
        <span class="token class-name">Properties</span> properties <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ProducerConfig</span><span class="token punctuation">.</span><span class="token constant">BOOTSTRAP_SERVERS_CONFIG</span><span class="token punctuation">,</span> <span class="token string">&quot;192.168.100.100:9092,192.168.100.110:9092,192.168.100.120:9092&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ProducerConfig</span><span class="token punctuation">.</span><span class="token constant">KEY_SERIALIZER_CLASS_CONFIG</span><span class="token punctuation">,</span> <span class="token class-name">StringSerializer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ProducerConfig</span><span class="token punctuation">.</span><span class="token constant">VALUE_SERIALIZER_CLASS_CONFIG</span><span class="token punctuation">,</span> <span class="token string">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2. 创建 KafkaProducer 对象</span>
        <span class="token comment">// try(KafkaProducer&lt;String, String&gt; kafkaProducer = new KafkaProducer&lt;&gt;(properties)){}</span>
        <span class="token class-name">KafkaProducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> kafkaProducer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KafkaProducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>properties<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 3. 调用 Send 方法</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 同步发送</span>
            kafkaProducer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ProducerRecord</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;first&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;example: &quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 4. 关闭资源</span>
        kafkaProducer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>测试</p></li></ul><h3 id="生产者分区" tabindex="-1"><a class="header-anchor" href="#生产者分区" aria-hidden="true">#</a> 生产者分区</h3><h4 id="分区优点" tabindex="-1"><a class="header-anchor" href="#分区优点" aria-hidden="true">#</a> 分区优点</h4><ul><li><p>便于<strong>合理使用存储资源</strong>，每个 Partition 在一个 Broker 上存储，可以把海量的数据按照分区切割成一 块一块数据存储在多台 Broker 上。</p><p>合理控制分区的任务，可以实现负载均衡的效果</p></li><li><p><strong>提高并行度</strong>，生产者可以以分区为单位发送数据；消费者可以以分区为单位进行消费数据</p></li></ul><img src="/assets/Kafka分区优点-856ebecb.png" alt="Kafka分区优点.png" style="zoom:80%;"><h4 id="生产者发送消息的分区策略" tabindex="-1"><a class="header-anchor" href="#生产者发送消息的分区策略" aria-hidden="true">#</a> 生产者发送消息的分区策略</h4><p>分区策略由默认的分区器 DefaultPartitioner 决定。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * The default partitioning strategy:
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>If a partition is specified in the record, use it
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>If no partition is specified but a key is present choose a partition based on a hash of the key
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>If no partition or key is present choose the sticky partition that changes when the batch is full.
 * 
 * See KIP-480 for details about sticky partitioning.
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DefaultPartitioner</span> <span class="token keyword">implements</span> <span class="token class-name">Partitioner</span> <span class="token punctuation">{</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>默认的分区策略有三种情况：</p><ul><li>指明 partition 的情况下，将所有数据写入指定的分区</li><li>没有指明 partition 但是 key 存在，会对 key 的 hash 值与 topic 的 partition 进行取余得到 partition 值</li><li>既没有 partition 值又没有 key 值的情况下，Kafka 采用 Sticky Partition（黏性分区器），会随机选择一个分区，并尽可能一直使用该分区，待该分区的 batch 已满或者已完成，Kafka 再随机一个分区进行使用（和上一次的分区不同，如果此次随机选择的分区和上一个相同，则会重新选择分区）。</li></ul><p>在 ProducerRecord 中指定分区：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProducerRecord</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> topic<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Integer</span> partition<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Headers</span> headers<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">K</span> key<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">V</span> value<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Long</span> timestamp<span class="token punctuation">;</span>
    
    <span class="token comment">// ......</span>

    <span class="token keyword">public</span> <span class="token class-name">ProducerRecord</span><span class="token punctuation">(</span><span class="token class-name">String</span> topic<span class="token punctuation">,</span> <span class="token class-name">Integer</span> partition<span class="token punctuation">,</span> <span class="token class-name">Long</span> timestamp<span class="token punctuation">,</span> <span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> partition<span class="token punctuation">,</span> timestamp<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  
    <span class="token keyword">public</span> <span class="token class-name">ProducerRecord</span><span class="token punctuation">(</span><span class="token class-name">String</span> topic<span class="token punctuation">,</span> <span class="token class-name">Integer</span> partition<span class="token punctuation">,</span> <span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">,</span> <span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Header</span><span class="token punctuation">&gt;</span></span> headers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> partition<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> headers<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token class-name">ProducerRecord</span><span class="token punctuation">(</span><span class="token class-name">String</span> topic<span class="token punctuation">,</span> <span class="token class-name">Integer</span> partition<span class="token punctuation">,</span> <span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> partition<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token class-name">ProducerRecord</span><span class="token punctuation">(</span><span class="token class-name">String</span> topic<span class="token punctuation">,</span> <span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token class-name">ProducerRecord</span><span class="token punctuation">(</span><span class="token class-name">String</span> topic<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// ......</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>注意：通过示例时，如果初始只有一个分区，则指定的分区不存在时，程序会阻塞，因此需要确保分区的数量不止一个，方便观察分区策略</strong></p><p>示例一：指明 partition 的情况下，将所有数据写入指定的分区</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>producer</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>common<span class="token punctuation">.</span>serialization<span class="token punctuation">.</span></span><span class="token class-name">StringSerializer</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Properties</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * 分区
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomProducerCallbackPartition</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1. 创建配置对象</span>
        <span class="token class-name">Properties</span> properties <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ProducerConfig</span><span class="token punctuation">.</span><span class="token constant">BOOTSTRAP_SERVERS_CONFIG</span><span class="token punctuation">,</span> <span class="token string">&quot;192.168.100.100:9092,192.168.100.110:9092,192.168.100.120:9092&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ProducerConfig</span><span class="token punctuation">.</span><span class="token constant">KEY_SERIALIZER_CLASS_CONFIG</span><span class="token punctuation">,</span> <span class="token class-name">StringSerializer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ProducerConfig</span><span class="token punctuation">.</span><span class="token constant">VALUE_SERIALIZER_CLASS_CONFIG</span><span class="token punctuation">,</span> <span class="token string">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// properties.put(ProducerConfig.PARTITIONER_CLASS_CONFIG, &quot;com.example.kafka.producer.MyPartitioner&quot;);</span>
        <span class="token comment">// 2. 创建 KafkaProducer 对象</span>
        <span class="token comment">// try(KafkaProducer&lt;String, String&gt; kafkaProducer = new KafkaProducer&lt;&gt;(properties)){}</span>
        <span class="token class-name">KafkaProducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> kafkaProducer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KafkaProducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>properties<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 3. 调用 Send 方法</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 指明 partition 的情况下，将所有数据写入指定的分区</span>
            kafkaProducer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ProducerRecord</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;first&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;example: &quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onCompletion</span><span class="token punctuation">(</span><span class="token class-name">RecordMetadata</span> metadata<span class="token punctuation">,</span> <span class="token class-name">Exception</span> exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>exception <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Topic: &quot;</span> <span class="token operator">+</span> metadata<span class="token punctuation">.</span><span class="token function">topic</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;, Partition: &quot;</span> <span class="token operator">+</span> metadata<span class="token punctuation">.</span><span class="token function">partition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                        exception<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 4. 关闭资源</span>
        kafkaProducer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>示例二：没有指明 partition 但是 key 存在，会对 key 的 hash 值与 topic 的 partition 进行取余得到 partition 值</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 没有指明 partition 但是 key 存在，会对 key 的 hash 值与 topic 的 partition 进行取余得到 partition 值</span>
        kafkaProducer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ProducerRecord</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;first&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;c&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;example: &quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onCompletion</span><span class="token punctuation">(</span><span class="token class-name">RecordMetadata</span> metadata<span class="token punctuation">,</span> <span class="token class-name">Exception</span> exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>exception <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Topic: &quot;</span> <span class="token operator">+</span> metadata<span class="token punctuation">.</span><span class="token function">topic</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;, Partition: &quot;</span> <span class="token operator">+</span> metadata<span class="token punctuation">.</span><span class="token function">partition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    exception<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="自定义分区器" tabindex="-1"><a class="header-anchor" href="#自定义分区器" aria-hidden="true">#</a> 自定义分区器</h4><p>自定义分区器时，需要实现 Partitioner 接口，重写 partition 方法，使用自定义分区器时，需要在 Properties 中配置参数</p><p>MyPartitioner：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>producer</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">Partitioner</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>common<span class="token punctuation">.</span></span><span class="token class-name">Cluster</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * 自定义分区
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyPartitioner</span> <span class="token keyword">implements</span> <span class="token class-name">Partitioner</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     *
     * <span class="token keyword">@param</span> <span class="token parameter">topic</span> The topic name
     * <span class="token keyword">@param</span> <span class="token parameter">key</span> The key to partition on (or null if no key)
     * <span class="token keyword">@param</span> <span class="token parameter">keyBytes</span> The serialized key to partition on( or null if no key)
     * <span class="token keyword">@param</span> <span class="token parameter">value</span> The value to partition on or null
     * <span class="token keyword">@param</span> <span class="token parameter">valueBytes</span> The serialized value to partition on or null
     * <span class="token keyword">@param</span> <span class="token parameter">cluster</span> The current cluster metadata
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">partition</span><span class="token punctuation">(</span><span class="token class-name">String</span> topic<span class="token punctuation">,</span> <span class="token class-name">Object</span> key<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> keyBytes<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> valueBytes<span class="token punctuation">,</span> <span class="token class-name">Cluster</span> cluster<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> value<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;example&quot;</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">2</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token operator">?</span><span class="token punctuation">&gt;</span></span> configs<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在 Properties 中配置参数：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>	properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ProducerConfig</span><span class="token punctuation">.</span><span class="token constant">PARTITIONER_CLASS_CONFIG</span><span class="token punctuation">,</span> <span class="token string">&quot;com.example.kafka.MyPartitioner&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="生产者如何提高吞吐量" tabindex="-1"><a class="header-anchor" href="#生产者如何提高吞吐量" aria-hidden="true">#</a> 生产者如何提高吞吐量</h3><p>设置几个重要参数：</p><ol><li>batch.size：批次大小，默认 16K <ul><li><strong>每次发送到 broker 的消息数据量大小</strong></li></ul></li><li><a href="http://linger.ms" target="_blank" rel="noopener noreferrer">linger.ms<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>：等待时间，生产中一般设置为 5 - 100ms <ul><li><strong>默认 0s，只要有消息就会被发送到 broker，但是会影响效率，当 <a href="http://linger.ms" target="_blank" rel="noopener noreferrer">linger.ms<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 设置较大时，消息有延迟。</strong></li></ul></li><li>compression.type：压缩 snappy <ul><li><strong>对批次数据进行压缩可以提高传输量，默认 none，可配置值 gzip、snappy（常用）、 lz4 和 zstd</strong></li></ul></li><li>RecordAccumulator：缓冲区大小，修改为 64M <ul><li><strong>当生产者异步发送消息时，如果 RecordAccumulator 过小，会造成消息堆积，生产者端会阻塞。</strong></li></ul></li></ol><p>示例：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>producer</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">KafkaProducer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">Producer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">ProducerConfig</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">ProducerRecord</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>common<span class="token punctuation">.</span>serialization<span class="token punctuation">.</span></span><span class="token class-name">StringSerializer</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Properties</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * 生产者提高吞吐量参数配置
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomProducerParameter</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Properties</span> properties <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ProducerConfig</span><span class="token punctuation">.</span><span class="token constant">BOOTSTRAP_SERVERS_CONFIG</span><span class="token punctuation">,</span> <span class="token string">&quot;192.168.100.100:9092,192.168.100.110:9092,192.168.100.120:9092&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ProducerConfig</span><span class="token punctuation">.</span><span class="token constant">KEY_SERIALIZER_CLASS_CONFIG</span><span class="token punctuation">,</span> <span class="token class-name">StringSerializer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ProducerConfig</span><span class="token punctuation">.</span><span class="token constant">VALUE_SERIALIZER_CLASS_CONFIG</span><span class="token punctuation">,</span> <span class="token string">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// batch.size 默认 16K</span>
        properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ProducerConfig</span><span class="token punctuation">.</span><span class="token constant">BATCH_SIZE_CONFIG</span><span class="token punctuation">,</span> <span class="token number">16384</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// linger.ms 默认 0ms</span>
        properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ProducerConfig</span><span class="token punctuation">.</span><span class="token constant">LINGER_MS_CONFIG</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// compression.type</span>
        properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ProducerConfig</span><span class="token punctuation">.</span><span class="token constant">COMPRESSION_TYPE_CONFIG</span><span class="token punctuation">,</span> <span class="token string">&quot;snappy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// RecordAccumulator 默认 64M</span>
        properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ProducerConfig</span><span class="token punctuation">.</span><span class="token constant">BUFFER_MEMORY_CONFIG</span><span class="token punctuation">,</span> <span class="token number">33554432</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">KafkaProducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> kafkaProducer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KafkaProducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>properties<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            kafkaProducer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ProducerRecord</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;first&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;example: &quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        kafkaProducer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="数据可靠性" tabindex="-1"><a class="header-anchor" href="#数据可靠性" aria-hidden="true">#</a> 数据可靠性</h3><p><strong>ACK 应答级别：</strong></p><ul><li>0：表示生产者发送过来的数据不需要等待数据落盘应答</li><li>1：表示生产者发送过来的数据，Leader 收到并落盘应答</li><li>-1（all）：表示生产者发送过来的数据，Leader 和 ISR 队列中的所有节点收到数据落盘后应答，-1 和 all 等价</li></ul><figure><img src="/assets/Kafka生产者发送流程-525b95f8.png" alt="Kafka生产者发送流程.png" tabindex="0" loading="lazy"><figcaption>Kafka生产者发送流程.png</figcaption></figure><p>ACK 应答级别：</p><ul><li><p>0：表示生产者发送过来的数据不需要等待数据落盘应答</p><p><strong>如果 Leader 收到数据后，尚且没有落盘，此时 Leader 挂掉，那么数据就会丢失。</strong></p><img src="/assets/ACK应答级别0-d34a6758.png" alt="ACK应答级别.0png" style="zoom:67%;"></li><li><p>1：表示生产者发送过来的数据，Leader 收到并落盘应答</p><p><strong>应答完成后，还没有同步副本，此时 Leader 挂掉，从剩余的 Follower 中选出 Leader，新的 Leader 不会收到消息，因为生产者认为已经发送成功了，会导致数据丢失。</strong></p><img src="/assets/ACK应答级别1-4457423a.png" alt="ACK 应答级别1.png" style="zoom:80%;"></li><li><p>-1（all）：默认值，表示生产者发送过来的数据，Leader 和 ISR （可以理解为保持同步的 Leader 和 Follower 集合）队列中的所有节点收到数据落盘后应答，-1 和 all 等价，如果 Leader 收到数据，所有 Follower 都开始同步数据， 但有一个 Follower，因为某种故障，迟迟不能与 Leader 进行同步，这样就会导致 Leader 不能应答，进而因为一个 Follower 挂掉导致整个集群瘫痪。</p><p><strong>因此 Leader 维护了一个动态的 in-sync replica set（ISR），意为和 Leader 保持同步的 Follower + Leader 集合（leader：0，isr:0,1,2）。如果 Follower 长时间未向Leader 发送通信请求或同步数据，则该 Follower 将被踢出 ISR。该时间阈值由 <a href="http://replica.lag.time.max.ms" target="_blank" rel="noopener noreferrer">replica.lag.time.max.ms<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 参数设定，默认 30s。这样就不用等待长期联系不上或者已经故障的节点。</strong></p><img src="/assets/ACK应答级别all-4746bd8a.png" alt="ACK 应答级别all.png" style="zoom:80%;"></li></ul><p>需要注意的是：如果分区副本设置为 1 个，或者 ISR 里应答的最小副本数量 （ min.insync.replicas 默认为1）设置为1，和 ack = 1 的效果是一样的，仍然有丢数的风险（leader：0，isr:0）</p><p><strong>因此：数据完全可靠条件 = ACK 级别设置为 -1 + 分区副本大于等于 2 + ISR 里应答的最小副本数量大于等于 2</strong></p><p>可靠性总结：</p><ul><li>acks = 0，生产者发送数据过来后，不需要等待数据落盘应答，可靠性差，效率高</li><li>acks = 1，生产者发送过来数据 Leader 应答落盘，可靠性中等，效率中等</li><li>acks = -1，生产者发送过来数据 Leader 和 ISR 队列里面所有 Follwer 应答，可靠性高，效率低</li><li>在生产环境中，acks=0 很少使用；acks=1，一般用于传输普通日志，允许丢个别数据；acks=-1，一般用于传输和钱相关的数据， 对可靠性要求比较高的场景。</li></ul><p>示例：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>producer</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">KafkaProducer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">ProducerConfig</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">ProducerRecord</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>common<span class="token punctuation">.</span>serialization<span class="token punctuation">.</span></span><span class="token class-name">StringSerializer</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Properties</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * 数据可靠性：ACK 应答级别
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomProducerACK</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">Properties</span> properties <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ProducerConfig</span><span class="token punctuation">.</span><span class="token constant">BOOTSTRAP_SERVERS_CONFIG</span><span class="token punctuation">,</span> <span class="token string">&quot;192.168.100.100:9092,192.168.100.110:9092,192.168.100.120:9092&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ProducerConfig</span><span class="token punctuation">.</span><span class="token constant">KEY_SERIALIZER_CLASS_CONFIG</span><span class="token punctuation">,</span> <span class="token class-name">StringSerializer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ProducerConfig</span><span class="token punctuation">.</span><span class="token constant">VALUE_SERIALIZER_CLASS_CONFIG</span><span class="token punctuation">,</span> <span class="token string">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// ACK 应答级别</span>
        properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ProducerConfig</span><span class="token punctuation">.</span><span class="token constant">ACKS_CONFIG</span><span class="token punctuation">,</span> <span class="token string">&quot;all&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 重试次数 retries，默认 2147483647</span>
        properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ProducerConfig</span><span class="token punctuation">.</span><span class="token constant">RETRIES_CONFIG</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">KafkaProducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> kafkaProducer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KafkaProducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>properties<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            kafkaProducer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ProducerRecord</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;first&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;example: &quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        kafkaProducer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="数据去重" tabindex="-1"><a class="header-anchor" href="#数据去重" aria-hidden="true">#</a> 数据去重</h3><p>**数据重复：**当应答级别为 all ，并且 Leader 和所有 Follower 都落盘后，Leader 还未应答，便已经挂掉，此时重新选举出 Leader 后，生产者重新发送消息，便会造成数据的重复。</p><img src="/assets/ACK应答级别为all时数据重复-de77c603.png" alt="ACK应答级别为all时数据重复.png" style="zoom:67%;"><h4 id="数据传递语义" tabindex="-1"><a class="header-anchor" href="#数据传递语义" aria-hidden="true">#</a> 数据传递语义</h4><ul><li><p>至少一次（At Least Once）= ACK 级别设置为 -1 + 分区副本大于等于 2 + ISR 里应答的最小副本数量大于等于2 【数据不丢】</p></li><li><p>最多一次（At Most Once）= ACK 级别设置为 0 【数据不重】</p></li><li><p>总结： At Least Once 可以保证数据不丢失，但是不能保证数据不重复； At Most Once 可以保证数据不重复，但是不能保证数据不丢失。</p></li><li><p>精确一次（Exactly Once）：对于一些非常重要的信息，比如和钱相关的数据，要求数据既不能重复也不丢失。</p></li><li><p>Kafka 0.11 版本以后，引入了一项重大特性：<strong>幂等性和事务</strong></p></li></ul><h4 id="幂等性" tabindex="-1"><a class="header-anchor" href="#幂等性" aria-hidden="true">#</a> 幂等性</h4><p><strong>幂等性原理：</strong></p><p>幂等性就是指 Producer 不论向 Broker 发送多少次重复数据，Broker 端都只会持久化一条，保证了不重复</p><p>精确一次（Exactly Once） = 幂等性 + 至少一次（ ack = -1 + 分区副本数 &gt;= 2 + ISR 最小副本数量 &gt;= 2）</p><p>重复数据的判断标准：具有【PID、Partition、SeqNumber】相同主键（key）的消息提交时，Broker 只会持久化一条。其中：</p><ul><li>PID 是 Kafka 每次重启都会分配一个新的</li><li>Partition 表示分区号</li><li>Sequence Number是单调自增的</li></ul><p><strong>所以幂等性只能保证的是在单分区单会话内不重复，一旦重启仍可能重复，如果要保证不重复，需要事务支持。</strong></p><p>如以下两个消息分别发送两个不同的分区。</p><figure><img src="/assets/幂等性原理-cf141c94.png" alt="幂等性原理.png" tabindex="0" loading="lazy"><figcaption>幂等性原理.png</figcaption></figure><p>**使用幂等性：**开启参数 enable.idempotence 默认为 true，false 关闭</p><h4 id="生产者事务" tabindex="-1"><a class="header-anchor" href="#生产者事务" aria-hidden="true">#</a> 生产者事务</h4><p><strong>Kafka 事务原理：</strong></p><p><strong>注意：开启事务，必须开启幂等性</strong></p><figure><img src="/assets/生产者事务原理-bc920ef1.png" alt="生产者事务原理.png" tabindex="0" loading="lazy"><figcaption>生产者事务原理.png</figcaption></figure><p>说明：</p><blockquote><ol><li>每个 Broker 都有一个事务协调器，事务需要持久化到磁盘上，有一个存储事务的特殊主题 Topic，该 Topic 有 50 个分区，每个分区负责一部分事务，需要手动指定事务 <a href="http://Transactional.id" target="_blank" rel="noopener noreferrer">Transactional.id<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> ，根据 hashcode % 50 决定采用这 50 个分区中的哪一个分区</li></ol></blockquote><h4 id="相关-api" tabindex="-1"><a class="header-anchor" href="#相关-api" aria-hidden="true">#</a> 相关 API</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">KafkaProducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">Producer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token comment">// 1 初始化事务</span>
    <span class="token keyword">void</span> <span class="token function">initTransactions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 2 开启事务</span>
    <span class="token keyword">void</span> <span class="token function">beginTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ProducerFencedException</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 3 在事务内提交已经消费的偏移量（主要用于消费者）</span>
    <span class="token keyword">void</span> <span class="token function">sendOffsetsToTransaction</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TopicPartition</span><span class="token punctuation">,</span> <span class="token class-name">OffsetAndMetadata</span><span class="token punctuation">&gt;</span></span> offsets<span class="token punctuation">,</span> <span class="token class-name">String</span> consumerGroupId<span class="token punctuation">)</span> <span class="token keyword">throws</span>   <span class="token class-name">ProducerFencedException</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 4 提交事务</span>
    <span class="token keyword">void</span> <span class="token function">commitTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ProducerFencedException</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 5 放弃事务（类似于回滚事务的操作）</span>
    <span class="token keyword">void</span> <span class="token function">abortTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ProducerFencedException</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>示例：通过事务保证消息不重复也不丢失</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>producer</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">KafkaProducer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">ProducerConfig</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">ProducerRecord</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>common<span class="token punctuation">.</span>serialization<span class="token punctuation">.</span></span><span class="token class-name">StringSerializer</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Properties</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * 通过事务保证消息不重复也不丢失
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomProducerTransaction</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">Properties</span> properties <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ProducerConfig</span><span class="token punctuation">.</span><span class="token constant">BOOTSTRAP_SERVERS_CONFIG</span><span class="token punctuation">,</span> <span class="token string">&quot;192.168.100.100:9092,192.168.100.110:9092,192.168.100.120:9092&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ProducerConfig</span><span class="token punctuation">.</span><span class="token constant">KEY_SERIALIZER_CLASS_CONFIG</span><span class="token punctuation">,</span> <span class="token class-name">StringSerializer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ProducerConfig</span><span class="token punctuation">.</span><span class="token constant">VALUE_SERIALIZER_CLASS_CONFIG</span><span class="token punctuation">,</span> <span class="token string">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 设置事务ID</span>
        properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ProducerConfig</span><span class="token punctuation">.</span><span class="token constant">TRANSACTIONAL_ID_CONFIG</span><span class="token punctuation">,</span> <span class="token string">&quot;transaction_id_0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">KafkaProducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> kafkaProducer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KafkaProducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>properties<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 初始化事务</span>
        kafkaProducer<span class="token punctuation">.</span><span class="token function">initTransactions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 开启事务</span>
        kafkaProducer<span class="token punctuation">.</span><span class="token function">beginTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                kafkaProducer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ProducerRecord</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;first&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;example: &quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// 模拟 Kafka 异常</span>
            <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">/</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token comment">// 提交事务</span>
            kafkaProducer<span class="token punctuation">.</span><span class="token function">commitTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 回滚事务</span>
            kafkaProducer<span class="token punctuation">.</span><span class="token function">abortTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            kafkaProducer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="数据乱序" tabindex="-1"><a class="header-anchor" href="#数据乱序" aria-hidden="true">#</a> 数据乱序</h3><p>数据乱序：</p><p>如下示例，Request1 和 Request2 发送成功会数据会落盘，Request3 因故障没有发送成功，后面的 Request4 和 Request5 却不会落盘，当 Request3 发送并落盘后，Request4 和 Request5 才会落盘，以此保证数据的有序性。</p><figure><img src="/assets/单分区数据有序-3cf30c41.png" alt="单分区数据有序.png" tabindex="0" loading="lazy"><figcaption>单分区数据有序.png</figcaption></figure><ul><li><p>kafka 在 1.x 版本之前保证数据单分区有序，条件如下：</p><p>max.in.flight.requests.per.connection = 1（不需要考虑是否开启幂等性）。</p></li><li><p>kafka 在 1.x 及以后版本保证数据单分区有序，条件如下：</p><ul><li><strong>未开启幂等性</strong>： max.in.flight.requests.per.connection 需要设置为 1</li><li><strong>开启幂等性</strong>： max.in.flight.requests.per.connection 需要设置小于等于 5 <ul><li>说明：因为在 kafka1.x 以后，启用幂等后，kafka 服务端会缓存 producer 发来的最近 5 个 request 的元数据， 故无论如何，都可以保证最近 5 个request 的数据都是有序的</li></ul></li></ul></li></ul><h3 id="数据有序" tabindex="-1"><a class="header-anchor" href="#数据有序" aria-hidden="true">#</a> 数据有序</h3><ul><li>对于单分区内保证数据有序</li><li>但多分区，分区与分区之间是无序的，如果要保证多分区内数据有序，则可以在消费端进行数据的重排序。</li></ul><img src="/assets/数据有序-45dfe85e.png" alt="数据有序.png" style="zoom:67%;"><h2 id="kafka-broker" tabindex="-1"><a class="header-anchor" href="#kafka-broker" aria-hidden="true">#</a> Kafka Broker</h2><h3 id="kafka-broker-工作流程" tabindex="-1"><a class="header-anchor" href="#kafka-broker-工作流程" aria-hidden="true">#</a> Kafka Broker 工作流程</h3><h4 id="zookeeper-存储的-kafka-信息" tabindex="-1"><a class="header-anchor" href="#zookeeper-存储的-kafka-信息" aria-hidden="true">#</a> Zookeeper 存储的 Kafka 信息</h4><p>在 Zookeeper 中查看 kafka 的信息</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment"># zkCli.sh</span>
<span class="token punctuation">[</span>zk: localhost:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token function">ls</span> /kafka
<span class="token punctuation">[</span>admin, brokers, cluster, config, consumers, controller, controller_epoch, feature, isr_change_notification, latest_producer_id_block, log_dir_event_notification<span class="token punctuation">]</span>
<span class="token punctuation">[</span>zk: localhost:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">4</span><span class="token punctuation">]</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Zookeeper 中存储的 Kafka 信息：</p><p>![Zookeeper 中存储的 Kafka 信息](Kafka/Zookeeper 中存储的 Kafka 信息.png)</p><h4 id="kafka-broker-整体工作流程" tabindex="-1"><a class="header-anchor" href="#kafka-broker-整体工作流程" aria-hidden="true">#</a> Kafka Broker 整体工作流程</h4><p>![Kafka Broker 整体工作流程](Kafka/Kafka Broker 整体工作流程.png)</p><p>说明：</p><blockquote><ol><li>Broker 在 Zookeeper 中注册：<code>/brokers/ids/ [0,1,2]</code></li><li>每个 Broker 上都有一个 Controller，谁先注册进 Zookeeper，谁就是具有话语权的 Controller，则这个选举出来的 Controller 会监听 brokers 节点的变化，进行辅助选举</li><li>之后进行正式的选举，选举规则：在 ISR 中存活为前提，按照 AR（Kakfa 分区中所有副本的统称）中排列在前面的优先，例如 ISR【1, 0, 2】，AR【1, 0, 2】，则 Leader 会轮询从 1, 0, 2 中产生</li><li>此时由 Controller 将节点的信息上传至 Zookeeper，其他的 Controller 从 Zookeeper 中拉取同步相关信息（为了避免 Controller 挂掉）</li><li>Producer 发送消息给 Leader，同步给副本，文件以 Log （虚拟的）的形式存在，Log 由 Segment 实现（1G），保证读取数据，Segment 使用了 .log （数据）文件和 .index （索引）文件。</li><li>假设 Broker 中的 Leader 1挂掉，Controller 会监听到节点的变化，同时获取 ISR，重新选举，选举规则同上，选出 Leader 0 ，完成后更新 Leader 和 ISR</li></ol></blockquote><p>示例：演示 Kafka 节点的上下线</p><ol><li><p>关闭 192.168.100.120 broker</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>kafka-server-stop.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>使用 Zookeeper 可视化工具 PrettyZoo 查看节点 brokers 的变化情况</p></li><li><p>重新启动 192.168.100.100 broker</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>kafka-server-start.sh <span class="token parameter variable">-daemon</span> /opt/kafka/kafka3.x/config/server.properties
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ol><h4 id="broker-重要参数" tabindex="-1"><a class="header-anchor" href="#broker-重要参数" aria-hidden="true">#</a> Broker 重要参数</h4><table><thead><tr><th>参数名称</th><th>描述</th></tr></thead><tbody><tr><td><a href="http://replica.lag.time.max.ms" target="_blank" rel="noopener noreferrer">replica.lag.time.max.ms<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td>ISR 中，如果 Follower 长时间未向 Leader 发送通 信请求或同步数据，则该 Follower 将被踢出 ISR。 该时间阈值，默认 30s。</td></tr><tr><td>auto.leader.rebalance.enable</td><td>默认是 true。 自动 Leader Partition 平衡。</td></tr><tr><td>leader.imbalance.per.broker.percentag</td><td>默认是 10%。每个 broker 允许的不平衡的 leader 的比率。如果每个 broker 超过了这个值，控制器 会触发 leader 的平衡。</td></tr><tr><td>leader.imbalance.check.interval.seconds</td><td>默认值 300 秒。检查 leader 负载是否平衡的间隔时 间。</td></tr><tr><td>log.segment.bytes</td><td>Kafka 中 log 日志是分成一块块存储的，此配置是 指 log 日志划分 成块的大小，默认值 1G。</td></tr><tr><td>log.index.interval.bytes</td><td>默认 4kb，kafka 里面每当写入了 4kb 大小的日志 （.log），然后就往 index 文件里面记录一个索引。</td></tr><tr><td>log.retention.hours</td><td>Kafka 中数据保存的时间，默认 7 天。</td></tr><tr><td>log.retention.minutes</td><td>Kafka 中数据保存的时间，分钟级别，默认关闭。</td></tr><tr><td><a href="http://log.retention.ms" target="_blank" rel="noopener noreferrer">log.retention.ms<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td>Kafka 中数据保存的时间，毫秒级别，默认关闭。</td></tr><tr><td><a href="http://log.retention.check.interval.ms" target="_blank" rel="noopener noreferrer">log.retention.check.interval.ms<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td>检查数据是否保存超时的间隔，默认是 5 分钟。</td></tr><tr><td>log.retention.bytes</td><td>默认等于-1，表示无穷大。超过设置的所有日志总 大小，删除最早的 segment。</td></tr><tr><td>log.cleanup.policy</td><td>默认是 delete，表示所有数据启用删除策略； 如果设置值为 compact，表示所有数据启用压缩策 略。</td></tr><tr><td>num.io.threads</td><td>默认是 8。负责写磁盘的线程数。整个参数值要占 总核数的 50%。</td></tr><tr><td>num.replica.fetchers</td><td>副本拉取线程数，这个参数占总核数的 50%的 1/3</td></tr><tr><td>num.network.threads</td><td>默认是 3。数据传输线程数，这个参数占总核数的 50%的 2/3 。</td></tr><tr><td>log.flush.interval.messages</td><td>强制页缓存刷写到磁盘的条数，默认是 long 的最 大值，9223372036854775807。一般不建议修改， 交给系统自己管理</td></tr><tr><td><a href="http://log.flush.interval.ms" target="_blank" rel="noopener noreferrer">log.flush.interval.ms<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td>每隔多久，刷数据到磁盘，默认是 null。一般不建 议修改，交给系统自己管理。</td></tr></tbody></table><h3 id="节点服役与退役" tabindex="-1"><a class="header-anchor" href="#节点服役与退役" aria-hidden="true">#</a> 节点服役与退役</h3><h4 id="服役新节点" tabindex="-1"><a class="header-anchor" href="#服役新节点" aria-hidden="true">#</a> 服役新节点</h4><p><strong>创建新节点</strong></p><ul><li>克隆一台新节点，修改 IP 以及主机名称 <code>vim /etc/hostname</code></li><li>删除 datas 和 logs 目录</li><li>修改 server.properties 的 <a href="http://broker.id" target="_blank" rel="noopener noreferrer">broker.id<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>，listeners，advertised.listeners</li><li>单独启动该节点</li></ul><p>示例：克隆主机为 192.168.100.130</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># cd /opt/kafka/kafka3.x/</span>
<span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment"># rm -rf datas/ logs/</span>
<span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment"># vim config/server.properties</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment"># zk.sh start</span>
<span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment"># kf.sh start</span>
<span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment"># jpsall.sh start</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>单独启动 192.168.100.130 的 kafka，查看主题 first ，发现 Replicas 等没有进行负载均衡。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment"># kafka-server-start.sh -daemon ./config/server.properties</span>
<span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment"># kafka-topics.sh --bootstrap-server=192.168.100.100:9092 --describe --topic first</span>
Topic: first    TopicId: rTpcJQk3RmCjahRc8mAQiw PartitionCount: <span class="token number">1</span>       ReplicationFactor: <span class="token number">3</span>    Configs: <span class="token assign-left variable">segment.bytes</span><span class="token operator">=</span><span class="token number">1073741824</span>
        Topic: first    Partition: <span class="token number">0</span>    Leader: <span class="token number">2</span>       Replicas: <span class="token number">0,2</span>,1 Isr: <span class="token number">2,0</span>,1
<span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>执行负载均衡操作</strong></p><ul><li><p>在 192.168.100.100 创建一个需要均衡的主题，如 first</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment"># vim topics-to-move.json</span>
<span class="token punctuation">{</span>
     <span class="token string">&quot;topics&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
     	<span class="token punctuation">{</span><span class="token string">&quot;topic&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;first&quot;</span><span class="token punctuation">}</span>
     <span class="token punctuation">]</span>,
     <span class="token string">&quot;version&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>生成一个负载均衡的计划，不满意可以重复执行</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment"># kafka-reassign-partitions.sh --bootstrap-server 192.168.100.100:9092 --topics-to-move-json-file topics-to-move.json --broker-list &quot;0,1,2,3&quot; --generate</span>
Current partition replica assignment
<span class="token punctuation">{</span><span class="token string">&quot;version&quot;</span>:1,<span class="token string">&quot;partitions&quot;</span>:<span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">&quot;topic&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;first&quot;</span>,<span class="token string">&quot;partition&quot;</span>:0,<span class="token string">&quot;replicas&quot;</span>:<span class="token punctuation">[</span><span class="token number">0,2</span>,1<span class="token punctuation">]</span>,<span class="token string">&quot;log_dirs&quot;</span>:<span class="token punctuation">[</span><span class="token string">&quot;any&quot;</span>,<span class="token string">&quot;any&quot;</span>,<span class="token string">&quot;any&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span>

Proposed partition reassignment configuration
<span class="token punctuation">{</span><span class="token string">&quot;version&quot;</span>:1,<span class="token string">&quot;partitions&quot;</span>:<span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">&quot;topic&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;first&quot;</span>,<span class="token string">&quot;partition&quot;</span>:0,<span class="token string">&quot;replicas&quot;</span>:<span class="token punctuation">[</span><span class="token number">2,1</span>,3<span class="token punctuation">]</span>,<span class="token string">&quot;log_dirs&quot;</span>:<span class="token punctuation">[</span><span class="token string">&quot;any&quot;</span>,<span class="token string">&quot;any&quot;</span>,<span class="token string">&quot;any&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>创建副本存储计划（所有副本存储在 broker0、broker1、broker2、broker3 中）</p><p>将上述执行计划中的 <code>Proposed partition reassignment configuration</code>写入文件中</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment"># vim increase-replication-factor.json</span>
<span class="token punctuation">{</span><span class="token string">&quot;version&quot;</span>:1,<span class="token string">&quot;partitions&quot;</span>:<span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">&quot;topic&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;first&quot;</span>,<span class="token string">&quot;partition&quot;</span>:0,<span class="token string">&quot;replicas&quot;</span>:<span class="token punctuation">[</span><span class="token number">2,1</span>,3<span class="token punctuation">]</span>,<span class="token string">&quot;log_dirs&quot;</span>:<span class="token punctuation">[</span><span class="token string">&quot;any&quot;</span>,<span class="token string">&quot;any&quot;</span>,<span class="token string">&quot;any&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>执行副本存储计划</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment"># kafka-reassign-partitions.sh --bootstrap-server 192.168.100.100:9092 --reassignment-jn-file increase-replication-factor.json --execute</span>
Current partition replica assignment

<span class="token punctuation">{</span><span class="token string">&quot;version&quot;</span>:1,<span class="token string">&quot;partitions&quot;</span>:<span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">&quot;topic&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;first&quot;</span>,<span class="token string">&quot;partition&quot;</span>:0,<span class="token string">&quot;replicas&quot;</span>:<span class="token punctuation">[</span><span class="token number">0,2</span>,1<span class="token punctuation">]</span>,<span class="token string">&quot;log_dirs&quot;</span>:<span class="token punctuation">[</span><span class="token string">&quot;any&quot;</span>,<span class="token string">&quot;any&quot;</span>,<span class="token string">&quot;any&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span>

Save this to use as the --reassignment-json-file option during rollback
Successfully started partition reassignment <span class="token keyword">for</span> first-0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>验证副本存储计划</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment"># kafka-reassign-partitions.sh --bootstrap-server 192.168.100.100:9092 --reassignment-json-file increase-replication-factor.json --verify</span>
Status of partition reassignment:
Reassignment of partition first-0 is complete.

Clearing broker-level throttles on brokers <span class="token number">0,1</span>,2,3
Clearing topic-level throttles on topic first
<span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>再次查看主题 first</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment"># kafka-topics.sh --bootstrap-server=192.168.100.100:9092 --describe --topic first</span>
Topic: first    TopicId: rTpcJQk3RmCjahRc8mAQiw PartitionCount: <span class="token number">1</span>       ReplicationFactor: <span class="token number">3</span>    Configs: <span class="token assign-left variable">segment.bytes</span><span class="token operator">=</span><span class="token number">1073741824</span>
        Topic: first    Partition: <span class="token number">0</span>    Leader: <span class="token number">2</span>       Replicas: <span class="token number">2,1</span>,3 Isr: <span class="token number">2,1</span>,3
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h4 id="退役旧节点" tabindex="-1"><a class="header-anchor" href="#退役旧节点" aria-hidden="true">#</a> 退役旧节点</h4><p>先按照退役一台节点，生成执行计划，然后按照服役时操作流程执行负载均衡，将数据需要迁移的数据均衡到其他 broker 上。</p><ul><li><p>在 192.168.100.100 创建一个需要均衡的主题，如 first</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment"># vim topics-to-move.json</span>
<span class="token punctuation">{</span>
     <span class="token string">&quot;topics&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
     	<span class="token punctuation">{</span><span class="token string">&quot;topic&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;first&quot;</span><span class="token punctuation">}</span>
     <span class="token punctuation">]</span>,
     <span class="token string">&quot;version&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>创建执行计划</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment"># kafka-reassign-partitions.sh --bootstrap-server 192.168.100.100:9092 --topics-to-move-json-file topics-to-move.json --broker-list &quot;0,1,2&quot; --generate</span>
Current partition replica assignment
<span class="token punctuation">{</span><span class="token string">&quot;version&quot;</span>:1,<span class="token string">&quot;partitions&quot;</span>:<span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">&quot;topic&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;first&quot;</span>,<span class="token string">&quot;partition&quot;</span>:0,<span class="token string">&quot;replicas&quot;</span>:<span class="token punctuation">[</span><span class="token number">2,1</span>,3<span class="token punctuation">]</span>,<span class="token string">&quot;log_dirs&quot;</span>:<span class="token punctuation">[</span><span class="token string">&quot;any&quot;</span>,<span class="token string">&quot;any&quot;</span>,<span class="token string">&quot;any&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span>

Proposed partition reassignment configuration
<span class="token punctuation">{</span><span class="token string">&quot;version&quot;</span>:1,<span class="token string">&quot;partitions&quot;</span>:<span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">&quot;topic&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;first&quot;</span>,<span class="token string">&quot;partition&quot;</span>:0,<span class="token string">&quot;replicas&quot;</span>:<span class="token punctuation">[</span><span class="token number">0,1</span>,2<span class="token punctuation">]</span>,<span class="token string">&quot;log_dirs&quot;</span>:<span class="token punctuation">[</span><span class="token string">&quot;any&quot;</span>,<span class="token string">&quot;any&quot;</span>,<span class="token string">&quot;any&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
<span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>创建副本存储计划（所有副本存储在 broker0、broker1、broker2 中）</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment"># vim increase-replication-factor.json</span>
<span class="token punctuation">{</span><span class="token string">&quot;version&quot;</span>:1,<span class="token string">&quot;partitions&quot;</span>:<span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">&quot;topic&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;first&quot;</span>,<span class="token string">&quot;partition&quot;</span>:0,<span class="token string">&quot;replicas&quot;</span>:<span class="token punctuation">[</span><span class="token number">0,1</span>,2<span class="token punctuation">]</span>,<span class="token string">&quot;log_dirs&quot;</span>:<span class="token punctuation">[</span><span class="token string">&quot;any&quot;</span>,<span class="token string">&quot;any&quot;</span>,<span class="token string">&quot;any&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>执行副本存储计划</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment"># kafka-reassign-partitions.sh --bootstrap-server 192.168.100.100:9092 --reassignment-json-file increase-replication-factor.json --execute</span>
Current partition replica assignment

<span class="token punctuation">{</span><span class="token string">&quot;version&quot;</span>:1,<span class="token string">&quot;partitions&quot;</span>:<span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">&quot;topic&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;first&quot;</span>,<span class="token string">&quot;partition&quot;</span>:0,<span class="token string">&quot;replicas&quot;</span>:<span class="token punctuation">[</span><span class="token number">2,1</span>,3<span class="token punctuation">]</span>,<span class="token string">&quot;log_dirs&quot;</span>:<span class="token punctuation">[</span><span class="token string">&quot;any&quot;</span>,<span class="token string">&quot;any&quot;</span>,<span class="token string">&quot;any&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span>

Save this to use as the --reassignment-json-file option during rollback
Successfully started partition reassignment <span class="token keyword">for</span> first-0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>验证副本存储计划</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment"># kafka-reassign-partitions.sh --bootstrap-server 192.168.100.100:9092 --reassignment-json-file increase-replication-factor.json --verify</span>
Status of partition reassignment:
Reassignment of partition first-0 is complete.

Clearing broker-level throttles on brokers <span class="token number">0,1</span>,2,3
Clearing topic-level throttles on topic first
<span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>192.168.100.130 执行停止命令</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment"># kafka-server-stop.sh</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul><h3 id="kafka-副本" tabindex="-1"><a class="header-anchor" href="#kafka-副本" aria-hidden="true">#</a> Kafka 副本</h3><h4 id="副本基本信息" tabindex="-1"><a class="header-anchor" href="#副本基本信息" aria-hidden="true">#</a> 副本基本信息</h4><ol><li><p>Kafka 副本作用：提高数据可靠性。</p></li><li><p>Kafka 默认副本 1 个，生产环境一般配置为 2 个，保证数据可靠性；太多副本会增加磁盘存储空间，增加网络上数据传输，降低效率。</p></li><li><p>Kafka 中副本分为：Leader 和 Follower。Kafka 生产者只会把数据发往 Leader， 然后 Follower 找 Leader 进行同步数据。</p></li><li><p>Kafka 分区中的所有副本统称为 AR（Assigned Repllicas）。 AR = ISR + OSR</p><p>ISR，表示和 Leader 保持同步的 Follower 集合。如果 Follower 长时间未向 Leader 发送通信请求或同步数据，则该 Follower 将被踢出 ISR。该时间阈值由 <a href="http://replica.lag.time.max.ms" target="_blank" rel="noopener noreferrer">replica.lag.time.max.ms<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 参数设定，默认 30s。Leader 发生故障之后，就会从 ISR 中选举新的 Leader。</p><p>OSR，表示 Follower 与 Leader 副本同步时，延迟过多的副本。</p></li></ol><h4 id="leader-选举流程" tabindex="-1"><a class="header-anchor" href="#leader-选举流程" aria-hidden="true">#</a> Leader 选举流程</h4><p>![Kafka Broker 整体工作流程](Kafka/Kafka Broker 整体工作流程.png)</p><p>说明：</p><blockquote><ol><li>Broker 在 Zookeeper 中注册：<code>/brokers/ids/ [0,1,2]</code></li><li>每个 Broker 上都有一个 Controller，谁先注册进 Zookeeper，谁就是具有话语权的 Controller，则这个选举出来的 Controller 会监听 brokers 节点的变化，进行辅助选举</li><li>之后进行正式的选举，选举规则：<strong>在 ISR 中存活为前提，按照 AR（Kakfa 分区中所有副本的统称）中排列在前面的优先</strong>，例如 ISR【1, 0, 2】，AR【1, 0, 2】，则 Leader 会轮询从 1, 0, 2 中产生</li><li>此时由 Controller 将节点的信息上传至 Zookeeper，其他的 Controller 从 Zookeeper 中拉取同步相关信息（为了避免 Controller 挂掉）</li><li>Producer 发送消息给 Leader，同步给副本，文件以 Log （虚拟的）的形式存在，Log 由 Segment 实现（1G），保证读取数据，Segment 使用了 .log （数据）文件和 .index （索引）文件。</li><li>假设 Broker 中的 Leader 1挂掉，Controller 会监听到节点的变化，同时获取 ISR，重新选举，选举规则同上，选出 Leader 0 ，完成后更新 Leader 和 ISR</li></ol></blockquote><p>示例：演示 Leader 的选举规则</p><p>准备 4 个 broker ，主题 example，分区 4 个，副本 4 个</p><ul><li><p>创建一个新的 topic，4 个分区，4 个副本，查看 Leader 分布情况</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment"># kafka-topics.sh --bootstrap-server=192.168.100.100:9092 --create --topic example --partitions 4 --replication-factor 4</span>
Created topic example.
<span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment"># kafka-topics.sh --bootstrap-server=192.168.100.100:9092 --describe --topic example</span>
Topic: example  TopicId: Tslw9AFKRKCK0RgdO274pA PartitionCount: <span class="token number">4</span>       ReplicationFactor: <span class="token number">4</span>    Configs: <span class="token assign-left variable">segment.bytes</span><span class="token operator">=</span><span class="token number">1073741824</span>
        Topic: example  Partition: <span class="token number">0</span>    Leader: <span class="token number">0</span>       Replicas: <span class="token number">0,2</span>,3,1       Isr: <span class="token number">0,2</span>,3,1
        Topic: example  Partition: <span class="token number">1</span>    Leader: <span class="token number">2</span>       Replicas: <span class="token number">2,3</span>,1,0       Isr: <span class="token number">2,3</span>,1,0
        Topic: example  Partition: <span class="token number">2</span>    Leader: <span class="token number">3</span>       Replicas: <span class="token number">3,1</span>,0,2       Isr: <span class="token number">3,1</span>,0,2
        Topic: example  Partition: <span class="token number">3</span>    Leader: <span class="token number">1</span>       Replicas: <span class="token number">1,0</span>,2,3       Isr: <span class="token number">1,0</span>,2,3
<span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>停止掉 192.168.100.130 （broker.id=3）的 kafka 进程，并查看 Leader 分区情况</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment"># kafka-topics.sh --bootstrap-server=192.168.100.100:9092 --describe --topic example</span>
Topic: example  TopicId: Tslw9AFKRKCK0RgdO274pA PartitionCount: <span class="token number">4</span>       ReplicationFactor: <span class="token number">4</span>    Configs: <span class="token assign-left variable">segment.bytes</span><span class="token operator">=</span><span class="token number">1073741824</span>
        Topic: example  Partition: <span class="token number">0</span>    Leader: <span class="token number">0</span>       Replicas: <span class="token number">0,2</span>,3,1       Isr: <span class="token number">0,2</span>,1
        Topic: example  Partition: <span class="token number">1</span>    Leader: <span class="token number">2</span>       Replicas: <span class="token number">2,3</span>,1,0       Isr: <span class="token number">2,1</span>,0
        Topic: example  Partition: <span class="token number">2</span>    Leader: <span class="token number">1</span>       Replicas: <span class="token number">3,1</span>,0,2       Isr: <span class="token number">1,0</span>,2
        Topic: example  Partition: <span class="token number">3</span>    Leader: <span class="token number">1</span>       Replicas: <span class="token number">1,0</span>,2,3       Isr: <span class="token number">1,0</span>,2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>停止掉 192.168.100.120 （broker.id=2）的 kafka 进程，并查看 Leader 分区情况</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment"># kafka-topics.sh --bootstrap-server=192.168.100.100:9092 --describe --topic example</span>
Topic: example  TopicId: Tslw9AFKRKCK0RgdO274pA PartitionCount: <span class="token number">4</span>       ReplicationFactor: <span class="token number">4</span>    Configs: <span class="token assign-left variable">segment.bytes</span><span class="token operator">=</span><span class="token number">1073741824</span>
        Topic: example  Partition: <span class="token number">0</span>    Leader: <span class="token number">0</span>       Replicas: <span class="token number">0,2</span>,3,1       Isr: <span class="token number">0,1</span>
        Topic: example  Partition: <span class="token number">1</span>    Leader: <span class="token number">1</span>       Replicas: <span class="token number">2,3</span>,1,0       Isr: <span class="token number">1,0</span>
        Topic: example  Partition: <span class="token number">2</span>    Leader: <span class="token number">1</span>       Replicas: <span class="token number">3,1</span>,0,2       Isr: <span class="token number">1,0</span>
        Topic: example  Partition: <span class="token number">3</span>    Leader: <span class="token number">1</span>       Replicas: <span class="token number">1,0</span>,2,3       Isr: <span class="token number">1,0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>启动 192.168.100.130 （broker.id=3）的 kafka 进程，并查看 Leader 分区情况</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment"># kafka-topics.sh --bootstrap-server=192.168.100.100:9092 --describe --topic example</span>
Topic: example  TopicId: Tslw9AFKRKCK0RgdO274pA PartitionCount: <span class="token number">4</span>       ReplicationFactor: <span class="token number">4</span>    Configs: <span class="token assign-left variable">segment.bytes</span><span class="token operator">=</span><span class="token number">1073741824</span>
        Topic: example  Partition: <span class="token number">0</span>    Leader: <span class="token number">0</span>       Replicas: <span class="token number">0,2</span>,3,1       Isr: <span class="token number">0,1</span>,3
        Topic: example  Partition: <span class="token number">1</span>    Leader: <span class="token number">1</span>       Replicas: <span class="token number">2,3</span>,1,0       Isr: <span class="token number">1,0</span>,3
        Topic: example  Partition: <span class="token number">2</span>    Leader: <span class="token number">1</span>       Replicas: <span class="token number">3,1</span>,0,2       Isr: <span class="token number">1,0</span>,3
        Topic: example  Partition: <span class="token number">3</span>    Leader: <span class="token number">1</span>       Replicas: <span class="token number">1,0</span>,2,3       Isr: <span class="token number">1,0</span>,3
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>启动 192.168.100.120 （broker.id=2）的 kafka 进程，并查看 Leader 分区情况</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment"># kafka-topics.sh --bootstrap-server=192.168.100.100:9092 --describe --topic example</span>
Topic: example  TopicId: Tslw9AFKRKCK0RgdO274pA PartitionCount: <span class="token number">4</span>       ReplicationFactor: <span class="token number">4</span>    Configs: <span class="token assign-left variable">segment.bytes</span><span class="token operator">=</span><span class="token number">1073741824</span>
        Topic: example  Partition: <span class="token number">0</span>    Leader: <span class="token number">0</span>       Replicas: <span class="token number">0,2</span>,3,1       Isr: <span class="token number">0,1</span>,3,2
        Topic: example  Partition: <span class="token number">1</span>    Leader: <span class="token number">1</span>       Replicas: <span class="token number">2,3</span>,1,0       Isr: <span class="token number">1,0</span>,3,2
        Topic: example  Partition: <span class="token number">2</span>    Leader: <span class="token number">1</span>       Replicas: <span class="token number">3,1</span>,0,2       Isr: <span class="token number">1,0</span>,3,2
        Topic: example  Partition: <span class="token number">3</span>    Leader: <span class="token number">1</span>       Replicas: <span class="token number">1,0</span>,2,3       Isr: <span class="token number">1,0</span>,3,2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>停止掉 192.168.100.110 （broker.id=1）的 kafka 进程，并查看 Leader 分区情况【注意是从前往后（从下标为 0 开始）的顺序优先为 Leader】</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment"># kafka-topics.sh --bootstrap-server=192.168.100.100:9092 --describe --topic example</span>
Topic: example  TopicId: Tslw9AFKRKCK0RgdO274pA PartitionCount: <span class="token number">4</span>       ReplicationFactor: <span class="token number">4</span>    Configs: <span class="token assign-left variable">segment.bytes</span><span class="token operator">=</span><span class="token number">1073741824</span>
        Topic: example  Partition: <span class="token number">0</span>    Leader: <span class="token number">0</span>       Replicas: <span class="token number">0,2</span>,3,1       Isr: <span class="token number">0,3</span>,2
        Topic: example  Partition: <span class="token number">1</span>    Leader: <span class="token number">2</span>       Replicas: <span class="token number">2,3</span>,1,0       Isr: <span class="token number">0,3</span>,2
        Topic: example  Partition: <span class="token number">2</span>    Leader: <span class="token number">3</span>       Replicas: <span class="token number">3,1</span>,0,2       Isr: <span class="token number">0,3</span>,2
        Topic: example  Partition: <span class="token number">3</span>    Leader: <span class="token number">0</span>       Replicas: <span class="token number">1,0</span>,2,3       Isr: <span class="token number">0,3</span>,2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h4 id="leader-和-follower-故障处理细节" tabindex="-1"><a class="header-anchor" href="#leader-和-follower-故障处理细节" aria-hidden="true">#</a> Leader 和 Follower 故障处理细节</h4><p><strong>Follower 故障</strong></p><ul><li>LEO （Log End Offset） : 每个副本的最后一个 offset，LEO 其实就是最新的 offset + 1</li><li>HW （High Watermark）: 所有副本中最小的 LEO。</li></ul><p>最初生产者和消费者只与 Leader 进行通信，Follower 从 Leader 拉取数据，HW 为所有副本中最小的 LEO</p><figure><img src="/assets/Follower故障处理细节-9788da85.png" alt="Follower故障处理细节" tabindex="0" loading="lazy"><figcaption>Follower故障处理细节</figcaption></figure><ol><li><p>Follower 故障</p><p>（1）Follower 发生故障后会被临时踢出 ISR</p><p>（2）这个期间 Leader 和 Follower 继续接收数据</p><p>（3）待该 Follower 恢复后，Follower 会读取本地磁盘记录的上次的 HW，并将 log 文件高于 HW 的部分截取掉，从 HW 开始向 Leader 进行同步</p><p>（4）等该 Follower 的 LEO 大于等于该 Partition 的 HW，即 Follower 追上 Leader 之后，就可以重新加入 ISR 了</p></li><li><p>Leader 故障</p><figure><img src="/assets/Leader故障处理细节-3d9b6111.png" alt="Leader故障处理细节" tabindex="0" loading="lazy"><figcaption>Leader故障处理细节</figcaption></figure></li></ol><h4 id="分区副本分配" tabindex="-1"><a class="header-anchor" href="#分区副本分配" aria-hidden="true">#</a> 分区副本分配</h4><p>如果 kafka 服务器只有 4 个节点，那么设置 kafka 的分区数大于服务器台数，在 kafka 底层如何分配存储副本？</p><p>示例：创建 16 分区，3 个副本</p><ol><li><p>创建一个新的 Topic，名称为 second</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment"># kafka-topics.sh --bootstrap-server=192.168.100.100:9092 --create --partitions 16 --replication-factor 3 --topic second</span>
Created topic second.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>查看分区和副本情况</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment"># kafka-topics.sh --bootstrap-server=192.168.100.100:9092 --describe --topic second</span>
Topic: second   TopicId: 9yWTWFHsSQqg52_Kzu-IkQ PartitionCount: <span class="token number">16</span>      ReplicationFactor: <span class="token number">3</span>    Configs: <span class="token assign-left variable">segment.bytes</span><span class="token operator">=</span><span class="token number">1073741824</span>
        Topic: second   Partition: <span class="token number">0</span>    Leader: <span class="token number">3</span>       Replicas: <span class="token number">3,0</span>,2 Isr: <span class="token number">3,0</span>,2
        Topic: second   Partition: <span class="token number">1</span>    Leader: <span class="token number">1</span>       Replicas: <span class="token number">1,2</span>,3 Isr: <span class="token number">1,2</span>,3
        Topic: second   Partition: <span class="token number">2</span>    Leader: <span class="token number">0</span>       Replicas: <span class="token number">0,3</span>,1 Isr: <span class="token number">0,3</span>,1
        Topic: second   Partition: <span class="token number">3</span>    Leader: <span class="token number">2</span>       Replicas: <span class="token number">2,1</span>,0 Isr: <span class="token number">2,1</span>,0
        Topic: second   Partition: <span class="token number">4</span>    Leader: <span class="token number">3</span>       Replicas: <span class="token number">3,2</span>,1 Isr: <span class="token number">3,2</span>,1
        Topic: second   Partition: <span class="token number">5</span>    Leader: <span class="token number">1</span>       Replicas: <span class="token number">1,3</span>,0 Isr: <span class="token number">1,3</span>,0
        Topic: second   Partition: <span class="token number">6</span>    Leader: <span class="token number">0</span>       Replicas: <span class="token number">0,1</span>,2 Isr: <span class="token number">0,1</span>,2
        Topic: second   Partition: <span class="token number">7</span>    Leader: <span class="token number">2</span>       Replicas: <span class="token number">2,0</span>,3 Isr: <span class="token number">2,0</span>,3
        Topic: second   Partition: <span class="token number">8</span>    Leader: <span class="token number">3</span>       Replicas: <span class="token number">3,1</span>,0 Isr: <span class="token number">3,1</span>,0
        Topic: second   Partition: <span class="token number">9</span>    Leader: <span class="token number">1</span>       Replicas: <span class="token number">1,0</span>,2 Isr: <span class="token number">1,0</span>,2
        Topic: second   Partition: <span class="token number">10</span>   Leader: <span class="token number">0</span>       Replicas: <span class="token number">0,2</span>,3 Isr: <span class="token number">0,2</span>,3
        Topic: second   Partition: <span class="token number">11</span>   Leader: <span class="token number">2</span>       Replicas: <span class="token number">2,3</span>,1 Isr: <span class="token number">2,3</span>,1
        Topic: second   Partition: <span class="token number">12</span>   Leader: <span class="token number">3</span>       Replicas: <span class="token number">3,0</span>,2 Isr: <span class="token number">3,0</span>,2
        Topic: second   Partition: <span class="token number">13</span>   Leader: <span class="token number">1</span>       Replicas: <span class="token number">1,2</span>,3 Isr: <span class="token number">1,2</span>,3
        Topic: second   Partition: <span class="token number">14</span>   Leader: <span class="token number">0</span>       Replicas: <span class="token number">0,3</span>,1 Isr: <span class="token number">0,3</span>,1
        Topic: second   Partition: <span class="token number">15</span>   Leader: <span class="token number">2</span>       Replicas: <span class="token number">2,1</span>,0 Isr: <span class="token number">2,1</span>,0
<span class="token punctuation">[</span>root@localhost kafka3.x<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h4 id="手动调整分区副本存储" tabindex="-1"><a class="header-anchor" href="#手动调整分区副本存储" aria-hidden="true">#</a> 手动调整分区副本存储</h4><h4 id="leader-partition-负载平衡" tabindex="-1"><a class="header-anchor" href="#leader-partition-负载平衡" aria-hidden="true">#</a> Leader Partition 负载平衡</h4><h4 id="增加副本因子" tabindex="-1"><a class="header-anchor" href="#增加副本因子" aria-hidden="true">#</a> 增加副本因子</h4><h3 id="文件存储" tabindex="-1"><a class="header-anchor" href="#文件存储" aria-hidden="true">#</a> 文件存储</h3><h4 id="文件存储机制" tabindex="-1"><a class="header-anchor" href="#文件存储机制" aria-hidden="true">#</a> 文件存储机制</h4><h4 id="文件清除策略" tabindex="-1"><a class="header-anchor" href="#文件清除策略" aria-hidden="true">#</a> 文件清除策略</h4><h3 id="高效读写数据" tabindex="-1"><a class="header-anchor" href="#高效读写数据" aria-hidden="true">#</a> 高效读写数据</h3><h2 id="kafka-消费者" tabindex="-1"><a class="header-anchor" href="#kafka-消费者" aria-hidden="true">#</a> Kafka 消费者</h2><h3 id="kafka-消费方式" tabindex="-1"><a class="header-anchor" href="#kafka-消费方式" aria-hidden="true">#</a> Kafka 消费方式</h3><ul><li><p>pull（拉）模式</p><p>Consumer 采用从 broker 中主动拉取数据， <strong>Kafka 采用这种方式</strong></p><p><strong>pull 模式不足之处是，如果 Kafka 没有数 据，消费者可能会陷入循环中，一直返回空数据。</strong></p></li><li><p>push（推）模式</p><p>Kafka 没有采用这种方式，因为由 broker 决定消息发送速率，很难适应所有消费者的消费速率。例如推送的速度是 50M/s， Consumer1、Consumer2 就来不及处理消息</p></li></ul><figure><img src="/assets/Kafka消费方式-9330205e.png" alt="Kafka消费方式" tabindex="0" loading="lazy"><figcaption>Kafka消费方式</figcaption></figure><h3 id="kafka-消费者工作流程" tabindex="-1"><a class="header-anchor" href="#kafka-消费者工作流程" aria-hidden="true">#</a> Kafka 消费者工作流程</h3><h4 id="消费者总体工作流程" tabindex="-1"><a class="header-anchor" href="#消费者总体工作流程" aria-hidden="true">#</a> 消费者总体工作流程</h4><figure><img src="/assets/消费者总体工作流程-eb52478f.png" alt="消费者总体工作流程" tabindex="0" loading="lazy"><figcaption>消费者总体工作流程</figcaption></figure><p>说明：</p><ol><li><p>一个消费者可以消费多个分区的数据，多个消费者可以消费同一个分区的数据</p></li><li><p>每个分区的数据只能由消费者组中一个消费者消费，防止重复消费等问题</p></li><li><p>每个消费者的消费进度 offset 由消费者提交到系统主题保存，保存在一个主题中。 kafka 0.9 版本之前会将消费进度存放在 Zookeeper 中，会造成大量的网络交互</p></li></ol><h4 id="消费者组原理" tabindex="-1"><a class="header-anchor" href="#消费者组原理" aria-hidden="true">#</a> 消费者组原理</h4><p>Consumer Group（CG）：消费者组，由多个 Consumer 组成。形成一个消费者组的条件，是所有消费者的 groupid 相同。</p><ul><li>消费者组内每个消费者负责消费不同分区的数据，一个分区只能由一个组内消费者消费。</li><li>消费者组之间互不影响。所有的消费者都属于某个消费者组，即消费者组是逻辑上的一个订阅者。</li></ul><figure><img src="/assets/消费者组原理-a356b2d0.png" alt="消费者组原理" tabindex="0" loading="lazy"><figcaption>消费者组原理</figcaption></figure><p>说明：</p><ol><li>如果只有一个消费者，则由该消费者消费所有分区数据</li><li>如果消费者数量不小于分区数量，则</li><li>如果消费者数量等于分区数量，则一对一消费</li><li>如果向消费组中添加更多的消费者，超过主题分区数量，则有一部分消费者就会闲置，不会接收任何消息</li><li>消费者组之间互不影响。所有的消费者都属于某个消费者组，即消费者组是逻辑上的一个订阅者</li></ol><h4 id="消费者组初始化流程" tabindex="-1"><a class="header-anchor" href="#消费者组初始化流程" aria-hidden="true">#</a> 消费者组初始化流程</h4><p>coordinator：辅助实现消费者组的初始化和分区的分配。</p><p>coordinator 节点选择 = groupid 的 hashcode 值 % 50（ <code>__consumer_offsets的分区数量</code>） 例如： groupid 的 hashcode 值 = 1，1% 50 = 1，那么<code>__consumer_offsets </code>主题的1号分区，在哪个 broker 上，就选择这个节点的 coordinator 作为这个消费者组的老大。</p><p>消费者组下的所有的消费者提交 offset 的时候就往这个分区去提交 offset。</p><figure><img src="/assets/消费者组初始化流程-330514ae.png" alt="消费者组初始化流程" tabindex="0" loading="lazy"><figcaption>消费者组初始化流程</figcaption></figure><h2 id="kafka-eagle-监控" tabindex="-1"><a class="header-anchor" href="#kafka-eagle-监控" aria-hidden="true">#</a> Kafka-Eagle 监控</h2><p>Kafka-Eagle 框架可以监控 Kafka 集群的整体运行情况，在生产环境中经常使用</p><h3 id="mysql-环境准备" tabindex="-1"><a class="header-anchor" href="#mysql-环境准备" aria-hidden="true">#</a> MySQL 环境准备</h3><p>Kafka-Eagle 的安装依赖于 MySQL，MySQL 主要用来存储可视化展示的数据。</p><ul><li><p>下载并解压相应安装包</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost mysql5.7<span class="token punctuation">]</span><span class="token comment"># pwd</span>
/opt/mysql5.7
<span class="token punctuation">[</span>root@localhost mysql5.7<span class="token punctuation">]</span><span class="token comment"># ll</span>
总用量 <span class="token number">185388</span>
-rw-r--r--. <span class="token number">1</span> root root    <span class="token number">277604</span> <span class="token number">6</span>月   <span class="token number">9</span> <span class="token number">13</span>:32 mysql-community-common-5.7.16-1.el7.x86_64.rpm
-rw-r--r--. <span class="token number">1</span> root root   <span class="token number">2237116</span> <span class="token number">6</span>月   <span class="token number">9</span> <span class="token number">13</span>:32 mysql-community-libs-5.7.16-1.el7.x86_64.rpm
-rw-r--r--. <span class="token number">1</span> root root   <span class="token number">2112700</span> <span class="token number">6</span>月   <span class="token number">9</span> <span class="token number">13</span>:32 mysql-community-libs-compat-5.7.16-1.el7.x86_64.rpm
-rw-r--r--. <span class="token number">1</span> root root  <span class="token number">25034716</span> <span class="token number">6</span>月   <span class="token number">9</span> <span class="token number">13</span>:32 mysql-community-client-5.7.16-1.el7.x86_64.rpm
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">159295840</span> <span class="token number">6</span>月   <span class="token number">9</span> <span class="token number">13</span>:32 mysql-community-server-5.7.16-1.el7.x86_64.rpm
-rw-r--r--. <span class="token number">1</span> root root    <span class="token number">872303</span> <span class="token number">6</span>月   <span class="token number">9</span> <span class="token number">13</span>:32 mysql-connector-java-5.1.27-bin.jar
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>卸载自带的 mysql-lib</p><ul><li><p>如果是虚拟机：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost mysql5.7<span class="token punctuation">]</span><span class="token comment"># rpm -qa | grep -i -E mysql\|mariadb | xargs -n1 sudo rpm -e --nodeps</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>如果是阿里云服务器（安装的是 Linux 最小版）</p><p>卸载 MySQL 依赖：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost mysql5.7<span class="token punctuation">]</span><span class="token comment"># yum remove mysql-libs</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>下载编译相关依赖并安装：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost mysql5.7<span class="token punctuation">]</span><span class="token comment"># yum install libaio</span>
<span class="token punctuation">[</span>root@localhost mysql5.7<span class="token punctuation">]</span><span class="token comment"># yum install autoconf</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li><li><p>安装依赖</p><ul><li><p>安装 MySQL 依赖：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost mysql5.7<span class="token punctuation">]</span><span class="token comment"># rpm -ivh mysql-community-common-5.7.16-1.el7.x86_64.rpm</span>
<span class="token punctuation">[</span>root@localhost mysql5.7<span class="token punctuation">]</span><span class="token comment"># rpm -ivh mysql-community-libs-5.7.16-1.el7.x86_64.rpm</span>
<span class="token punctuation">[</span>root@localhost mysql5.7<span class="token punctuation">]</span><span class="token comment"># rpm -ivh mysql-community-libs-compat-5.7.16-1.el7.x86_64.rpm</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>安装 MySQL-Client</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost mysql5.7<span class="token punctuation">]</span><span class="token comment"># rpm -ivh mysql-community-client-5.7.16-1.el7.x86_64.rpm</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>安装 MySQL-Server</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost mysql5.7<span class="token punctuation">]</span><span class="token comment"># rpm -ivh mysql-community-server-5.7.16-1.el7.x86_64.rpm</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul></li><li><p>启动 MySQL</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost mysql5.7<span class="token punctuation">]</span><span class="token comment"># systemctl start mysqld</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>查看 MySQL 密码</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost mysql5.7<span class="token punctuation">]</span><span class="token comment"># cat /var/log/mysqld.log | grep password</span>
<span class="token number">2023</span>-06-09T05:53:49.161800Z <span class="token number">1</span> <span class="token punctuation">[</span>Note<span class="token punctuation">]</span> A temporary password is generated <span class="token keyword">for</span> root@localhost: tQlEHZzjF5_c
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>配置密码</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 使用上一步查询到的密码（带单引号）登录 MySQL</span>
<span class="token punctuation">[</span>root@localhost mysql5.7<span class="token punctuation">]</span><span class="token comment"># mysql -uroot -p&#39;tQlEHZzjF5_c&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>更改密码策略</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysql<span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> global <span class="token assign-left variable">validate_password_length</span><span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> global <span class="token assign-left variable">validate_password_policy</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>重新设置密码</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysql<span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> <span class="token assign-left variable">password</span><span class="token operator">=</span>password<span class="token punctuation">(</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>设置 MySQL 远程连接</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> user,host from user<span class="token punctuation">;</span>
+-----------+-----------+
<span class="token operator">|</span> user      <span class="token operator">|</span> <span class="token function">host</span>      <span class="token operator">|</span>
+-----------+-----------+
<span class="token operator">|</span> mysql.sys <span class="token operator">|</span> localhost <span class="token operator">|</span>
<span class="token operator">|</span> root      <span class="token operator">|</span> localhost <span class="token operator">|</span>
+-----------+-----------+
<span class="token number">2</span> rows <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
mysql<span class="token operator">&gt;</span> update user <span class="token builtin class-name">set</span> <span class="token function">host</span> <span class="token operator">=</span> <span class="token string">&#39;%&#39;</span> where user <span class="token operator">=</span> <span class="token string">&#39;root&#39;</span><span class="token punctuation">;</span>
Query OK, <span class="token number">1</span> row affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
Rows matched: <span class="token number">1</span>  Changed: <span class="token number">1</span>  Warnings: <span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>刷新权限并退出</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysql<span class="token operator">&gt;</span> flush privileges<span class="token punctuation">;</span>
Query OK, <span class="token number">0</span> rows affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
mysql<span class="token operator">&gt;</span> quit
Bye
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h2 id="kafka-kraft-模式" tabindex="-1"><a class="header-anchor" href="#kafka-kraft-模式" aria-hidden="true">#</a> Kafka-Kraft 模式</h2><h1 id="kafka-集成" tabindex="-1"><a class="header-anchor" href="#kafka-集成" aria-hidden="true">#</a> Kafka 集成</h1><h2 id="集成-flume" tabindex="-1"><a class="header-anchor" href="#集成-flume" aria-hidden="true">#</a> 集成 Flume</h2><h2 id="集成-flink" tabindex="-1"><a class="header-anchor" href="#集成-flink" aria-hidden="true">#</a> 集成 Flink</h2><h2 id="集成-springboot" tabindex="-1"><a class="header-anchor" href="#集成-springboot" aria-hidden="true">#</a> 集成 SpringBoot</h2><h2 id="集成-spark" tabindex="-1"><a class="header-anchor" href="#集成-spark" aria-hidden="true">#</a> 集成 Spark</h2><h1 id="源码解析" tabindex="-1"><a class="header-anchor" href="#源码解析" aria-hidden="true">#</a> 源码解析</h1><h2 id="环境准备" tabindex="-1"><a class="header-anchor" href="#环境准备" aria-hidden="true">#</a> 环境准备</h2><h2 id="生产者源码" tabindex="-1"><a class="header-anchor" href="#生产者源码" aria-hidden="true">#</a> 生产者源码</h2><h2 id="消费者源码" tabindex="-1"><a class="header-anchor" href="#消费者源码" aria-hidden="true">#</a> 消费者源码</h2><h2 id="服务器源码" tabindex="-1"><a class="header-anchor" href="#服务器源码" aria-hidden="true">#</a> 服务器源码</h2><h1 id="生产调优" tabindex="-1"><a class="header-anchor" href="#生产调优" aria-hidden="true">#</a> 生产调优</h1><h2 id="kafka-硬件配置选择" tabindex="-1"><a class="header-anchor" href="#kafka-硬件配置选择" aria-hidden="true">#</a> Kafka 硬件配置选择</h2><h2 id="kafka-生产者-1" tabindex="-1"><a class="header-anchor" href="#kafka-生产者-1" aria-hidden="true">#</a> Kafka 生产者</h2><h2 id="kafka-broker-1" tabindex="-1"><a class="header-anchor" href="#kafka-broker-1" aria-hidden="true">#</a> kafka Broker</h2><h2 id="kafka-消费者-1" tabindex="-1"><a class="header-anchor" href="#kafka-消费者-1" aria-hidden="true">#</a> Kafka 消费者</h2><h2 id="kafka-总体" tabindex="-1"><a class="header-anchor" href="#kafka-总体" aria-hidden="true">#</a> kafka 总体</h2></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/vuepress-theme-hope/vuepress-theme-hope/edit/main/src/Java/Kafka.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page on GitHub" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->Edit this page on GitHub<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><!----><!----></div></footer><nav class="vp-page-nav"><!----><a class="vp-link nav-link next" href="/Java/JavaSE.html"><div class="hint">Next<span class="arrow end"></span></div><div class="link">JavaSE<!----></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><!----><div class="vp-copyright">Copyright © 2023 MineTing</div></footer></div><!--]--><!--]--></div>
    <script type="module" src="/assets/app-ae2ce5af.js" defer></script>
  </body>
</html>
